{"mappings":"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I,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAC9I,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,G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AI,GACpJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAChJ,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAE1IpC,EAAKqC,YAAc,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAEjIrC,EAAKsC,UAAY,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,MACjJ,OAKFtC,EAAKuC,OAAS,SAASC,GACtB,OAAQ9kC,EAAS,IAAMqiC,EAAWyC,GAAQzC,EAAW,KAAOriC,IAAW,KAIxEsiC,EAAKyC,YAAc,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAGzGzC,EAAK0C,YAAc,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAGnH1C,EAAK2C,aAAe,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE5E3C,EAAK4C,SAAW,CAAE,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,IAahFf,EAAWgB,aAAe,CAAE,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EACvJ,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAChJ,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EACjJ,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAC7I,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAC/I,EAAG,IAAK,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EAAG,IAAK,EAC/I,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAC7I,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAChJ,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EACjJ,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAC7I,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAC/I,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAC7I,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EACjJ,IAAK,EAAG,IAAK,EAAG,GAAI,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,IAAK,EAAG,EAAG,EAAG,GAAI,EACjJ,GAAI,EA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G,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAC9I,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAC9I,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAC9I,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAC/I,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAC/I,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EACjJ,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAC/I,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAC7I,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAC/I,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAC7I,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAChJ,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAC/I,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAC/I,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAC/I,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAC9I,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAC9I,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAC/I,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAChJ,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EACjJ,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EACjJ,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAChJ,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EACjJ,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EACjJ,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAC/I,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EACjJ,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EACjJ,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,EAAG,EAAG,EACjJ,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EACjJ,IAAK,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,IAAK,EAAG,EAAG,GAAI,EAAG,EAAG,IAAK,GAAI,EAAG,GAAI,EAAG,EAAG,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","sources":["node_modules/os-browserify/browser.js","node_modules/tweakpane/dist/tweakpane.js","node_modules/events/events.js","node_modules/simple-dropzone/node_modules/zip-js-esm/src/deflate.js","node_modules/simple-dropzone/node_modules/zip-js-esm/src/inflate.js","node_modules/simple-dropzone/node_modules/zip-js-esm/src/zip.js","node_modules/simple-dropzone/lib/zip-fs.js","node_modules/simple-dropzone/index.js","packages/viewer/three_renderer.ts","packages/viewer/scene_loader.ts","node_modules/three/examples/jsm/loaders/KTX2Loader.js","node_modules/three/examples/jsm/utils/WorkerPool.js","node_modules/property-graph/src/event-dispatcher.ts","node_modules/property-graph/src/graph-edge.ts","node_modules/property-graph/src/graph.ts","node_modules/property-graph/src/utils.ts","node_modules/property-graph/src/graph-node.ts","node_modules/gl-matrix/esm/common.js","node_modules/gl-matrix/esm/vec3.js","node_modules/gl-matrix/esm/mat4.js","node_modules/buffer/index.js","node_modules/base64-js/index.js","node_modules/ieee754/index.js","node_modules/@gltf-transform/core/src/constants.ts","node_modules/@gltf-transform/core/src/utils/bounds.ts","node_modules/@gltf-transform/core/src/utils/buffer-utils.ts","node_modules/@gltf-transform/core/src/utils/color-utils.ts","node_modules/@gltf-transform/core/src/utils/image-utils.ts","node_modules/@gltf-transform/core/src/utils/file-utils.ts","node_modules/@gltf-transform/core/src/utils/is-plain-object.ts","node_modules/@gltf-transform/core/src/utils/logger.ts","node_modules/@gltf-transform/core/src/utils/math-utils.ts","node_modules/@gltf-transform/core/src/utils/property-utils.ts","node_modules/@gltf-transform/core/src/utils/uuid.ts","node_modules/@gltf-transform/core/src/utils/http-utils.ts","node_modules/@gltf-transform/core/src/properties/property.ts","node_modules/@gltf-transform/core/src/properties/extensible-property.ts","node_modules/@gltf-transform/core/src/properties/accessor.ts","node_modules/@gltf-transform/core/src/properties/animation.ts","node_modules/@gltf-transform/core/src/properties/animation-channel.ts","node_modules/@gltf-transform/core/src/properties/animation-sampler.ts","node_modules/@gltf-transform/core/src/properties/buffer.ts","node_modules/@gltf-transform/core/src/properties/camera.ts","node_modules/@gltf-transform/core/src/properties/extension-property.ts","node_modules/@gltf-transform/core/src/properties/texture-info.ts","node_modules/@gltf-transform/core/src/properties/material.ts","node_modules/@gltf-transform/core/src/properties/mesh.ts","node_modules/@gltf-transform/core/src/properties/node.ts","node_modules/@gltf-transform/core/src/properties/primitive.ts","node_modules/@gltf-transform/core/src/properties/primitive-target.ts","node_modules/@gltf-transform/core/src/properties/scene.ts","node_modules/@gltf-transform/core/src/properties/skin.ts","node_modules/@gltf-transform/core/src/properties/texture.ts","node_modules/@gltf-transform/core/src/properties/root.ts","node_modules/@gltf-transform/core/src/document.ts","node_modules/@gltf-transform/core/src/extension.ts","node_modules/@gltf-transform/core/src/io/reader-context.ts","node_modules/@gltf-transform/core/src/io/reader.ts","node_modules/@gltf-transform/core/src/io/writer-context.ts","node_modules/@gltf-transform/core/src/io/writer.ts","node_modules/@gltf-transform/core/src/io/platform-io.ts","node_modules/@gltf-transform/core/src/io/deno-io.ts","node_modules/@gltf-transform/core/src/io/web-io.ts","node_modules/ktx-parse/src/constants.ts","node_modules/ktx-parse/src/enums.ts","node_modules/ktx-parse/src/container.ts","node_modules/ktx-parse/src/buffer-reader.ts","node_modules/ktx-parse/src/util.ts","node_modules/ktx-parse/src/read.ts","node_modules/@gltf-transform/extensions/src/ext-mesh-gpu-instancing/instanced-mesh.ts","node_modules/@gltf-transform/extensions/src/constants.ts","node_modules/@gltf-transform/extensions/src/ext-mesh-gpu-instancing/mesh-gpu-instancing.ts","node_modules/@gltf-transform/extensions/src/ext-meshopt-compression/constants.ts","node_modules/@gltf-transform/extensions/src/ext-meshopt-compression/encoder.ts","node_modules/@gltf-transform/extensions/src/ext-meshopt-compression/meshopt-compression.ts","node_modules/@gltf-transform/extensions/src/ext-meshopt-compression/decoder.ts","node_modules/@gltf-transform/extensions/src/ext-texture-webp/texture-webp.ts","node_modules/@gltf-transform/extensions/src/khr-draco-mesh-compression/decoder.ts","node_modules/@gltf-transform/extensions/src/khr-draco-mesh-compression/encoder.ts","node_modules/@gltf-transform/extensions/src/khr-draco-mesh-compression/draco-mesh-compression.ts","node_modules/@gltf-transform/extensions/src/khr-lights-punctual/light.ts","node_modules/@gltf-transform/extensions/src/khr-lights-punctual/lights-punctual.ts","node_modules/@gltf-transform/extensions/src/khr-materials-anisotropy/anisotropy.ts","node_modules/@gltf-transform/extensions/src/khr-materials-anisotropy/materials-anisotropy.ts","node_modules/@gltf-transform/extensions/src/khr-materials-clearcoat/clearcoat.ts","node_modules/@gltf-transform/extensions/src/khr-materials-clearcoat/materials-clearcoat.ts","node_modules/@gltf-transform/extensions/src/khr-materials-emissive-strength/emissive-strength.ts","node_modules/@gltf-transform/extensions/src/khr-materials-emissive-strength/materials-emissive-strength.ts","node_modules/@gltf-transform/extensions/src/khr-materials-ior/ior.ts","node_modules/@gltf-transform/extensions/src/khr-materials-ior/materials-ior.ts","node_modules/@gltf-transform/extensions/src/khr-materials-iridescence/iridescence.ts","node_modules/@gltf-transform/extensions/src/khr-materials-iridescence/materials-iridescence.ts","node_modules/@gltf-transform/extensions/src/khr-materials-pbr-specular-glossiness/pbr-specular-glossiness.ts","node_modules/@gltf-transform/extensions/src/khr-materials-pbr-specular-glossiness/materials-pbr-specular-glossiness.ts","node_modules/@gltf-transform/extensions/src/khr-materials-sheen/sheen.ts","node_modules/@gltf-transform/extensions/src/khr-materials-sheen/materials-sheen.ts","node_modules/@gltf-transform/extensions/src/khr-materials-specular/specular.ts","node_modules/@gltf-transform/extensions/src/khr-materials-specular/materials-specular.ts","node_modules/@gltf-transform/extensions/src/khr-materials-translucency/translucency.ts","node_modules/@gltf-transform/extensions/src/khr-materials-translucency/materials-translucency.ts","node_modules/@gltf-transform/extensions/src/khr-materials-transmission/transmission.ts","node_modules/@gltf-transform/extensions/src/khr-materials-transmission/materials-transmission.ts","node_modules/@gltf-transform/extensions/src/khr-materials-unlit/unlit.ts","node_modules/@gltf-transform/extensions/src/khr-materials-unlit/materials-unlit.ts","node_modules/@gltf-transform/extensions/src/khr-materials-variants/mapping.ts","node_modules/@gltf-transform/extensions/src/khr-materials-variants/mapping-list.ts","node_modules/@gltf-transform/extensions/src/khr-materials-variants/variant.ts","node_modules/@gltf-transform/extensions/src/khr-materials-variants/materials-variants.ts","node_modules/@gltf-transform/extensions/src/khr-materials-volume/volume.ts","node_modules/@gltf-transform/extensions/src/khr-materials-volume/materials-volume.ts","node_modules/@gltf-transform/extensions/src/khr-mesh-quantization/mesh-quantization.ts","node_modules/@gltf-transform/extensions/src/khr-texture-basisu/texture-basisu.ts","node_modules/@gltf-transform/extensions/src/khr-texture-transform/transform.ts","node_modules/@gltf-transform/extensions/src/khr-texture-transform/texture-transform.ts","node_modules/@gltf-transform/extensions/src/khr-xmp-json-ld/packet.ts","node_modules/@gltf-transform/extensions/src/khr-xmp-json-ld/xmp.ts","node_modules/@gltf-transform/extensions/src/extensions.ts","node_modules/iota-array/iota.js","node_modules/is-buffer/index.js","node_modules/ndarray/ndarray.js","node_modules/cwise-compiler/lib/compile.js","node_modules/cwise-compiler/compiler.js","node_modules/uniq/uniq.js","node_modules/cwise-compiler/lib/thunk.js","node_modules/ndarray-ops/ndarray-ops.js","node_modules/ndarray-lanczos/src/index.ts","node_modules/@gltf-transform/functions/src/utils.ts","node_modules/ndarray-lanczos/vendor/filters.ts","node_modules/@gltf-transform/functions/src/dedup.ts","node_modules/@gltf-transform/functions/src/dequantize.ts","node_modules/@gltf-transform/functions/src/prune.ts","node_modules/@gltf-transform/functions/src/quantize.ts","node_modules/@gltf-transform/functions/src/squoosh.ts","node_modules/@gltf-transform/functions/src/texture-resize.ts","node_modules/@gltf-transform/functions/src/unlit.ts","node_modules/@gltf-transform/functions/src/weld.ts","node_modules/meshoptimizer/meshopt_encoder.module.js","node_modules/meshoptimizer/meshopt_decoder.module.js","packages/viewer/main.ts","packages/examples/asset_index.ts","packages/examples/index.ts"],"sourcesContent":["exports.endianness = function () { return 'LE' };\n\nexports.hostname = function () {\n    if (typeof location !== 'undefined') {\n        return location.hostname\n    }\n    else return '';\n};\n\nexports.loadavg = function () { return [] };\n\nexports.uptime = function () { return 0 };\n\nexports.freemem = function () {\n    return Number.MAX_VALUE;\n};\n\nexports.totalmem = function () {\n    return Number.MAX_VALUE;\n};\n\nexports.cpus = function () { return [] };\n\nexports.type = function () { return 'Browser' };\n\nexports.release = function () {\n    if (typeof navigator !== 'undefined') {\n        return navigator.appVersion;\n    }\n    return '';\n};\n\nexports.networkInterfaces\n= exports.getNetworkInterfaces\n= function () { return {} };\n\nexports.arch = function () { return 'javascript' };\n\nexports.platform = function () { return 'browser' };\n\nexports.tmpdir = exports.tmpDir = function () {\n    return '/tmp';\n};\n\nexports.EOL = '\\n';\n\nexports.homedir = function () {\n\treturn '/'\n};\n","/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.Tweakpane = {}));\n})(this, (function (exports) { 'use strict';\n\n    /***\n     * A simple semantic versioning perser.\n     */\n    class Semver {\n        /**\n         * @hidden\n         */\n        constructor(text) {\n            const [core, prerelease] = text.split('-');\n            const coreComps = core.split('.');\n            this.major = parseInt(coreComps[0], 10);\n            this.minor = parseInt(coreComps[1], 10);\n            this.patch = parseInt(coreComps[2], 10);\n            this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n        }\n        toString() {\n            const core = [this.major, this.minor, this.patch].join('.');\n            return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n        }\n    }\n\n    class BladeApi {\n        constructor(controller) {\n            this.controller_ = controller;\n        }\n        get disabled() {\n            return this.controller_.viewProps.get('disabled');\n        }\n        set disabled(disabled) {\n            this.controller_.viewProps.set('disabled', disabled);\n        }\n        get hidden() {\n            return this.controller_.viewProps.get('hidden');\n        }\n        set hidden(hidden) {\n            this.controller_.viewProps.set('hidden', hidden);\n        }\n        dispose() {\n            this.controller_.viewProps.set('disposed', true);\n        }\n    }\n\n    class TpEvent {\n        constructor(target) {\n            this.target = target;\n        }\n    }\n    class TpChangeEvent extends TpEvent {\n        constructor(target, value, presetKey, last) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n            this.last = last !== null && last !== void 0 ? last : true;\n        }\n    }\n    class TpUpdateEvent extends TpEvent {\n        constructor(target, value, presetKey) {\n            super(target);\n            this.value = value;\n            this.presetKey = presetKey;\n        }\n    }\n    class TpFoldEvent extends TpEvent {\n        constructor(target, expanded) {\n            super(target);\n            this.expanded = expanded;\n        }\n    }\n\n    function forceCast(v) {\n        return v;\n    }\n    function isEmpty(value) {\n        return value === null || value === undefined;\n    }\n    function deepEqualsArray(a1, a2) {\n        if (a1.length !== a2.length) {\n            return false;\n        }\n        for (let i = 0; i < a1.length; i++) {\n            if (a1[i] !== a2[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    const CREATE_MESSAGE_MAP = {\n        alreadydisposed: () => 'View has been already disposed',\n        invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n        nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n        nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n        notbindable: () => `Value is not bindable`,\n        propertynotfound: (context) => `Property '${context.name}' not found`,\n        shouldneverhappen: () => 'This error should never happen',\n    };\n    class TpError {\n        constructor(config) {\n            var _a;\n            this.message =\n                (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n            this.name = this.constructor.name;\n            this.stack = new Error(this.message).stack;\n            this.type = config.type;\n        }\n        static alreadyDisposed() {\n            return new TpError({ type: 'alreadydisposed' });\n        }\n        static notBindable() {\n            return new TpError({\n                type: 'notbindable',\n            });\n        }\n        static propertyNotFound(name) {\n            return new TpError({\n                type: 'propertynotfound',\n                context: {\n                    name: name,\n                },\n            });\n        }\n        static shouldNeverHappen() {\n            return new TpError({ type: 'shouldneverhappen' });\n        }\n    }\n\n    class BindingTarget {\n        constructor(obj, key, opt_id) {\n            this.obj_ = obj;\n            this.key_ = key;\n            this.presetKey_ = opt_id !== null && opt_id !== void 0 ? opt_id : key;\n        }\n        static isBindable(obj) {\n            if (obj === null) {\n                return false;\n            }\n            if (typeof obj !== 'object') {\n                return false;\n            }\n            return true;\n        }\n        get key() {\n            return this.key_;\n        }\n        get presetKey() {\n            return this.presetKey_;\n        }\n        read() {\n            return this.obj_[this.key_];\n        }\n        write(value) {\n            this.obj_[this.key_] = value;\n        }\n        writeProperty(name, value) {\n            const valueObj = this.read();\n            if (!BindingTarget.isBindable(valueObj)) {\n                throw TpError.notBindable();\n            }\n            if (!(name in valueObj)) {\n                throw TpError.propertyNotFound(name);\n            }\n            valueObj[name] = value;\n        }\n    }\n\n    class ButtonApi extends BladeApi {\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.valueController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.valueController.props.set('title', title);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            const emitter = this.controller_.valueController.emitter;\n            emitter.on(eventName, () => {\n                bh(new TpEvent(this));\n            });\n            return this;\n        }\n    }\n\n    class Emitter {\n        constructor() {\n            this.observers_ = {};\n        }\n        on(eventName, handler) {\n            let observers = this.observers_[eventName];\n            if (!observers) {\n                observers = this.observers_[eventName] = [];\n            }\n            observers.push({\n                handler: handler,\n            });\n            return this;\n        }\n        off(eventName, handler) {\n            const observers = this.observers_[eventName];\n            if (observers) {\n                this.observers_[eventName] = observers.filter((observer) => {\n                    return observer.handler !== handler;\n                });\n            }\n            return this;\n        }\n        emit(eventName, event) {\n            const observers = this.observers_[eventName];\n            if (!observers) {\n                return;\n            }\n            observers.forEach((observer) => {\n                observer.handler(event);\n            });\n        }\n    }\n\n    const PREFIX = 'tp';\n    function ClassName(viewName) {\n        const fn = (opt_elementName, opt_modifier) => {\n            return [\n                PREFIX,\n                '-',\n                viewName,\n                'v',\n                opt_elementName ? `_${opt_elementName}` : '',\n                opt_modifier ? `-${opt_modifier}` : '',\n            ].join('');\n        };\n        return fn;\n    }\n\n    function compose(h1, h2) {\n        return (input) => h2(h1(input));\n    }\n    function extractValue(ev) {\n        return ev.rawValue;\n    }\n    function bindValue(value, applyValue) {\n        value.emitter.on('change', compose(extractValue, applyValue));\n        applyValue(value.rawValue);\n    }\n    function bindValueMap(valueMap, key, applyValue) {\n        bindValue(valueMap.value(key), applyValue);\n    }\n\n    function applyClass(elem, className, active) {\n        if (active) {\n            elem.classList.add(className);\n        }\n        else {\n            elem.classList.remove(className);\n        }\n    }\n    function valueToClassName(elem, className) {\n        return (value) => {\n            applyClass(elem, className, value);\n        };\n    }\n    function bindValueToTextContent(value, elem) {\n        bindValue(value, (text) => {\n            elem.textContent = text !== null && text !== void 0 ? text : '';\n        });\n    }\n\n    const className$q = ClassName('btn');\n    class ButtonView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$q());\n            config.viewProps.bindClassModifiers(this.element);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$q('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$q('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n        }\n    }\n\n    class ButtonController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new ButtonView(doc, {\n                props: this.props,\n                viewProps: this.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class BoundValue {\n        constructor(initialValue, config) {\n            var _a;\n            this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n            this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n            this.emitter = new Emitter();\n            this.rawValue_ = initialValue;\n        }\n        get constraint() {\n            return this.constraint_;\n        }\n        get rawValue() {\n            return this.rawValue_;\n        }\n        set rawValue(rawValue) {\n            this.setRawValue(rawValue, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(rawValue, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            const constrainedValue = this.constraint_\n                ? this.constraint_.constrain(rawValue)\n                : rawValue;\n            const changed = !this.equals_(this.rawValue_, constrainedValue);\n            if (!changed && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.rawValue_ = constrainedValue;\n            this.emitter.emit('change', {\n                options: opts,\n                rawValue: constrainedValue,\n                sender: this,\n            });\n        }\n    }\n\n    class PrimitiveValue {\n        constructor(initialValue) {\n            this.emitter = new Emitter();\n            this.value_ = initialValue;\n        }\n        get rawValue() {\n            return this.value_;\n        }\n        set rawValue(value) {\n            this.setRawValue(value, {\n                forceEmit: false,\n                last: true,\n            });\n        }\n        setRawValue(value, options) {\n            const opts = options !== null && options !== void 0 ? options : {\n                forceEmit: false,\n                last: true,\n            };\n            if (this.value_ === value && !opts.forceEmit) {\n                return;\n            }\n            this.emitter.emit('beforechange', {\n                sender: this,\n            });\n            this.value_ = value;\n            this.emitter.emit('change', {\n                options: opts,\n                rawValue: this.value_,\n                sender: this,\n            });\n        }\n    }\n\n    function createValue(initialValue, config) {\n        const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n        const equals = config === null || config === void 0 ? void 0 : config.equals;\n        if (!constraint && !equals) {\n            return new PrimitiveValue(initialValue);\n        }\n        return new BoundValue(initialValue, config);\n    }\n\n    class ValueMap {\n        constructor(valueMap) {\n            this.emitter = new Emitter();\n            this.valMap_ = valueMap;\n            for (const key in this.valMap_) {\n                const v = this.valMap_[key];\n                v.emitter.on('change', () => {\n                    this.emitter.emit('change', {\n                        key: key,\n                        sender: this,\n                    });\n                });\n            }\n        }\n        static createCore(initialValue) {\n            const keys = Object.keys(initialValue);\n            return keys.reduce((o, key) => {\n                return Object.assign(o, {\n                    [key]: createValue(initialValue[key]),\n                });\n            }, {});\n        }\n        static fromObject(initialValue) {\n            const core = this.createCore(initialValue);\n            return new ValueMap(core);\n        }\n        get(key) {\n            return this.valMap_[key].rawValue;\n        }\n        set(key, value) {\n            this.valMap_[key].rawValue = value;\n        }\n        value(key) {\n            return this.valMap_[key];\n        }\n    }\n\n    function parseObject(value, keyToParserMap) {\n        const keys = Object.keys(keyToParserMap);\n        const result = keys.reduce((tmp, key) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const parser = keyToParserMap[key];\n            const result = parser(value[key]);\n            return result.succeeded\n                ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n        }, {});\n        return forceCast(result);\n    }\n    function parseArray(value, parseItem) {\n        return value.reduce((tmp, item) => {\n            if (tmp === undefined) {\n                return undefined;\n            }\n            const result = parseItem(item);\n            if (!result.succeeded || result.value === undefined) {\n                return undefined;\n            }\n            return [...tmp, result.value];\n        }, []);\n    }\n    function isObject(value) {\n        if (value === null) {\n            return false;\n        }\n        return typeof value === 'object';\n    }\n    function createParamsParserBuilder(parse) {\n        return (optional) => (v) => {\n            if (!optional && v === undefined) {\n                return {\n                    succeeded: false,\n                    value: undefined,\n                };\n            }\n            if (optional && v === undefined) {\n                return {\n                    succeeded: true,\n                    value: undefined,\n                };\n            }\n            const result = parse(v);\n            return result !== undefined\n                ? {\n                    succeeded: true,\n                    value: result,\n                }\n                : {\n                    succeeded: false,\n                    value: undefined,\n                };\n        };\n    }\n    function createParamsParserBuilders(optional) {\n        return {\n            custom: (parse) => createParamsParserBuilder(parse)(optional),\n            boolean: createParamsParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n            number: createParamsParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n            string: createParamsParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n            function: createParamsParserBuilder((v) =>\n            typeof v === 'function' ? v : undefined)(optional),\n            constant: (value) => createParamsParserBuilder((v) => (v === value ? value : undefined))(optional),\n            raw: createParamsParserBuilder((v) => v)(optional),\n            object: (keyToParserMap) => createParamsParserBuilder((v) => {\n                if (!isObject(v)) {\n                    return undefined;\n                }\n                return parseObject(v, keyToParserMap);\n            })(optional),\n            array: (itemParser) => createParamsParserBuilder((v) => {\n                if (!Array.isArray(v)) {\n                    return undefined;\n                }\n                return parseArray(v, itemParser);\n            })(optional),\n        };\n    }\n    const ParamsParsers = {\n        optional: createParamsParserBuilders(true),\n        required: createParamsParserBuilders(false),\n    };\n    function parseParams(value, keyToParserMap) {\n        const result = ParamsParsers.required.object(keyToParserMap)(value);\n        return result.succeeded ? result.value : undefined;\n    }\n\n    function disposeElement(elem) {\n        if (elem && elem.parentElement) {\n            elem.parentElement.removeChild(elem);\n        }\n        return null;\n    }\n\n    function getAllBladePositions() {\n        return ['veryfirst', 'first', 'last', 'verylast'];\n    }\n\n    const className$p = ClassName('');\n    const POS_TO_CLASS_NAME_MAP = {\n        veryfirst: 'vfst',\n        first: 'fst',\n        last: 'lst',\n        verylast: 'vlst',\n    };\n    class BladeController {\n        constructor(config) {\n            this.parent_ = null;\n            this.blade = config.blade;\n            this.view = config.view;\n            this.viewProps = config.viewProps;\n            const elem = this.view.element;\n            this.blade.value('positions').emitter.on('change', () => {\n                getAllBladePositions().forEach((pos) => {\n                    elem.classList.remove(className$p(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n                this.blade.get('positions').forEach((pos) => {\n                    elem.classList.add(className$p(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n                });\n            });\n            this.viewProps.handleDispose(() => {\n                disposeElement(elem);\n            });\n        }\n        get parent() {\n            return this.parent_;\n        }\n    }\n\n    const SVG_NS = 'http://www.w3.org/2000/svg';\n    function forceReflow(element) {\n        element.offsetHeight;\n    }\n    function disableTransitionTemporarily(element, callback) {\n        const t = element.style.transition;\n        element.style.transition = 'none';\n        callback();\n        element.style.transition = t;\n    }\n    function supportsTouch(doc) {\n        return doc.ontouchstart !== undefined;\n    }\n    function getGlobalObject() {\n        return new Function('return this')();\n    }\n    function getWindowDocument() {\n        const globalObj = forceCast(getGlobalObject());\n        return globalObj.document;\n    }\n    function getCanvasContext(canvasElement) {\n        const win = canvasElement.ownerDocument.defaultView;\n        if (!win) {\n            return null;\n        }\n        const isBrowser = 'document' in win;\n        return isBrowser ? canvasElement.getContext('2d') : null;\n    }\n    const ICON_ID_TO_INNER_HTML_MAP = {\n        check: '<path d=\"M2 8l4 4l8 -8\"/>',\n        dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n        p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n    };\n    function createSvgIconElement(document, iconId) {\n        const elem = document.createElementNS(SVG_NS, 'svg');\n        elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n        return elem;\n    }\n    function insertElementAt(parentElement, element, index) {\n        parentElement.insertBefore(element, parentElement.children[index]);\n    }\n    function removeElement(element) {\n        if (element.parentElement) {\n            element.parentElement.removeChild(element);\n        }\n    }\n    function removeChildElements(element) {\n        while (element.children.length > 0) {\n            element.removeChild(element.children[0]);\n        }\n    }\n    function removeChildNodes(element) {\n        while (element.childNodes.length > 0) {\n            element.removeChild(element.childNodes[0]);\n        }\n    }\n    function findNextTarget(ev) {\n        if (ev.relatedTarget) {\n            return forceCast(ev.relatedTarget);\n        }\n        if ('explicitOriginalTarget' in ev) {\n            return ev.explicitOriginalTarget;\n        }\n        return null;\n    }\n\n    const className$o = ClassName('lbl');\n    function createLabelNode(doc, label) {\n        const frag = doc.createDocumentFragment();\n        const lineNodes = label.split('\\n').map((line) => {\n            return doc.createTextNode(line);\n        });\n        lineNodes.forEach((lineNode, index) => {\n            if (index > 0) {\n                frag.appendChild(doc.createElement('br'));\n            }\n            frag.appendChild(lineNode);\n        });\n        return frag;\n    }\n    class LabelView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$o());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('div');\n            labelElem.classList.add(className$o('l'));\n            bindValueMap(config.props, 'label', (value) => {\n                if (isEmpty(value)) {\n                    this.element.classList.add(className$o(undefined, 'nol'));\n                }\n                else {\n                    this.element.classList.remove(className$o(undefined, 'nol'));\n                    removeChildNodes(labelElem);\n                    labelElem.appendChild(createLabelNode(doc, value));\n                }\n            });\n            this.element.appendChild(labelElem);\n            this.labelElement = labelElem;\n            const valueElem = doc.createElement('div');\n            valueElem.classList.add(className$o('v'));\n            this.element.appendChild(valueElem);\n            this.valueElement = valueElem;\n        }\n    }\n\n    class LabelController extends BladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    const ButtonBladePlugin = {\n        id: 'button',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('button'),\n                label: p.optional.string,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new LabelController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: new ButtonController(args.document, {\n                    props: ValueMap.fromObject({\n                        title: args.params.title,\n                    }),\n                    viewProps: args.viewProps,\n                }),\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabelController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ButtonController)) {\n                return null;\n            }\n            return new ButtonApi(args.controller);\n        },\n    };\n\n    class ValueBladeController extends BladeController {\n        constructor(config) {\n            super(config);\n            this.value = config.value;\n        }\n    }\n\n    function createBlade() {\n        return new ValueMap({\n            positions: createValue([], {\n                equals: deepEqualsArray,\n            }),\n        });\n    }\n\n    class Foldable extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(expanded) {\n            const coreObj = {\n                completed: true,\n                expanded: expanded,\n                expandedHeight: null,\n                shouldFixHeight: false,\n                temporaryExpanded: null,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new Foldable(core);\n        }\n        get styleExpanded() {\n            var _a;\n            return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n        }\n        get styleHeight() {\n            if (!this.styleExpanded) {\n                return '0';\n            }\n            const exHeight = this.get('expandedHeight');\n            if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n                return `${exHeight}px`;\n            }\n            return 'auto';\n        }\n        bindExpandedClass(elem, expandedClassName) {\n            const onExpand = () => {\n                const expanded = this.styleExpanded;\n                if (expanded) {\n                    elem.classList.add(expandedClassName);\n                }\n                else {\n                    elem.classList.remove(expandedClassName);\n                }\n            };\n            bindValueMap(this, 'expanded', onExpand);\n            bindValueMap(this, 'temporaryExpanded', onExpand);\n        }\n        cleanUpTransition() {\n            this.set('shouldFixHeight', false);\n            this.set('expandedHeight', null);\n            this.set('completed', true);\n        }\n    }\n    function computeExpandedFolderHeight(folder, containerElement) {\n        let height = 0;\n        disableTransitionTemporarily(containerElement, () => {\n            folder.set('expandedHeight', null);\n            folder.set('temporaryExpanded', true);\n            forceReflow(containerElement);\n            height = containerElement.clientHeight;\n            folder.set('temporaryExpanded', null);\n            forceReflow(containerElement);\n        });\n        return height;\n    }\n    function applyHeight(foldable, elem) {\n        elem.style.height = foldable.styleHeight;\n    }\n    function bindFoldable(foldable, elem) {\n        foldable.value('expanded').emitter.on('beforechange', () => {\n            foldable.set('completed', false);\n            if (isEmpty(foldable.get('expandedHeight'))) {\n                foldable.set('expandedHeight', computeExpandedFolderHeight(foldable, elem));\n            }\n            foldable.set('shouldFixHeight', true);\n            forceReflow(elem);\n        });\n        foldable.emitter.on('change', () => {\n            applyHeight(foldable, elem);\n        });\n        applyHeight(foldable, elem);\n        elem.addEventListener('transitionend', (ev) => {\n            if (ev.propertyName !== 'height') {\n                return;\n            }\n            foldable.cleanUpTransition();\n        });\n    }\n\n    class RackLikeApi extends BladeApi {\n        constructor(controller, rackApi) {\n            super(controller);\n            this.rackApi_ = rackApi;\n        }\n    }\n\n    function addButtonAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n    }\n    function addFolderAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n    }\n    function addSeparatorAsBlade(api, opt_params) {\n        const params = opt_params || {};\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'separator' }));\n    }\n    function addTabAsBlade(api, params) {\n        return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n    }\n\n    class NestedOrderedSet {\n        constructor(extract) {\n            this.emitter = new Emitter();\n            this.items_ = [];\n            this.cache_ = new Set();\n            this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n            this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n            this.extract_ = extract;\n        }\n        get items() {\n            return this.items_;\n        }\n        allItems() {\n            return Array.from(this.cache_);\n        }\n        find(callback) {\n            for (const item of this.allItems()) {\n                if (callback(item)) {\n                    return item;\n                }\n            }\n            return null;\n        }\n        includes(item) {\n            return this.cache_.has(item);\n        }\n        add(item, opt_index) {\n            if (this.includes(item)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const index = opt_index !== undefined ? opt_index : this.items_.length;\n            this.items_.splice(index, 0, item);\n            this.cache_.add(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.on('add', this.onSubListAdd_);\n                subList.emitter.on('remove', this.onSubListRemove_);\n                subList.allItems().forEach((item) => {\n                    this.cache_.add(item);\n                });\n            }\n            this.emitter.emit('add', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        remove(item) {\n            const index = this.items_.indexOf(item);\n            if (index < 0) {\n                return;\n            }\n            this.items_.splice(index, 1);\n            this.cache_.delete(item);\n            const subList = this.extract_(item);\n            if (subList) {\n                subList.emitter.off('add', this.onSubListAdd_);\n                subList.emitter.off('remove', this.onSubListRemove_);\n            }\n            this.emitter.emit('remove', {\n                index: index,\n                item: item,\n                root: this,\n                target: this,\n            });\n        }\n        onSubListAdd_(ev) {\n            this.cache_.add(ev.item);\n            this.emitter.emit('add', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n        onSubListRemove_(ev) {\n            this.cache_.delete(ev.item);\n            this.emitter.emit('remove', {\n                index: ev.index,\n                item: ev.item,\n                root: this,\n                target: ev.target,\n            });\n        }\n    }\n\n    class InputBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingChange_ = this.onBindingChange_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('change', this.onBindingChange_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingChange_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('change', {\n                event: new TpChangeEvent(this, forceCast(value), this.controller_.binding.target.presetKey, ev.options.last),\n            });\n        }\n    }\n\n    class InputBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n        }\n    }\n\n    class MonitorBindingApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.onBindingUpdate_ = this.onBindingUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.controller_.binding.emitter.on('update', this.onBindingUpdate_);\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        refresh() {\n            this.controller_.binding.read();\n        }\n        onBindingUpdate_(ev) {\n            const value = ev.sender.target.read();\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(this, forceCast(value), this.controller_.binding.target.presetKey),\n            });\n        }\n    }\n\n    class MonitorBindingController extends LabelController {\n        constructor(doc, config) {\n            super(doc, config);\n            this.binding = config.binding;\n            this.viewProps.bindDisabled(this.binding.ticker);\n            this.viewProps.handleDispose(() => {\n                this.binding.dispose();\n            });\n        }\n    }\n\n    function findSubBladeApiSet(api) {\n        if (api instanceof RackApi) {\n            return api['apiSet_'];\n        }\n        if (api instanceof RackLikeApi) {\n            return api['rackApi_']['apiSet_'];\n        }\n        return null;\n    }\n    function getApiByController(apiSet, controller) {\n        const api = apiSet.find((api) => api.controller_ === controller);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return api;\n    }\n    function createBindingTarget(obj, key, opt_id) {\n        if (!BindingTarget.isBindable(obj)) {\n            throw TpError.notBindable();\n        }\n        return new BindingTarget(obj, key, opt_id);\n    }\n    class RackApi extends BladeApi {\n        constructor(controller, pool) {\n            super(controller);\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            this.onRackInputChange_ = this.onRackInputChange_.bind(this);\n            this.onRackMonitorUpdate_ = this.onRackMonitorUpdate_.bind(this);\n            this.emitter_ = new Emitter();\n            this.apiSet_ = new NestedOrderedSet(findSubBladeApiSet);\n            this.pool_ = pool;\n            const rack = this.controller_.rack;\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            rack.emitter.on('inputchange', this.onRackInputChange_);\n            rack.emitter.on('monitorupdate', this.onRackMonitorUpdate_);\n            rack.children.forEach((bc) => {\n                this.setUpApi_(bc);\n            });\n        }\n        get children() {\n            return this.controller_.rack.children.map((bc) => getApiByController(this.apiSet_, bc));\n        }\n        addInput(object, key, opt_params) {\n            const params = opt_params || {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createInput(doc, createBindingTarget(object, key, params.presetKey), params);\n            const api = new InputBindingApi(bc);\n            return this.add(api, params.index);\n        }\n        addMonitor(object, key, opt_params) {\n            const params = opt_params || {};\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createMonitor(doc, createBindingTarget(object, key), params);\n            const api = new MonitorBindingApi(bc);\n            return forceCast(this.add(api, params.index));\n        }\n        addFolder(params) {\n            return addFolderAsBlade(this, params);\n        }\n        addButton(params) {\n            return addButtonAsBlade(this, params);\n        }\n        addSeparator(opt_params) {\n            return addSeparatorAsBlade(this, opt_params);\n        }\n        addTab(params) {\n            return addTabAsBlade(this, params);\n        }\n        add(api, opt_index) {\n            this.controller_.rack.add(api.controller_, opt_index);\n            const gapi = this.apiSet_.find((a) => a.controller_ === api.controller_);\n            if (gapi) {\n                this.apiSet_.remove(gapi);\n            }\n            this.apiSet_.add(api);\n            return api;\n        }\n        remove(api) {\n            this.controller_.rack.remove(api.controller_);\n        }\n        addBlade(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const bc = this.pool_.createBlade(doc, params);\n            const api = this.pool_.createBladeApi(bc);\n            return this.add(api, params.index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpApi_(bc) {\n            const api = this.apiSet_.find((api) => api.controller_ === bc);\n            if (!api) {\n                this.apiSet_.add(this.pool_.createBladeApi(bc));\n            }\n        }\n        onRackAdd_(ev) {\n            this.setUpApi_(ev.bladeController);\n        }\n        onRackRemove_(ev) {\n            if (ev.isRoot) {\n                const api = getApiByController(this.apiSet_, ev.bladeController);\n                this.apiSet_.remove(api);\n            }\n        }\n        onRackInputChange_(ev) {\n            const bc = ev.bladeController;\n            if (bc instanceof InputBindingController) {\n                const api = getApiByController(this.apiSet_, bc);\n                const binding = bc.binding;\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, forceCast(binding.target.read()), binding.target.presetKey, ev.options.last),\n                });\n            }\n            else if (bc instanceof ValueBladeController) {\n                const api = getApiByController(this.apiSet_, bc);\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(api, bc.value.rawValue, undefined, ev.options.last),\n                });\n            }\n        }\n        onRackMonitorUpdate_(ev) {\n            if (!(ev.bladeController instanceof MonitorBindingController)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = getApiByController(this.apiSet_, ev.bladeController);\n            const binding = ev.bladeController.binding;\n            this.emitter_.emit('update', {\n                event: new TpUpdateEvent(api, forceCast(binding.target.read()), binding.target.presetKey),\n            });\n        }\n    }\n\n    class FolderApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.emitter_ = new Emitter();\n            this.controller_.foldable\n                .value('expanded')\n                .emitter.on('change', (ev) => {\n                this.emitter_.emit('fold', {\n                    event: new TpFoldEvent(this, ev.sender.rawValue),\n                });\n            });\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n        }\n        get expanded() {\n            return this.controller_.foldable.get('expanded');\n        }\n        set expanded(expanded) {\n            this.controller_.foldable.set('expanded', expanded);\n        }\n        get title() {\n            return this.controller_.props.get('title');\n        }\n        set title(title) {\n            this.controller_.props.set('title', title);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            return this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class RackLikeController extends BladeController {\n        constructor(config) {\n            super({\n                blade: config.blade,\n                view: config.view,\n                viewProps: config.rackController.viewProps,\n            });\n            this.rackController = config.rackController;\n        }\n    }\n\n    class PlainView {\n        constructor(doc, config) {\n            const className = ClassName(config.viewName);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n        }\n    }\n\n    function findInputBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof InputBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findMonitorBindingController(bcs, b) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof MonitorBindingController && bc.binding === b) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findValueBladeController(bcs, v) {\n        for (let i = 0; i < bcs.length; i++) {\n            const bc = bcs[i];\n            if (bc instanceof ValueBladeController && bc.value === v) {\n                return bc;\n            }\n        }\n        return null;\n    }\n    function findSubRack(bc) {\n        if (bc instanceof RackController) {\n            return bc.rack;\n        }\n        if (bc instanceof RackLikeController) {\n            return bc.rackController.rack;\n        }\n        return null;\n    }\n    function findSubBladeControllerSet(bc) {\n        const rack = findSubRack(bc);\n        return rack ? rack['bcSet_'] : null;\n    }\n    class BladeRack {\n        constructor(blade) {\n            var _a;\n            this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n            this.onSetAdd_ = this.onSetAdd_.bind(this);\n            this.onSetRemove_ = this.onSetRemove_.bind(this);\n            this.onChildDispose_ = this.onChildDispose_.bind(this);\n            this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n            this.onChildInputChange_ = this.onChildInputChange_.bind(this);\n            this.onChildMonitorUpdate_ = this.onChildMonitorUpdate_.bind(this);\n            this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n            this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n            this.onDescendantLayout_ = this.onDescendantLayout_.bind(this);\n            this.onDescendantInputChange_ = this.onDescendantInputChange_.bind(this);\n            this.onDescendantMonitorUpdate_ =\n                this.onDescendantMonitorUpdate_.bind(this);\n            this.emitter = new Emitter();\n            this.blade_ = blade !== null && blade !== void 0 ? blade : null;\n            (_a = this.blade_) === null || _a === void 0 ? void 0 : _a.value('positions').emitter.on('change', this.onBladePositionsChange_);\n            this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n            this.bcSet_.emitter.on('add', this.onSetAdd_);\n            this.bcSet_.emitter.on('remove', this.onSetRemove_);\n        }\n        get children() {\n            return this.bcSet_.items;\n        }\n        add(bc, opt_index) {\n            if (bc.parent) {\n                bc.parent.remove(bc);\n            }\n            bc['parent_'] = this;\n            this.bcSet_.add(bc, opt_index);\n        }\n        remove(bc) {\n            bc['parent_'] = null;\n            this.bcSet_.remove(bc);\n        }\n        find(controllerClass) {\n            return forceCast(this.bcSet_.allItems().filter((bc) => {\n                return bc instanceof controllerClass;\n            }));\n        }\n        onSetAdd_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('add', {\n                bladeController: ev.item,\n                index: ev.index,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n            bc.blade\n                .value('positions')\n                .emitter.on('change', this.onChildPositionsChange_);\n            bc.viewProps.handleDispose(this.onChildDispose_);\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.on('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.on('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.on('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.on('layout', this.onDescendantLayout_);\n                    emitter.on('inputchange', this.onDescendantInputChange_);\n                    emitter.on('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        onSetRemove_(ev) {\n            this.updatePositions_();\n            const isRoot = ev.target === ev.root;\n            this.emitter.emit('remove', {\n                bladeController: ev.item,\n                isRoot: isRoot,\n                sender: this,\n            });\n            if (!isRoot) {\n                return;\n            }\n            const bc = ev.item;\n            if (bc instanceof InputBindingController) {\n                bc.binding.emitter.off('change', this.onChildInputChange_);\n            }\n            else if (bc instanceof MonitorBindingController) {\n                bc.binding.emitter.off('update', this.onChildMonitorUpdate_);\n            }\n            else if (bc instanceof ValueBladeController) {\n                bc.value.emitter.off('change', this.onChildValueChange_);\n            }\n            else {\n                const rack = findSubRack(bc);\n                if (rack) {\n                    const emitter = rack.emitter;\n                    emitter.off('layout', this.onDescendantLayout_);\n                    emitter.off('inputchange', this.onDescendantInputChange_);\n                    emitter.off('monitorupdate', this.onDescendantMonitorUpdate_);\n                }\n            }\n        }\n        updatePositions_() {\n            const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n            const firstVisibleItem = visibleItems[0];\n            const lastVisibleItem = visibleItems[visibleItems.length - 1];\n            this.bcSet_.items.forEach((bc) => {\n                const ps = [];\n                if (bc === firstVisibleItem) {\n                    ps.push('first');\n                    if (!this.blade_ ||\n                        this.blade_.get('positions').includes('veryfirst')) {\n                        ps.push('veryfirst');\n                    }\n                }\n                if (bc === lastVisibleItem) {\n                    ps.push('last');\n                    if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                        ps.push('verylast');\n                    }\n                }\n                bc.blade.set('positions', ps);\n            });\n        }\n        onChildPositionsChange_() {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildViewPropsChange_(_ev) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onChildDispose_() {\n            const disposedUcs = this.bcSet_.items.filter((bc) => {\n                return bc.viewProps.get('disposed');\n            });\n            disposedUcs.forEach((bc) => {\n                this.bcSet_.remove(bc);\n            });\n        }\n        onChildInputChange_(ev) {\n            const bc = findInputBindingController(this.find(InputBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onChildMonitorUpdate_(ev) {\n            const bc = findMonitorBindingController(this.find(MonitorBindingController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('monitorupdate', {\n                bladeController: bc,\n                sender: this,\n            });\n        }\n        onChildValueChange_(ev) {\n            const bc = findValueBladeController(this.find(ValueBladeController), ev.sender);\n            if (!bc) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.emitter.emit('inputchange', {\n                bladeController: bc,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantLayout_(_) {\n            this.updatePositions_();\n            this.emitter.emit('layout', {\n                sender: this,\n            });\n        }\n        onDescendantInputChange_(ev) {\n            this.emitter.emit('inputchange', {\n                bladeController: ev.bladeController,\n                options: ev.options,\n                sender: this,\n            });\n        }\n        onDescendantMonitorUpdate_(ev) {\n            this.emitter.emit('monitorupdate', {\n                bladeController: ev.bladeController,\n                sender: this,\n            });\n        }\n        onBladePositionsChange_() {\n            this.updatePositions_();\n        }\n    }\n\n    class RackController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new PlainView(doc, {\n                    viewName: 'brk',\n                    viewProps: config.viewProps,\n                }) }));\n            this.onRackAdd_ = this.onRackAdd_.bind(this);\n            this.onRackRemove_ = this.onRackRemove_.bind(this);\n            const rack = new BladeRack(config.root ? undefined : config.blade);\n            rack.emitter.on('add', this.onRackAdd_);\n            rack.emitter.on('remove', this.onRackRemove_);\n            this.rack = rack;\n            this.viewProps.handleDispose(() => {\n                for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                    const bc = this.rack.children[i];\n                    bc.viewProps.set('disposed', true);\n                }\n            });\n        }\n        onRackAdd_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            insertElementAt(this.view.element, ev.bladeController.view.element, ev.index);\n        }\n        onRackRemove_(ev) {\n            if (!ev.isRoot) {\n                return;\n            }\n            removeElement(ev.bladeController.view.element);\n        }\n    }\n\n    const bladeContainerClassName = ClassName('cnt');\n\n    class FolderView {\n        constructor(doc, config) {\n            this.className_ = ClassName(config.viewName || 'fld');\n            this.element = doc.createElement('div');\n            this.element.classList.add(this.className_(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            this.foldable_ = config.foldable;\n            this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n            bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(this.className_('b'));\n            bindValueMap(config.props, 'title', (title) => {\n                if (isEmpty(title)) {\n                    this.element.classList.add(this.className_(undefined, 'not'));\n                }\n                else {\n                    this.element.classList.remove(this.className_(undefined, 'not'));\n                }\n            });\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(this.className_('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(this.className_('m'));\n            this.buttonElement.appendChild(markElem);\n            const containerElem = config.containerElement;\n            containerElem.classList.add(this.className_('c'));\n            this.element.appendChild(containerElem);\n            this.containerElement = containerElem;\n        }\n    }\n\n    class FolderController extends RackLikeController {\n        constructor(doc, config) {\n            var _a;\n            const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n            const rc = new RackController(doc, {\n                blade: config.blade,\n                root: config.root,\n                viewProps: config.viewProps,\n            });\n            super(Object.assign(Object.assign({}, config), { rackController: rc, view: new FolderView(doc, {\n                    containerElement: rc.view.element,\n                    foldable: foldable,\n                    props: config.props,\n                    viewName: config.root ? 'rot' : undefined,\n                    viewProps: config.viewProps,\n                }) }));\n            this.onTitleClick_ = this.onTitleClick_.bind(this);\n            this.props = config.props;\n            this.foldable = foldable;\n            bindFoldable(this.foldable, this.view.containerElement);\n            this.rackController.rack.emitter.on('add', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.rackController.rack.emitter.on('remove', () => {\n                this.foldable.cleanUpTransition();\n            });\n            this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n        }\n        get document() {\n            return this.view.element.ownerDocument;\n        }\n        onTitleClick_() {\n            this.foldable.set('expanded', !this.foldable.get('expanded'));\n        }\n    }\n\n    const FolderBladePlugin = {\n        id: 'folder',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                title: p.required.string,\n                view: p.required.constant('folder'),\n                expanded: p.optional.boolean,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new FolderController(args.document, {\n                blade: args.blade,\n                expanded: args.params.expanded,\n                props: ValueMap.fromObject({\n                    title: args.params.title,\n                }),\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof FolderController)) {\n                return null;\n            }\n            return new FolderApi(args.controller, args.pool);\n        },\n    };\n\n    class LabeledValueController extends ValueBladeController {\n        constructor(doc, config) {\n            const viewProps = config.valueController.viewProps;\n            super(Object.assign(Object.assign({}, config), { value: config.valueController.value, view: new LabelView(doc, {\n                    props: config.props,\n                    viewProps: viewProps,\n                }), viewProps: viewProps }));\n            this.props = config.props;\n            this.valueController = config.valueController;\n            this.view.valueElement.appendChild(this.valueController.view.element);\n        }\n    }\n\n    class SeparatorApi extends BladeApi {\n    }\n\n    const className$n = ClassName('spr');\n    class SeparatorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$n());\n            config.viewProps.bindClassModifiers(this.element);\n            const hrElem = doc.createElement('hr');\n            hrElem.classList.add(className$n('r'));\n            this.element.appendChild(hrElem);\n        }\n    }\n\n    class SeparatorController extends BladeController {\n        constructor(doc, config) {\n            super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                    viewProps: config.viewProps,\n                }) }));\n        }\n    }\n\n    const SeparatorBladePlugin = {\n        id: 'separator',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                view: p.required.constant('separator'),\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            return new SeparatorController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof SeparatorController)) {\n                return null;\n            }\n            return new SeparatorApi(args.controller);\n        },\n    };\n\n    const className$m = ClassName('');\n    function valueToModifier(elem, modifier) {\n        return valueToClassName(elem, className$m(undefined, modifier));\n    }\n    class ViewProps extends ValueMap {\n        constructor(valueMap) {\n            super(valueMap);\n        }\n        static create(opt_initialValue) {\n            var _a, _b;\n            const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n            const coreObj = {\n                disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n                disposed: false,\n                hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n            };\n            const core = ValueMap.createCore(coreObj);\n            return new ViewProps(core);\n        }\n        bindClassModifiers(elem) {\n            bindValueMap(this, 'disabled', valueToModifier(elem, 'disabled'));\n            bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n        }\n        bindDisabled(target) {\n            bindValueMap(this, 'disabled', (disabled) => {\n                target.disabled = disabled;\n            });\n        }\n        bindTabIndex(elem) {\n            bindValueMap(this, 'disabled', (disabled) => {\n                elem.tabIndex = disabled ? -1 : 0;\n            });\n        }\n        handleDispose(callback) {\n            this.value('disposed').emitter.on('change', (disposed) => {\n                if (disposed) {\n                    callback();\n                }\n            });\n        }\n    }\n\n    const className$l = ClassName('tbi');\n    class TabItemView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$l());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValueMap(config.props, 'selected', (selected) => {\n                if (selected) {\n                    this.element.classList.add(className$l(undefined, 'sel'));\n                }\n                else {\n                    this.element.classList.remove(className$l(undefined, 'sel'));\n                }\n            });\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$l('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const titleElem = doc.createElement('div');\n            titleElem.classList.add(className$l('t'));\n            bindValueToTextContent(config.props.value('title'), titleElem);\n            this.buttonElement.appendChild(titleElem);\n            this.titleElement = titleElem;\n        }\n    }\n\n    class TabItemController {\n        constructor(doc, config) {\n            this.emitter = new Emitter();\n            this.onClick_ = this.onClick_.bind(this);\n            this.props = config.props;\n            this.viewProps = config.viewProps;\n            this.view = new TabItemView(doc, {\n                props: config.props,\n                viewProps: config.viewProps,\n            });\n            this.view.buttonElement.addEventListener('click', this.onClick_);\n        }\n        onClick_() {\n            this.emitter.emit('click', {\n                sender: this,\n            });\n        }\n    }\n\n    class TabPageController {\n        constructor(doc, config) {\n            this.onItemClick_ = this.onItemClick_.bind(this);\n            this.ic_ = new TabItemController(doc, {\n                props: config.itemProps,\n                viewProps: ViewProps.create(),\n            });\n            this.ic_.emitter.on('click', this.onItemClick_);\n            this.cc_ = new RackController(doc, {\n                blade: createBlade(),\n                viewProps: ViewProps.create(),\n            });\n            this.props = config.props;\n            bindValueMap(this.props, 'selected', (selected) => {\n                this.itemController.props.set('selected', selected);\n                this.contentController.viewProps.set('hidden', !selected);\n            });\n        }\n        get itemController() {\n            return this.ic_;\n        }\n        get contentController() {\n            return this.cc_;\n        }\n        onItemClick_() {\n            this.props.set('selected', true);\n        }\n    }\n\n    class TabPageApi {\n        constructor(controller, contentRackApi) {\n            this.controller_ = controller;\n            this.rackApi_ = contentRackApi;\n        }\n        get title() {\n            var _a;\n            return (_a = this.controller_.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n        }\n        set title(title) {\n            this.controller_.itemController.props.set('title', title);\n        }\n        get selected() {\n            return this.controller_.props.get('selected');\n        }\n        set selected(selected) {\n            this.controller_.props.set('selected', selected);\n        }\n        get children() {\n            return this.rackApi_.children;\n        }\n        addButton(params) {\n            return this.rackApi_.addButton(params);\n        }\n        addFolder(params) {\n            return this.rackApi_.addFolder(params);\n        }\n        addSeparator(opt_params) {\n            return this.rackApi_.addSeparator(opt_params);\n        }\n        addTab(params) {\n            return this.rackApi_.addTab(params);\n        }\n        add(api, opt_index) {\n            this.rackApi_.add(api, opt_index);\n        }\n        remove(api) {\n            this.rackApi_.remove(api);\n        }\n        addInput(object, key, opt_params) {\n            return this.rackApi_.addInput(object, key, opt_params);\n        }\n        addMonitor(object, key, opt_params) {\n            return this.rackApi_.addMonitor(object, key, opt_params);\n        }\n        addBlade(params) {\n            return this.rackApi_.addBlade(params);\n        }\n    }\n\n    class TabApi extends RackLikeApi {\n        constructor(controller, pool) {\n            super(controller, new RackApi(controller.rackController, pool));\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.emitter_ = new Emitter();\n            this.pageApiMap_ = new Map();\n            this.rackApi_.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: ev,\n                });\n            });\n            this.rackApi_.on('update', (ev) => {\n                this.emitter_.emit('update', {\n                    event: ev,\n                });\n            });\n            this.controller_.pageSet.emitter.on('add', this.onPageAdd_);\n            this.controller_.pageSet.emitter.on('remove', this.onPageRemove_);\n            this.controller_.pageSet.items.forEach((pc) => {\n                this.setUpPageApi_(pc);\n            });\n        }\n        get pages() {\n            return this.controller_.pageSet.items.map((pc) => {\n                const api = this.pageApiMap_.get(pc);\n                if (!api) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return api;\n            });\n        }\n        addPage(params) {\n            const doc = this.controller_.view.element.ownerDocument;\n            const pc = new TabPageController(doc, {\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: params.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n            });\n            this.controller_.add(pc, params.index);\n            const api = this.pageApiMap_.get(pc);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n        removePage(index) {\n            this.controller_.remove(index);\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n        setUpPageApi_(pc) {\n            const rackApi = this.rackApi_['apiSet_'].find((api) => api.controller_ === pc.contentController);\n            if (!rackApi) {\n                throw TpError.shouldNeverHappen();\n            }\n            const api = new TabPageApi(pc, rackApi);\n            this.pageApiMap_.set(pc, api);\n        }\n        onPageAdd_(ev) {\n            this.setUpPageApi_(ev.item);\n        }\n        onPageRemove_(ev) {\n            const api = this.pageApiMap_.get(ev.item);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            this.pageApiMap_.delete(ev.item);\n        }\n    }\n\n    const className$k = ClassName('tab');\n    class TabView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$k(), bladeContainerClassName());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.empty, valueToClassName(this.element, className$k(undefined, 'nop')));\n            const itemsElem = doc.createElement('div');\n            itemsElem.classList.add(className$k('i'));\n            this.element.appendChild(itemsElem);\n            this.itemsElement = itemsElem;\n            const contentsElem = config.contentsElement;\n            contentsElem.classList.add(className$k('c'));\n            this.element.appendChild(contentsElem);\n            this.contentsElement = contentsElem;\n        }\n    }\n\n    class TabController extends RackLikeController {\n        constructor(doc, config) {\n            const cr = new RackController(doc, {\n                blade: config.blade,\n                viewProps: config.viewProps,\n            });\n            const empty = createValue(true);\n            super({\n                blade: config.blade,\n                rackController: cr,\n                view: new TabView(doc, {\n                    contentsElement: cr.view.element,\n                    empty: empty,\n                    viewProps: config.viewProps,\n                }),\n            });\n            this.onPageAdd_ = this.onPageAdd_.bind(this);\n            this.onPageRemove_ = this.onPageRemove_.bind(this);\n            this.onPageSelectedChange_ = this.onPageSelectedChange_.bind(this);\n            this.pageSet_ = new NestedOrderedSet(() => null);\n            this.pageSet_.emitter.on('add', this.onPageAdd_);\n            this.pageSet_.emitter.on('remove', this.onPageRemove_);\n            this.empty_ = empty;\n            this.applyPages_();\n        }\n        get pageSet() {\n            return this.pageSet_;\n        }\n        add(pc, opt_index) {\n            this.pageSet_.add(pc, opt_index !== null && opt_index !== void 0 ? opt_index : this.pageSet_.items.length);\n        }\n        remove(index) {\n            this.pageSet_.remove(this.pageSet_.items[index]);\n        }\n        applyPages_() {\n            this.keepSelection_();\n            this.empty_.rawValue = this.pageSet_.items.length === 0;\n        }\n        onPageAdd_(ev) {\n            const pc = ev.item;\n            insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n            this.rackController.rack.add(pc.contentController, ev.index);\n            pc.props.value('selected').emitter.on('change', this.onPageSelectedChange_);\n            this.applyPages_();\n        }\n        onPageRemove_(ev) {\n            const pc = ev.item;\n            removeElement(pc.itemController.view.element);\n            this.rackController.rack.remove(pc.contentController);\n            pc.props\n                .value('selected')\n                .emitter.off('change', this.onPageSelectedChange_);\n            this.applyPages_();\n        }\n        keepSelection_() {\n            if (this.pageSet_.items.length === 0) {\n                return;\n            }\n            const firstSelIndex = this.pageSet_.items.findIndex((pc) => pc.props.get('selected'));\n            if (firstSelIndex < 0) {\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === 0);\n                });\n            }\n            else {\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === firstSelIndex);\n                });\n            }\n        }\n        onPageSelectedChange_(ev) {\n            if (ev.rawValue) {\n                const index = this.pageSet_.items.findIndex((pc) => pc.props.value('selected') === ev.sender);\n                this.pageSet_.items.forEach((pc, i) => {\n                    pc.props.set('selected', i === index);\n                });\n            }\n            else {\n                this.keepSelection_();\n            }\n        }\n    }\n\n    const TabBladePlugin = {\n        id: 'tab',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                pages: p.required.array(p.required.object({ title: p.required.string })),\n                view: p.required.constant('tab'),\n            });\n            if (!result || result.pages.length === 0) {\n                return null;\n            }\n            return { params: result };\n        },\n        controller(args) {\n            const c = new TabController(args.document, {\n                blade: args.blade,\n                viewProps: args.viewProps,\n            });\n            args.params.pages.forEach((p) => {\n                const pc = new TabPageController(args.document, {\n                    itemProps: ValueMap.fromObject({\n                        selected: false,\n                        title: p.title,\n                    }),\n                    props: ValueMap.fromObject({\n                        selected: false,\n                    }),\n                });\n                c.add(pc);\n            });\n            return c;\n        },\n        api(args) {\n            if (!(args.controller instanceof TabController)) {\n                return null;\n            }\n            return new TabApi(args.controller, args.pool);\n        },\n    };\n\n    function createBladeController(plugin, args) {\n        const ac = plugin.accept(args.params);\n        if (!ac) {\n            return null;\n        }\n        const disabled = ParamsParsers.optional.boolean(args.params['disabled']).value;\n        const hidden = ParamsParsers.optional.boolean(args.params['hidden']).value;\n        return plugin.controller({\n            blade: createBlade(),\n            document: args.document,\n            params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: disabled, hidden: hidden })),\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n    }\n\n    class ManualTicker {\n        constructor() {\n            this.disabled = false;\n            this.emitter = new Emitter();\n        }\n        dispose() { }\n        tick() {\n            if (this.disabled) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class IntervalTicker {\n        constructor(doc, interval) {\n            this.disabled_ = false;\n            this.timerId_ = null;\n            this.onTick_ = this.onTick_.bind(this);\n            this.doc_ = doc;\n            this.emitter = new Emitter();\n            this.interval_ = interval;\n            this.setTimer_();\n        }\n        get disabled() {\n            return this.disabled_;\n        }\n        set disabled(inactive) {\n            this.disabled_ = inactive;\n            if (this.disabled_) {\n                this.clearTimer_();\n            }\n            else {\n                this.setTimer_();\n            }\n        }\n        dispose() {\n            this.clearTimer_();\n        }\n        clearTimer_() {\n            if (this.timerId_ === null) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                win.clearInterval(this.timerId_);\n            }\n            this.timerId_ = null;\n        }\n        setTimer_() {\n            this.clearTimer_();\n            if (this.interval_ <= 0) {\n                return;\n            }\n            const win = this.doc_.defaultView;\n            if (win) {\n                this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n            }\n        }\n        onTick_() {\n            if (this.disabled_) {\n                return;\n            }\n            this.emitter.emit('tick', {\n                sender: this,\n            });\n        }\n    }\n\n    class CompositeConstraint {\n        constructor(constraints) {\n            this.constraints = constraints;\n        }\n        constrain(value) {\n            return this.constraints.reduce((result, c) => {\n                return c.constrain(result);\n            }, value);\n        }\n    }\n    function findConstraint(c, constraintClass) {\n        if (c instanceof constraintClass) {\n            return c;\n        }\n        if (c instanceof CompositeConstraint) {\n            const result = c.constraints.reduce((tmpResult, sc) => {\n                if (tmpResult) {\n                    return tmpResult;\n                }\n                return sc instanceof constraintClass ? sc : null;\n            }, null);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    }\n\n    class ListConstraint {\n        constructor(options) {\n            this.options = options;\n        }\n        constrain(value) {\n            const opts = this.options;\n            if (opts.length === 0) {\n                return value;\n            }\n            const matched = opts.filter((item) => {\n                return item.value === value;\n            }).length > 0;\n            return matched ? value : opts[0].value;\n        }\n    }\n\n    class RangeConstraint {\n        constructor(config) {\n            this.maxValue = config.max;\n            this.minValue = config.min;\n        }\n        constrain(value) {\n            let result = value;\n            if (!isEmpty(this.minValue)) {\n                result = Math.max(result, this.minValue);\n            }\n            if (!isEmpty(this.maxValue)) {\n                result = Math.min(result, this.maxValue);\n            }\n            return result;\n        }\n    }\n\n    class StepConstraint {\n        constructor(step) {\n            this.step = step;\n        }\n        constrain(value) {\n            const r = value < 0\n                ? -Math.round(-value / this.step)\n                : Math.round(value / this.step);\n            return r * this.step;\n        }\n    }\n\n    const className$j = ClassName('lst');\n    class ListView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.props_ = config.props;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$j());\n            config.viewProps.bindClassModifiers(this.element);\n            const selectElem = doc.createElement('select');\n            selectElem.classList.add(className$j('s'));\n            bindValueMap(this.props_, 'options', (opts) => {\n                removeChildElements(selectElem);\n                opts.forEach((item, index) => {\n                    const optionElem = doc.createElement('option');\n                    optionElem.dataset.index = String(index);\n                    optionElem.textContent = item.text;\n                    optionElem.value = String(item.value);\n                    selectElem.appendChild(optionElem);\n                });\n            });\n            config.viewProps.bindDisabled(selectElem);\n            this.element.appendChild(selectElem);\n            this.selectElement = selectElem;\n            const markElem = doc.createElement('div');\n            markElem.classList.add(className$j('m'));\n            markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            this.element.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value_ = config.value;\n            this.update_();\n        }\n        update_() {\n            this.selectElement.value = String(this.value_.rawValue);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ListController {\n        constructor(doc, config) {\n            this.onSelectChange_ = this.onSelectChange_.bind(this);\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ListView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.selectElement.addEventListener('change', this.onSelectChange_);\n        }\n        onSelectChange_(e) {\n            const selectElem = forceCast(e.currentTarget);\n            const optElem = selectElem.selectedOptions.item(0);\n            if (!optElem) {\n                return;\n            }\n            const itemIndex = Number(optElem.dataset.index);\n            this.value.rawValue = this.props.get('options')[itemIndex].value;\n        }\n    }\n\n    const className$i = ClassName('pop');\n    class PopupView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$i());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.shows, valueToClassName(this.element, className$i(undefined, 'v')));\n        }\n    }\n\n    class PopupController {\n        constructor(doc, config) {\n            this.shows = createValue(false);\n            this.viewProps = config.viewProps;\n            this.view = new PopupView(doc, {\n                shows: this.shows,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$h = ClassName('txt');\n    class TextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$h());\n            config.viewProps.bindClassModifiers(this.element);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$h('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value_ = config.value;\n            this.refresh();\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value_.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class TextController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new TextView(doc, {\n                props: config.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n    }\n\n    function boolToString(value) {\n        return String(value);\n    }\n    function boolFromUnknown(value) {\n        if (value === 'false') {\n            return false;\n        }\n        return !!value;\n    }\n    function BooleanFormatter(value) {\n        return boolToString(value);\n    }\n\n    class NumberLiteralNode {\n        constructor(text) {\n            this.text = text;\n        }\n        evaluate() {\n            return Number(this.text);\n        }\n        toString() {\n            return this.text;\n        }\n    }\n    const BINARY_OPERATION_MAP = {\n        '**': (v1, v2) => Math.pow(v1, v2),\n        '*': (v1, v2) => v1 * v2,\n        '/': (v1, v2) => v1 / v2,\n        '%': (v1, v2) => v1 % v2,\n        '+': (v1, v2) => v1 + v2,\n        '-': (v1, v2) => v1 - v2,\n        '<<': (v1, v2) => v1 << v2,\n        '>>': (v1, v2) => v1 >> v2,\n        '>>>': (v1, v2) => v1 >>> v2,\n        '&': (v1, v2) => v1 & v2,\n        '^': (v1, v2) => v1 ^ v2,\n        '|': (v1, v2) => v1 | v2,\n    };\n    class BinaryOperationNode {\n        constructor(operator, left, right) {\n            this.left = left;\n            this.operator = operator;\n            this.right = right;\n        }\n        evaluate() {\n            const op = BINARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected binary operator: '${this.operator}`);\n            }\n            return op(this.left.evaluate(), this.right.evaluate());\n        }\n        toString() {\n            return [\n                'b(',\n                this.left.toString(),\n                this.operator,\n                this.right.toString(),\n                ')',\n            ].join(' ');\n        }\n    }\n    const UNARY_OPERATION_MAP = {\n        '+': (v) => v,\n        '-': (v) => -v,\n        '~': (v) => ~v,\n    };\n    class UnaryOperationNode {\n        constructor(operator, expr) {\n            this.operator = operator;\n            this.expression = expr;\n        }\n        evaluate() {\n            const op = UNARY_OPERATION_MAP[this.operator];\n            if (!op) {\n                throw new Error(`unexpected unary operator: '${this.operator}`);\n            }\n            return op(this.expression.evaluate());\n        }\n        toString() {\n            return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n        }\n    }\n\n    function combineReader(parsers) {\n        return (text, cursor) => {\n            for (let i = 0; i < parsers.length; i++) {\n                const result = parsers[i](text, cursor);\n                if (result !== '') {\n                    return result;\n                }\n            }\n            return '';\n        };\n    }\n    function readWhitespace(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^\\s+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readNonZeroDigit(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        return ch.match(/^[1-9]$/) ? ch : '';\n    }\n    function readDecimalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readSignedInteger(text, cursor) {\n        const ds = readDecimalDigits(text, cursor);\n        if (ds !== '') {\n            return ds;\n        }\n        const sign = text.substr(cursor, 1);\n        cursor += 1;\n        if (sign !== '-' && sign !== '+') {\n            return '';\n        }\n        const sds = readDecimalDigits(text, cursor);\n        if (sds === '') {\n            return '';\n        }\n        return sign + sds;\n    }\n    function readExponentPart(text, cursor) {\n        const e = text.substr(cursor, 1);\n        cursor += 1;\n        if (e.toLowerCase() !== 'e') {\n            return '';\n        }\n        const si = readSignedInteger(text, cursor);\n        if (si === '') {\n            return '';\n        }\n        return e + si;\n    }\n    function readDecimalIntegerLiteral(text, cursor) {\n        const ch = text.substr(cursor, 1);\n        if (ch === '0') {\n            return ch;\n        }\n        const nzd = readNonZeroDigit(text, cursor);\n        cursor += nzd.length;\n        if (nzd === '') {\n            return '';\n        }\n        return nzd + readDecimalDigits(text, cursor);\n    }\n    function readDecimalLiteral1(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        return dil + dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral2(text, cursor) {\n        const dot = text.substr(cursor, 1);\n        cursor += dot.length;\n        if (dot !== '.') {\n            return '';\n        }\n        const dds = readDecimalDigits(text, cursor);\n        cursor += dds.length;\n        if (dds === '') {\n            return '';\n        }\n        return dot + dds + readExponentPart(text, cursor);\n    }\n    function readDecimalLiteral3(text, cursor) {\n        const dil = readDecimalIntegerLiteral(text, cursor);\n        cursor += dil.length;\n        if (dil === '') {\n            return '';\n        }\n        return dil + readExponentPart(text, cursor);\n    }\n    const readDecimalLiteral = combineReader([\n        readDecimalLiteral1,\n        readDecimalLiteral2,\n        readDecimalLiteral3,\n    ]);\n    function parseBinaryDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[01]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readBinaryIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0b') {\n            return '';\n        }\n        const bds = parseBinaryDigits(text, cursor);\n        if (bds === '') {\n            return '';\n        }\n        return prefix + bds;\n    }\n    function readOctalDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-7]+/);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readOctalIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0o') {\n            return '';\n        }\n        const ods = readOctalDigits(text, cursor);\n        if (ods === '') {\n            return '';\n        }\n        return prefix + ods;\n    }\n    function readHexDigits(text, cursor) {\n        var _a;\n        const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n        return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n    }\n    function readHexIntegerLiteral(text, cursor) {\n        const prefix = text.substr(cursor, 2);\n        cursor += prefix.length;\n        if (prefix.toLowerCase() !== '0x') {\n            return '';\n        }\n        const hds = readHexDigits(text, cursor);\n        if (hds === '') {\n            return '';\n        }\n        return prefix + hds;\n    }\n    const readNonDecimalIntegerLiteral = combineReader([\n        readBinaryIntegerLiteral,\n        readOctalIntegerLiteral,\n        readHexIntegerLiteral,\n    ]);\n    const readNumericLiteral = combineReader([\n        readNonDecimalIntegerLiteral,\n        readDecimalLiteral,\n    ]);\n\n    function parseLiteral(text, cursor) {\n        const num = readNumericLiteral(text, cursor);\n        cursor += num.length;\n        if (num === '') {\n            return null;\n        }\n        return {\n            evaluable: new NumberLiteralNode(num),\n            cursor: cursor,\n        };\n    }\n    function parseParenthesizedExpression(text, cursor) {\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '(') {\n            return null;\n        }\n        const expr = parseExpression(text, cursor);\n        if (!expr) {\n            return null;\n        }\n        cursor = expr.cursor;\n        cursor += readWhitespace(text, cursor).length;\n        const cl = text.substr(cursor, 1);\n        cursor += cl.length;\n        if (cl !== ')') {\n            return null;\n        }\n        return {\n            evaluable: expr.evaluable,\n            cursor: cursor,\n        };\n    }\n    function parsePrimaryExpression(text, cursor) {\n        return (parseLiteral(text, cursor) || parseParenthesizedExpression(text, cursor));\n    }\n    function parseUnaryExpression(text, cursor) {\n        const expr = parsePrimaryExpression(text, cursor);\n        if (expr) {\n            return expr;\n        }\n        const op = text.substr(cursor, 1);\n        cursor += op.length;\n        if (op !== '+' && op !== '-' && op !== '~') {\n            return null;\n        }\n        const num = parseUnaryExpression(text, cursor);\n        if (!num) {\n            return null;\n        }\n        cursor = num.cursor;\n        return {\n            cursor: cursor,\n            evaluable: new UnaryOperationNode(op, num.evaluable),\n        };\n    }\n    function readBinaryOperator(ops, text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n        if (!op) {\n            return null;\n        }\n        cursor += op.length;\n        cursor += readWhitespace(text, cursor).length;\n        return {\n            cursor: cursor,\n            operator: op,\n        };\n    }\n    function createBinaryOperationExpressionParser(exprParser, ops) {\n        return (text, cursor) => {\n            const firstExpr = exprParser(text, cursor);\n            if (!firstExpr) {\n                return null;\n            }\n            cursor = firstExpr.cursor;\n            let expr = firstExpr.evaluable;\n            for (;;) {\n                const op = readBinaryOperator(ops, text, cursor);\n                if (!op) {\n                    break;\n                }\n                cursor = op.cursor;\n                const nextExpr = exprParser(text, cursor);\n                if (!nextExpr) {\n                    return null;\n                }\n                cursor = nextExpr.cursor;\n                expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n            }\n            return expr\n                ? {\n                    cursor: cursor,\n                    evaluable: expr,\n                }\n                : null;\n        };\n    }\n    const parseBinaryOperationExpression = [\n        ['**'],\n        ['*', '/', '%'],\n        ['+', '-'],\n        ['<<', '>>>', '>>'],\n        ['&'],\n        ['^'],\n        ['|'],\n    ].reduce((parser, ops) => {\n        return createBinaryOperationExpressionParser(parser, ops);\n    }, parseUnaryExpression);\n    function parseExpression(text, cursor) {\n        cursor += readWhitespace(text, cursor).length;\n        return parseBinaryOperationExpression(text, cursor);\n    }\n    function parseEcmaNumberExpression(text) {\n        const expr = parseExpression(text, 0);\n        if (!expr) {\n            return null;\n        }\n        const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n        if (cursor !== text.length) {\n            return null;\n        }\n        return expr.evaluable;\n    }\n\n    function parseNumber(text) {\n        var _a;\n        const r = parseEcmaNumberExpression(text);\n        return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n    }\n    function numberFromUnknown(value) {\n        if (typeof value === 'number') {\n            return value;\n        }\n        if (typeof value === 'string') {\n            const pv = parseNumber(value);\n            if (!isEmpty(pv)) {\n                return pv;\n            }\n        }\n        return 0;\n    }\n    function numberToString(value) {\n        return String(value);\n    }\n    function createNumberFormatter(digits) {\n        return (value) => {\n            return value.toFixed(Math.max(Math.min(digits, 20), 0));\n        };\n    }\n\n    const innerFormatter = createNumberFormatter(0);\n    function formatPercentage(value) {\n        return innerFormatter(value) + '%';\n    }\n\n    function stringFromUnknown(value) {\n        return String(value);\n    }\n    function formatString(value) {\n        return value;\n    }\n\n    function fillBuffer(buffer, bufferSize) {\n        while (buffer.length < bufferSize) {\n            buffer.push(undefined);\n        }\n    }\n    function initializeBuffer(bufferSize) {\n        const buffer = [];\n        fillBuffer(buffer, bufferSize);\n        return createValue(buffer);\n    }\n    function createTrimmedBuffer(buffer) {\n        const index = buffer.indexOf(undefined);\n        return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n    }\n    function createPushedBuffer(buffer, newValue) {\n        const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n        if (newBuffer.length > buffer.length) {\n            newBuffer.splice(0, newBuffer.length - buffer.length);\n        }\n        else {\n            fillBuffer(newBuffer, buffer.length);\n        }\n        return newBuffer;\n    }\n\n    function connectValues({ primary, secondary, forward, backward, }) {\n        let changing = false;\n        function preventFeedback(callback) {\n            if (changing) {\n                return;\n            }\n            changing = true;\n            callback();\n            changing = false;\n        }\n        primary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        secondary.emitter.on('change', (ev) => {\n            preventFeedback(() => {\n                primary.setRawValue(backward(primary, secondary), ev.options);\n            });\n            preventFeedback(() => {\n                secondary.setRawValue(forward(primary, secondary), ev.options);\n            });\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary, secondary), {\n                forceEmit: false,\n                last: true,\n            });\n        });\n    }\n\n    function getStepForKey(baseStep, keys) {\n        const step = baseStep * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n        if (keys.upKey) {\n            return +step;\n        }\n        else if (keys.downKey) {\n            return -step;\n        }\n        return 0;\n    }\n    function getVerticalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowDown',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowUp',\n        };\n    }\n    function getHorizontalStepKeys(ev) {\n        return {\n            altKey: ev.altKey,\n            downKey: ev.key === 'ArrowLeft',\n            shiftKey: ev.shiftKey,\n            upKey: ev.key === 'ArrowRight',\n        };\n    }\n    function isVerticalArrowKey(key) {\n        return key === 'ArrowUp' || key === 'ArrowDown';\n    }\n    function isArrowKey(key) {\n        return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n    }\n\n    function computeOffset$1(ev, elem) {\n        const win = elem.ownerDocument.defaultView;\n        const rect = elem.getBoundingClientRect();\n        return {\n            x: ev.pageX - (((win && win.scrollX) || 0) + rect.left),\n            y: ev.pageY - (((win && win.scrollY) || 0) + rect.top),\n        };\n    }\n    class PointerHandler {\n        constructor(element) {\n            this.lastTouch_ = null;\n            this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n            this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n            this.onMouseDown_ = this.onMouseDown_.bind(this);\n            this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n            this.onTouchMove_ = this.onTouchMove_.bind(this);\n            this.onTouchStart_ = this.onTouchStart_.bind(this);\n            this.elem_ = element;\n            this.emitter = new Emitter();\n            element.addEventListener('touchstart', this.onTouchStart_, {\n                passive: false,\n            });\n            element.addEventListener('touchmove', this.onTouchMove_, {\n                passive: true,\n            });\n            element.addEventListener('touchend', this.onTouchEnd_);\n            element.addEventListener('mousedown', this.onMouseDown_);\n        }\n        computePosition_(offset) {\n            const rect = this.elem_.getBoundingClientRect();\n            return {\n                bounds: {\n                    width: rect.width,\n                    height: rect.height,\n                },\n                point: offset\n                    ? {\n                        x: offset.x,\n                        y: offset.y,\n                    }\n                    : null,\n            };\n        }\n        onMouseDown_(ev) {\n            var _a;\n            ev.preventDefault();\n            (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n            const doc = this.elem_.ownerDocument;\n            doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseMove_(ev) {\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onDocumentMouseUp_(ev) {\n            const doc = this.elem_.ownerDocument;\n            doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n            doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n        onTouchStart_(ev) {\n            ev.preventDefault();\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('down', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchMove_(ev) {\n            const touch = ev.targetTouches.item(0);\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('move', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n            this.lastTouch_ = touch;\n        }\n        onTouchEnd_(ev) {\n            var _a;\n            const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n            const rect = this.elem_.getBoundingClientRect();\n            this.emitter.emit('up', {\n                altKey: ev.altKey,\n                data: this.computePosition_(touch\n                    ? {\n                        x: touch.clientX - rect.left,\n                        y: touch.clientY - rect.top,\n                    }\n                    : undefined),\n                sender: this,\n                shiftKey: ev.shiftKey,\n            });\n        }\n    }\n\n    function mapRange(value, start1, end1, start2, end2) {\n        const p = (value - start1) / (end1 - start1);\n        return start2 + p * (end2 - start2);\n    }\n    function getDecimalDigits(value) {\n        const text = String(value.toFixed(10));\n        const frac = text.split('.')[1];\n        return frac.replace(/0+$/, '').length;\n    }\n    function constrainRange(value, min, max) {\n        return Math.min(Math.max(value, min), max);\n    }\n    function loopRange(value, max) {\n        return ((value % max) + max) % max;\n    }\n\n    const className$g = ClassName('txt');\n    class NumberTextView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$g(), className$g(undefined, 'num'));\n            if (config.arrayPosition) {\n                this.element.classList.add(className$g(undefined, config.arrayPosition));\n            }\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$g('i'));\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n            this.dragging_ = config.dragging;\n            this.dragging_.emitter.on('change', this.onDraggingChange_);\n            this.element.classList.add(className$g());\n            this.inputElement.classList.add(className$g('i'));\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$g('k'));\n            this.element.appendChild(knobElem);\n            this.knobElement = knobElem;\n            const guideElem = doc.createElementNS(SVG_NS, 'svg');\n            guideElem.classList.add(className$g('g'));\n            this.knobElement.appendChild(guideElem);\n            const bodyElem = doc.createElementNS(SVG_NS, 'path');\n            bodyElem.classList.add(className$g('gb'));\n            guideElem.appendChild(bodyElem);\n            this.guideBodyElem_ = bodyElem;\n            const headElem = doc.createElementNS(SVG_NS, 'path');\n            headElem.classList.add(className$g('gh'));\n            guideElem.appendChild(headElem);\n            this.guideHeadElem_ = headElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(ClassName('tt')());\n            this.knobElement.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.refresh();\n        }\n        onDraggingChange_(ev) {\n            if (ev.rawValue === null) {\n                this.element.classList.remove(className$g(undefined, 'drg'));\n                return;\n            }\n            this.element.classList.add(className$g(undefined, 'drg'));\n            const x = ev.rawValue / this.props_.get('draggingScale');\n            const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n            const adx = constrainRange(-aox, -4, +4);\n            this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n            this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n            const formatter = this.props_.get('formatter');\n            this.tooltipElem_.textContent = formatter(this.value.rawValue);\n            this.tooltipElem_.style.left = `${x}px`;\n        }\n        refresh() {\n            const formatter = this.props_.get('formatter');\n            this.inputElement.value = formatter(this.value.rawValue);\n        }\n        onChange_() {\n            this.refresh();\n        }\n    }\n\n    class NumberTextController {\n        constructor(doc, config) {\n            this.originRawValue_ = 0;\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n            this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.parser_ = config.parser;\n            this.props = config.props;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.dragging_ = createValue(null);\n            this.view = new NumberTextView(doc, {\n                arrayPosition: config.arrayPosition,\n                dragging: this.dragging_,\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n            this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n            this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n            const ph = new PointerHandler(this.view.knobElement);\n            ph.emitter.on('down', this.onPointerDown_);\n            ph.emitter.on('move', this.onPointerMove_);\n            ph.emitter.on('up', this.onPointerUp_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            const value = inputElem.value;\n            const parsedValue = this.parser_(value);\n            if (!isEmpty(parsedValue)) {\n                this.value.rawValue = parsedValue;\n            }\n            this.view.refresh();\n        }\n        onInputKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onInputKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getVerticalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPointerDown_() {\n            this.originRawValue_ = this.value.rawValue;\n            this.dragging_.rawValue = 0;\n        }\n        computeDraggingValue_(data) {\n            if (!data.point) {\n                return null;\n            }\n            const dx = data.point.x - data.bounds.width / 2;\n            return this.originRawValue_ + dx * this.props.get('draggingScale');\n        }\n        onPointerMove_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: false,\n                last: false,\n            });\n            this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n        }\n        onPointerUp_(ev) {\n            const v = this.computeDraggingValue_(ev.data);\n            if (v === null) {\n                return;\n            }\n            this.value.setRawValue(v, {\n                forceEmit: true,\n                last: true,\n            });\n            this.dragging_.rawValue = null;\n        }\n    }\n\n    const className$f = ClassName('sld');\n    class SliderView {\n        constructor(doc, config) {\n            this.onChange_ = this.onChange_.bind(this);\n            this.props_ = config.props;\n            this.props_.emitter.on('change', this.onChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$f());\n            config.viewProps.bindClassModifiers(this.element);\n            const trackElem = doc.createElement('div');\n            trackElem.classList.add(className$f('t'));\n            config.viewProps.bindTabIndex(trackElem);\n            this.element.appendChild(trackElem);\n            this.trackElement = trackElem;\n            const knobElem = doc.createElement('div');\n            knobElem.classList.add(className$f('k'));\n            this.trackElement.appendChild(knobElem);\n            this.knobElement = knobElem;\n            config.value.emitter.on('change', this.onChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('minValue'), this.props_.get('maxValue'), 0, 100), 0, 100);\n            this.knobElement.style.width = `${p}%`;\n        }\n        onChange_() {\n            this.update_();\n        }\n    }\n\n    class SliderController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.baseStep_ = config.baseStep;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.props = config.props;\n            this.view = new SliderView(doc, {\n                props: this.props,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.trackElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n            this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('minValue'), this.props.get('maxValue')), opts);\n        }\n        onPointerDownOrMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue + step, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(this.baseStep_, getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$e = ClassName('sldtxt');\n    class SliderTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$e());\n            const sliderElem = doc.createElement('div');\n            sliderElem.classList.add(className$e('s'));\n            this.sliderView_ = config.sliderView;\n            sliderElem.appendChild(this.sliderView_.element);\n            this.element.appendChild(sliderElem);\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$e('t'));\n            this.textView_ = config.textView;\n            textElem.appendChild(this.textView_.element);\n            this.element.appendChild(textElem);\n        }\n    }\n\n    class SliderTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.sliderC_ = new SliderController(doc, {\n                baseStep: config.baseStep,\n                props: config.sliderProps,\n                value: config.value,\n                viewProps: this.viewProps,\n            });\n            this.textC_ = new NumberTextController(doc, {\n                baseStep: config.baseStep,\n                parser: config.parser,\n                props: config.textProps,\n                value: config.value,\n                viewProps: config.viewProps,\n            });\n            this.view = new SliderTextView(doc, {\n                sliderView: this.sliderC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get sliderController() {\n            return this.sliderC_;\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    function writePrimitive(target, value) {\n        target.write(value);\n    }\n\n    function parseListOptions(value) {\n        const p = ParamsParsers;\n        if (Array.isArray(value)) {\n            return p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            }))(value).value;\n        }\n        if (typeof value === 'object') {\n            return p.required.raw(value)\n                .value;\n        }\n        return undefined;\n    }\n    function parsePickerLayout(value) {\n        if (value === 'inline' || value === 'popup') {\n            return value;\n        }\n        return undefined;\n    }\n    function parsePointDimensionParams(value) {\n        const p = ParamsParsers;\n        return p.required.object({\n            max: p.optional.number,\n            min: p.optional.number,\n            step: p.optional.number,\n        })(value).value;\n    }\n    function normalizeListOptions(options) {\n        if (Array.isArray(options)) {\n            return options;\n        }\n        const items = [];\n        Object.keys(options).forEach((text) => {\n            items.push({ text: text, value: options[text] });\n        });\n        return items;\n    }\n    function createListConstraint(options) {\n        return !isEmpty(options)\n            ? new ListConstraint(normalizeListOptions(forceCast(options)))\n            : null;\n    }\n    function findListItems(constraint) {\n        const c = constraint\n            ? findConstraint(constraint, ListConstraint)\n            : null;\n        if (!c) {\n            return null;\n        }\n        return c.options;\n    }\n    function findStep(constraint) {\n        const c = constraint ? findConstraint(constraint, StepConstraint) : null;\n        if (!c) {\n            return null;\n        }\n        return c.step;\n    }\n    function getSuitableDecimalDigits(constraint, rawValue) {\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        if (sc) {\n            return getDecimalDigits(sc.step);\n        }\n        return Math.max(getDecimalDigits(rawValue), 2);\n    }\n    function getBaseStep(constraint) {\n        const step = findStep(constraint);\n        return step !== null && step !== void 0 ? step : 1;\n    }\n    function getSuitableDraggingScale(constraint, rawValue) {\n        var _a;\n        const sc = constraint && findConstraint(constraint, StepConstraint);\n        const base = Math.abs((_a = sc === null || sc === void 0 ? void 0 : sc.step) !== null && _a !== void 0 ? _a : rawValue);\n        return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n    }\n\n    const className$d = ClassName('ckb');\n    class CheckboxView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$d());\n            config.viewProps.bindClassModifiers(this.element);\n            const labelElem = doc.createElement('label');\n            labelElem.classList.add(className$d('l'));\n            this.element.appendChild(labelElem);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$d('i'));\n            inputElem.type = 'checkbox';\n            labelElem.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.viewProps.bindDisabled(this.inputElement);\n            const wrapperElem = doc.createElement('div');\n            wrapperElem.classList.add(className$d('w'));\n            labelElem.appendChild(wrapperElem);\n            const markElem = createSvgIconElement(doc, 'check');\n            wrapperElem.appendChild(markElem);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            this.inputElement.checked = this.value.rawValue;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class CheckboxController {\n        constructor(doc, config) {\n            this.onInputChange_ = this.onInputChange_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new CheckboxView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view.inputElement.addEventListener('change', this.onInputChange_);\n        }\n        onInputChange_(e) {\n            const inputElem = forceCast(e.currentTarget);\n            this.value.rawValue = inputElem.checked;\n        }\n    }\n\n    function createConstraint$5(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const BooleanInputPlugin = {\n        id: 'input-bool',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n            constraint: (args) => createConstraint$5(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(doc, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new CheckboxController(doc, {\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const className$c = ClassName('col');\n    class ColorView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$c());\n            config.foldable.bindExpandedClass(this.element, className$c(undefined, 'expanded'));\n            bindValueMap(config.foldable, 'completed', valueToClassName(this.element, className$c(undefined, 'cpl')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$c('h'));\n            this.element.appendChild(headElem);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$c('s'));\n            headElem.appendChild(swatchElem);\n            this.swatchElement = swatchElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$c('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$c('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    function rgbToHsl(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const c = cmax - cmin;\n        let h = 0;\n        let s = 0;\n        const l = (cmin + cmax) / 2;\n        if (c !== 0) {\n            s = c / (1 - Math.abs(cmax + cmin - 1));\n            if (rp === cmax) {\n                h = (gp - bp) / c;\n            }\n            else if (gp === cmax) {\n                h = 2 + (bp - rp) / c;\n            }\n            else {\n                h = 4 + (rp - gp) / c;\n            }\n            h = h / 6 + (h < 0 ? 1 : 0);\n        }\n        return [h * 360, s * 100, l * 100];\n    }\n    function hslToRgb(h, s, l) {\n        const hp = ((h % 360) + 360) % 360;\n        const sp = constrainRange(s / 100, 0, 1);\n        const lp = constrainRange(l / 100, 0, 1);\n        const c = (1 - Math.abs(2 * lp - 1)) * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = lp - c / 2;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function rgbToHsv(r, g, b) {\n        const rp = constrainRange(r / 255, 0, 1);\n        const gp = constrainRange(g / 255, 0, 1);\n        const bp = constrainRange(b / 255, 0, 1);\n        const cmax = Math.max(rp, gp, bp);\n        const cmin = Math.min(rp, gp, bp);\n        const d = cmax - cmin;\n        let h;\n        if (d === 0) {\n            h = 0;\n        }\n        else if (cmax === rp) {\n            h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n        }\n        else if (cmax === gp) {\n            h = 60 * ((bp - rp) / d + 2);\n        }\n        else {\n            h = 60 * ((rp - gp) / d + 4);\n        }\n        const s = cmax === 0 ? 0 : d / cmax;\n        const v = cmax;\n        return [h, s * 100, v * 100];\n    }\n    function hsvToRgb(h, s, v) {\n        const hp = loopRange(h, 360);\n        const sp = constrainRange(s / 100, 0, 1);\n        const vp = constrainRange(v / 100, 0, 1);\n        const c = vp * sp;\n        const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n        const m = vp - c;\n        let rp, gp, bp;\n        if (hp >= 0 && hp < 60) {\n            [rp, gp, bp] = [c, x, 0];\n        }\n        else if (hp >= 60 && hp < 120) {\n            [rp, gp, bp] = [x, c, 0];\n        }\n        else if (hp >= 120 && hp < 180) {\n            [rp, gp, bp] = [0, c, x];\n        }\n        else if (hp >= 180 && hp < 240) {\n            [rp, gp, bp] = [0, x, c];\n        }\n        else if (hp >= 240 && hp < 300) {\n            [rp, gp, bp] = [x, 0, c];\n        }\n        else {\n            [rp, gp, bp] = [c, 0, x];\n        }\n        return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n    }\n    function hslToHsv(h, s, l) {\n        const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n        return [\n            h,\n            sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n            l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n        ];\n    }\n    function hsvToHsl(h, s, v) {\n        const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n        return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n    }\n    function removeAlphaComponent(comps) {\n        return [comps[0], comps[1], comps[2]];\n    }\n    function appendAlphaComponent(comps, alpha) {\n        return [comps[0], comps[1], comps[2], alpha];\n    }\n    const MODE_CONVERTER_MAP = {\n        hsl: {\n            hsl: (h, s, l) => [h, s, l],\n            hsv: hslToHsv,\n            rgb: hslToRgb,\n        },\n        hsv: {\n            hsl: hsvToHsl,\n            hsv: (h, s, v) => [h, s, v],\n            rgb: hsvToRgb,\n        },\n        rgb: {\n            hsl: rgbToHsl,\n            hsv: rgbToHsv,\n            rgb: (r, g, b) => [r, g, b],\n        },\n    };\n    function convertColorMode(components, fromMode, toMode) {\n        return MODE_CONVERTER_MAP[fromMode][toMode](...components);\n    }\n\n    const CONSTRAINT_MAP = {\n        hsl: (comps) => {\n            var _a;\n            return [\n                loopRange(comps[0], 360),\n                constrainRange(comps[1], 0, 100),\n                constrainRange(comps[2], 0, 100),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n        hsv: (comps) => {\n            var _a;\n            return [\n                loopRange(comps[0], 360),\n                constrainRange(comps[1], 0, 100),\n                constrainRange(comps[2], 0, 100),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n        rgb: (comps) => {\n            var _a;\n            return [\n                constrainRange(comps[0], 0, 255),\n                constrainRange(comps[1], 0, 255),\n                constrainRange(comps[2], 0, 255),\n                constrainRange((_a = comps[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n            ];\n        },\n    };\n    function isRgbColorComponent(obj, key) {\n        if (typeof obj !== 'object' || isEmpty(obj)) {\n            return false;\n        }\n        return key in obj && typeof obj[key] === 'number';\n    }\n    class Color {\n        constructor(comps, mode) {\n            this.mode_ = mode;\n            this.comps_ = CONSTRAINT_MAP[mode](comps);\n        }\n        static black() {\n            return new Color([0, 0, 0], 'rgb');\n        }\n        static fromObject(obj) {\n            const comps = 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n            return new Color(comps, 'rgb');\n        }\n        static toRgbaObject(color) {\n            return color.toRgbaObject();\n        }\n        static isRgbColorObject(obj) {\n            return (isRgbColorComponent(obj, 'r') &&\n                isRgbColorComponent(obj, 'g') &&\n                isRgbColorComponent(obj, 'b'));\n        }\n        static isRgbaColorObject(obj) {\n            return this.isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n        }\n        static isColorObject(obj) {\n            return this.isRgbColorObject(obj);\n        }\n        static equals(v1, v2) {\n            if (v1.mode_ !== v2.mode_) {\n                return false;\n            }\n            const comps1 = v1.comps_;\n            const comps2 = v2.comps_;\n            for (let i = 0; i < comps1.length; i++) {\n                if (comps1[i] !== comps2[i]) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        get mode() {\n            return this.mode_;\n        }\n        getComponents(opt_mode) {\n            return appendAlphaComponent(convertColorMode(removeAlphaComponent(this.comps_), this.mode_, opt_mode || this.mode_), this.comps_[3]);\n        }\n        toRgbaObject() {\n            const rgbComps = this.getComponents('rgb');\n            return {\n                r: rgbComps[0],\n                g: rgbComps[1],\n                b: rgbComps[2],\n                a: rgbComps[3],\n            };\n        }\n    }\n\n    const className$b = ClassName('colp');\n    class ColorPickerView {\n        constructor(doc, config) {\n            this.alphaViews_ = null;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$b());\n            const hsvElem = doc.createElement('div');\n            hsvElem.classList.add(className$b('hsv'));\n            const svElem = doc.createElement('div');\n            svElem.classList.add(className$b('sv'));\n            this.svPaletteView_ = config.svPaletteView;\n            svElem.appendChild(this.svPaletteView_.element);\n            hsvElem.appendChild(svElem);\n            const hElem = doc.createElement('div');\n            hElem.classList.add(className$b('h'));\n            this.hPaletteView_ = config.hPaletteView;\n            hElem.appendChild(this.hPaletteView_.element);\n            hsvElem.appendChild(hElem);\n            this.element.appendChild(hsvElem);\n            const rgbElem = doc.createElement('div');\n            rgbElem.classList.add(className$b('rgb'));\n            this.textView_ = config.textView;\n            rgbElem.appendChild(this.textView_.element);\n            this.element.appendChild(rgbElem);\n            if (config.alphaViews) {\n                this.alphaViews_ = {\n                    palette: config.alphaViews.palette,\n                    text: config.alphaViews.text,\n                };\n                const aElem = doc.createElement('div');\n                aElem.classList.add(className$b('a'));\n                const apElem = doc.createElement('div');\n                apElem.classList.add(className$b('ap'));\n                apElem.appendChild(this.alphaViews_.palette.element);\n                aElem.appendChild(apElem);\n                const atElem = doc.createElement('div');\n                atElem.classList.add(className$b('at'));\n                atElem.appendChild(this.alphaViews_.text.element);\n                aElem.appendChild(atElem);\n                this.element.appendChild(aElem);\n            }\n        }\n        get allFocusableElements() {\n            const elems = [\n                this.svPaletteView_.element,\n                this.hPaletteView_.element,\n                this.textView_.modeSelectElement,\n                ...this.textView_.textViews.map((v) => v.inputElement),\n            ];\n            if (this.alphaViews_) {\n                elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n            }\n            return elems;\n        }\n    }\n\n    function parseColorInputParams(params) {\n        const p = ParamsParsers;\n        return parseParams(params, {\n            alpha: p.optional.boolean,\n            expanded: p.optional.boolean,\n            picker: p.optional.custom(parsePickerLayout),\n        });\n    }\n    function getBaseStepForColor(forAlpha) {\n        return forAlpha ? 0.1 : 1;\n    }\n\n    function parseCssNumberOrPercentage(text, maxValue) {\n        const m = text.match(/^(.+)%$/);\n        if (!m) {\n            return Math.min(parseFloat(text), maxValue);\n        }\n        return Math.min(parseFloat(m[1]) * 0.01 * maxValue, maxValue);\n    }\n    const ANGLE_TO_DEG_MAP = {\n        deg: (angle) => angle,\n        grad: (angle) => (angle * 360) / 400,\n        rad: (angle) => (angle * 360) / (2 * Math.PI),\n        turn: (angle) => angle * 360,\n    };\n    function parseCssNumberOrAngle(text) {\n        const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n        if (!m) {\n            return parseFloat(text);\n        }\n        const angle = parseFloat(m[1]);\n        const unit = m[2];\n        return ANGLE_TO_DEG_MAP[unit](angle);\n    }\n    const NOTATION_TO_PARSER_MAP = {\n        'func.rgb': (text) => {\n            const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrPercentage(m[1], 255),\n                parseCssNumberOrPercentage(m[2], 255),\n                parseCssNumberOrPercentage(m[3], 255),\n            ];\n            if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n                return null;\n            }\n            return new Color(comps, 'rgb');\n        },\n        'func.rgba': (text) => {\n            const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrPercentage(m[1], 255),\n                parseCssNumberOrPercentage(m[2], 255),\n                parseCssNumberOrPercentage(m[3], 255),\n                parseCssNumberOrPercentage(m[4], 1),\n            ];\n            if (isNaN(comps[0]) ||\n                isNaN(comps[1]) ||\n                isNaN(comps[2]) ||\n                isNaN(comps[3])) {\n                return null;\n            }\n            return new Color(comps, 'rgb');\n        },\n        'func.hsl': (text) => {\n            const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrAngle(m[1]),\n                parseCssNumberOrPercentage(m[2], 100),\n                parseCssNumberOrPercentage(m[3], 100),\n            ];\n            if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n                return null;\n            }\n            return new Color(comps, 'hsl');\n        },\n        'func.hsla': (text) => {\n            const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n            if (!m) {\n                return null;\n            }\n            const comps = [\n                parseCssNumberOrAngle(m[1]),\n                parseCssNumberOrPercentage(m[2], 100),\n                parseCssNumberOrPercentage(m[3], 100),\n                parseCssNumberOrPercentage(m[4], 1),\n            ];\n            if (isNaN(comps[0]) ||\n                isNaN(comps[1]) ||\n                isNaN(comps[2]) ||\n                isNaN(comps[3])) {\n                return null;\n            }\n            return new Color(comps, 'hsl');\n        },\n        'hex.rgb': (text) => {\n            const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n            if (mRgb) {\n                return new Color([\n                    parseInt(mRgb[1] + mRgb[1], 16),\n                    parseInt(mRgb[2] + mRgb[2], 16),\n                    parseInt(mRgb[3] + mRgb[3], 16),\n                ], 'rgb');\n            }\n            const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n            if (mRrggbb) {\n                return new Color([\n                    parseInt(mRrggbb[1], 16),\n                    parseInt(mRrggbb[2], 16),\n                    parseInt(mRrggbb[3], 16),\n                ], 'rgb');\n            }\n            return null;\n        },\n        'hex.rgba': (text) => {\n            const mRgb = text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n            if (mRgb) {\n                return new Color([\n                    parseInt(mRgb[1] + mRgb[1], 16),\n                    parseInt(mRgb[2] + mRgb[2], 16),\n                    parseInt(mRgb[3] + mRgb[3], 16),\n                    mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n                ], 'rgb');\n            }\n            const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n            if (mRrggbb) {\n                return new Color([\n                    parseInt(mRrggbb[1], 16),\n                    parseInt(mRrggbb[2], 16),\n                    parseInt(mRrggbb[3], 16),\n                    mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n                ], 'rgb');\n            }\n            return null;\n        },\n    };\n    function getColorNotation(text) {\n        const notations = Object.keys(NOTATION_TO_PARSER_MAP);\n        return notations.reduce((result, notation) => {\n            if (result) {\n                return result;\n            }\n            const subparser = NOTATION_TO_PARSER_MAP[notation];\n            return subparser(text) ? notation : null;\n        }, null);\n    }\n    const CompositeColorParser = (text) => {\n        const notation = getColorNotation(text);\n        return notation ? NOTATION_TO_PARSER_MAP[notation](text) : null;\n    };\n    function hasAlphaComponent(notation) {\n        return (notation === 'func.hsla' ||\n            notation === 'func.rgba' ||\n            notation === 'hex.rgba');\n    }\n    function colorFromString(value) {\n        if (typeof value === 'string') {\n            const cv = CompositeColorParser(value);\n            if (cv) {\n                return cv;\n            }\n        }\n        return Color.black();\n    }\n    function zerofill(comp) {\n        const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n        return hex.length === 1 ? `0${hex}` : hex;\n    }\n    function colorToHexRgbString(value, prefix = '#') {\n        const hexes = removeAlphaComponent(value.getComponents('rgb'))\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToHexRgbaString(value, prefix = '#') {\n        const rgbaComps = value.getComponents('rgb');\n        const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n            .map(zerofill)\n            .join('');\n        return `${prefix}${hexes}`;\n    }\n    function colorToFunctionalRgbString(value) {\n        const formatter = createNumberFormatter(0);\n        const comps = removeAlphaComponent(value.getComponents('rgb')).map((comp) => formatter(comp));\n        return `rgb(${comps.join(', ')})`;\n    }\n    function colorToFunctionalRgbaString(value) {\n        const aFormatter = createNumberFormatter(2);\n        const rgbFormatter = createNumberFormatter(0);\n        const comps = value.getComponents('rgb').map((comp, index) => {\n            const formatter = index === 3 ? aFormatter : rgbFormatter;\n            return formatter(comp);\n        });\n        return `rgba(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n        ];\n        const comps = removeAlphaComponent(value.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n        return `hsl(${comps.join(', ')})`;\n    }\n    function colorToFunctionalHslaString(value) {\n        const formatters = [\n            createNumberFormatter(0),\n            formatPercentage,\n            formatPercentage,\n            createNumberFormatter(2),\n        ];\n        const comps = value\n            .getComponents('hsl')\n            .map((comp, index) => formatters[index](comp));\n        return `hsla(${comps.join(', ')})`;\n    }\n    const NOTATION_TO_STRINGIFIER_MAP = {\n        'func.hsl': colorToFunctionalHslString,\n        'func.hsla': colorToFunctionalHslaString,\n        'func.rgb': colorToFunctionalRgbString,\n        'func.rgba': colorToFunctionalRgbaString,\n        'hex.rgb': colorToHexRgbString,\n        'hex.rgba': colorToHexRgbaString,\n    };\n    function getColorStringifier(notation) {\n        return NOTATION_TO_STRINGIFIER_MAP[notation];\n    }\n\n    const className$a = ClassName('apl');\n    class APaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$a());\n            config.viewProps.bindTabIndex(this.element);\n            const barElem = doc.createElement('div');\n            barElem.classList.add(className$a('b'));\n            this.element.appendChild(barElem);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$a('c'));\n            barElem.appendChild(colorElem);\n            this.colorElem_ = colorElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$a('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            const previewElem = doc.createElement('div');\n            previewElem.classList.add(className$a('p'));\n            this.markerElem_.appendChild(previewElem);\n            this.previewElem_ = previewElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const rgbaComps = c.getComponents('rgb');\n            const leftColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n            const rightColor = new Color([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n            const gradientComps = [\n                'to right',\n                colorToFunctionalRgbaString(leftColor),\n                colorToFunctionalRgbaString(rightColor),\n            ];\n            this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n            this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n            const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class APaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new APaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const alpha = d.point.x / d.bounds.width;\n            const c = this.value.rawValue;\n            const [h, s, v] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, alpha], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h, s, v, a + step], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(true), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$9 = ClassName('coltxt');\n    function createModeSelectElement(doc) {\n        const selectElem = doc.createElement('select');\n        const items = [\n            { text: 'RGB', value: 'rgb' },\n            { text: 'HSL', value: 'hsl' },\n            { text: 'HSV', value: 'hsv' },\n        ];\n        selectElem.appendChild(items.reduce((frag, item) => {\n            const optElem = doc.createElement('option');\n            optElem.textContent = item.text;\n            optElem.value = item.value;\n            frag.appendChild(optElem);\n            return frag;\n        }, doc.createDocumentFragment()));\n        return selectElem;\n    }\n    class ColorTextView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$9());\n            const modeElem = doc.createElement('div');\n            modeElem.classList.add(className$9('m'));\n            this.modeElem_ = createModeSelectElement(doc);\n            this.modeElem_.classList.add(className$9('ms'));\n            modeElem.appendChild(this.modeSelectElement);\n            const modeMarkerElem = doc.createElement('div');\n            modeMarkerElem.classList.add(className$9('mm'));\n            modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n            modeElem.appendChild(modeMarkerElem);\n            this.element.appendChild(modeElem);\n            const textsElem = doc.createElement('div');\n            textsElem.classList.add(className$9('w'));\n            this.element.appendChild(textsElem);\n            this.textsElem_ = textsElem;\n            this.textViews_ = config.textViews;\n            this.applyTextViews_();\n            bindValue(config.colorMode, (mode) => {\n                this.modeElem_.value = mode;\n            });\n        }\n        get modeSelectElement() {\n            return this.modeElem_;\n        }\n        get textViews() {\n            return this.textViews_;\n        }\n        set textViews(textViews) {\n            this.textViews_ = textViews;\n            this.applyTextViews_();\n        }\n        applyTextViews_() {\n            removeChildElements(this.textsElem_);\n            const doc = this.element.ownerDocument;\n            this.textViews_.forEach((v) => {\n                const compElem = doc.createElement('div');\n                compElem.classList.add(className$9('c'));\n                compElem.appendChild(v.element);\n                this.textsElem_.appendChild(compElem);\n            });\n        }\n    }\n\n    const FORMATTER = createNumberFormatter(0);\n    const MODE_TO_CONSTRAINT_MAP = {\n        rgb: () => {\n            return new RangeConstraint({ min: 0, max: 255 });\n        },\n        hsl: (index) => {\n            return index === 0\n                ? new RangeConstraint({ min: 0, max: 360 })\n                : new RangeConstraint({ min: 0, max: 100 });\n        },\n        hsv: (index) => {\n            return index === 0\n                ? new RangeConstraint({ min: 0, max: 360 })\n                : new RangeConstraint({ min: 0, max: 100 });\n        },\n    };\n    function createComponentController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n            baseStep: getBaseStepForColor(false),\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                draggingScale: 1,\n                formatter: FORMATTER,\n            }),\n            value: createValue(0, {\n                constraint: MODE_TO_CONSTRAINT_MAP[config.colorMode](index),\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class ColorTextController {\n        constructor(doc, config) {\n            this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n            this.parser_ = config.parser;\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.colorMode = createValue(this.value.rawValue.mode);\n            this.ccs_ = this.createComponentControllers_(doc);\n            this.view = new ColorTextView(doc, {\n                colorMode: this.colorMode,\n                textViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n            });\n            this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n        }\n        createComponentControllers_(doc) {\n            const cc = {\n                colorMode: this.colorMode.rawValue,\n                parser: this.parser_,\n                viewProps: this.viewProps,\n            };\n            const ccs = [\n                createComponentController(doc, cc, 0),\n                createComponentController(doc, cc, 1),\n                createComponentController(doc, cc, 2),\n            ];\n            ccs.forEach((cs, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: cs.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents(this.colorMode.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const pickedMode = this.colorMode.rawValue;\n                        const comps = p.rawValue.getComponents(pickedMode);\n                        comps[index] = s.rawValue;\n                        return new Color(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode);\n                    },\n                });\n            });\n            return ccs;\n        }\n        onModeSelectChange_(ev) {\n            const selectElem = ev.currentTarget;\n            this.colorMode.rawValue = selectElem.value;\n            this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n            this.view.textViews = [\n                this.ccs_[0].view,\n                this.ccs_[1].view,\n                this.ccs_[2].view,\n            ];\n        }\n    }\n\n    const className$8 = ClassName('hpl');\n    class HPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$8());\n            config.viewProps.bindTabIndex(this.element);\n            const colorElem = doc.createElement('div');\n            colorElem.classList.add(className$8('c'));\n            this.element.appendChild(colorElem);\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$8('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const c = this.value.rawValue;\n            const [h] = c.getComponents('hsv');\n            this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new Color([h, 100, 100], 'hsv'));\n            const left = mapRange(h, 0, 360, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class HPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new HPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const hue = mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, 0, 359);\n            const c = this.value.rawValue;\n            const [, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([hue, s, v, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const [h, s, v, a] = c.getComponents('hsv');\n            this.value.setRawValue(new Color([h + step, s, v, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const step = getStepForKey(getBaseStepForColor(false), getHorizontalStepKeys(ev));\n            if (step === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    const className$7 = ClassName('svp');\n    const CANVAS_RESOL = 64;\n    class SvPaletteView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$7());\n            config.viewProps.bindTabIndex(this.element);\n            const canvasElem = doc.createElement('canvas');\n            canvasElem.height = CANVAS_RESOL;\n            canvasElem.width = CANVAS_RESOL;\n            canvasElem.classList.add(className$7('c'));\n            this.element.appendChild(canvasElem);\n            this.canvasElement = canvasElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$7('m'));\n            this.element.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            this.update_();\n        }\n        update_() {\n            const ctx = getCanvasContext(this.canvasElement);\n            if (!ctx) {\n                return;\n            }\n            const c = this.value.rawValue;\n            const hsvComps = c.getComponents('hsv');\n            const width = this.canvasElement.width;\n            const height = this.canvasElement.height;\n            const imgData = ctx.getImageData(0, 0, width, height);\n            const data = imgData.data;\n            for (let iy = 0; iy < height; iy++) {\n                for (let ix = 0; ix < width; ix++) {\n                    const s = mapRange(ix, 0, width, 0, 100);\n                    const v = mapRange(iy, 0, height, 100, 0);\n                    const rgbComps = hsvToRgb(hsvComps[0], s, v);\n                    const i = (iy * width + ix) * 4;\n                    data[i] = rgbComps[0];\n                    data[i + 1] = rgbComps[1];\n                    data[i + 2] = rgbComps[2];\n                    data[i + 3] = 255;\n                }\n            }\n            ctx.putImageData(imgData, 0, 0);\n            const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n            this.markerElem_.style.left = `${left}%`;\n            const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n            this.markerElem_.style.top = `${top}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class SvPaletteController {\n        constructor(doc, config) {\n            this.onKeyDown_ = this.onKeyDown_.bind(this);\n            this.onKeyUp_ = this.onKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SvPaletteView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.element);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.element.addEventListener('keydown', this.onKeyDown_);\n            this.view.element.addEventListener('keyup', this.onKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n            const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n            const [h, , , a] = this.value.rawValue.getComponents('hsv');\n            this.value.setRawValue(new Color([h, saturation, value, a], 'hsv'), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(new Color([h, s + ds, v + dv, a], 'hsv'), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onKeyUp_(ev) {\n            const baseStep = getBaseStepForColor(false);\n            const ds = getStepForKey(baseStep, getHorizontalStepKeys(ev));\n            const dv = getStepForKey(baseStep, getVerticalStepKeys(ev));\n            if (ds === 0 && dv === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class ColorPickerController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.hPaletteC_ = new HPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.svPaletteC_ = new SvPaletteController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.alphaIcs_ = config.supportsAlpha\n                ? {\n                    palette: new APaletteController(doc, {\n                        value: this.value,\n                        viewProps: this.viewProps,\n                    }),\n                    text: new NumberTextController(doc, {\n                        parser: parseNumber,\n                        baseStep: 0.1,\n                        props: ValueMap.fromObject({\n                            draggingScale: 0.01,\n                            formatter: createNumberFormatter(2),\n                        }),\n                        value: createValue(0, {\n                            constraint: new RangeConstraint({ min: 0, max: 1 }),\n                        }),\n                        viewProps: this.viewProps,\n                    }),\n                }\n                : null;\n            if (this.alphaIcs_) {\n                connectValues({\n                    primary: this.value,\n                    secondary: this.alphaIcs_.text.value,\n                    forward: (p) => {\n                        return p.rawValue.getComponents()[3];\n                    },\n                    backward: (p, s) => {\n                        const comps = p.rawValue.getComponents();\n                        comps[3] = s.rawValue;\n                        return new Color(comps, p.rawValue.mode);\n                    },\n                });\n            }\n            this.textC_ = new ColorTextController(doc, {\n                parser: parseNumber,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorPickerView(doc, {\n                alphaViews: this.alphaIcs_\n                    ? {\n                        palette: this.alphaIcs_.palette.view,\n                        text: this.alphaIcs_.text.view,\n                    }\n                    : null,\n                hPaletteView: this.hPaletteC_.view,\n                supportsAlpha: config.supportsAlpha,\n                svPaletteView: this.svPaletteC_.view,\n                textView: this.textC_.view,\n            });\n        }\n        get textController() {\n            return this.textC_;\n        }\n    }\n\n    const className$6 = ClassName('colsw');\n    class ColorSwatchView {\n        constructor(doc, config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$6());\n            config.viewProps.bindClassModifiers(this.element);\n            const swatchElem = doc.createElement('div');\n            swatchElem.classList.add(className$6('sw'));\n            this.element.appendChild(swatchElem);\n            this.swatchElem_ = swatchElem;\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$6('b'));\n            config.viewProps.bindDisabled(buttonElem);\n            this.element.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            this.update_();\n        }\n        update_() {\n            const value = this.value.rawValue;\n            this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n        }\n        onValueChange_() {\n            this.update_();\n        }\n    }\n\n    class ColorSwatchController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new ColorSwatchView(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    class ColorController {\n        constructor(doc, config) {\n            this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n            this.onButtonClick_ = this.onButtonClick_.bind(this);\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.swatchC_ = new ColorSwatchController(doc, {\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            const buttonElem = this.swatchC_.view.buttonElement;\n            buttonElem.addEventListener('blur', this.onButtonBlur_);\n            buttonElem.addEventListener('click', this.onButtonClick_);\n            this.textC_ = new TextController(doc, {\n                parser: config.parser,\n                props: ValueMap.fromObject({\n                    formatter: config.formatter,\n                }),\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new ColorView(doc, {\n                foldable: this.foldable_,\n                pickerLayout: config.pickerLayout,\n            });\n            this.view.swatchElement.appendChild(this.swatchC_.view.element);\n            this.view.textElement.appendChild(this.textC_.view.element);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const pickerC = new ColorPickerController(doc, {\n                supportsAlpha: config.supportsAlpha,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            pickerC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = pickerC;\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(pickerC.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        get textController() {\n            return this.textC_;\n        }\n        onButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.swatchC_.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.swatchC_.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function colorFromObject(value) {\n        if (Color.isColorObject(value)) {\n            return Color.fromObject(value);\n        }\n        return Color.black();\n    }\n    function colorToRgbNumber(value) {\n        return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n            return (result << 8) | (Math.floor(comp) & 0xff);\n        }, 0);\n    }\n    function colorToRgbaNumber(value) {\n        return (value.getComponents('rgb').reduce((result, comp, index) => {\n            const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n            return (result << 8) | hex;\n        }, 0) >>> 0);\n    }\n    function numberToRgbColor(num) {\n        return new Color([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n    }\n    function numberToRgbaColor(num) {\n        return new Color([\n            (num >> 24) & 0xff,\n            (num >> 16) & 0xff,\n            (num >> 8) & 0xff,\n            mapRange(num & 0xff, 0, 255, 0, 1),\n        ], 'rgb');\n    }\n    function colorFromRgbNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbColor(value);\n    }\n    function colorFromRgbaNumber(value) {\n        if (typeof value !== 'number') {\n            return Color.black();\n        }\n        return numberToRgbaColor(value);\n    }\n\n    function createColorStringWriter(notation) {\n        const stringify = getColorStringifier(notation);\n        return (target, value) => {\n            writePrimitive(target, stringify(value));\n        };\n    }\n    function createColorNumberWriter(supportsAlpha) {\n        const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n        return (target, value) => {\n            writePrimitive(target, colorToNumber(value));\n        };\n    }\n    function writeRgbaColorObject(target, value) {\n        const obj = value.toRgbaObject();\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n        target.writeProperty('a', obj.a);\n    }\n    function writeRgbColorObject(target, value) {\n        const obj = value.toRgbaObject();\n        target.writeProperty('r', obj.r);\n        target.writeProperty('g', obj.g);\n        target.writeProperty('b', obj.b);\n    }\n    function createColorObjectWriter(supportsAlpha) {\n        return supportsAlpha ? writeRgbaColorObject : writeRgbColorObject;\n    }\n\n    function shouldSupportAlpha$1(inputParams) {\n        return 'alpha' in inputParams && inputParams.alpha === true;\n    }\n    function createFormatter$1(supportsAlpha) {\n        return supportsAlpha\n            ? (v) => colorToHexRgbaString(v, '0x')\n            : (v) => colorToHexRgbString(v, '0x');\n    }\n    const NumberColorInputPlugin = {\n        id: 'input-color-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            if (!('view' in params)) {\n                return null;\n            }\n            if (params.view !== 'color') {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (args) => {\n                return shouldSupportAlpha$1(args.params)\n                    ? colorFromRgbaNumber\n                    : colorFromRgbNumber;\n            },\n            equals: Color.equals,\n            writer: (args) => {\n                return createColorNumberWriter(shouldSupportAlpha$1(args.params));\n            },\n        },\n        controller: (args) => {\n            const supportsAlpha = shouldSupportAlpha$1(args.params);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: createFormatter$1(supportsAlpha),\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function shouldSupportAlpha(initialValue) {\n        return Color.isRgbaColorObject(initialValue);\n    }\n    const ObjectColorInputPlugin = {\n        id: 'input-color-object',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Color.isColorObject(value)) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => colorFromObject,\n            equals: Color.equals,\n            writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue)),\n        },\n        controller: (args) => {\n            const supportsAlpha = Color.isRgbaColorObject(args.initialValue);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            const formatter = supportsAlpha\n                ? colorToHexRgbaString\n                : colorToHexRgbString;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: formatter,\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: supportsAlpha,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const StringColorInputPlugin = {\n        id: 'input-color-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            if ('view' in params && params.view === 'text') {\n                return null;\n            }\n            const notation = getColorNotation(value);\n            if (!notation) {\n                return null;\n            }\n            const result = parseColorInputParams(params);\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => colorFromString,\n            equals: Color.equals,\n            writer: (args) => {\n                const notation = getColorNotation(args.initialValue);\n                if (!notation) {\n                    throw TpError.shouldNeverHappen();\n                }\n                return createColorStringWriter(notation);\n            },\n        },\n        controller: (args) => {\n            const notation = getColorNotation(args.initialValue);\n            if (!notation) {\n                throw TpError.shouldNeverHappen();\n            }\n            const stringifier = getColorStringifier(notation);\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new ColorController(args.document, {\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                formatter: stringifier,\n                parser: CompositeColorParser,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                supportsAlpha: hasAlphaComponent(notation),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class PointNdConstraint {\n        constructor(config) {\n            this.components = config.components;\n            this.asm_ = config.assembly;\n        }\n        constrain(value) {\n            const comps = this.asm_\n                .toComponents(value)\n                .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n            return this.asm_.fromComponents(comps);\n        }\n    }\n\n    const className$5 = ClassName('pndtxt');\n    class PointNdTextView {\n        constructor(doc, config) {\n            this.textViews = config.textViews;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$5());\n            this.textViews.forEach((v) => {\n                const axisElem = doc.createElement('div');\n                axisElem.classList.add(className$5('a'));\n                axisElem.appendChild(v.element);\n                this.element.appendChild(axisElem);\n            });\n        }\n    }\n\n    function createAxisController(doc, config, index) {\n        return new NumberTextController(doc, {\n            arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n            baseStep: config.axes[index].baseStep,\n            parser: config.parser,\n            props: config.axes[index].textProps,\n            value: createValue(0, {\n                constraint: config.axes[index].constraint,\n            }),\n            viewProps: config.viewProps,\n        });\n    }\n    class PointNdTextController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n            this.acs_.forEach((c, index) => {\n                connectValues({\n                    primary: this.value,\n                    secondary: c.value,\n                    forward: (p) => {\n                        return config.assembly.toComponents(p.rawValue)[index];\n                    },\n                    backward: (p, s) => {\n                        const comps = config.assembly.toComponents(p.rawValue);\n                        comps[index] = s.rawValue;\n                        return config.assembly.fromComponents(comps);\n                    },\n                });\n            });\n            this.view = new PointNdTextView(doc, {\n                textViews: this.acs_.map((ac) => ac.view),\n            });\n        }\n    }\n\n    function createStepConstraint(params) {\n        if ('step' in params && !isEmpty(params.step)) {\n            return new StepConstraint(params.step);\n        }\n        return null;\n    }\n    function createRangeConstraint(params) {\n        if (('max' in params && !isEmpty(params.max)) ||\n            ('min' in params && !isEmpty(params.min))) {\n            return new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            });\n        }\n        return null;\n    }\n    function createConstraint$4(params) {\n        const constraints = [];\n        const sc = createStepConstraint(params);\n        if (sc) {\n            constraints.push(sc);\n        }\n        const rc = createRangeConstraint(params);\n        if (rc) {\n            constraints.push(rc);\n        }\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function findRange(constraint) {\n        const c = constraint ? findConstraint(constraint, RangeConstraint) : null;\n        if (!c) {\n            return [undefined, undefined];\n        }\n        return [c.minValue, c.maxValue];\n    }\n    function estimateSuitableRange(constraint) {\n        const [min, max] = findRange(constraint);\n        return [min !== null && min !== void 0 ? min : 0, max !== null && max !== void 0 ? max : 100];\n    }\n    const NumberInputPlugin = {\n        id: 'input-number',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                max: p.optional.number,\n                min: p.optional.number,\n                options: p.optional.custom(parseListOptions),\n                step: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => numberFromUnknown,\n            constraint: (args) => createConstraint$4(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a, _b;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(args.document, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            const formatter = (_b = ('format' in args.params ? args.params.format : undefined)) !== null && _b !== void 0 ? _b : createNumberFormatter(getSuitableDecimalDigits(c, value.rawValue));\n            if (c && findConstraint(c, RangeConstraint)) {\n                const [min, max] = estimateSuitableRange(c);\n                return new SliderTextController(args.document, {\n                    baseStep: getBaseStep(c),\n                    parser: parseNumber,\n                    sliderProps: ValueMap.fromObject({\n                        maxValue: max,\n                        minValue: min,\n                    }),\n                    textProps: ValueMap.fromObject({\n                        draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                        formatter: formatter,\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new NumberTextController(args.document, {\n                baseStep: getBaseStep(c),\n                parser: parseNumber,\n                props: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(c, value.rawValue),\n                    formatter: formatter,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point2d {\n        constructor(x = 0, y = 0) {\n            this.x = x;\n            this.y = y;\n        }\n        getComponents() {\n            return [this.x, this.y];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            if (typeof x !== 'number' || typeof y !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n            };\n        }\n    }\n    const Point2dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point2d(...comps),\n    };\n\n    const className$4 = ClassName('p2d');\n    class Point2dView {\n        constructor(doc, config) {\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$4());\n            config.viewProps.bindClassModifiers(this.element);\n            bindValue(config.expanded, valueToClassName(this.element, className$4(undefined, 'expanded')));\n            const headElem = doc.createElement('div');\n            headElem.classList.add(className$4('h'));\n            this.element.appendChild(headElem);\n            const buttonElem = doc.createElement('button');\n            buttonElem.classList.add(className$4('b'));\n            buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n            config.viewProps.bindDisabled(buttonElem);\n            headElem.appendChild(buttonElem);\n            this.buttonElement = buttonElem;\n            const textElem = doc.createElement('div');\n            textElem.classList.add(className$4('t'));\n            headElem.appendChild(textElem);\n            this.textElement = textElem;\n            if (config.pickerLayout === 'inline') {\n                const pickerElem = doc.createElement('div');\n                pickerElem.classList.add(className$4('p'));\n                this.element.appendChild(pickerElem);\n                this.pickerElement = pickerElem;\n            }\n            else {\n                this.pickerElement = null;\n            }\n        }\n    }\n\n    const className$3 = ClassName('p2dp');\n    class Point2dPickerView {\n        constructor(doc, config) {\n            this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.invertsY_ = config.invertsY;\n            this.maxValue_ = config.maxValue;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$3());\n            if (config.layout === 'popup') {\n                this.element.classList.add(className$3(undefined, 'p'));\n            }\n            const padElem = doc.createElement('div');\n            padElem.classList.add(className$3('p'));\n            config.viewProps.bindTabIndex(padElem);\n            this.element.appendChild(padElem);\n            this.padElement = padElem;\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className$3('g'));\n            this.padElement.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n            xAxisElem.classList.add(className$3('ax'));\n            xAxisElem.setAttributeNS(null, 'x1', '0');\n            xAxisElem.setAttributeNS(null, 'y1', '50%');\n            xAxisElem.setAttributeNS(null, 'x2', '100%');\n            xAxisElem.setAttributeNS(null, 'y2', '50%');\n            this.svgElem_.appendChild(xAxisElem);\n            const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n            yAxisElem.classList.add(className$3('ax'));\n            yAxisElem.setAttributeNS(null, 'x1', '50%');\n            yAxisElem.setAttributeNS(null, 'y1', '0');\n            yAxisElem.setAttributeNS(null, 'x2', '50%');\n            yAxisElem.setAttributeNS(null, 'y2', '100%');\n            this.svgElem_.appendChild(yAxisElem);\n            const lineElem = doc.createElementNS(SVG_NS, 'line');\n            lineElem.classList.add(className$3('l'));\n            lineElem.setAttributeNS(null, 'x1', '50%');\n            lineElem.setAttributeNS(null, 'y1', '50%');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const markerElem = doc.createElement('div');\n            markerElem.classList.add(className$3('m'));\n            this.padElement.appendChild(markerElem);\n            this.markerElem_ = markerElem;\n            config.value.emitter.on('change', this.onValueChange_);\n            this.value = config.value;\n            this.update_();\n        }\n        get allFocusableElements() {\n            return [this.padElement];\n        }\n        update_() {\n            const [x, y] = this.value.rawValue.getComponents();\n            const max = this.maxValue_;\n            const px = mapRange(x, -max, +max, 0, 100);\n            const py = mapRange(y, -max, +max, 0, 100);\n            const ipy = this.invertsY_ ? 100 - py : py;\n            this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n            this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n            this.markerElem_.style.left = `${px}%`;\n            this.markerElem_.style.top = `${ipy}%`;\n        }\n        onValueChange_() {\n            this.update_();\n        }\n        onFoldableChange_() {\n            this.update_();\n        }\n    }\n\n    function computeOffset(ev, baseSteps, invertsY) {\n        return [\n            getStepForKey(baseSteps[0], getHorizontalStepKeys(ev)),\n            getStepForKey(baseSteps[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n        ];\n    }\n    class Point2dPickerController {\n        constructor(doc, config) {\n            this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n            this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n            this.onPointerDown_ = this.onPointerDown_.bind(this);\n            this.onPointerMove_ = this.onPointerMove_.bind(this);\n            this.onPointerUp_ = this.onPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.baseSteps_ = config.baseSteps;\n            this.maxValue_ = config.maxValue;\n            this.invertsY_ = config.invertsY;\n            this.view = new Point2dPickerView(doc, {\n                invertsY: this.invertsY_,\n                layout: config.layout,\n                maxValue: this.maxValue_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.ptHandler_ = new PointerHandler(this.view.padElement);\n            this.ptHandler_.emitter.on('down', this.onPointerDown_);\n            this.ptHandler_.emitter.on('move', this.onPointerMove_);\n            this.ptHandler_.emitter.on('up', this.onPointerUp_);\n            this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n            this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n        }\n        handlePointerEvent_(d, opts) {\n            if (!d.point) {\n                return;\n            }\n            const max = this.maxValue_;\n            const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n            const py = mapRange(this.invertsY_ ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n            this.value.setRawValue(new Point2d(px, py), opts);\n        }\n        onPointerDown_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerMove_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPointerUp_(ev) {\n            this.handlePointerEvent_(ev.data, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n        onPadKeyDown_(ev) {\n            if (isArrowKey(ev.key)) {\n                ev.preventDefault();\n            }\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n                forceEmit: false,\n                last: false,\n            });\n        }\n        onPadKeyUp_(ev) {\n            const [dx, dy] = computeOffset(ev, this.baseSteps_, this.invertsY_);\n            if (dx === 0 && dy === 0) {\n                return;\n            }\n            this.value.setRawValue(this.value.rawValue, {\n                forceEmit: true,\n                last: true,\n            });\n        }\n    }\n\n    class Point2dController {\n        constructor(doc, config) {\n            var _a, _b;\n            this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n            this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n            this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n            this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.foldable_ = Foldable.create(config.expanded);\n            this.popC_ =\n                config.pickerLayout === 'popup'\n                    ? new PopupController(doc, {\n                        viewProps: this.viewProps,\n                    })\n                    : null;\n            const padC = new Point2dPickerController(doc, {\n                baseSteps: [config.axes[0].baseStep, config.axes[1].baseStep],\n                invertsY: config.invertsY,\n                layout: config.pickerLayout,\n                maxValue: config.maxValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            padC.view.allFocusableElements.forEach((elem) => {\n                elem.addEventListener('blur', this.onPopupChildBlur_);\n                elem.addEventListener('keydown', this.onPopupChildKeydown_);\n            });\n            this.pickerC_ = padC;\n            this.textC_ = new PointNdTextController(doc, {\n                assembly: Point2dAssembly,\n                axes: config.axes,\n                parser: config.parser,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            this.view = new Point2dView(doc, {\n                expanded: this.foldable_.value('expanded'),\n                pickerLayout: config.pickerLayout,\n                viewProps: this.viewProps,\n            });\n            this.view.textElement.appendChild(this.textC_.view.element);\n            (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n            (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n            if (this.popC_) {\n                this.view.element.appendChild(this.popC_.view.element);\n                this.popC_.view.element.appendChild(this.pickerC_.view.element);\n                connectValues({\n                    primary: this.foldable_.value('expanded'),\n                    secondary: this.popC_.shows,\n                    forward: (p) => p.rawValue,\n                    backward: (_, s) => s.rawValue,\n                });\n            }\n            else if (this.view.pickerElement) {\n                this.view.pickerElement.appendChild(this.pickerC_.view.element);\n                bindFoldable(this.foldable_, this.view.pickerElement);\n            }\n        }\n        onPadButtonBlur_(e) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.view.element;\n            const nextTarget = forceCast(e.relatedTarget);\n            if (!nextTarget || !elem.contains(nextTarget)) {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        onPadButtonClick_() {\n            this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n            if (this.foldable_.get('expanded')) {\n                this.pickerC_.view.allFocusableElements[0].focus();\n            }\n        }\n        onPopupChildBlur_(ev) {\n            if (!this.popC_) {\n                return;\n            }\n            const elem = this.popC_.view.element;\n            const nextTarget = findNextTarget(ev);\n            if (nextTarget && elem.contains(nextTarget)) {\n                return;\n            }\n            if (nextTarget &&\n                nextTarget === this.view.buttonElement &&\n                !supportsTouch(elem.ownerDocument)) {\n                return;\n            }\n            this.popC_.shows.rawValue = false;\n        }\n        onPopupChildKeydown_(ev) {\n            if (this.popC_) {\n                if (ev.key === 'Escape') {\n                    this.popC_.shows.rawValue = false;\n                }\n            }\n            else if (this.view.pickerElement) {\n                if (ev.key === 'Escape') {\n                    this.view.buttonElement.focus();\n                }\n            }\n        }\n    }\n\n    function point2dFromUnknown(value) {\n        return Point2d.isObject(value)\n            ? new Point2d(value.x, value.y)\n            : new Point2d();\n    }\n    function writePoint2d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n    }\n\n    function createDimensionConstraint$2(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$3(params) {\n        return new PointNdConstraint({\n            assembly: Point2dAssembly,\n            components: [\n                createDimensionConstraint$2('x' in params ? params.x : undefined),\n                createDimensionConstraint$2('y' in params ? params.y : undefined),\n            ],\n        });\n    }\n    function getSuitableMaxDimensionValue(constraint, rawValue) {\n        const rc = constraint && findConstraint(constraint, RangeConstraint);\n        if (rc) {\n            return Math.max(Math.abs(rc.minValue || 0), Math.abs(rc.maxValue || 0));\n        }\n        const step = getBaseStep(constraint);\n        return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n    }\n    function getSuitableMaxValue(initialValue, constraint) {\n        const xc = constraint instanceof PointNdConstraint\n            ? constraint.components[0]\n            : undefined;\n        const yc = constraint instanceof PointNdConstraint\n            ? constraint.components[1]\n            : undefined;\n        const xr = getSuitableMaxDimensionValue(xc, initialValue.x);\n        const yr = getSuitableMaxDimensionValue(yc, initialValue.y);\n        return Math.max(xr, yr);\n    }\n    function createAxis$2(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    function shouldInvertY(params) {\n        if (!('y' in params)) {\n            return false;\n        }\n        const yParams = params.y;\n        if (!yParams) {\n            return false;\n        }\n        return 'inverted' in yParams ? !!yParams.inverted : false;\n    }\n    const Point2dInputPlugin = {\n        id: 'input-point2d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point2d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                expanded: p.optional.boolean,\n                picker: p.optional.custom(parsePickerLayout),\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.object({\n                    inverted: p.optional.boolean,\n                    max: p.optional.number,\n                    min: p.optional.number,\n                    step: p.optional.number,\n                }),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point2dFromUnknown,\n            constraint: (args) => createConstraint$3(args.params),\n            equals: Point2d.equals,\n            writer: (_args) => writePoint2d,\n        },\n        controller: (args) => {\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            const expanded = 'expanded' in args.params ? args.params.expanded : undefined;\n            const picker = 'picker' in args.params ? args.params.picker : undefined;\n            return new Point2dController(doc, {\n                axes: [\n                    createAxis$2(value.rawValue.x, c.components[0]),\n                    createAxis$2(value.rawValue.y, c.components[1]),\n                ],\n                expanded: expanded !== null && expanded !== void 0 ? expanded : false,\n                invertsY: shouldInvertY(args.params),\n                maxValue: getSuitableMaxValue(value.rawValue, c),\n                parser: parseNumber,\n                pickerLayout: picker !== null && picker !== void 0 ? picker : 'popup',\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point3d {\n        constructor(x = 0, y = 0, z = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n            };\n        }\n    }\n    const Point3dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point3d(...comps),\n    };\n\n    function point3dFromUnknown(value) {\n        return Point3d.isObject(value)\n            ? new Point3d(value.x, value.y, value.z)\n            : new Point3d();\n    }\n    function writePoint3d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n    }\n\n    function createDimensionConstraint$1(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$2(params) {\n        return new PointNdConstraint({\n            assembly: Point3dAssembly,\n            components: [\n                createDimensionConstraint$1('x' in params ? params.x : undefined),\n                createDimensionConstraint$1('y' in params ? params.y : undefined),\n                createDimensionConstraint$1('z' in params ? params.z : undefined),\n            ],\n        });\n    }\n    function createAxis$1(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point3dInputPlugin = {\n        id: 'input-point3d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point3d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point3dFromUnknown,\n            constraint: (args) => createConstraint$2(args.params),\n            equals: Point3d.equals,\n            writer: (_args) => writePoint3d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point3dAssembly,\n                axes: [\n                    createAxis$1(value.rawValue.x, c.components[0]),\n                    createAxis$1(value.rawValue.y, c.components[1]),\n                    createAxis$1(value.rawValue.z, c.components[2]),\n                ],\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class Point4d {\n        constructor(x = 0, y = 0, z = 0, w = 0) {\n            this.x = x;\n            this.y = y;\n            this.z = z;\n            this.w = w;\n        }\n        getComponents() {\n            return [this.x, this.y, this.z, this.w];\n        }\n        static isObject(obj) {\n            if (isEmpty(obj)) {\n                return false;\n            }\n            const x = obj.x;\n            const y = obj.y;\n            const z = obj.z;\n            const w = obj.w;\n            if (typeof x !== 'number' ||\n                typeof y !== 'number' ||\n                typeof z !== 'number' ||\n                typeof w !== 'number') {\n                return false;\n            }\n            return true;\n        }\n        static equals(v1, v2) {\n            return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n        }\n        toObject() {\n            return {\n                x: this.x,\n                y: this.y,\n                z: this.z,\n                w: this.w,\n            };\n        }\n    }\n    const Point4dAssembly = {\n        toComponents: (p) => p.getComponents(),\n        fromComponents: (comps) => new Point4d(...comps),\n    };\n\n    function point4dFromUnknown(value) {\n        return Point4d.isObject(value)\n            ? new Point4d(value.x, value.y, value.z, value.w)\n            : new Point4d();\n    }\n    function writePoint4d(target, value) {\n        target.writeProperty('x', value.x);\n        target.writeProperty('y', value.y);\n        target.writeProperty('z', value.z);\n        target.writeProperty('w', value.w);\n    }\n\n    function createDimensionConstraint(params) {\n        if (!params) {\n            return undefined;\n        }\n        const constraints = [];\n        if (!isEmpty(params.step)) {\n            constraints.push(new StepConstraint(params.step));\n        }\n        if (!isEmpty(params.max) || !isEmpty(params.min)) {\n            constraints.push(new RangeConstraint({\n                max: params.max,\n                min: params.min,\n            }));\n        }\n        return new CompositeConstraint(constraints);\n    }\n    function createConstraint$1(params) {\n        return new PointNdConstraint({\n            assembly: Point4dAssembly,\n            components: [\n                createDimensionConstraint('x' in params ? params.x : undefined),\n                createDimensionConstraint('y' in params ? params.y : undefined),\n                createDimensionConstraint('z' in params ? params.z : undefined),\n                createDimensionConstraint('w' in params ? params.w : undefined),\n            ],\n        });\n    }\n    function createAxis(initialValue, constraint) {\n        return {\n            baseStep: getBaseStep(constraint),\n            constraint: constraint,\n            textProps: ValueMap.fromObject({\n                draggingScale: getSuitableDraggingScale(constraint, initialValue),\n                formatter: createNumberFormatter(getSuitableDecimalDigits(constraint, initialValue)),\n            }),\n        };\n    }\n    const Point4dInputPlugin = {\n        id: 'input-point4d',\n        type: 'input',\n        accept: (value, params) => {\n            if (!Point4d.isObject(value)) {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                x: p.optional.custom(parsePointDimensionParams),\n                y: p.optional.custom(parsePointDimensionParams),\n                z: p.optional.custom(parsePointDimensionParams),\n                w: p.optional.custom(parsePointDimensionParams),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => point4dFromUnknown,\n            constraint: (args) => createConstraint$1(args.params),\n            equals: Point4d.equals,\n            writer: (_args) => writePoint4d,\n        },\n        controller: (args) => {\n            const value = args.value;\n            const c = args.constraint;\n            if (!(c instanceof PointNdConstraint)) {\n                throw TpError.shouldNeverHappen();\n            }\n            return new PointNdTextController(args.document, {\n                assembly: Point4dAssembly,\n                axes: value.rawValue\n                    .getComponents()\n                    .map((comp, index) => createAxis(comp, c.components[index])),\n                parser: parseNumber,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    function createConstraint(params) {\n        const constraints = [];\n        const lc = createListConstraint(params.options);\n        if (lc) {\n            constraints.push(lc);\n        }\n        return new CompositeConstraint(constraints);\n    }\n    const StringInputPlugin = {\n        id: 'input-string',\n        type: 'input',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                options: p.optional.custom(parseListOptions),\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n            constraint: (args) => createConstraint(args.params),\n            writer: (_args) => writePrimitive,\n        },\n        controller: (args) => {\n            var _a;\n            const doc = args.document;\n            const value = args.value;\n            const c = args.constraint;\n            if (c && findConstraint(c, ListConstraint)) {\n                return new ListController(doc, {\n                    props: ValueMap.fromObject({\n                        options: (_a = findListItems(c)) !== null && _a !== void 0 ? _a : [],\n                    }),\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new TextController(doc, {\n                parser: (v) => v,\n                props: ValueMap.fromObject({\n                    formatter: formatString,\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    const Constants = {\n        monitor: {\n            defaultInterval: 200,\n            defaultLineCount: 3,\n        },\n    };\n\n    const className$2 = ClassName('mll');\n    class MultiLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$2());\n            config.viewProps.bindClassModifiers(this.element);\n            const textareaElem = doc.createElement('textarea');\n            textareaElem.classList.add(className$2('i'));\n            textareaElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            textareaElem.readOnly = true;\n            config.viewProps.bindDisabled(textareaElem);\n            this.element.appendChild(textareaElem);\n            this.textareaElem_ = textareaElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const elem = this.textareaElem_;\n            const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n            const lines = [];\n            this.value.rawValue.forEach((value) => {\n                if (value !== undefined) {\n                    lines.push(this.formatter_(value));\n                }\n            });\n            elem.textContent = lines.join('\\n');\n            if (shouldScroll) {\n                elem.scrollTop = elem.scrollHeight;\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class MultiLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new MultiLogView(doc, {\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const className$1 = ClassName('sgl');\n    class SingleLogView {\n        constructor(doc, config) {\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.formatter_ = config.formatter;\n            this.element = doc.createElement('div');\n            this.element.classList.add(className$1());\n            config.viewProps.bindClassModifiers(this.element);\n            const inputElem = doc.createElement('input');\n            inputElem.classList.add(className$1('i'));\n            inputElem.readOnly = true;\n            inputElem.type = 'text';\n            config.viewProps.bindDisabled(inputElem);\n            this.element.appendChild(inputElem);\n            this.inputElement = inputElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        update_() {\n            const values = this.value.rawValue;\n            const lastValue = values[values.length - 1];\n            this.inputElement.value =\n                lastValue !== undefined ? this.formatter_(lastValue) : '';\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n    }\n\n    class SingleLogController {\n        constructor(doc, config) {\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.view = new SingleLogView(doc, {\n                formatter: config.formatter,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n    }\n\n    const BooleanMonitorPlugin = {\n        id: 'monitor-bool',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'boolean') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => boolFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            if (args.value.rawValue.length === 1) {\n                return new SingleLogController(args.document, {\n                    formatter: BooleanFormatter,\n                    value: args.value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new MultiLogController(args.document, {\n                formatter: BooleanFormatter,\n                lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class GraphCursor {\n        constructor() {\n            this.emitter = new Emitter();\n            this.index_ = -1;\n        }\n        get index() {\n            return this.index_;\n        }\n        set index(index) {\n            const changed = this.index_ !== index;\n            if (changed) {\n                this.index_ = index;\n                this.emitter.emit('change', {\n                    index: index,\n                    sender: this,\n                });\n            }\n        }\n    }\n\n    const className = ClassName('grl');\n    class GraphLogView {\n        constructor(doc, config) {\n            this.onCursorChange_ = this.onCursorChange_.bind(this);\n            this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n            this.element = doc.createElement('div');\n            this.element.classList.add(className());\n            config.viewProps.bindClassModifiers(this.element);\n            this.formatter_ = config.formatter;\n            this.minValue_ = config.minValue;\n            this.maxValue_ = config.maxValue;\n            this.cursor_ = config.cursor;\n            this.cursor_.emitter.on('change', this.onCursorChange_);\n            const svgElem = doc.createElementNS(SVG_NS, 'svg');\n            svgElem.classList.add(className('g'));\n            svgElem.style.height = `calc(var(--bld-us) * ${config.lineCount})`;\n            this.element.appendChild(svgElem);\n            this.svgElem_ = svgElem;\n            const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n            this.svgElem_.appendChild(lineElem);\n            this.lineElem_ = lineElem;\n            const tooltipElem = doc.createElement('div');\n            tooltipElem.classList.add(className('t'), ClassName('tt')());\n            this.element.appendChild(tooltipElem);\n            this.tooltipElem_ = tooltipElem;\n            config.value.emitter.on('change', this.onValueUpdate_);\n            this.value = config.value;\n            this.update_();\n        }\n        get graphElement() {\n            return this.svgElem_;\n        }\n        update_() {\n            const bounds = this.svgElem_.getBoundingClientRect();\n            const maxIndex = this.value.rawValue.length - 1;\n            const min = this.minValue_;\n            const max = this.maxValue_;\n            const points = [];\n            this.value.rawValue.forEach((v, index) => {\n                if (v === undefined) {\n                    return;\n                }\n                const x = mapRange(index, 0, maxIndex, 0, bounds.width);\n                const y = mapRange(v, min, max, bounds.height, 0);\n                points.push([x, y].join(','));\n            });\n            this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n            const tooltipElem = this.tooltipElem_;\n            const value = this.value.rawValue[this.cursor_.index];\n            if (value === undefined) {\n                tooltipElem.classList.remove(className('t', 'a'));\n                return;\n            }\n            const tx = mapRange(this.cursor_.index, 0, maxIndex, 0, bounds.width);\n            const ty = mapRange(value, min, max, bounds.height, 0);\n            tooltipElem.style.left = `${tx}px`;\n            tooltipElem.style.top = `${ty}px`;\n            tooltipElem.textContent = `${this.formatter_(value)}`;\n            if (!tooltipElem.classList.contains(className('t', 'a'))) {\n                tooltipElem.classList.add(className('t', 'a'), className('t', 'in'));\n                forceReflow(tooltipElem);\n                tooltipElem.classList.remove(className('t', 'in'));\n            }\n        }\n        onValueUpdate_() {\n            this.update_();\n        }\n        onCursorChange_() {\n            this.update_();\n        }\n    }\n\n    class GraphLogController {\n        constructor(doc, config) {\n            this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n            this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n            this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n            this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n            this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n            this.value = config.value;\n            this.viewProps = config.viewProps;\n            this.cursor_ = new GraphCursor();\n            this.view = new GraphLogView(doc, {\n                cursor: this.cursor_,\n                formatter: config.formatter,\n                lineCount: config.lineCount,\n                maxValue: config.maxValue,\n                minValue: config.minValue,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n            if (!supportsTouch(doc)) {\n                this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n                this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n            }\n            else {\n                const ph = new PointerHandler(this.view.element);\n                ph.emitter.on('down', this.onGraphPointerDown_);\n                ph.emitter.on('move', this.onGraphPointerMove_);\n                ph.emitter.on('up', this.onGraphPointerUp_);\n            }\n        }\n        onGraphMouseLeave_() {\n            this.cursor_.index = -1;\n        }\n        onGraphMouseMove_(ev) {\n            const bounds = this.view.element.getBoundingClientRect();\n            this.cursor_.index = Math.floor(mapRange(ev.offsetX, 0, bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerDown_(ev) {\n            this.onGraphPointerMove_(ev);\n        }\n        onGraphPointerMove_(ev) {\n            if (!ev.data.point) {\n                this.cursor_.index = -1;\n                return;\n            }\n            this.cursor_.index = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n        }\n        onGraphPointerUp_() {\n            this.cursor_.index = -1;\n        }\n    }\n\n    function createFormatter(params) {\n        return 'format' in params && !isEmpty(params.format)\n            ? params.format\n            : createNumberFormatter(2);\n    }\n    function createTextMonitor(args) {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: createFormatter(args.params),\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function createGraphMonitor(args) {\n        var _a, _b, _c;\n        return new GraphLogController(args.document, {\n            formatter: createFormatter(args.params),\n            lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n            maxValue: (_b = ('max' in args.params ? args.params.max : null)) !== null && _b !== void 0 ? _b : 100,\n            minValue: (_c = ('min' in args.params ? args.params.min : null)) !== null && _c !== void 0 ? _c : 0,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    function shouldShowGraph(params) {\n        return 'view' in params && params.view === 'graph';\n    }\n    const NumberMonitorPlugin = {\n        id: 'monitor-number',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'number') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                format: p.optional.function,\n                lineCount: p.optional.number,\n                max: p.optional.number,\n                min: p.optional.number,\n                view: p.optional.string,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n            reader: (_args) => numberFromUnknown,\n        },\n        controller: (args) => {\n            if (shouldShowGraph(args.params)) {\n                return createGraphMonitor(args);\n            }\n            return createTextMonitor(args);\n        },\n    };\n\n    const StringMonitorPlugin = {\n        id: 'monitor-string',\n        type: 'monitor',\n        accept: (value, params) => {\n            if (typeof value !== 'string') {\n                return null;\n            }\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                lineCount: p.optional.number,\n                multiline: p.optional.boolean,\n            });\n            return result\n                ? {\n                    initialValue: value,\n                    params: result,\n                }\n                : null;\n        },\n        binding: {\n            reader: (_args) => stringFromUnknown,\n        },\n        controller: (args) => {\n            var _a;\n            const value = args.value;\n            const multiline = value.rawValue.length > 1 ||\n                ('multiline' in args.params && args.params.multiline);\n            if (multiline) {\n                return new MultiLogController(args.document, {\n                    formatter: formatString,\n                    lineCount: (_a = args.params.lineCount) !== null && _a !== void 0 ? _a : Constants.monitor.defaultLineCount,\n                    value: value,\n                    viewProps: args.viewProps,\n                });\n            }\n            return new SingleLogController(args.document, {\n                formatter: formatString,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        },\n    };\n\n    class InputBinding {\n        constructor(config) {\n            this.onValueChange_ = this.onValueChange_.bind(this);\n            this.reader = config.reader;\n            this.writer = config.writer;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.value.emitter.on('change', this.onValueChange_);\n            this.target = config.target;\n            this.read();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue !== undefined) {\n                this.value.rawValue = this.reader(targetValue);\n            }\n        }\n        write_(rawValue) {\n            this.writer(this.target, rawValue);\n        }\n        onValueChange_(ev) {\n            this.write_(ev.rawValue);\n            this.emitter.emit('change', {\n                options: ev.options,\n                rawValue: ev.rawValue,\n                sender: this,\n            });\n        }\n    }\n\n    function createInputBindingController(plugin, args) {\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const p = ParamsParsers;\n        const valueArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(valueArgs);\n        const constraint = plugin.binding.constraint\n            ? plugin.binding.constraint(valueArgs)\n            : undefined;\n        const value = createValue(reader(result.initialValue), {\n            constraint: constraint,\n            equals: plugin.binding.equals,\n        });\n        const binding = new InputBinding({\n            reader: reader,\n            target: args.target,\n            value: value,\n            writer: plugin.binding.writer(valueArgs),\n        });\n        const disabled = p.optional.boolean(args.params.disabled).value;\n        const hidden = p.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            constraint: constraint,\n            document: args.document,\n            initialValue: result.initialValue,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        const label = p.optional.string(args.params.label).value;\n        return new InputBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: label || args.target.key,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class MonitorBinding {\n        constructor(config) {\n            this.onTick_ = this.onTick_.bind(this);\n            this.reader_ = config.reader;\n            this.target = config.target;\n            this.emitter = new Emitter();\n            this.value = config.value;\n            this.ticker = config.ticker;\n            this.ticker.emitter.on('tick', this.onTick_);\n            this.read();\n        }\n        dispose() {\n            this.ticker.dispose();\n        }\n        read() {\n            const targetValue = this.target.read();\n            if (targetValue === undefined) {\n                return;\n            }\n            const buffer = this.value.rawValue;\n            const newValue = this.reader_(targetValue);\n            this.value.rawValue = createPushedBuffer(buffer, newValue);\n            this.emitter.emit('update', {\n                rawValue: newValue,\n                sender: this,\n            });\n        }\n        onTick_(_) {\n            this.read();\n        }\n    }\n\n    function createTicker(document, interval) {\n        return interval === 0\n            ? new ManualTicker()\n            : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n    }\n    function createMonitorBindingController(plugin, args) {\n        var _a, _b, _c;\n        const P = ParamsParsers;\n        const result = plugin.accept(args.target.read(), args.params);\n        if (isEmpty(result)) {\n            return null;\n        }\n        const bindingArgs = {\n            target: args.target,\n            initialValue: result.initialValue,\n            params: result.params,\n        };\n        const reader = plugin.binding.reader(bindingArgs);\n        const bufferSize = (_b = (_a = P.optional.number(args.params.bufferSize).value) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n            plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n        const interval = P.optional.number(args.params.interval).value;\n        const binding = new MonitorBinding({\n            reader: reader,\n            target: args.target,\n            ticker: createTicker(args.document, interval),\n            value: initializeBuffer(bufferSize),\n        });\n        const disabled = P.optional.boolean(args.params.disabled).value;\n        const hidden = P.optional.boolean(args.params.hidden).value;\n        const controller = plugin.controller({\n            document: args.document,\n            params: result.params,\n            value: binding.value,\n            viewProps: ViewProps.create({\n                disabled: disabled,\n                hidden: hidden,\n            }),\n        });\n        const label = (_c = P.optional.string(args.params.label).value) !== null && _c !== void 0 ? _c : args.target.key;\n        return new MonitorBindingController(args.document, {\n            binding: binding,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                label: label,\n            }),\n            valueController: controller,\n        });\n    }\n\n    class PluginPool {\n        constructor() {\n            this.pluginsMap_ = {\n                blades: [],\n                inputs: [],\n                monitors: [],\n            };\n        }\n        getAll() {\n            return [\n                ...this.pluginsMap_.blades,\n                ...this.pluginsMap_.inputs,\n                ...this.pluginsMap_.monitors,\n            ];\n        }\n        register(r) {\n            if (r.type === 'blade') {\n                this.pluginsMap_.blades.unshift(r);\n            }\n            else if (r.type === 'input') {\n                this.pluginsMap_.inputs.unshift(r);\n            }\n            else if (r.type === 'monitor') {\n                this.pluginsMap_.monitors.unshift(r);\n            }\n        }\n        createInput(document, target, params) {\n            const initialValue = target.read();\n            if (isEmpty(initialValue)) {\n                throw new TpError({\n                    context: {\n                        key: target.key,\n                    },\n                    type: 'nomatchingcontroller',\n                });\n            }\n            const bc = this.pluginsMap_.inputs.reduce((result, plugin) => result ||\n                createInputBindingController(plugin, {\n                    document: document,\n                    target: target,\n                    params: params,\n                }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createMonitor(document, target, params) {\n            const bc = this.pluginsMap_.monitors.reduce((result, plugin) => result ||\n                createMonitorBindingController(plugin, {\n                    document: document,\n                    params: params,\n                    target: target,\n                }), null);\n            if (bc) {\n                return bc;\n            }\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        createBlade(document, params) {\n            const bc = this.pluginsMap_.blades.reduce((result, plugin) => result ||\n                createBladeController(plugin, {\n                    document: document,\n                    params: params,\n                }), null);\n            if (!bc) {\n                throw new TpError({\n                    type: 'nomatchingview',\n                    context: {\n                        params: params,\n                    },\n                });\n            }\n            return bc;\n        }\n        createBladeApi(bc) {\n            if (bc instanceof InputBindingController) {\n                return new InputBindingApi(bc);\n            }\n            if (bc instanceof MonitorBindingController) {\n                return new MonitorBindingApi(bc);\n            }\n            if (bc instanceof RackController) {\n                return new RackApi(bc, this);\n            }\n            const api = this.pluginsMap_.blades.reduce((result, plugin) => result ||\n                plugin.api({\n                    controller: bc,\n                    pool: this,\n                }), null);\n            if (!api) {\n                throw TpError.shouldNeverHappen();\n            }\n            return api;\n        }\n    }\n\n    function createDefaultPluginPool() {\n        const pool = new PluginPool();\n        [\n            Point2dInputPlugin,\n            Point3dInputPlugin,\n            Point4dInputPlugin,\n            StringInputPlugin,\n            NumberInputPlugin,\n            StringColorInputPlugin,\n            ObjectColorInputPlugin,\n            NumberColorInputPlugin,\n            BooleanInputPlugin,\n            BooleanMonitorPlugin,\n            StringMonitorPlugin,\n            NumberMonitorPlugin,\n            ButtonBladePlugin,\n            FolderBladePlugin,\n            SeparatorBladePlugin,\n            TabBladePlugin,\n        ].forEach((p) => {\n            pool.register(p);\n        });\n        return pool;\n    }\n\n    class ListApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get options() {\n            return this.controller_.valueController.props.get('options');\n        }\n        set options(options) {\n            this.controller_.valueController.props.set('options', options);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class SliderApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get maxValue() {\n            return this.controller_.valueController.sliderController.props.get('maxValue');\n        }\n        set maxValue(maxValue) {\n            this.controller_.valueController.sliderController.props.set('maxValue', maxValue);\n        }\n        get minValue() {\n            return this.controller_.valueController.sliderController.props.get('minValue');\n        }\n        set minValue(minValue) {\n            this.controller_.valueController.sliderController.props.set('minValue', minValue);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    class TextApi extends BladeApi {\n        constructor(controller) {\n            super(controller);\n            this.emitter_ = new Emitter();\n            this.controller_.valueController.value.emitter.on('change', (ev) => {\n                this.emitter_.emit('change', {\n                    event: new TpChangeEvent(this, ev.rawValue),\n                });\n            });\n        }\n        get label() {\n            return this.controller_.props.get('label');\n        }\n        set label(label) {\n            this.controller_.props.set('label', label);\n        }\n        get formatter() {\n            return this.controller_.valueController.props.get('formatter');\n        }\n        set formatter(formatter) {\n            this.controller_.valueController.props.set('formatter', formatter);\n        }\n        get value() {\n            return this.controller_.valueController.value.rawValue;\n        }\n        set value(value) {\n            this.controller_.valueController.value.rawValue = value;\n        }\n        on(eventName, handler) {\n            const bh = handler.bind(this);\n            this.emitter_.on(eventName, (ev) => {\n                bh(ev.event);\n            });\n            return this;\n        }\n    }\n\n    const ListBladePlugin = (function () {\n        return {\n            id: 'list',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    options: p.required.custom(parseListOptions),\n                    value: p.required.raw,\n                    view: p.required.constant('list'),\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                const ic = new ListController(args.document, {\n                    props: ValueMap.fromObject({\n                        options: normalizeListOptions(args.params.options),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof ListController)) {\n                    return null;\n                }\n                return new ListApi(args.controller);\n            },\n        };\n    })();\n\n    /**\n     * @hidden\n     */\n    function exportPresetJson(targets) {\n        return targets.reduce((result, target) => {\n            return Object.assign(result, {\n                [target.presetKey]: target.read(),\n            });\n        }, {});\n    }\n    /**\n     * @hidden\n     */\n    function importPresetJson(targets, preset) {\n        targets.forEach((target) => {\n            const value = preset[target.presetKey];\n            if (value !== undefined) {\n                target.write(value);\n            }\n        });\n    }\n\n    class RootApi extends FolderApi {\n        /**\n         * @hidden\n         */\n        constructor(controller, pool) {\n            super(controller, pool);\n        }\n        get element() {\n            return this.controller_.view.element;\n        }\n        /**\n         * Imports a preset of all inputs.\n         * @param preset The preset object to import.\n         */\n        importPreset(preset) {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            importPresetJson(targets, preset);\n            this.refresh();\n        }\n        /**\n         * Exports a preset of all inputs.\n         * @return An exported preset object.\n         */\n        exportPreset() {\n            const targets = this.controller_.rackController.rack\n                .find(InputBindingController)\n                .map((ibc) => {\n                return ibc.binding.target;\n            });\n            return exportPresetJson(targets);\n        }\n        /**\n         * Refreshes all bindings of the pane.\n         */\n        refresh() {\n            // Force-read all input bindings\n            this.controller_.rackController.rack\n                .find(InputBindingController)\n                .forEach((ibc) => {\n                ibc.binding.read();\n            });\n            // Force-read all monitor bindings\n            this.controller_.rackController.rack\n                .find(MonitorBindingController)\n                .forEach((mbc) => {\n                mbc.binding.read();\n            });\n        }\n    }\n\n    class RootController extends FolderController {\n        constructor(doc, config) {\n            super(doc, {\n                expanded: config.expanded,\n                blade: config.blade,\n                props: config.props,\n                root: true,\n                viewProps: config.viewProps,\n            });\n        }\n    }\n\n    const SliderBladePlugin = {\n        id: 'slider',\n        type: 'blade',\n        accept(params) {\n            const p = ParamsParsers;\n            const result = parseParams(params, {\n                max: p.required.number,\n                min: p.required.number,\n                view: p.required.constant('slider'),\n                format: p.optional.function,\n                label: p.optional.string,\n                value: p.optional.number,\n            });\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a, _b;\n            const v = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n            const vc = new SliderTextController(args.document, {\n                baseStep: 1,\n                parser: parseNumber,\n                sliderProps: ValueMap.fromObject({\n                    maxValue: args.params.max,\n                    minValue: args.params.min,\n                }),\n                textProps: ValueMap.fromObject({\n                    draggingScale: getSuitableDraggingScale(undefined, v),\n                    formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n                }),\n                value: createValue(v),\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                valueController: vc,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof SliderTextController)) {\n                return null;\n            }\n            return new SliderApi(args.controller);\n        },\n    };\n\n    const TextBladePlugin = (function () {\n        return {\n            id: 'text',\n            type: 'blade',\n            accept(params) {\n                const p = ParamsParsers;\n                const result = parseParams(params, {\n                    parse: p.required.function,\n                    value: p.required.raw,\n                    view: p.required.constant('text'),\n                    format: p.optional.function,\n                    label: p.optional.string,\n                });\n                return result ? { params: result } : null;\n            },\n            controller(args) {\n                var _a;\n                const ic = new TextController(args.document, {\n                    parser: args.params.parse,\n                    props: ValueMap.fromObject({\n                        formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                    }),\n                    value: createValue(args.params.value),\n                    viewProps: args.viewProps,\n                });\n                return new LabeledValueController(args.document, {\n                    blade: args.blade,\n                    props: ValueMap.fromObject({\n                        label: args.params.label,\n                    }),\n                    valueController: ic,\n                });\n            },\n            api(args) {\n                if (!(args.controller instanceof LabeledValueController)) {\n                    return null;\n                }\n                if (!(args.controller.valueController instanceof TextController)) {\n                    return null;\n                }\n                return new TextApi(args.controller);\n            },\n        };\n    })();\n\n    function createDefaultWrapperElement(doc) {\n        const elem = doc.createElement('div');\n        elem.classList.add(ClassName('dfw')());\n        if (doc.body) {\n            doc.body.appendChild(elem);\n        }\n        return elem;\n    }\n    function embedStyle(doc, id, css) {\n        if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n            return;\n        }\n        const styleElem = doc.createElement('style');\n        styleElem.dataset.tpStyle = id;\n        styleElem.textContent = css;\n        doc.head.appendChild(styleElem);\n    }\n    /**\n     * The root pane of Tweakpane.\n     */\n    class Pane extends RootApi {\n        constructor(opt_config) {\n            var _a;\n            const config = opt_config || {};\n            const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n            const pool = createDefaultPluginPool();\n            const rootController = new RootController(doc, {\n                expanded: config.expanded,\n                blade: createBlade(),\n                props: ValueMap.fromObject({\n                    title: config.title,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            super(rootController, pool);\n            this.pool_ = pool;\n            this.containerElem_ = config.container || createDefaultWrapperElement(doc);\n            this.containerElem_.appendChild(this.element);\n            this.doc_ = doc;\n            this.usesDefaultWrapper_ = !config.container;\n            this.setUpDefaultPlugins_();\n        }\n        get document() {\n            if (!this.doc_) {\n                throw TpError.alreadyDisposed();\n            }\n            return this.doc_;\n        }\n        dispose() {\n            const containerElem = this.containerElem_;\n            if (!containerElem) {\n                throw TpError.alreadyDisposed();\n            }\n            if (this.usesDefaultWrapper_) {\n                const parentElem = containerElem.parentElement;\n                if (parentElem) {\n                    parentElem.removeChild(containerElem);\n                }\n            }\n            this.containerElem_ = null;\n            this.doc_ = null;\n            super.dispose();\n        }\n        registerPlugin(bundle) {\n            const plugins = 'plugin' in bundle\n                ? [bundle.plugin]\n                : 'plugins' in bundle\n                    ? bundle.plugins\n                    : [];\n            plugins.forEach((p) => {\n                this.pool_.register(p);\n                this.embedPluginStyle_(p);\n            });\n        }\n        embedPluginStyle_(plugin) {\n            if (plugin.css) {\n                embedStyle(this.document, `plugin-${plugin.id}`, plugin.css);\n            }\n        }\n        setUpDefaultPlugins_() {\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            embedStyle(this.document, 'default', '.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\"\";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:\"\";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:\"\";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:\"\";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:\"\";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}');\n            this.pool_.getAll().forEach((plugin) => {\n                this.embedPluginStyle_(plugin);\n            });\n            this.registerPlugin({\n                plugins: [\n                    SliderBladePlugin,\n                    ListBladePlugin,\n                    TabBladePlugin,\n                    TextBladePlugin,\n                ],\n            });\n        }\n    }\n\n    const VERSION = new Semver('3.0.8');\n\n    exports.BladeApi = BladeApi;\n    exports.ButtonApi = ButtonApi;\n    exports.FolderApi = FolderApi;\n    exports.InputBindingApi = InputBindingApi;\n    exports.ListApi = ListApi;\n    exports.MonitorBindingApi = MonitorBindingApi;\n    exports.Pane = Pane;\n    exports.SeparatorApi = SeparatorApi;\n    exports.SliderApi = SliderApi;\n    exports.TabApi = TabApi;\n    exports.TabPageApi = TabPageApi;\n    exports.TextApi = TextApi;\n    exports.TpChangeEvent = TpChangeEvent;\n    exports.VERSION = VERSION;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/*\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are met:\n\n 1. Redistributions of source code must retain the above copyright notice,\n this list of conditions and the following disclaimer.\n\n 2. Redistributions in binary form must reproduce the above copyright \n notice, this list of conditions and the following disclaimer in \n the documentation and/or other materials provided with the distribution.\n\n 3. The names of the authors may not be used to endorse or promote products\n derived from this software without specific prior written permission.\n\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/*\n * This program is based on JZlib 1.0.2 ymnk, JCraft,Inc.\n * JZlib is based on zlib-1.1.3, so all credit should go authors\n * Jean-loup Gailly(jloup@gzip.org) and Mark Adler(madler@alumni.caltech.edu)\n * and contributors of zlib.\n */\n\n// Global\n\nvar MAX_BITS = 15;\nvar D_CODES = 30;\nvar BL_CODES = 19;\n\nvar LENGTH_CODES = 29;\nvar LITERALS = 256;\nvar L_CODES = (LITERALS + 1 + LENGTH_CODES);\nvar HEAP_SIZE = (2 * L_CODES + 1);\n\nvar END_BLOCK = 256;\n\n// Bit length codes must not exceed MAX_BL_BITS bits\nvar MAX_BL_BITS = 7;\n\n// repeat previous bit length 3-6 times (2 bits of repeat count)\nvar REP_3_6 = 16;\n\n// repeat a zero length 3-10 times (3 bits of repeat count)\nvar REPZ_3_10 = 17;\n\n// repeat a zero length 11-138 times (7 bits of repeat count)\nvar REPZ_11_138 = 18;\n\n// The lengths of the bit length codes are sent in order of decreasing\n// probability, to avoid transmitting the lengths for unused bit\n// length codes.\n\nvar Buf_size = 8 * 2;\n\n// JZlib version : \"1.0.2\"\nvar Z_DEFAULT_COMPRESSION = -1;\n\n// compression strategy\nvar Z_FILTERED = 1;\nvar Z_HUFFMAN_ONLY = 2;\nvar Z_DEFAULT_STRATEGY = 0;\n\nvar Z_NO_FLUSH = 0;\nvar Z_PARTIAL_FLUSH = 1;\nvar Z_FULL_FLUSH = 3;\nvar Z_FINISH = 4;\n\nvar Z_OK = 0;\nvar Z_STREAM_END = 1;\nvar Z_NEED_DICT = 2;\nvar Z_STREAM_ERROR = -2;\nvar Z_DATA_ERROR = -3;\nvar Z_BUF_ERROR = -5;\n\n// Tree\n\n// see definition of array dist_code below\nvar _dist_code = [ 0, 1, 2, 3, 4, 4, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,\n\t\t10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,\n\t\t12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,\n\t\t13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,\n\t\t14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,\n\t\t14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,\n\t\t15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 0, 0, 16, 17, 18, 18, 19, 19,\n\t\t20, 20, 20, 20, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26,\n\t\t26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,\n\t\t27, 27, 27, 27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,\n\t\t28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 29,\n\t\t29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29,\n\t\t29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29 ];\n\nfunction Tree() {\n\tvar that = this;\n\n\t// dyn_tree; // the dynamic tree\n\t// max_code; // largest code with non zero frequency\n\t// stat_desc; // the corresponding static tree\n\n\t// Compute the optimal bit lengths for a tree and update the total bit\n\t// length\n\t// for the current block.\n\t// IN assertion: the fields freq and dad are set, heap[heap_max] and\n\t// above are the tree nodes sorted by increasing frequency.\n\t// OUT assertions: the field len is set to the optimal bit length, the\n\t// array bl_count contains the frequencies for each bit length.\n\t// The length opt_len is updated; static_len is also updated if stree is\n\t// not null.\n\tfunction gen_bitlen(s) {\n\t\tvar tree = that.dyn_tree;\n\t\tvar stree = that.stat_desc.static_tree;\n\t\tvar extra = that.stat_desc.extra_bits;\n\t\tvar base = that.stat_desc.extra_base;\n\t\tvar max_length = that.stat_desc.max_length;\n\t\tvar h; // heap index\n\t\tvar n, m; // iterate over the tree elements\n\t\tvar bits; // bit length\n\t\tvar xbits; // extra bits\n\t\tvar f; // frequency\n\t\tvar overflow = 0; // number of elements with bit length too large\n\n\t\tfor (bits = 0; bits <= MAX_BITS; bits++)\n\t\t\ts.bl_count[bits] = 0;\n\n\t\t// In a first pass, compute the optimal bit lengths (which may\n\t\t// overflow in the case of the bit length tree).\n\t\ttree[s.heap[s.heap_max] * 2 + 1] = 0; // root of the heap\n\n\t\tfor (h = s.heap_max + 1; h < HEAP_SIZE; h++) {\n\t\t\tn = s.heap[h];\n\t\t\tbits = tree[tree[n * 2 + 1] * 2 + 1] + 1;\n\t\t\tif (bits > max_length) {\n\t\t\t\tbits = max_length;\n\t\t\t\toverflow++;\n\t\t\t}\n\t\t\ttree[n * 2 + 1] = bits;\n\t\t\t// We overwrite tree[n*2+1] which is no longer needed\n\n\t\t\tif (n > that.max_code)\n\t\t\t\tcontinue; // not a leaf node\n\n\t\t\ts.bl_count[bits]++;\n\t\t\txbits = 0;\n\t\t\tif (n >= base)\n\t\t\t\txbits = extra[n - base];\n\t\t\tf = tree[n * 2];\n\t\t\ts.opt_len += f * (bits + xbits);\n\t\t\tif (stree)\n\t\t\t\ts.static_len += f * (stree[n * 2 + 1] + xbits);\n\t\t}\n\t\tif (overflow === 0)\n\t\t\treturn;\n\n\t\t// This happens for example on obj2 and pic of the Calgary corpus\n\t\t// Find the first bit length which could increase:\n\t\tdo {\n\t\t\tbits = max_length - 1;\n\t\t\twhile (s.bl_count[bits] === 0)\n\t\t\t\tbits--;\n\t\t\ts.bl_count[bits]--; // move one leaf down the tree\n\t\t\ts.bl_count[bits + 1] += 2; // move one overflow item as its brother\n\t\t\ts.bl_count[max_length]--;\n\t\t\t// The brother of the overflow item also moves one step up,\n\t\t\t// but this does not affect bl_count[max_length]\n\t\t\toverflow -= 2;\n\t\t} while (overflow > 0);\n\n\t\tfor (bits = max_length; bits !== 0; bits--) {\n\t\t\tn = s.bl_count[bits];\n\t\t\twhile (n !== 0) {\n\t\t\t\tm = s.heap[--h];\n\t\t\t\tif (m > that.max_code)\n\t\t\t\t\tcontinue;\n\t\t\t\tif (tree[m * 2 + 1] != bits) {\n\t\t\t\t\ts.opt_len += (bits - tree[m * 2 + 1]) * tree[m * 2];\n\t\t\t\t\ttree[m * 2 + 1] = bits;\n\t\t\t\t}\n\t\t\t\tn--;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Reverse the first len bits of a code, using straightforward code (a\n\t// faster\n\t// method would use a table)\n\t// IN assertion: 1 <= len <= 15\n\tfunction bi_reverse(code, // the value to invert\n\tlen // its bit length\n\t) {\n\t\tvar res = 0;\n\t\tdo {\n\t\t\tres |= code & 1;\n\t\t\tcode >>>= 1;\n\t\t\tres <<= 1;\n\t\t} while (--len > 0);\n\t\treturn res >>> 1;\n\t}\n\n\t// Generate the codes for a given tree and bit counts (which need not be\n\t// optimal).\n\t// IN assertion: the array bl_count contains the bit length statistics for\n\t// the given tree and the field len is set for all tree elements.\n\t// OUT assertion: the field code is set for all tree elements of non\n\t// zero code length.\n\tfunction gen_codes(tree, // the tree to decorate\n\tmax_code, // largest code with non zero frequency\n\tbl_count // number of codes at each bit length\n\t) {\n\t\tvar next_code = []; // next code value for each\n\t\t// bit length\n\t\tvar code = 0; // running code value\n\t\tvar bits; // bit index\n\t\tvar n; // code index\n\t\tvar len;\n\n\t\t// The distribution counts are first used to generate the code values\n\t\t// without bit reversal.\n\t\tfor (bits = 1; bits <= MAX_BITS; bits++) {\n\t\t\tnext_code[bits] = code = ((code + bl_count[bits - 1]) << 1);\n\t\t}\n\n\t\t// Check that the bit counts in bl_count are consistent. The last code\n\t\t// must be all ones.\n\t\t// Assert (code + bl_count[MAX_BITS]-1 == (1<<MAX_BITS)-1,\n\t\t// \"inconsistent bit counts\");\n\t\t// Tracev((stderr,\"\\ngen_codes: max_code %d \", max_code));\n\n\t\tfor (n = 0; n <= max_code; n++) {\n\t\t\tlen = tree[n * 2 + 1];\n\t\t\tif (len === 0)\n\t\t\t\tcontinue;\n\t\t\t// Now reverse the bits\n\t\t\ttree[n * 2] = bi_reverse(next_code[len]++, len);\n\t\t}\n\t}\n\n\t// Construct one Huffman tree and assigns the code bit strings and lengths.\n\t// Update the total bit length for the current block.\n\t// IN assertion: the field freq is set for all tree elements.\n\t// OUT assertions: the fields len and code are set to the optimal bit length\n\t// and corresponding code. The length opt_len is updated; static_len is\n\t// also updated if stree is not null. The field max_code is set.\n\tthat.build_tree = function(s) {\n\t\tvar tree = that.dyn_tree;\n\t\tvar stree = that.stat_desc.static_tree;\n\t\tvar elems = that.stat_desc.elems;\n\t\tvar n, m; // iterate over heap elements\n\t\tvar max_code = -1; // largest code with non zero frequency\n\t\tvar node; // new node being created\n\n\t\t// Construct the initial heap, with least frequent element in\n\t\t// heap[1]. The sons of heap[n] are heap[2*n] and heap[2*n+1].\n\t\t// heap[0] is not used.\n\t\ts.heap_len = 0;\n\t\ts.heap_max = HEAP_SIZE;\n\n\t\tfor (n = 0; n < elems; n++) {\n\t\t\tif (tree[n * 2] !== 0) {\n\t\t\t\ts.heap[++s.heap_len] = max_code = n;\n\t\t\t\ts.depth[n] = 0;\n\t\t\t} else {\n\t\t\t\ttree[n * 2 + 1] = 0;\n\t\t\t}\n\t\t}\n\n\t\t// The pkzip format requires that at least one distance code exists,\n\t\t// and that at least one bit should be sent even if there is only one\n\t\t// possible code. So to avoid special checks later on we force at least\n\t\t// two codes of non zero frequency.\n\t\twhile (s.heap_len < 2) {\n\t\t\tnode = s.heap[++s.heap_len] = max_code < 2 ? ++max_code : 0;\n\t\t\ttree[node * 2] = 1;\n\t\t\ts.depth[node] = 0;\n\t\t\ts.opt_len--;\n\t\t\tif (stree)\n\t\t\t\ts.static_len -= stree[node * 2 + 1];\n\t\t\t// node is 0 or 1 so it does not have extra bits\n\t\t}\n\t\tthat.max_code = max_code;\n\n\t\t// The elements heap[heap_len/2+1 .. heap_len] are leaves of the tree,\n\t\t// establish sub-heaps of increasing lengths:\n\n\t\tfor (n = Math.floor(s.heap_len / 2); n >= 1; n--)\n\t\t\ts.pqdownheap(tree, n);\n\n\t\t// Construct the Huffman tree by repeatedly combining the least two\n\t\t// frequent nodes.\n\n\t\tnode = elems; // next internal node of the tree\n\t\tdo {\n\t\t\t// n = node of least frequency\n\t\t\tn = s.heap[1];\n\t\t\ts.heap[1] = s.heap[s.heap_len--];\n\t\t\ts.pqdownheap(tree, 1);\n\t\t\tm = s.heap[1]; // m = node of next least frequency\n\n\t\t\ts.heap[--s.heap_max] = n; // keep the nodes sorted by frequency\n\t\t\ts.heap[--s.heap_max] = m;\n\n\t\t\t// Create a new node father of n and m\n\t\t\ttree[node * 2] = (tree[n * 2] + tree[m * 2]);\n\t\t\ts.depth[node] = Math.max(s.depth[n], s.depth[m]) + 1;\n\t\t\ttree[n * 2 + 1] = tree[m * 2 + 1] = node;\n\n\t\t\t// and insert the new node in the heap\n\t\t\ts.heap[1] = node++;\n\t\t\ts.pqdownheap(tree, 1);\n\t\t} while (s.heap_len >= 2);\n\n\t\ts.heap[--s.heap_max] = s.heap[1];\n\n\t\t// At this point, the fields freq and dad are set. We can now\n\t\t// generate the bit lengths.\n\n\t\tgen_bitlen(s);\n\n\t\t// The field len is now set, we can generate the bit codes\n\t\tgen_codes(tree, that.max_code, s.bl_count);\n\t};\n\n}\n\nTree._length_code = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16,\n\t\t16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20,\n\t\t20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25,\n\t\t25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26,\n\t\t26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 28 ];\n\nTree.base_length = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 14, 16, 20, 24, 28, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 0 ];\n\nTree.base_dist = [ 0, 1, 2, 3, 4, 6, 8, 12, 16, 24, 32, 48, 64, 96, 128, 192, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096, 6144, 8192, 12288, 16384,\n\t\t24576 ];\n\n// Mapping from a distance to a distance code. dist is the distance - 1 and\n// must not have side effects. _dist_code[256] and _dist_code[257] are never\n// used.\nTree.d_code = function(dist) {\n\treturn ((dist) < 256 ? _dist_code[dist] : _dist_code[256 + ((dist) >>> 7)]);\n};\n\n// extra bits for each length code\nTree.extra_lbits = [ 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0 ];\n\n// extra bits for each distance code\nTree.extra_dbits = [ 0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13 ];\n\n// extra bits for each bit length code\nTree.extra_blbits = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7 ];\n\nTree.bl_order = [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];\n\n// StaticTree\n\nfunction StaticTree(static_tree, extra_bits, extra_base, elems, max_length) {\n\tvar that = this;\n\tthat.static_tree = static_tree;\n\tthat.extra_bits = extra_bits;\n\tthat.extra_base = extra_base;\n\tthat.elems = elems;\n\tthat.max_length = max_length;\n}\n\nStaticTree.static_ltree = [ 12, 8, 140, 8, 76, 8, 204, 8, 44, 8, 172, 8, 108, 8, 236, 8, 28, 8, 156, 8, 92, 8, 220, 8, 60, 8, 188, 8, 124, 8, 252, 8, 2, 8,\n\t\t130, 8, 66, 8, 194, 8, 34, 8, 162, 8, 98, 8, 226, 8, 18, 8, 146, 8, 82, 8, 210, 8, 50, 8, 178, 8, 114, 8, 242, 8, 10, 8, 138, 8, 74, 8, 202, 8, 42,\n\t\t8, 170, 8, 106, 8, 234, 8, 26, 8, 154, 8, 90, 8, 218, 8, 58, 8, 186, 8, 122, 8, 250, 8, 6, 8, 134, 8, 70, 8, 198, 8, 38, 8, 166, 8, 102, 8, 230, 8,\n\t\t22, 8, 150, 8, 86, 8, 214, 8, 54, 8, 182, 8, 118, 8, 246, 8, 14, 8, 142, 8, 78, 8, 206, 8, 46, 8, 174, 8, 110, 8, 238, 8, 30, 8, 158, 8, 94, 8,\n\t\t222, 8, 62, 8, 190, 8, 126, 8, 254, 8, 1, 8, 129, 8, 65, 8, 193, 8, 33, 8, 161, 8, 97, 8, 225, 8, 17, 8, 145, 8, 81, 8, 209, 8, 49, 8, 177, 8, 113,\n\t\t8, 241, 8, 9, 8, 137, 8, 73, 8, 201, 8, 41, 8, 169, 8, 105, 8, 233, 8, 25, 8, 153, 8, 89, 8, 217, 8, 57, 8, 185, 8, 121, 8, 249, 8, 5, 8, 133, 8,\n\t\t69, 8, 197, 8, 37, 8, 165, 8, 101, 8, 229, 8, 21, 8, 149, 8, 85, 8, 213, 8, 53, 8, 181, 8, 117, 8, 245, 8, 13, 8, 141, 8, 77, 8, 205, 8, 45, 8,\n\t\t173, 8, 109, 8, 237, 8, 29, 8, 157, 8, 93, 8, 221, 8, 61, 8, 189, 8, 125, 8, 253, 8, 19, 9, 275, 9, 147, 9, 403, 9, 83, 9, 339, 9, 211, 9, 467, 9,\n\t\t51, 9, 307, 9, 179, 9, 435, 9, 115, 9, 371, 9, 243, 9, 499, 9, 11, 9, 267, 9, 139, 9, 395, 9, 75, 9, 331, 9, 203, 9, 459, 9, 43, 9, 299, 9, 171, 9,\n\t\t427, 9, 107, 9, 363, 9, 235, 9, 491, 9, 27, 9, 283, 9, 155, 9, 411, 9, 91, 9, 347, 9, 219, 9, 475, 9, 59, 9, 315, 9, 187, 9, 443, 9, 123, 9, 379,\n\t\t9, 251, 9, 507, 9, 7, 9, 263, 9, 135, 9, 391, 9, 71, 9, 327, 9, 199, 9, 455, 9, 39, 9, 295, 9, 167, 9, 423, 9, 103, 9, 359, 9, 231, 9, 487, 9, 23,\n\t\t9, 279, 9, 151, 9, 407, 9, 87, 9, 343, 9, 215, 9, 471, 9, 55, 9, 311, 9, 183, 9, 439, 9, 119, 9, 375, 9, 247, 9, 503, 9, 15, 9, 271, 9, 143, 9,\n\t\t399, 9, 79, 9, 335, 9, 207, 9, 463, 9, 47, 9, 303, 9, 175, 9, 431, 9, 111, 9, 367, 9, 239, 9, 495, 9, 31, 9, 287, 9, 159, 9, 415, 9, 95, 9, 351, 9,\n\t\t223, 9, 479, 9, 63, 9, 319, 9, 191, 9, 447, 9, 127, 9, 383, 9, 255, 9, 511, 9, 0, 7, 64, 7, 32, 7, 96, 7, 16, 7, 80, 7, 48, 7, 112, 7, 8, 7, 72, 7,\n\t\t40, 7, 104, 7, 24, 7, 88, 7, 56, 7, 120, 7, 4, 7, 68, 7, 36, 7, 100, 7, 20, 7, 84, 7, 52, 7, 116, 7, 3, 8, 131, 8, 67, 8, 195, 8, 35, 8, 163, 8,\n\t\t99, 8, 227, 8 ];\n\nStaticTree.static_dtree = [ 0, 5, 16, 5, 8, 5, 24, 5, 4, 5, 20, 5, 12, 5, 28, 5, 2, 5, 18, 5, 10, 5, 26, 5, 6, 5, 22, 5, 14, 5, 30, 5, 1, 5, 17, 5, 9, 5,\n\t\t25, 5, 5, 5, 21, 5, 13, 5, 29, 5, 3, 5, 19, 5, 11, 5, 27, 5, 7, 5, 23, 5 ];\n\nStaticTree.static_l_desc = new StaticTree(StaticTree.static_ltree, Tree.extra_lbits, LITERALS + 1, L_CODES, MAX_BITS);\n\nStaticTree.static_d_desc = new StaticTree(StaticTree.static_dtree, Tree.extra_dbits, 0, D_CODES, MAX_BITS);\n\nStaticTree.static_bl_desc = new StaticTree(null, Tree.extra_blbits, 0, BL_CODES, MAX_BL_BITS);\n\n// Deflate\n\nvar MAX_MEM_LEVEL = 9;\nvar DEF_MEM_LEVEL = 8;\n\nfunction Config(good_length, max_lazy, nice_length, max_chain, func) {\n\tvar that = this;\n\tthat.good_length = good_length;\n\tthat.max_lazy = max_lazy;\n\tthat.nice_length = nice_length;\n\tthat.max_chain = max_chain;\n\tthat.func = func;\n}\n\nvar STORED = 0;\nvar FAST = 1;\nvar SLOW = 2;\nvar config_table = [ new Config(0, 0, 0, 0, STORED), new Config(4, 4, 8, 4, FAST), new Config(4, 5, 16, 8, FAST), new Config(4, 6, 32, 32, FAST),\n\t\tnew Config(4, 4, 16, 16, SLOW), new Config(8, 16, 32, 32, SLOW), new Config(8, 16, 128, 128, SLOW), new Config(8, 32, 128, 256, SLOW),\n\t\tnew Config(32, 128, 258, 1024, SLOW), new Config(32, 258, 258, 4096, SLOW) ];\n\nvar z_errmsg = [ \"need dictionary\", // Z_NEED_DICT\n// 2\n\"stream end\", // Z_STREAM_END 1\n\"\", // Z_OK 0\n\"\", // Z_ERRNO (-1)\n\"stream error\", // Z_STREAM_ERROR (-2)\n\"data error\", // Z_DATA_ERROR (-3)\n\"\", // Z_MEM_ERROR (-4)\n\"buffer error\", // Z_BUF_ERROR (-5)\n\"\",// Z_VERSION_ERROR (-6)\n\"\" ];\n\n// block not completed, need more input or more output\nvar NeedMore = 0;\n\n// block flush performed\nvar BlockDone = 1;\n\n// finish started, need only more output at next deflate\nvar FinishStarted = 2;\n\n// finish done, accept no more input or output\nvar FinishDone = 3;\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT = 0x20;\n\nvar INIT_STATE = 42;\nvar BUSY_STATE = 113;\nvar FINISH_STATE = 666;\n\n// The deflate compression method\nvar Z_DEFLATED = 8;\n\nvar STORED_BLOCK = 0;\nvar STATIC_TREES = 1;\nvar DYN_TREES = 2;\n\nvar MIN_MATCH = 3;\nvar MAX_MATCH = 258;\nvar MIN_LOOKAHEAD = (MAX_MATCH + MIN_MATCH + 1);\n\nfunction smaller(tree, n, m, depth) {\n\tvar tn2 = tree[n * 2];\n\tvar tm2 = tree[m * 2];\n\treturn (tn2 < tm2 || (tn2 == tm2 && depth[n] <= depth[m]));\n}\n\nfunction Deflate() {\n\n\tvar that = this;\n\tvar strm; // pointer back to this zlib stream\n\tvar status; // as the name implies\n\t// pending_buf; // output still pending\n\tvar pending_buf_size; // size of pending_buf\n\t// pending_out; // next pending byte to output to the stream\n\t// pending; // nb of bytes in the pending buffer\n\tvar method; // STORED (for zip only) or DEFLATED\n\tvar last_flush; // value of flush param for previous deflate call\n\n\tvar w_size; // LZ77 window size (32K by default)\n\tvar w_bits; // log2(w_size) (8..16)\n\tvar w_mask; // w_size - 1\n\n\tvar window;\n\t// Sliding window. Input bytes are read into the second half of the window,\n\t// and move to the first half later to keep a dictionary of at least wSize\n\t// bytes. With this organization, matches are limited to a distance of\n\t// wSize-MAX_MATCH bytes, but this ensures that IO is always\n\t// performed with a length multiple of the block size. Also, it limits\n\t// the window size to 64K, which is quite useful on MSDOS.\n\t// To do: use the user input buffer as sliding window.\n\n\tvar window_size;\n\t// Actual size of window: 2*wSize, except when the user input buffer\n\t// is directly used as sliding window.\n\n\tvar prev;\n\t// Link to older string with same hash index. To limit the size of this\n\t// array to 64K, this link is maintained only for the last 32K strings.\n\t// An index in this array is thus a window index modulo 32K.\n\n\tvar head; // Heads of the hash chains or NIL.\n\n\tvar ins_h; // hash index of string to be inserted\n\tvar hash_size; // number of elements in hash table\n\tvar hash_bits; // log2(hash_size)\n\tvar hash_mask; // hash_size-1\n\n\t// Number of bits by which ins_h must be shifted at each input\n\t// step. It must be such that after MIN_MATCH steps, the oldest\n\t// byte no longer takes part in the hash key, that is:\n\t// hash_shift * MIN_MATCH >= hash_bits\n\tvar hash_shift;\n\n\t// Window position at the beginning of the current output block. Gets\n\t// negative when the window is moved backwards.\n\n\tvar block_start;\n\n\tvar match_length; // length of best match\n\tvar prev_match; // previous match\n\tvar match_available; // set if previous match exists\n\tvar strstart; // start of string to insert\n\tvar match_start; // start of matching string\n\tvar lookahead; // number of valid bytes ahead in window\n\n\t// Length of the best match at previous step. Matches not greater than this\n\t// are discarded. This is used in the lazy match evaluation.\n\tvar prev_length;\n\n\t// To speed up deflation, hash chains are never searched beyond this\n\t// length. A higher limit improves compression ratio but degrades the speed.\n\tvar max_chain_length;\n\n\t// Attempt to find a better match only when the current match is strictly\n\t// smaller than this value. This mechanism is used only for compression\n\t// levels >= 4.\n\tvar max_lazy_match;\n\n\t// Insert new strings in the hash table only if the match length is not\n\t// greater than this length. This saves time but degrades compression.\n\t// max_insert_length is used only for compression levels <= 3.\n\n\tvar level; // compression level (1..9)\n\tvar strategy; // favor or force Huffman coding\n\n\t// Use a faster search when the previous match is longer than this\n\tvar good_match;\n\n\t// Stop searching when current match exceeds this\n\tvar nice_match;\n\n\tvar dyn_ltree; // literal and length tree\n\tvar dyn_dtree; // distance tree\n\tvar bl_tree; // Huffman tree for bit lengths\n\n\tvar l_desc = new Tree(); // desc for literal tree\n\tvar d_desc = new Tree(); // desc for distance tree\n\tvar bl_desc = new Tree(); // desc for bit length tree\n\n\t// that.heap_len; // number of elements in the heap\n\t// that.heap_max; // element of largest frequency\n\t// The sons of heap[n] are heap[2*n] and heap[2*n+1]. heap[0] is not used.\n\t// The same heap array is used to build all trees.\n\n\t// Depth of each subtree used as tie breaker for trees of equal frequency\n\tthat.depth = [];\n\n\tvar l_buf; // index for literals or lengths */\n\n\t// Size of match buffer for literals/lengths. There are 4 reasons for\n\t// limiting lit_bufsize to 64K:\n\t// - frequencies can be kept in 16 bit counters\n\t// - if compression is not successful for the first block, all input\n\t// data is still in the window so we can still emit a stored block even\n\t// when input comes from standard input. (This can also be done for\n\t// all blocks if lit_bufsize is not greater than 32K.)\n\t// - if compression is not successful for a file smaller than 64K, we can\n\t// even emit a stored file instead of a stored block (saving 5 bytes).\n\t// This is applicable only for zip (not gzip or zlib).\n\t// - creating new Huffman trees less frequently may not provide fast\n\t// adaptation to changes in the input data statistics. (Take for\n\t// example a binary file with poorly compressible code followed by\n\t// a highly compressible string table.) Smaller buffer sizes give\n\t// fast adaptation but have of course the overhead of transmitting\n\t// trees more frequently.\n\t// - I can't count above 4\n\tvar lit_bufsize;\n\n\tvar last_lit; // running index in l_buf\n\n\t// Buffer for distances. To simplify the code, d_buf and l_buf have\n\t// the same number of elements. To use different lengths, an extra flag\n\t// array would be necessary.\n\n\tvar d_buf; // index of pendig_buf\n\n\t// that.opt_len; // bit length of current block with optimal trees\n\t// that.static_len; // bit length of current block with static trees\n\tvar matches; // number of string matches in current block\n\tvar last_eob_len; // bit length of EOB code for last block\n\n\t// Output buffer. bits are inserted starting at the bottom (least\n\t// significant bits).\n\tvar bi_buf;\n\n\t// Number of valid bits in bi_buf. All bits above the last valid bit\n\t// are always zero.\n\tvar bi_valid;\n\n\t// number of codes at each bit length for an optimal tree\n\tthat.bl_count = [];\n\n\t// heap used to build the Huffman trees\n\tthat.heap = [];\n\n\tdyn_ltree = [];\n\tdyn_dtree = [];\n\tbl_tree = [];\n\n\tfunction lm_init() {\n\t\tvar i;\n\t\twindow_size = 2 * w_size;\n\n\t\thead[hash_size - 1] = 0;\n\t\tfor (i = 0; i < hash_size - 1; i++) {\n\t\t\thead[i] = 0;\n\t\t}\n\n\t\t// Set the default configuration parameters:\n\t\tmax_lazy_match = config_table[level].max_lazy;\n\t\tgood_match = config_table[level].good_length;\n\t\tnice_match = config_table[level].nice_length;\n\t\tmax_chain_length = config_table[level].max_chain;\n\n\t\tstrstart = 0;\n\t\tblock_start = 0;\n\t\tlookahead = 0;\n\t\tmatch_length = prev_length = MIN_MATCH - 1;\n\t\tmatch_available = 0;\n\t\tins_h = 0;\n\t}\n\n\tfunction init_block() {\n\t\tvar i;\n\t\t// Initialize the trees.\n\t\tfor (i = 0; i < L_CODES; i++)\n\t\t\tdyn_ltree[i * 2] = 0;\n\t\tfor (i = 0; i < D_CODES; i++)\n\t\t\tdyn_dtree[i * 2] = 0;\n\t\tfor (i = 0; i < BL_CODES; i++)\n\t\t\tbl_tree[i * 2] = 0;\n\n\t\tdyn_ltree[END_BLOCK * 2] = 1;\n\t\tthat.opt_len = that.static_len = 0;\n\t\tlast_lit = matches = 0;\n\t}\n\n\t// Initialize the tree data structures for a new zlib stream.\n\tfunction tr_init() {\n\n\t\tl_desc.dyn_tree = dyn_ltree;\n\t\tl_desc.stat_desc = StaticTree.static_l_desc;\n\n\t\td_desc.dyn_tree = dyn_dtree;\n\t\td_desc.stat_desc = StaticTree.static_d_desc;\n\n\t\tbl_desc.dyn_tree = bl_tree;\n\t\tbl_desc.stat_desc = StaticTree.static_bl_desc;\n\n\t\tbi_buf = 0;\n\t\tbi_valid = 0;\n\t\tlast_eob_len = 8; // enough lookahead for inflate\n\n\t\t// Initialize the first block of the first file:\n\t\tinit_block();\n\t}\n\n\t// Restore the heap property by moving down the tree starting at node k,\n\t// exchanging a node with the smallest of its two sons if necessary,\n\t// stopping\n\t// when the heap property is re-established (each father smaller than its\n\t// two sons).\n\tthat.pqdownheap = function(tree, // the tree to restore\n\tk // node to move down\n\t) {\n\t\tvar heap = that.heap;\n\t\tvar v = heap[k];\n\t\tvar j = k << 1; // left son of k\n\t\twhile (j <= that.heap_len) {\n\t\t\t// Set j to the smallest of the two sons:\n\t\t\tif (j < that.heap_len && smaller(tree, heap[j + 1], heap[j], that.depth)) {\n\t\t\t\tj++;\n\t\t\t}\n\t\t\t// Exit if v is smaller than both sons\n\t\t\tif (smaller(tree, v, heap[j], that.depth))\n\t\t\t\tbreak;\n\n\t\t\t// Exchange v with the smallest son\n\t\t\theap[k] = heap[j];\n\t\t\tk = j;\n\t\t\t// And continue down the tree, setting j to the left son of k\n\t\t\tj <<= 1;\n\t\t}\n\t\theap[k] = v;\n\t};\n\n\t// Scan a literal or distance tree to determine the frequencies of the codes\n\t// in the bit length tree.\n\tfunction scan_tree(tree,// the tree to be scanned\n\tmax_code // and its largest code of non zero frequency\n\t) {\n\t\tvar n; // iterates over all tree elements\n\t\tvar prevlen = -1; // last emitted length\n\t\tvar curlen; // length of current code\n\t\tvar nextlen = tree[0 * 2 + 1]; // length of next code\n\t\tvar count = 0; // repeat count of the current code\n\t\tvar max_count = 7; // max repeat count\n\t\tvar min_count = 4; // min repeat count\n\n\t\tif (nextlen === 0) {\n\t\t\tmax_count = 138;\n\t\t\tmin_count = 3;\n\t\t}\n\t\ttree[(max_code + 1) * 2 + 1] = 0xffff; // guard\n\n\t\tfor (n = 0; n <= max_code; n++) {\n\t\t\tcurlen = nextlen;\n\t\t\tnextlen = tree[(n + 1) * 2 + 1];\n\t\t\tif (++count < max_count && curlen == nextlen) {\n\t\t\t\tcontinue;\n\t\t\t} else if (count < min_count) {\n\t\t\t\tbl_tree[curlen * 2] += count;\n\t\t\t} else if (curlen !== 0) {\n\t\t\t\tif (curlen != prevlen)\n\t\t\t\t\tbl_tree[curlen * 2]++;\n\t\t\t\tbl_tree[REP_3_6 * 2]++;\n\t\t\t} else if (count <= 10) {\n\t\t\t\tbl_tree[REPZ_3_10 * 2]++;\n\t\t\t} else {\n\t\t\t\tbl_tree[REPZ_11_138 * 2]++;\n\t\t\t}\n\t\t\tcount = 0;\n\t\t\tprevlen = curlen;\n\t\t\tif (nextlen === 0) {\n\t\t\t\tmax_count = 138;\n\t\t\t\tmin_count = 3;\n\t\t\t} else if (curlen == nextlen) {\n\t\t\t\tmax_count = 6;\n\t\t\t\tmin_count = 3;\n\t\t\t} else {\n\t\t\t\tmax_count = 7;\n\t\t\t\tmin_count = 4;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Construct the Huffman tree for the bit lengths and return the index in\n\t// bl_order of the last bit length code to send.\n\tfunction build_bl_tree() {\n\t\tvar max_blindex; // index of last bit length code of non zero freq\n\n\t\t// Determine the bit length frequencies for literal and distance trees\n\t\tscan_tree(dyn_ltree, l_desc.max_code);\n\t\tscan_tree(dyn_dtree, d_desc.max_code);\n\n\t\t// Build the bit length tree:\n\t\tbl_desc.build_tree(that);\n\t\t// opt_len now includes the length of the tree representations, except\n\t\t// the lengths of the bit lengths codes and the 5+5+4 bits for the\n\t\t// counts.\n\n\t\t// Determine the number of bit length codes to send. The pkzip format\n\t\t// requires that at least 4 bit length codes be sent. (appnote.txt says\n\t\t// 3 but the actual value used is 4.)\n\t\tfor (max_blindex = BL_CODES - 1; max_blindex >= 3; max_blindex--) {\n\t\t\tif (bl_tree[Tree.bl_order[max_blindex] * 2 + 1] !== 0)\n\t\t\t\tbreak;\n\t\t}\n\t\t// Update opt_len to include the bit length tree and counts\n\t\tthat.opt_len += 3 * (max_blindex + 1) + 5 + 5 + 4;\n\n\t\treturn max_blindex;\n\t}\n\n\t// Output a byte on the stream.\n\t// IN assertion: there is enough room in pending_buf.\n\tfunction put_byte(p) {\n\t\tthat.pending_buf[that.pending++] = p;\n\t}\n\n\tfunction put_short(w) {\n\t\tput_byte(w & 0xff);\n\t\tput_byte((w >>> 8) & 0xff);\n\t}\n\n\tfunction putShortMSB(b) {\n\t\tput_byte((b >> 8) & 0xff);\n\t\tput_byte((b & 0xff) & 0xff);\n\t}\n\n\tfunction send_bits(value, length) {\n\t\tvar val, len = length;\n\t\tif (bi_valid > Buf_size - len) {\n\t\t\tval = value;\n\t\t\t// bi_buf |= (val << bi_valid);\n\t\t\tbi_buf |= ((val << bi_valid) & 0xffff);\n\t\t\tput_short(bi_buf);\n\t\t\tbi_buf = val >>> (Buf_size - bi_valid);\n\t\t\tbi_valid += len - Buf_size;\n\t\t} else {\n\t\t\t// bi_buf |= (value) << bi_valid;\n\t\t\tbi_buf |= (((value) << bi_valid) & 0xffff);\n\t\t\tbi_valid += len;\n\t\t}\n\t}\n\n\tfunction send_code(c, tree) {\n\t\tvar c2 = c * 2;\n\t\tsend_bits(tree[c2] & 0xffff, tree[c2 + 1] & 0xffff);\n\t}\n\n\t// Send a literal or distance tree in compressed form, using the codes in\n\t// bl_tree.\n\tfunction send_tree(tree,// the tree to be sent\n\tmax_code // and its largest code of non zero frequency\n\t) {\n\t\tvar n; // iterates over all tree elements\n\t\tvar prevlen = -1; // last emitted length\n\t\tvar curlen; // length of current code\n\t\tvar nextlen = tree[0 * 2 + 1]; // length of next code\n\t\tvar count = 0; // repeat count of the current code\n\t\tvar max_count = 7; // max repeat count\n\t\tvar min_count = 4; // min repeat count\n\n\t\tif (nextlen === 0) {\n\t\t\tmax_count = 138;\n\t\t\tmin_count = 3;\n\t\t}\n\n\t\tfor (n = 0; n <= max_code; n++) {\n\t\t\tcurlen = nextlen;\n\t\t\tnextlen = tree[(n + 1) * 2 + 1];\n\t\t\tif (++count < max_count && curlen == nextlen) {\n\t\t\t\tcontinue;\n\t\t\t} else if (count < min_count) {\n\t\t\t\tdo {\n\t\t\t\t\tsend_code(curlen, bl_tree);\n\t\t\t\t} while (--count !== 0);\n\t\t\t} else if (curlen !== 0) {\n\t\t\t\tif (curlen != prevlen) {\n\t\t\t\t\tsend_code(curlen, bl_tree);\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\t\t\t\tsend_code(REP_3_6, bl_tree);\n\t\t\t\tsend_bits(count - 3, 2);\n\t\t\t} else if (count <= 10) {\n\t\t\t\tsend_code(REPZ_3_10, bl_tree);\n\t\t\t\tsend_bits(count - 3, 3);\n\t\t\t} else {\n\t\t\t\tsend_code(REPZ_11_138, bl_tree);\n\t\t\t\tsend_bits(count - 11, 7);\n\t\t\t}\n\t\t\tcount = 0;\n\t\t\tprevlen = curlen;\n\t\t\tif (nextlen === 0) {\n\t\t\t\tmax_count = 138;\n\t\t\t\tmin_count = 3;\n\t\t\t} else if (curlen == nextlen) {\n\t\t\t\tmax_count = 6;\n\t\t\t\tmin_count = 3;\n\t\t\t} else {\n\t\t\t\tmax_count = 7;\n\t\t\t\tmin_count = 4;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Send the header for a block using dynamic Huffman trees: the counts, the\n\t// lengths of the bit length codes, the literal tree and the distance tree.\n\t// IN assertion: lcodes >= 257, dcodes >= 1, blcodes >= 4.\n\tfunction send_all_trees(lcodes, dcodes, blcodes) {\n\t\tvar rank; // index in bl_order\n\n\t\tsend_bits(lcodes - 257, 5); // not +255 as stated in appnote.txt\n\t\tsend_bits(dcodes - 1, 5);\n\t\tsend_bits(blcodes - 4, 4); // not -3 as stated in appnote.txt\n\t\tfor (rank = 0; rank < blcodes; rank++) {\n\t\t\tsend_bits(bl_tree[Tree.bl_order[rank] * 2 + 1], 3);\n\t\t}\n\t\tsend_tree(dyn_ltree, lcodes - 1); // literal tree\n\t\tsend_tree(dyn_dtree, dcodes - 1); // distance tree\n\t}\n\n\t// Flush the bit buffer, keeping at most 7 bits in it.\n\tfunction bi_flush() {\n\t\tif (bi_valid == 16) {\n\t\t\tput_short(bi_buf);\n\t\t\tbi_buf = 0;\n\t\t\tbi_valid = 0;\n\t\t} else if (bi_valid >= 8) {\n\t\t\tput_byte(bi_buf & 0xff);\n\t\t\tbi_buf >>>= 8;\n\t\t\tbi_valid -= 8;\n\t\t}\n\t}\n\n\t// Send one empty static block to give enough lookahead for inflate.\n\t// This takes 10 bits, of which 7 may remain in the bit buffer.\n\t// The current inflate code requires 9 bits of lookahead. If the\n\t// last two codes for the previous block (real code plus EOB) were coded\n\t// on 5 bits or less, inflate may have only 5+3 bits of lookahead to decode\n\t// the last real code. In this case we send two empty static blocks instead\n\t// of one. (There are no problems if the previous block is stored or fixed.)\n\t// To simplify the code, we assume the worst case of last real code encoded\n\t// on one bit only.\n\tfunction _tr_align() {\n\t\tsend_bits(STATIC_TREES << 1, 3);\n\t\tsend_code(END_BLOCK, StaticTree.static_ltree);\n\n\t\tbi_flush();\n\n\t\t// Of the 10 bits for the empty block, we have already sent\n\t\t// (10 - bi_valid) bits. The lookahead for the last real code (before\n\t\t// the EOB of the previous block) was thus at least one plus the length\n\t\t// of the EOB plus what we have just sent of the empty static block.\n\t\tif (1 + last_eob_len + 10 - bi_valid < 9) {\n\t\t\tsend_bits(STATIC_TREES << 1, 3);\n\t\t\tsend_code(END_BLOCK, StaticTree.static_ltree);\n\t\t\tbi_flush();\n\t\t}\n\t\tlast_eob_len = 7;\n\t}\n\n\t// Save the match info and tally the frequency counts. Return true if\n\t// the current block must be flushed.\n\tfunction _tr_tally(dist, // distance of matched string\n\tlc // match length-MIN_MATCH or unmatched char (if dist==0)\n\t) {\n\t\tvar out_length, in_length, dcode;\n\t\tthat.pending_buf[d_buf + last_lit * 2] = (dist >>> 8) & 0xff;\n\t\tthat.pending_buf[d_buf + last_lit * 2 + 1] = dist & 0xff;\n\n\t\tthat.pending_buf[l_buf + last_lit] = lc & 0xff;\n\t\tlast_lit++;\n\n\t\tif (dist === 0) {\n\t\t\t// lc is the unmatched char\n\t\t\tdyn_ltree[lc * 2]++;\n\t\t} else {\n\t\t\tmatches++;\n\t\t\t// Here, lc is the match length - MIN_MATCH\n\t\t\tdist--; // dist = match distance - 1\n\t\t\tdyn_ltree[(Tree._length_code[lc] + LITERALS + 1) * 2]++;\n\t\t\tdyn_dtree[Tree.d_code(dist) * 2]++;\n\t\t}\n\n\t\tif ((last_lit & 0x1fff) === 0 && level > 2) {\n\t\t\t// Compute an upper bound for the compressed length\n\t\t\tout_length = last_lit * 8;\n\t\t\tin_length = strstart - block_start;\n\t\t\tfor (dcode = 0; dcode < D_CODES; dcode++) {\n\t\t\t\tout_length += dyn_dtree[dcode * 2] * (5 + Tree.extra_dbits[dcode]);\n\t\t\t}\n\t\t\tout_length >>>= 3;\n\t\t\tif ((matches < Math.floor(last_lit / 2)) && out_length < Math.floor(in_length / 2))\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn (last_lit == lit_bufsize - 1);\n\t\t// We avoid equality with lit_bufsize because of wraparound at 64K\n\t\t// on 16 bit machines and because stored blocks are restricted to\n\t\t// 64K-1 bytes.\n\t}\n\n\t// Send the block data compressed using the given Huffman trees\n\tfunction compress_block(ltree, dtree) {\n\t\tvar dist; // distance of matched string\n\t\tvar lc; // match length or unmatched char (if dist === 0)\n\t\tvar lx = 0; // running index in l_buf\n\t\tvar code; // the code to send\n\t\tvar extra; // number of extra bits to send\n\n\t\tif (last_lit !== 0) {\n\t\t\tdo {\n\t\t\t\tdist = ((that.pending_buf[d_buf + lx * 2] << 8) & 0xff00) | (that.pending_buf[d_buf + lx * 2 + 1] & 0xff);\n\t\t\t\tlc = (that.pending_buf[l_buf + lx]) & 0xff;\n\t\t\t\tlx++;\n\n\t\t\t\tif (dist === 0) {\n\t\t\t\t\tsend_code(lc, ltree); // send a literal byte\n\t\t\t\t} else {\n\t\t\t\t\t// Here, lc is the match length - MIN_MATCH\n\t\t\t\t\tcode = Tree._length_code[lc];\n\n\t\t\t\t\tsend_code(code + LITERALS + 1, ltree); // send the length\n\t\t\t\t\t// code\n\t\t\t\t\textra = Tree.extra_lbits[code];\n\t\t\t\t\tif (extra !== 0) {\n\t\t\t\t\t\tlc -= Tree.base_length[code];\n\t\t\t\t\t\tsend_bits(lc, extra); // send the extra length bits\n\t\t\t\t\t}\n\t\t\t\t\tdist--; // dist is now the match distance - 1\n\t\t\t\t\tcode = Tree.d_code(dist);\n\n\t\t\t\t\tsend_code(code, dtree); // send the distance code\n\t\t\t\t\textra = Tree.extra_dbits[code];\n\t\t\t\t\tif (extra !== 0) {\n\t\t\t\t\t\tdist -= Tree.base_dist[code];\n\t\t\t\t\t\tsend_bits(dist, extra); // send the extra distance bits\n\t\t\t\t\t}\n\t\t\t\t} // literal or match pair ?\n\n\t\t\t\t// Check that the overlay between pending_buf and d_buf+l_buf is\n\t\t\t\t// ok:\n\t\t\t} while (lx < last_lit);\n\t\t}\n\n\t\tsend_code(END_BLOCK, ltree);\n\t\tlast_eob_len = ltree[END_BLOCK * 2 + 1];\n\t}\n\n\t// Flush the bit buffer and align the output on a byte boundary\n\tfunction bi_windup() {\n\t\tif (bi_valid > 8) {\n\t\t\tput_short(bi_buf);\n\t\t} else if (bi_valid > 0) {\n\t\t\tput_byte(bi_buf & 0xff);\n\t\t}\n\t\tbi_buf = 0;\n\t\tbi_valid = 0;\n\t}\n\n\t// Copy a stored block, storing first the length and its\n\t// one's complement if requested.\n\tfunction copy_block(buf, // the input data\n\tlen, // its length\n\theader // true if block header must be written\n\t) {\n\t\tbi_windup(); // align on byte boundary\n\t\tlast_eob_len = 8; // enough lookahead for inflate\n\n\t\tif (header) {\n\t\t\tput_short(len);\n\t\t\tput_short(~len);\n\t\t}\n\n\t\tthat.pending_buf.set(window.subarray(buf, buf + len), that.pending);\n\t\tthat.pending += len;\n\t}\n\n\t// Send a stored block\n\tfunction _tr_stored_block(buf, // input block\n\tstored_len, // length of input block\n\teof // true if this is the last block for a file\n\t) {\n\t\tsend_bits((STORED_BLOCK << 1) + (eof ? 1 : 0), 3); // send block type\n\t\tcopy_block(buf, stored_len, true); // with header\n\t}\n\n\t// Determine the best encoding for the current block: dynamic trees, static\n\t// trees or store, and output the encoded block to the zip file.\n\tfunction _tr_flush_block(buf, // input block, or NULL if too old\n\tstored_len, // length of input block\n\teof // true if this is the last block for a file\n\t) {\n\t\tvar opt_lenb, static_lenb;// opt_len and static_len in bytes\n\t\tvar max_blindex = 0; // index of last bit length code of non zero freq\n\n\t\t// Build the Huffman trees unless a stored block is forced\n\t\tif (level > 0) {\n\t\t\t// Construct the literal and distance trees\n\t\t\tl_desc.build_tree(that);\n\n\t\t\td_desc.build_tree(that);\n\n\t\t\t// At this point, opt_len and static_len are the total bit lengths\n\t\t\t// of\n\t\t\t// the compressed block data, excluding the tree representations.\n\n\t\t\t// Build the bit length tree for the above two trees, and get the\n\t\t\t// index\n\t\t\t// in bl_order of the last bit length code to send.\n\t\t\tmax_blindex = build_bl_tree();\n\n\t\t\t// Determine the best encoding. Compute first the block length in\n\t\t\t// bytes\n\t\t\topt_lenb = (that.opt_len + 3 + 7) >>> 3;\n\t\t\tstatic_lenb = (that.static_len + 3 + 7) >>> 3;\n\n\t\t\tif (static_lenb <= opt_lenb)\n\t\t\t\topt_lenb = static_lenb;\n\t\t} else {\n\t\t\topt_lenb = static_lenb = stored_len + 5; // force a stored block\n\t\t}\n\n\t\tif ((stored_len + 4 <= opt_lenb) && buf != -1) {\n\t\t\t// 4: two words for the lengths\n\t\t\t// The test buf != NULL is only necessary if LIT_BUFSIZE > WSIZE.\n\t\t\t// Otherwise we can't have processed more than WSIZE input bytes\n\t\t\t// since\n\t\t\t// the last block flush, because compression would have been\n\t\t\t// successful. If LIT_BUFSIZE <= WSIZE, it is never too late to\n\t\t\t// transform a block into a stored block.\n\t\t\t_tr_stored_block(buf, stored_len, eof);\n\t\t} else if (static_lenb == opt_lenb) {\n\t\t\tsend_bits((STATIC_TREES << 1) + (eof ? 1 : 0), 3);\n\t\t\tcompress_block(StaticTree.static_ltree, StaticTree.static_dtree);\n\t\t} else {\n\t\t\tsend_bits((DYN_TREES << 1) + (eof ? 1 : 0), 3);\n\t\t\tsend_all_trees(l_desc.max_code + 1, d_desc.max_code + 1, max_blindex + 1);\n\t\t\tcompress_block(dyn_ltree, dyn_dtree);\n\t\t}\n\n\t\t// The above check is made mod 2^32, for files larger than 512 MB\n\t\t// and uLong implemented on 32 bits.\n\n\t\tinit_block();\n\n\t\tif (eof) {\n\t\t\tbi_windup();\n\t\t}\n\t}\n\n\tfunction flush_block_only(eof) {\n\t\t_tr_flush_block(block_start >= 0 ? block_start : -1, strstart - block_start, eof);\n\t\tblock_start = strstart;\n\t\tstrm.flush_pending();\n\t}\n\n\t// Fill the window when the lookahead becomes insufficient.\n\t// Updates strstart and lookahead.\n\t//\n\t// IN assertion: lookahead < MIN_LOOKAHEAD\n\t// OUT assertions: strstart <= window_size-MIN_LOOKAHEAD\n\t// At least one byte has been read, or avail_in === 0; reads are\n\t// performed for at least two bytes (required for the zip translate_eol\n\t// option -- not supported here).\n\tfunction fill_window() {\n\t\tvar n, m;\n\t\tvar p;\n\t\tvar more; // Amount of free space at the end of the window.\n\n\t\tdo {\n\t\t\tmore = (window_size - lookahead - strstart);\n\n\t\t\t// Deal with !@#$% 64K limit:\n\t\t\tif (more === 0 && strstart === 0 && lookahead === 0) {\n\t\t\t\tmore = w_size;\n\t\t\t} else if (more == -1) {\n\t\t\t\t// Very unlikely, but possible on 16 bit machine if strstart ==\n\t\t\t\t// 0\n\t\t\t\t// and lookahead == 1 (input done one byte at time)\n\t\t\t\tmore--;\n\n\t\t\t\t// If the window is almost full and there is insufficient\n\t\t\t\t// lookahead,\n\t\t\t\t// move the upper half to the lower one to make room in the\n\t\t\t\t// upper half.\n\t\t\t} else if (strstart >= w_size + w_size - MIN_LOOKAHEAD) {\n\t\t\t\twindow.set(window.subarray(w_size, w_size + w_size), 0);\n\n\t\t\t\tmatch_start -= w_size;\n\t\t\t\tstrstart -= w_size; // we now have strstart >= MAX_DIST\n\t\t\t\tblock_start -= w_size;\n\n\t\t\t\t// Slide the hash table (could be avoided with 32 bit values\n\t\t\t\t// at the expense of memory usage). We slide even when level ==\n\t\t\t\t// 0\n\t\t\t\t// to keep the hash table consistent if we switch back to level\n\t\t\t\t// > 0\n\t\t\t\t// later. (Using level 0 permanently is not an optimal usage of\n\t\t\t\t// zlib, so we don't care about this pathological case.)\n\n\t\t\t\tn = hash_size;\n\t\t\t\tp = n;\n\t\t\t\tdo {\n\t\t\t\t\tm = (head[--p] & 0xffff);\n\t\t\t\t\thead[p] = (m >= w_size ? m - w_size : 0);\n\t\t\t\t} while (--n !== 0);\n\n\t\t\t\tn = w_size;\n\t\t\t\tp = n;\n\t\t\t\tdo {\n\t\t\t\t\tm = (prev[--p] & 0xffff);\n\t\t\t\t\tprev[p] = (m >= w_size ? m - w_size : 0);\n\t\t\t\t\t// If n is not on any hash chain, prev[n] is garbage but\n\t\t\t\t\t// its value will never be used.\n\t\t\t\t} while (--n !== 0);\n\t\t\t\tmore += w_size;\n\t\t\t}\n\n\t\t\tif (strm.avail_in === 0)\n\t\t\t\treturn;\n\n\t\t\t// If there was no sliding:\n\t\t\t// strstart <= WSIZE+MAX_DIST-1 && lookahead <= MIN_LOOKAHEAD - 1 &&\n\t\t\t// more == window_size - lookahead - strstart\n\t\t\t// => more >= window_size - (MIN_LOOKAHEAD-1 + WSIZE + MAX_DIST-1)\n\t\t\t// => more >= window_size - 2*WSIZE + 2\n\t\t\t// In the BIG_MEM or MMAP case (not yet supported),\n\t\t\t// window_size == input_size + MIN_LOOKAHEAD &&\n\t\t\t// strstart + s->lookahead <= input_size => more >= MIN_LOOKAHEAD.\n\t\t\t// Otherwise, window_size == 2*WSIZE so more >= 2.\n\t\t\t// If there was sliding, more >= WSIZE. So in all cases, more >= 2.\n\n\t\t\tn = strm.read_buf(window, strstart + lookahead, more);\n\t\t\tlookahead += n;\n\n\t\t\t// Initialize the hash value now that we have some input:\n\t\t\tif (lookahead >= MIN_MATCH) {\n\t\t\t\tins_h = window[strstart] & 0xff;\n\t\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[strstart + 1] & 0xff)) & hash_mask;\n\t\t\t}\n\t\t\t// If the whole input has less than MIN_MATCH bytes, ins_h is\n\t\t\t// garbage,\n\t\t\t// but this is not important since only literal bytes will be\n\t\t\t// emitted.\n\t\t} while (lookahead < MIN_LOOKAHEAD && strm.avail_in !== 0);\n\t}\n\n\t// Copy without compression as much as possible from the input stream,\n\t// return\n\t// the current block state.\n\t// This function does not insert new strings in the dictionary since\n\t// uncompressible data is probably not useful. This function is used\n\t// only for the level=0 compression option.\n\t// NOTE: this function should be optimized to avoid extra copying from\n\t// window to pending_buf.\n\tfunction deflate_stored(flush) {\n\t\t// Stored blocks are limited to 0xffff bytes, pending_buf is limited\n\t\t// to pending_buf_size, and each stored block has a 5 byte header:\n\n\t\tvar max_block_size = 0xffff;\n\t\tvar max_start;\n\n\t\tif (max_block_size > pending_buf_size - 5) {\n\t\t\tmax_block_size = pending_buf_size - 5;\n\t\t}\n\n\t\t// Copy as much as possible from input to output:\n\t\twhile (true) {\n\t\t\t// Fill the window as much as possible:\n\t\t\tif (lookahead <= 1) {\n\t\t\t\tfill_window();\n\t\t\t\tif (lookahead === 0 && flush == Z_NO_FLUSH)\n\t\t\t\t\treturn NeedMore;\n\t\t\t\tif (lookahead === 0)\n\t\t\t\t\tbreak; // flush the current block\n\t\t\t}\n\n\t\t\tstrstart += lookahead;\n\t\t\tlookahead = 0;\n\n\t\t\t// Emit a stored block if pending_buf will be full:\n\t\t\tmax_start = block_start + max_block_size;\n\t\t\tif (strstart === 0 || strstart >= max_start) {\n\t\t\t\t// strstart === 0 is possible when wraparound on 16-bit machine\n\t\t\t\tlookahead = (strstart - max_start);\n\t\t\t\tstrstart = max_start;\n\n\t\t\t\tflush_block_only(false);\n\t\t\t\tif (strm.avail_out === 0)\n\t\t\t\t\treturn NeedMore;\n\n\t\t\t}\n\n\t\t\t// Flush if we may have to slide, otherwise block_start may become\n\t\t\t// negative and the data will be gone:\n\t\t\tif (strstart - block_start >= w_size - MIN_LOOKAHEAD) {\n\t\t\t\tflush_block_only(false);\n\t\t\t\tif (strm.avail_out === 0)\n\t\t\t\t\treturn NeedMore;\n\t\t\t}\n\t\t}\n\n\t\tflush_block_only(flush == Z_FINISH);\n\t\tif (strm.avail_out === 0)\n\t\t\treturn (flush == Z_FINISH) ? FinishStarted : NeedMore;\n\n\t\treturn flush == Z_FINISH ? FinishDone : BlockDone;\n\t}\n\n\tfunction longest_match(cur_match) {\n\t\tvar chain_length = max_chain_length; // max hash chain length\n\t\tvar scan = strstart; // current string\n\t\tvar match; // matched string\n\t\tvar len; // length of current match\n\t\tvar best_len = prev_length; // best match length so far\n\t\tvar limit = strstart > (w_size - MIN_LOOKAHEAD) ? strstart - (w_size - MIN_LOOKAHEAD) : 0;\n\t\tvar _nice_match = nice_match;\n\n\t\t// Stop when cur_match becomes <= limit. To simplify the code,\n\t\t// we prevent matches with the string of window index 0.\n\n\t\tvar wmask = w_mask;\n\n\t\tvar strend = strstart + MAX_MATCH;\n\t\tvar scan_end1 = window[scan + best_len - 1];\n\t\tvar scan_end = window[scan + best_len];\n\n\t\t// The code is optimized for HASH_BITS >= 8 and MAX_MATCH-2 multiple of\n\t\t// 16.\n\t\t// It is easy to get rid of this optimization if necessary.\n\n\t\t// Do not waste too much time if we already have a good match:\n\t\tif (prev_length >= good_match) {\n\t\t\tchain_length >>= 2;\n\t\t}\n\n\t\t// Do not look for matches beyond the end of the input. This is\n\t\t// necessary\n\t\t// to make deflate deterministic.\n\t\tif (_nice_match > lookahead)\n\t\t\t_nice_match = lookahead;\n\n\t\tdo {\n\t\t\tmatch = cur_match;\n\n\t\t\t// Skip to next match if the match length cannot increase\n\t\t\t// or if the match length is less than 2:\n\t\t\tif (window[match + best_len] != scan_end || window[match + best_len - 1] != scan_end1 || window[match] != window[scan]\n\t\t\t\t\t|| window[++match] != window[scan + 1])\n\t\t\t\tcontinue;\n\n\t\t\t// The check at best_len-1 can be removed because it will be made\n\t\t\t// again later. (This heuristic is not always a win.)\n\t\t\t// It is not necessary to compare scan[2] and match[2] since they\n\t\t\t// are always equal when the other bytes match, given that\n\t\t\t// the hash keys are equal and that HASH_BITS >= 8.\n\t\t\tscan += 2;\n\t\t\tmatch++;\n\n\t\t\t// We check for insufficient lookahead only every 8th comparison;\n\t\t\t// the 256th check will be made at strstart+258.\n\t\t\tdo {\n\t\t\t} while (window[++scan] == window[++match] && window[++scan] == window[++match] && window[++scan] == window[++match]\n\t\t\t\t\t&& window[++scan] == window[++match] && window[++scan] == window[++match] && window[++scan] == window[++match]\n\t\t\t\t\t&& window[++scan] == window[++match] && window[++scan] == window[++match] && scan < strend);\n\n\t\t\tlen = MAX_MATCH - (strend - scan);\n\t\t\tscan = strend - MAX_MATCH;\n\n\t\t\tif (len > best_len) {\n\t\t\t\tmatch_start = cur_match;\n\t\t\t\tbest_len = len;\n\t\t\t\tif (len >= _nice_match)\n\t\t\t\t\tbreak;\n\t\t\t\tscan_end1 = window[scan + best_len - 1];\n\t\t\t\tscan_end = window[scan + best_len];\n\t\t\t}\n\n\t\t} while ((cur_match = (prev[cur_match & wmask] & 0xffff)) > limit && --chain_length !== 0);\n\n\t\tif (best_len <= lookahead)\n\t\t\treturn best_len;\n\t\treturn lookahead;\n\t}\n\n\t// Compress as much as possible from the input stream, return the current\n\t// block state.\n\t// This function does not perform lazy evaluation of matches and inserts\n\t// new strings in the dictionary only for unmatched strings or for short\n\t// matches. It is used only for the fast compression options.\n\tfunction deflate_fast(flush) {\n\t\t// short hash_head = 0; // head of the hash chain\n\t\tvar hash_head = 0; // head of the hash chain\n\t\tvar bflush; // set if current block must be flushed\n\n\t\twhile (true) {\n\t\t\t// Make sure that we always have enough lookahead, except\n\t\t\t// at the end of the input file. We need MAX_MATCH bytes\n\t\t\t// for the next match, plus MIN_MATCH bytes to insert the\n\t\t\t// string following the next match.\n\t\t\tif (lookahead < MIN_LOOKAHEAD) {\n\t\t\t\tfill_window();\n\t\t\t\tif (lookahead < MIN_LOOKAHEAD && flush == Z_NO_FLUSH) {\n\t\t\t\t\treturn NeedMore;\n\t\t\t\t}\n\t\t\t\tif (lookahead === 0)\n\t\t\t\t\tbreak; // flush the current block\n\t\t\t}\n\n\t\t\t// Insert the string window[strstart .. strstart+2] in the\n\t\t\t// dictionary, and set hash_head to the head of the hash chain:\n\t\t\tif (lookahead >= MIN_MATCH) {\n\t\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[(strstart) + (MIN_MATCH - 1)] & 0xff)) & hash_mask;\n\n\t\t\t\t// prev[strstart&w_mask]=hash_head=head[ins_h];\n\t\t\t\thash_head = (head[ins_h] & 0xffff);\n\t\t\t\tprev[strstart & w_mask] = head[ins_h];\n\t\t\t\thead[ins_h] = strstart;\n\t\t\t}\n\n\t\t\t// Find the longest match, discarding those <= prev_length.\n\t\t\t// At this point we have always match_length < MIN_MATCH\n\n\t\t\tif (hash_head !== 0 && ((strstart - hash_head) & 0xffff) <= w_size - MIN_LOOKAHEAD) {\n\t\t\t\t// To simplify the code, we prevent matches with the string\n\t\t\t\t// of window index 0 (in particular we have to avoid a match\n\t\t\t\t// of the string with itself at the start of the input file).\n\t\t\t\tif (strategy != Z_HUFFMAN_ONLY) {\n\t\t\t\t\tmatch_length = longest_match(hash_head);\n\t\t\t\t}\n\t\t\t\t// longest_match() sets match_start\n\t\t\t}\n\t\t\tif (match_length >= MIN_MATCH) {\n\t\t\t\t// check_match(strstart, match_start, match_length);\n\n\t\t\t\tbflush = _tr_tally(strstart - match_start, match_length - MIN_MATCH);\n\n\t\t\t\tlookahead -= match_length;\n\n\t\t\t\t// Insert new strings in the hash table only if the match length\n\t\t\t\t// is not too large. This saves time but degrades compression.\n\t\t\t\tif (match_length <= max_lazy_match && lookahead >= MIN_MATCH) {\n\t\t\t\t\tmatch_length--; // string at strstart already in hash table\n\t\t\t\t\tdo {\n\t\t\t\t\t\tstrstart++;\n\n\t\t\t\t\t\tins_h = ((ins_h << hash_shift) ^ (window[(strstart) + (MIN_MATCH - 1)] & 0xff)) & hash_mask;\n\t\t\t\t\t\t// prev[strstart&w_mask]=hash_head=head[ins_h];\n\t\t\t\t\t\thash_head = (head[ins_h] & 0xffff);\n\t\t\t\t\t\tprev[strstart & w_mask] = head[ins_h];\n\t\t\t\t\t\thead[ins_h] = strstart;\n\n\t\t\t\t\t\t// strstart never exceeds WSIZE-MAX_MATCH, so there are\n\t\t\t\t\t\t// always MIN_MATCH bytes ahead.\n\t\t\t\t\t} while (--match_length !== 0);\n\t\t\t\t\tstrstart++;\n\t\t\t\t} else {\n\t\t\t\t\tstrstart += match_length;\n\t\t\t\t\tmatch_length = 0;\n\t\t\t\t\tins_h = window[strstart] & 0xff;\n\n\t\t\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[strstart + 1] & 0xff)) & hash_mask;\n\t\t\t\t\t// If lookahead < MIN_MATCH, ins_h is garbage, but it does\n\t\t\t\t\t// not\n\t\t\t\t\t// matter since it will be recomputed at next deflate call.\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// No match, output a literal byte\n\n\t\t\t\tbflush = _tr_tally(0, window[strstart] & 0xff);\n\t\t\t\tlookahead--;\n\t\t\t\tstrstart++;\n\t\t\t}\n\t\t\tif (bflush) {\n\n\t\t\t\tflush_block_only(false);\n\t\t\t\tif (strm.avail_out === 0)\n\t\t\t\t\treturn NeedMore;\n\t\t\t}\n\t\t}\n\n\t\tflush_block_only(flush == Z_FINISH);\n\t\tif (strm.avail_out === 0) {\n\t\t\tif (flush == Z_FINISH)\n\t\t\t\treturn FinishStarted;\n\t\t\telse\n\t\t\t\treturn NeedMore;\n\t\t}\n\t\treturn flush == Z_FINISH ? FinishDone : BlockDone;\n\t}\n\n\t// Same as above, but achieves better compression. We use a lazy\n\t// evaluation for matches: a match is finally adopted only if there is\n\t// no better match at the next window position.\n\tfunction deflate_slow(flush) {\n\t\t// short hash_head = 0; // head of hash chain\n\t\tvar hash_head = 0; // head of hash chain\n\t\tvar bflush; // set if current block must be flushed\n\t\tvar max_insert;\n\n\t\t// Process the input block.\n\t\twhile (true) {\n\t\t\t// Make sure that we always have enough lookahead, except\n\t\t\t// at the end of the input file. We need MAX_MATCH bytes\n\t\t\t// for the next match, plus MIN_MATCH bytes to insert the\n\t\t\t// string following the next match.\n\n\t\t\tif (lookahead < MIN_LOOKAHEAD) {\n\t\t\t\tfill_window();\n\t\t\t\tif (lookahead < MIN_LOOKAHEAD && flush == Z_NO_FLUSH) {\n\t\t\t\t\treturn NeedMore;\n\t\t\t\t}\n\t\t\t\tif (lookahead === 0)\n\t\t\t\t\tbreak; // flush the current block\n\t\t\t}\n\n\t\t\t// Insert the string window[strstart .. strstart+2] in the\n\t\t\t// dictionary, and set hash_head to the head of the hash chain:\n\n\t\t\tif (lookahead >= MIN_MATCH) {\n\t\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[(strstart) + (MIN_MATCH - 1)] & 0xff)) & hash_mask;\n\t\t\t\t// prev[strstart&w_mask]=hash_head=head[ins_h];\n\t\t\t\thash_head = (head[ins_h] & 0xffff);\n\t\t\t\tprev[strstart & w_mask] = head[ins_h];\n\t\t\t\thead[ins_h] = strstart;\n\t\t\t}\n\n\t\t\t// Find the longest match, discarding those <= prev_length.\n\t\t\tprev_length = match_length;\n\t\t\tprev_match = match_start;\n\t\t\tmatch_length = MIN_MATCH - 1;\n\n\t\t\tif (hash_head !== 0 && prev_length < max_lazy_match && ((strstart - hash_head) & 0xffff) <= w_size - MIN_LOOKAHEAD) {\n\t\t\t\t// To simplify the code, we prevent matches with the string\n\t\t\t\t// of window index 0 (in particular we have to avoid a match\n\t\t\t\t// of the string with itself at the start of the input file).\n\n\t\t\t\tif (strategy != Z_HUFFMAN_ONLY) {\n\t\t\t\t\tmatch_length = longest_match(hash_head);\n\t\t\t\t}\n\t\t\t\t// longest_match() sets match_start\n\n\t\t\t\tif (match_length <= 5 && (strategy == Z_FILTERED || (match_length == MIN_MATCH && strstart - match_start > 4096))) {\n\n\t\t\t\t\t// If prev_match is also MIN_MATCH, match_start is garbage\n\t\t\t\t\t// but we will ignore the current match anyway.\n\t\t\t\t\tmatch_length = MIN_MATCH - 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If there was a match at the previous step and the current\n\t\t\t// match is not better, output the previous match:\n\t\t\tif (prev_length >= MIN_MATCH && match_length <= prev_length) {\n\t\t\t\tmax_insert = strstart + lookahead - MIN_MATCH;\n\t\t\t\t// Do not insert strings in hash table beyond this.\n\n\t\t\t\t// check_match(strstart-1, prev_match, prev_length);\n\n\t\t\t\tbflush = _tr_tally(strstart - 1 - prev_match, prev_length - MIN_MATCH);\n\n\t\t\t\t// Insert in hash table all strings up to the end of the match.\n\t\t\t\t// strstart-1 and strstart are already inserted. If there is not\n\t\t\t\t// enough lookahead, the last two strings are not inserted in\n\t\t\t\t// the hash table.\n\t\t\t\tlookahead -= prev_length - 1;\n\t\t\t\tprev_length -= 2;\n\t\t\t\tdo {\n\t\t\t\t\tif (++strstart <= max_insert) {\n\t\t\t\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[(strstart) + (MIN_MATCH - 1)] & 0xff)) & hash_mask;\n\t\t\t\t\t\t// prev[strstart&w_mask]=hash_head=head[ins_h];\n\t\t\t\t\t\thash_head = (head[ins_h] & 0xffff);\n\t\t\t\t\t\tprev[strstart & w_mask] = head[ins_h];\n\t\t\t\t\t\thead[ins_h] = strstart;\n\t\t\t\t\t}\n\t\t\t\t} while (--prev_length !== 0);\n\t\t\t\tmatch_available = 0;\n\t\t\t\tmatch_length = MIN_MATCH - 1;\n\t\t\t\tstrstart++;\n\n\t\t\t\tif (bflush) {\n\t\t\t\t\tflush_block_only(false);\n\t\t\t\t\tif (strm.avail_out === 0)\n\t\t\t\t\t\treturn NeedMore;\n\t\t\t\t}\n\t\t\t} else if (match_available !== 0) {\n\n\t\t\t\t// If there was no match at the previous position, output a\n\t\t\t\t// single literal. If there was a match but the current match\n\t\t\t\t// is longer, truncate the previous match to a single literal.\n\n\t\t\t\tbflush = _tr_tally(0, window[strstart - 1] & 0xff);\n\n\t\t\t\tif (bflush) {\n\t\t\t\t\tflush_block_only(false);\n\t\t\t\t}\n\t\t\t\tstrstart++;\n\t\t\t\tlookahead--;\n\t\t\t\tif (strm.avail_out === 0)\n\t\t\t\t\treturn NeedMore;\n\t\t\t} else {\n\t\t\t\t// There is no previous match to compare with, wait for\n\t\t\t\t// the next step to decide.\n\n\t\t\t\tmatch_available = 1;\n\t\t\t\tstrstart++;\n\t\t\t\tlookahead--;\n\t\t\t}\n\t\t}\n\n\t\tif (match_available !== 0) {\n\t\t\tbflush = _tr_tally(0, window[strstart - 1] & 0xff);\n\t\t\tmatch_available = 0;\n\t\t}\n\t\tflush_block_only(flush == Z_FINISH);\n\n\t\tif (strm.avail_out === 0) {\n\t\t\tif (flush == Z_FINISH)\n\t\t\t\treturn FinishStarted;\n\t\t\telse\n\t\t\t\treturn NeedMore;\n\t\t}\n\n\t\treturn flush == Z_FINISH ? FinishDone : BlockDone;\n\t}\n\n\tfunction deflateReset(strm) {\n\t\tstrm.total_in = strm.total_out = 0;\n\t\tstrm.msg = null; //\n\n\t\tthat.pending = 0;\n\t\tthat.pending_out = 0;\n\n\t\tstatus = BUSY_STATE;\n\n\t\tlast_flush = Z_NO_FLUSH;\n\n\t\ttr_init();\n\t\tlm_init();\n\t\treturn Z_OK;\n\t}\n\n\tthat.deflateInit = function(strm, _level, bits, _method, memLevel, _strategy) {\n\t\tif (!_method)\n\t\t\t_method = Z_DEFLATED;\n\t\tif (!memLevel)\n\t\t\tmemLevel = DEF_MEM_LEVEL;\n\t\tif (!_strategy)\n\t\t\t_strategy = Z_DEFAULT_STRATEGY;\n\n\t\t// byte[] my_version=ZLIB_VERSION;\n\n\t\t//\n\t\t// if (!version || version[0] != my_version[0]\n\t\t// || stream_size != sizeof(z_stream)) {\n\t\t// return Z_VERSION_ERROR;\n\t\t// }\n\n\t\tstrm.msg = null;\n\n\t\tif (_level == Z_DEFAULT_COMPRESSION)\n\t\t\t_level = 6;\n\n\t\tif (memLevel < 1 || memLevel > MAX_MEM_LEVEL || _method != Z_DEFLATED || bits < 9 || bits > 15 || _level < 0 || _level > 9 || _strategy < 0\n\t\t\t\t|| _strategy > Z_HUFFMAN_ONLY) {\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\n\t\tstrm.dstate = that;\n\n\t\tw_bits = bits;\n\t\tw_size = 1 << w_bits;\n\t\tw_mask = w_size - 1;\n\n\t\thash_bits = memLevel + 7;\n\t\thash_size = 1 << hash_bits;\n\t\thash_mask = hash_size - 1;\n\t\thash_shift = Math.floor((hash_bits + MIN_MATCH - 1) / MIN_MATCH);\n\n\t\twindow = new Uint8Array(w_size * 2);\n\t\tprev = [];\n\t\thead = [];\n\n\t\tlit_bufsize = 1 << (memLevel + 6); // 16K elements by default\n\n\t\t// We overlay pending_buf and d_buf+l_buf. This works since the average\n\t\t// output size for (length,distance) codes is <= 24 bits.\n\t\tthat.pending_buf = new Uint8Array(lit_bufsize * 4);\n\t\tpending_buf_size = lit_bufsize * 4;\n\n\t\td_buf = Math.floor(lit_bufsize / 2);\n\t\tl_buf = (1 + 2) * lit_bufsize;\n\n\t\tlevel = _level;\n\n\t\tstrategy = _strategy;\n\t\tmethod = _method & 0xff;\n\n\t\treturn deflateReset(strm);\n\t};\n\n\tthat.deflateEnd = function() {\n\t\tif (status != INIT_STATE && status != BUSY_STATE && status != FINISH_STATE) {\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\t\t// Deallocate in reverse order of allocations:\n\t\tthat.pending_buf = null;\n\t\thead = null;\n\t\tprev = null;\n\t\twindow = null;\n\t\t// free\n\t\tthat.dstate = null;\n\t\treturn status == BUSY_STATE ? Z_DATA_ERROR : Z_OK;\n\t};\n\n\tthat.deflateParams = function(strm, _level, _strategy) {\n\t\tvar err = Z_OK;\n\n\t\tif (_level == Z_DEFAULT_COMPRESSION) {\n\t\t\t_level = 6;\n\t\t}\n\t\tif (_level < 0 || _level > 9 || _strategy < 0 || _strategy > Z_HUFFMAN_ONLY) {\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\n\t\tif (config_table[level].func != config_table[_level].func && strm.total_in !== 0) {\n\t\t\t// Flush the last buffer:\n\t\t\terr = strm.deflate(Z_PARTIAL_FLUSH);\n\t\t}\n\n\t\tif (level != _level) {\n\t\t\tlevel = _level;\n\t\t\tmax_lazy_match = config_table[level].max_lazy;\n\t\t\tgood_match = config_table[level].good_length;\n\t\t\tnice_match = config_table[level].nice_length;\n\t\t\tmax_chain_length = config_table[level].max_chain;\n\t\t}\n\t\tstrategy = _strategy;\n\t\treturn err;\n\t};\n\n\tthat.deflateSetDictionary = function(strm, dictionary, dictLength) {\n\t\tvar length = dictLength;\n\t\tvar n, index = 0;\n\n\t\tif (!dictionary || status != INIT_STATE)\n\t\t\treturn Z_STREAM_ERROR;\n\n\t\tif (length < MIN_MATCH)\n\t\t\treturn Z_OK;\n\t\tif (length > w_size - MIN_LOOKAHEAD) {\n\t\t\tlength = w_size - MIN_LOOKAHEAD;\n\t\t\tindex = dictLength - length; // use the tail of the dictionary\n\t\t}\n\t\twindow.set(dictionary.subarray(index, index + length), 0);\n\n\t\tstrstart = length;\n\t\tblock_start = length;\n\n\t\t// Insert all strings in the hash table (except for the last two bytes).\n\t\t// s->lookahead stays null, so s->ins_h will be recomputed at the next\n\t\t// call of fill_window.\n\n\t\tins_h = window[0] & 0xff;\n\t\tins_h = (((ins_h) << hash_shift) ^ (window[1] & 0xff)) & hash_mask;\n\n\t\tfor (n = 0; n <= length - MIN_MATCH; n++) {\n\t\t\tins_h = (((ins_h) << hash_shift) ^ (window[(n) + (MIN_MATCH - 1)] & 0xff)) & hash_mask;\n\t\t\tprev[n & w_mask] = head[ins_h];\n\t\t\thead[ins_h] = n;\n\t\t}\n\t\treturn Z_OK;\n\t};\n\n\tthat.deflate = function(_strm, flush) {\n\t\tvar i, header, level_flags, old_flush, bstate;\n\n\t\tif (flush > Z_FINISH || flush < 0) {\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\n\t\tif (!_strm.next_out || (!_strm.next_in && _strm.avail_in !== 0) || (status == FINISH_STATE && flush != Z_FINISH)) {\n\t\t\t_strm.msg = z_errmsg[Z_NEED_DICT - (Z_STREAM_ERROR)];\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\t\tif (_strm.avail_out === 0) {\n\t\t\t_strm.msg = z_errmsg[Z_NEED_DICT - (Z_BUF_ERROR)];\n\t\t\treturn Z_BUF_ERROR;\n\t\t}\n\n\t\tstrm = _strm; // just in case\n\t\told_flush = last_flush;\n\t\tlast_flush = flush;\n\n\t\t// Write the zlib header\n\t\tif (status == INIT_STATE) {\n\t\t\theader = (Z_DEFLATED + ((w_bits - 8) << 4)) << 8;\n\t\t\tlevel_flags = ((level - 1) & 0xff) >> 1;\n\n\t\t\tif (level_flags > 3)\n\t\t\t\tlevel_flags = 3;\n\t\t\theader |= (level_flags << 6);\n\t\t\tif (strstart !== 0)\n\t\t\t\theader |= PRESET_DICT;\n\t\t\theader += 31 - (header % 31);\n\n\t\t\tstatus = BUSY_STATE;\n\t\t\tputShortMSB(header);\n\t\t}\n\n\t\t// Flush as much pending output as possible\n\t\tif (that.pending !== 0) {\n\t\t\tstrm.flush_pending();\n\t\t\tif (strm.avail_out === 0) {\n\t\t\t\t// console.log(\" avail_out==0\");\n\t\t\t\t// Since avail_out is 0, deflate will be called again with\n\t\t\t\t// more output space, but possibly with both pending and\n\t\t\t\t// avail_in equal to zero. There won't be anything to do,\n\t\t\t\t// but this is not an error situation so make sure we\n\t\t\t\t// return OK instead of BUF_ERROR at next call of deflate:\n\t\t\t\tlast_flush = -1;\n\t\t\t\treturn Z_OK;\n\t\t\t}\n\n\t\t\t// Make sure there is something to do and avoid duplicate\n\t\t\t// consecutive\n\t\t\t// flushes. For repeated and useless calls with Z_FINISH, we keep\n\t\t\t// returning Z_STREAM_END instead of Z_BUFF_ERROR.\n\t\t} else if (strm.avail_in === 0 && flush <= old_flush && flush != Z_FINISH) {\n\t\t\tstrm.msg = z_errmsg[Z_NEED_DICT - (Z_BUF_ERROR)];\n\t\t\treturn Z_BUF_ERROR;\n\t\t}\n\n\t\t// User must not provide more input after the first FINISH:\n\t\tif (status == FINISH_STATE && strm.avail_in !== 0) {\n\t\t\t_strm.msg = z_errmsg[Z_NEED_DICT - (Z_BUF_ERROR)];\n\t\t\treturn Z_BUF_ERROR;\n\t\t}\n\n\t\t// Start a new block or continue the current one.\n\t\tif (strm.avail_in !== 0 || lookahead !== 0 || (flush != Z_NO_FLUSH && status != FINISH_STATE)) {\n\t\t\tbstate = -1;\n\t\t\tswitch (config_table[level].func) {\n\t\t\tcase STORED:\n\t\t\t\tbstate = deflate_stored(flush);\n\t\t\t\tbreak;\n\t\t\tcase FAST:\n\t\t\t\tbstate = deflate_fast(flush);\n\t\t\t\tbreak;\n\t\t\tcase SLOW:\n\t\t\t\tbstate = deflate_slow(flush);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t}\n\n\t\t\tif (bstate == FinishStarted || bstate == FinishDone) {\n\t\t\t\tstatus = FINISH_STATE;\n\t\t\t}\n\t\t\tif (bstate == NeedMore || bstate == FinishStarted) {\n\t\t\t\tif (strm.avail_out === 0) {\n\t\t\t\t\tlast_flush = -1; // avoid BUF_ERROR next call, see above\n\t\t\t\t}\n\t\t\t\treturn Z_OK;\n\t\t\t\t// If flush != Z_NO_FLUSH && avail_out === 0, the next call\n\t\t\t\t// of deflate should use the same flush parameter to make sure\n\t\t\t\t// that the flush is complete. So we don't have to output an\n\t\t\t\t// empty block here, this will be done at next call. This also\n\t\t\t\t// ensures that for a very small output buffer, we emit at most\n\t\t\t\t// one empty block.\n\t\t\t}\n\n\t\t\tif (bstate == BlockDone) {\n\t\t\t\tif (flush == Z_PARTIAL_FLUSH) {\n\t\t\t\t\t_tr_align();\n\t\t\t\t} else { // FULL_FLUSH or SYNC_FLUSH\n\t\t\t\t\t_tr_stored_block(0, 0, false);\n\t\t\t\t\t// For a full flush, this empty block will be recognized\n\t\t\t\t\t// as a special marker by inflate_sync().\n\t\t\t\t\tif (flush == Z_FULL_FLUSH) {\n\t\t\t\t\t\t// state.head[s.hash_size-1]=0;\n\t\t\t\t\t\tfor (i = 0; i < hash_size/*-1*/; i++)\n\t\t\t\t\t\t\t// forget history\n\t\t\t\t\t\t\thead[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstrm.flush_pending();\n\t\t\t\tif (strm.avail_out === 0) {\n\t\t\t\t\tlast_flush = -1; // avoid BUF_ERROR at next call, see above\n\t\t\t\t\treturn Z_OK;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (flush != Z_FINISH)\n\t\t\treturn Z_OK;\n\t\treturn Z_STREAM_END;\n\t};\n}\n\n// ZStream\n\nfunction ZStream() {\n\tvar that = this;\n\tthat.next_in_index = 0;\n\tthat.next_out_index = 0;\n\t// that.next_in; // next input byte\n\tthat.avail_in = 0; // number of bytes available at next_in\n\tthat.total_in = 0; // total nb of input bytes read so far\n\t// that.next_out; // next output byte should be put there\n\tthat.avail_out = 0; // remaining free space at next_out\n\tthat.total_out = 0; // total nb of bytes output so far\n\t// that.msg;\n\t// that.dstate;\n}\n\nZStream.prototype = {\n\tdeflateInit : function(level, bits) {\n\t\tvar that = this;\n\t\tthat.dstate = new Deflate();\n\t\tif (!bits)\n\t\t\tbits = MAX_BITS;\n\t\treturn that.dstate.deflateInit(that, level, bits);\n\t},\n\n\tdeflate : function(flush) {\n\t\tvar that = this;\n\t\tif (!that.dstate) {\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\t\treturn that.dstate.deflate(that, flush);\n\t},\n\n\tdeflateEnd : function() {\n\t\tvar that = this;\n\t\tif (!that.dstate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\tvar ret = that.dstate.deflateEnd();\n\t\tthat.dstate = null;\n\t\treturn ret;\n\t},\n\n\tdeflateParams : function(level, strategy) {\n\t\tvar that = this;\n\t\tif (!that.dstate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn that.dstate.deflateParams(that, level, strategy);\n\t},\n\n\tdeflateSetDictionary : function(dictionary, dictLength) {\n\t\tvar that = this;\n\t\tif (!that.dstate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn that.dstate.deflateSetDictionary(that, dictionary, dictLength);\n\t},\n\n\t// Read a new buffer from the current input stream, update the\n\t// total number of bytes read. All deflate() input goes through\n\t// this function so some applications may wish to modify it to avoid\n\t// allocating a large strm->next_in buffer and copying from it.\n\t// (See also flush_pending()).\n\tread_buf : function(buf, start, size) {\n\t\tvar that = this;\n\t\tvar len = that.avail_in;\n\t\tif (len > size)\n\t\t\tlen = size;\n\t\tif (len === 0)\n\t\t\treturn 0;\n\t\tthat.avail_in -= len;\n\t\tbuf.set(that.next_in.subarray(that.next_in_index, that.next_in_index + len), start);\n\t\tthat.next_in_index += len;\n\t\tthat.total_in += len;\n\t\treturn len;\n\t},\n\n\t// Flush as much pending output as possible. All deflate() output goes\n\t// through this function so some applications may wish to modify it\n\t// to avoid allocating a large strm->next_out buffer and copying into it.\n\t// (See also read_buf()).\n\tflush_pending : function() {\n\t\tvar that = this;\n\t\tvar len = that.dstate.pending;\n\n\t\tif (len > that.avail_out)\n\t\t\tlen = that.avail_out;\n\t\tif (len === 0)\n\t\t\treturn;\n\n\t\t// if (that.dstate.pending_buf.length <= that.dstate.pending_out || that.next_out.length <= that.next_out_index\n\t\t// || that.dstate.pending_buf.length < (that.dstate.pending_out + len) || that.next_out.length < (that.next_out_index +\n\t\t// len)) {\n\t\t// console.log(that.dstate.pending_buf.length + \", \" + that.dstate.pending_out + \", \" + that.next_out.length + \", \" +\n\t\t// that.next_out_index + \", \" + len);\n\t\t// console.log(\"avail_out=\" + that.avail_out);\n\t\t// }\n\n\t\tthat.next_out.set(that.dstate.pending_buf.subarray(that.dstate.pending_out, that.dstate.pending_out + len), that.next_out_index);\n\n\t\tthat.next_out_index += len;\n\t\tthat.dstate.pending_out += len;\n\t\tthat.total_out += len;\n\t\tthat.avail_out -= len;\n\t\tthat.dstate.pending -= len;\n\t\tif (that.dstate.pending === 0) {\n\t\t\tthat.dstate.pending_out = 0;\n\t\t}\n\t}\n};\n\n// Deflater\n\nexport function Deflater(options) {\n\tvar that = this;\n\tvar z = new ZStream();\n\tvar bufsize = 512;\n\tvar flush = Z_NO_FLUSH;\n\tvar buf = new Uint8Array(bufsize);\n\tvar level = options ? options.level : Z_DEFAULT_COMPRESSION;\n\tif (typeof level == \"undefined\")\n\t\tlevel = Z_DEFAULT_COMPRESSION;\n\tz.deflateInit(level);\n\tz.next_out = buf;\n\n\tthat.append = function(data, onprogress) {\n\t\tvar err, buffers = [], lastIndex = 0, bufferIndex = 0, bufferSize = 0, array;\n\t\tif (!data.length)\n\t\t\treturn;\n\t\tz.next_in_index = 0;\n\t\tz.next_in = data;\n\t\tz.avail_in = data.length;\n\t\tdo {\n\t\t\tz.next_out_index = 0;\n\t\t\tz.avail_out = bufsize;\n\t\t\terr = z.deflate(flush);\n\t\t\tif (err != Z_OK)\n\t\t\t\tthrow new Error(\"deflating: \" + z.msg);\n\t\t\tif (z.next_out_index)\n\t\t\t\tif (z.next_out_index == bufsize)\n\t\t\t\t\tbuffers.push(new Uint8Array(buf));\n\t\t\t\telse\n\t\t\t\t\tbuffers.push(new Uint8Array(buf.subarray(0, z.next_out_index)));\n\t\t\tbufferSize += z.next_out_index;\n\t\t\tif (onprogress && z.next_in_index > 0 && z.next_in_index != lastIndex) {\n\t\t\t\tonprogress(z.next_in_index);\n\t\t\t\tlastIndex = z.next_in_index;\n\t\t\t}\n\t\t} while (z.avail_in > 0 || z.avail_out === 0);\n\t\tarray = new Uint8Array(bufferSize);\n\t\tbuffers.forEach(function(chunk) {\n\t\t\tarray.set(chunk, bufferIndex);\n\t\t\tbufferIndex += chunk.length;\n\t\t});\n\t\treturn array;\n\t};\n\tthat.flush = function() {\n\t\tvar err, buffers = [], bufferIndex = 0, bufferSize = 0, array;\n\t\tdo {\n\t\t\tz.next_out_index = 0;\n\t\t\tz.avail_out = bufsize;\n\t\t\terr = z.deflate(Z_FINISH);\n\t\t\tif (err != Z_STREAM_END && err != Z_OK)\n\t\t\t\tthrow new Error(\"deflating: \" + z.msg);\n\t\t\tif (bufsize - z.avail_out > 0)\n\t\t\t\tbuffers.push(new Uint8Array(buf.subarray(0, z.next_out_index)));\n\t\t\tbufferSize += z.next_out_index;\n\t\t} while (z.avail_in > 0 || z.avail_out === 0);\n\t\tz.deflateEnd();\n\t\tarray = new Uint8Array(bufferSize);\n\t\tbuffers.forEach(function(chunk) {\n\t\t\tarray.set(chunk, bufferIndex);\n\t\t\tbufferIndex += chunk.length;\n\t\t});\n\t\treturn array;\n\t};\n}\n\n// 'zip' may not be defined in z-worker and some tests\nself._zipjs_Deflater = Deflater;\n","/*\nCopyright (c) 2013 Gildas Lormeau. All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice,\nthis list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright\nnotice, this list of conditions and the following disclaimer in\nthe documentation and/or other materials provided with the distribution.\n\n3. The names of the authors may not be used to endorse or promote products\nderived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\nINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\nFITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\nINC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\nOR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\nLIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\nNEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\nEVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n* This program is based on JZlib 1.0.2 ymnk, JCraft,Inc.\n* JZlib is based on zlib-1.1.3, so all credit should go authors\n* Jean-loup Gailly(jloup@gzip.org) and Mark Adler(madler@alumni.caltech.edu)\n* and contributors of zlib.\n*/\n\n// Global\nvar MAX_BITS = 15;\n\nvar Z_OK = 0;\nvar Z_STREAM_END = 1;\nvar Z_NEED_DICT = 2;\nvar Z_STREAM_ERROR = -2;\nvar Z_DATA_ERROR = -3;\nvar Z_MEM_ERROR = -4;\nvar Z_BUF_ERROR = -5;\n\nvar inflate_mask = [ 0x00000000, 0x00000001, 0x00000003, 0x00000007, 0x0000000f, 0x0000001f, 0x0000003f, 0x0000007f, 0x000000ff, 0x000001ff, 0x000003ff,\n\t\t0x000007ff, 0x00000fff, 0x00001fff, 0x00003fff, 0x00007fff, 0x0000ffff ];\n\nvar MANY = 1440;\n\n// JZlib version : \"1.0.2\"\nvar Z_NO_FLUSH = 0;\nvar Z_FINISH = 4;\n\n// InfTree\nvar fixed_bl = 9;\nvar fixed_bd = 5;\n\nvar fixed_tl = [ 96, 7, 256, 0, 8, 80, 0, 8, 16, 84, 8, 115, 82, 7, 31, 0, 8, 112, 0, 8, 48, 0, 9, 192, 80, 7, 10, 0, 8, 96, 0, 8, 32, 0, 9, 160, 0, 8, 0,\n\t\t0, 8, 128, 0, 8, 64, 0, 9, 224, 80, 7, 6, 0, 8, 88, 0, 8, 24, 0, 9, 144, 83, 7, 59, 0, 8, 120, 0, 8, 56, 0, 9, 208, 81, 7, 17, 0, 8, 104, 0, 8, 40,\n\t\t0, 9, 176, 0, 8, 8, 0, 8, 136, 0, 8, 72, 0, 9, 240, 80, 7, 4, 0, 8, 84, 0, 8, 20, 85, 8, 227, 83, 7, 43, 0, 8, 116, 0, 8, 52, 0, 9, 200, 81, 7, 13,\n\t\t0, 8, 100, 0, 8, 36, 0, 9, 168, 0, 8, 4, 0, 8, 132, 0, 8, 68, 0, 9, 232, 80, 7, 8, 0, 8, 92, 0, 8, 28, 0, 9, 152, 84, 7, 83, 0, 8, 124, 0, 8, 60,\n\t\t0, 9, 216, 82, 7, 23, 0, 8, 108, 0, 8, 44, 0, 9, 184, 0, 8, 12, 0, 8, 140, 0, 8, 76, 0, 9, 248, 80, 7, 3, 0, 8, 82, 0, 8, 18, 85, 8, 163, 83, 7,\n\t\t35, 0, 8, 114, 0, 8, 50, 0, 9, 196, 81, 7, 11, 0, 8, 98, 0, 8, 34, 0, 9, 164, 0, 8, 2, 0, 8, 130, 0, 8, 66, 0, 9, 228, 80, 7, 7, 0, 8, 90, 0, 8,\n\t\t26, 0, 9, 148, 84, 7, 67, 0, 8, 122, 0, 8, 58, 0, 9, 212, 82, 7, 19, 0, 8, 106, 0, 8, 42, 0, 9, 180, 0, 8, 10, 0, 8, 138, 0, 8, 74, 0, 9, 244, 80,\n\t\t7, 5, 0, 8, 86, 0, 8, 22, 192, 8, 0, 83, 7, 51, 0, 8, 118, 0, 8, 54, 0, 9, 204, 81, 7, 15, 0, 8, 102, 0, 8, 38, 0, 9, 172, 0, 8, 6, 0, 8, 134, 0,\n\t\t8, 70, 0, 9, 236, 80, 7, 9, 0, 8, 94, 0, 8, 30, 0, 9, 156, 84, 7, 99, 0, 8, 126, 0, 8, 62, 0, 9, 220, 82, 7, 27, 0, 8, 110, 0, 8, 46, 0, 9, 188, 0,\n\t\t8, 14, 0, 8, 142, 0, 8, 78, 0, 9, 252, 96, 7, 256, 0, 8, 81, 0, 8, 17, 85, 8, 131, 82, 7, 31, 0, 8, 113, 0, 8, 49, 0, 9, 194, 80, 7, 10, 0, 8, 97,\n\t\t0, 8, 33, 0, 9, 162, 0, 8, 1, 0, 8, 129, 0, 8, 65, 0, 9, 226, 80, 7, 6, 0, 8, 89, 0, 8, 25, 0, 9, 146, 83, 7, 59, 0, 8, 121, 0, 8, 57, 0, 9, 210,\n\t\t81, 7, 17, 0, 8, 105, 0, 8, 41, 0, 9, 178, 0, 8, 9, 0, 8, 137, 0, 8, 73, 0, 9, 242, 80, 7, 4, 0, 8, 85, 0, 8, 21, 80, 8, 258, 83, 7, 43, 0, 8, 117,\n\t\t0, 8, 53, 0, 9, 202, 81, 7, 13, 0, 8, 101, 0, 8, 37, 0, 9, 170, 0, 8, 5, 0, 8, 133, 0, 8, 69, 0, 9, 234, 80, 7, 8, 0, 8, 93, 0, 8, 29, 0, 9, 154,\n\t\t84, 7, 83, 0, 8, 125, 0, 8, 61, 0, 9, 218, 82, 7, 23, 0, 8, 109, 0, 8, 45, 0, 9, 186, 0, 8, 13, 0, 8, 141, 0, 8, 77, 0, 9, 250, 80, 7, 3, 0, 8, 83,\n\t\t0, 8, 19, 85, 8, 195, 83, 7, 35, 0, 8, 115, 0, 8, 51, 0, 9, 198, 81, 7, 11, 0, 8, 99, 0, 8, 35, 0, 9, 166, 0, 8, 3, 0, 8, 131, 0, 8, 67, 0, 9, 230,\n\t\t80, 7, 7, 0, 8, 91, 0, 8, 27, 0, 9, 150, 84, 7, 67, 0, 8, 123, 0, 8, 59, 0, 9, 214, 82, 7, 19, 0, 8, 107, 0, 8, 43, 0, 9, 182, 0, 8, 11, 0, 8, 139,\n\t\t0, 8, 75, 0, 9, 246, 80, 7, 5, 0, 8, 87, 0, 8, 23, 192, 8, 0, 83, 7, 51, 0, 8, 119, 0, 8, 55, 0, 9, 206, 81, 7, 15, 0, 8, 103, 0, 8, 39, 0, 9, 174,\n\t\t0, 8, 7, 0, 8, 135, 0, 8, 71, 0, 9, 238, 80, 7, 9, 0, 8, 95, 0, 8, 31, 0, 9, 158, 84, 7, 99, 0, 8, 127, 0, 8, 63, 0, 9, 222, 82, 7, 27, 0, 8, 111,\n\t\t0, 8, 47, 0, 9, 190, 0, 8, 15, 0, 8, 143, 0, 8, 79, 0, 9, 254, 96, 7, 256, 0, 8, 80, 0, 8, 16, 84, 8, 115, 82, 7, 31, 0, 8, 112, 0, 8, 48, 0, 9,\n\t\t193, 80, 7, 10, 0, 8, 96, 0, 8, 32, 0, 9, 161, 0, 8, 0, 0, 8, 128, 0, 8, 64, 0, 9, 225, 80, 7, 6, 0, 8, 88, 0, 8, 24, 0, 9, 145, 83, 7, 59, 0, 8,\n\t\t120, 0, 8, 56, 0, 9, 209, 81, 7, 17, 0, 8, 104, 0, 8, 40, 0, 9, 177, 0, 8, 8, 0, 8, 136, 0, 8, 72, 0, 9, 241, 80, 7, 4, 0, 8, 84, 0, 8, 20, 85, 8,\n\t\t227, 83, 7, 43, 0, 8, 116, 0, 8, 52, 0, 9, 201, 81, 7, 13, 0, 8, 100, 0, 8, 36, 0, 9, 169, 0, 8, 4, 0, 8, 132, 0, 8, 68, 0, 9, 233, 80, 7, 8, 0, 8,\n\t\t92, 0, 8, 28, 0, 9, 153, 84, 7, 83, 0, 8, 124, 0, 8, 60, 0, 9, 217, 82, 7, 23, 0, 8, 108, 0, 8, 44, 0, 9, 185, 0, 8, 12, 0, 8, 140, 0, 8, 76, 0, 9,\n\t\t249, 80, 7, 3, 0, 8, 82, 0, 8, 18, 85, 8, 163, 83, 7, 35, 0, 8, 114, 0, 8, 50, 0, 9, 197, 81, 7, 11, 0, 8, 98, 0, 8, 34, 0, 9, 165, 0, 8, 2, 0, 8,\n\t\t130, 0, 8, 66, 0, 9, 229, 80, 7, 7, 0, 8, 90, 0, 8, 26, 0, 9, 149, 84, 7, 67, 0, 8, 122, 0, 8, 58, 0, 9, 213, 82, 7, 19, 0, 8, 106, 0, 8, 42, 0, 9,\n\t\t181, 0, 8, 10, 0, 8, 138, 0, 8, 74, 0, 9, 245, 80, 7, 5, 0, 8, 86, 0, 8, 22, 192, 8, 0, 83, 7, 51, 0, 8, 118, 0, 8, 54, 0, 9, 205, 81, 7, 15, 0, 8,\n\t\t102, 0, 8, 38, 0, 9, 173, 0, 8, 6, 0, 8, 134, 0, 8, 70, 0, 9, 237, 80, 7, 9, 0, 8, 94, 0, 8, 30, 0, 9, 157, 84, 7, 99, 0, 8, 126, 0, 8, 62, 0, 9,\n\t\t221, 82, 7, 27, 0, 8, 110, 0, 8, 46, 0, 9, 189, 0, 8, 14, 0, 8, 142, 0, 8, 78, 0, 9, 253, 96, 7, 256, 0, 8, 81, 0, 8, 17, 85, 8, 131, 82, 7, 31, 0,\n\t\t8, 113, 0, 8, 49, 0, 9, 195, 80, 7, 10, 0, 8, 97, 0, 8, 33, 0, 9, 163, 0, 8, 1, 0, 8, 129, 0, 8, 65, 0, 9, 227, 80, 7, 6, 0, 8, 89, 0, 8, 25, 0, 9,\n\t\t147, 83, 7, 59, 0, 8, 121, 0, 8, 57, 0, 9, 211, 81, 7, 17, 0, 8, 105, 0, 8, 41, 0, 9, 179, 0, 8, 9, 0, 8, 137, 0, 8, 73, 0, 9, 243, 80, 7, 4, 0, 8,\n\t\t85, 0, 8, 21, 80, 8, 258, 83, 7, 43, 0, 8, 117, 0, 8, 53, 0, 9, 203, 81, 7, 13, 0, 8, 101, 0, 8, 37, 0, 9, 171, 0, 8, 5, 0, 8, 133, 0, 8, 69, 0, 9,\n\t\t235, 80, 7, 8, 0, 8, 93, 0, 8, 29, 0, 9, 155, 84, 7, 83, 0, 8, 125, 0, 8, 61, 0, 9, 219, 82, 7, 23, 0, 8, 109, 0, 8, 45, 0, 9, 187, 0, 8, 13, 0, 8,\n\t\t141, 0, 8, 77, 0, 9, 251, 80, 7, 3, 0, 8, 83, 0, 8, 19, 85, 8, 195, 83, 7, 35, 0, 8, 115, 0, 8, 51, 0, 9, 199, 81, 7, 11, 0, 8, 99, 0, 8, 35, 0, 9,\n\t\t167, 0, 8, 3, 0, 8, 131, 0, 8, 67, 0, 9, 231, 80, 7, 7, 0, 8, 91, 0, 8, 27, 0, 9, 151, 84, 7, 67, 0, 8, 123, 0, 8, 59, 0, 9, 215, 82, 7, 19, 0, 8,\n\t\t107, 0, 8, 43, 0, 9, 183, 0, 8, 11, 0, 8, 139, 0, 8, 75, 0, 9, 247, 80, 7, 5, 0, 8, 87, 0, 8, 23, 192, 8, 0, 83, 7, 51, 0, 8, 119, 0, 8, 55, 0, 9,\n\t\t207, 81, 7, 15, 0, 8, 103, 0, 8, 39, 0, 9, 175, 0, 8, 7, 0, 8, 135, 0, 8, 71, 0, 9, 239, 80, 7, 9, 0, 8, 95, 0, 8, 31, 0, 9, 159, 84, 7, 99, 0, 8,\n\t\t127, 0, 8, 63, 0, 9, 223, 82, 7, 27, 0, 8, 111, 0, 8, 47, 0, 9, 191, 0, 8, 15, 0, 8, 143, 0, 8, 79, 0, 9, 255 ];\nvar fixed_td = [ 80, 5, 1, 87, 5, 257, 83, 5, 17, 91, 5, 4097, 81, 5, 5, 89, 5, 1025, 85, 5, 65, 93, 5, 16385, 80, 5, 3, 88, 5, 513, 84, 5, 33, 92, 5,\n\t\t8193, 82, 5, 9, 90, 5, 2049, 86, 5, 129, 192, 5, 24577, 80, 5, 2, 87, 5, 385, 83, 5, 25, 91, 5, 6145, 81, 5, 7, 89, 5, 1537, 85, 5, 97, 93, 5,\n\t\t24577, 80, 5, 4, 88, 5, 769, 84, 5, 49, 92, 5, 12289, 82, 5, 13, 90, 5, 3073, 86, 5, 193, 192, 5, 24577 ];\n\n// Tables for deflate from PKZIP's appnote.txt.\nvar cplens = [ // Copy lengths for literal codes 257..285\n3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0 ];\n\n// see note #13 above about 258\nvar cplext = [ // Extra bits for literal codes 257..285\n0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 112, 112 // 112==invalid\n];\n\nvar cpdist = [ // Copy offsets for distance codes 0..29\n1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577 ];\n\nvar cpdext = [ // Extra bits for distance codes\n0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13 ];\n\n// If BMAX needs to be larger than 16, then h and x[] should be uLong.\nvar BMAX = 15; // maximum bit length of any code\n\nfunction InfTree() {\n\tvar that = this;\n\n\tvar hn; // hufts used in space\n\tvar v; // work area for huft_build\n\tvar c; // bit length count table\n\tvar r; // table entry for structure assignment\n\tvar u; // table stack\n\tvar x; // bit offsets, then code stack\n\n\tfunction huft_build(b, // code lengths in bits (all assumed <=\n\t// BMAX)\n\tbindex, n, // number of codes (assumed <= 288)\n\ts, // number of simple-valued codes (0..s-1)\n\td, // list of base values for non-simple codes\n\te, // list of extra bits for non-simple codes\n\tt, // result: starting table\n\tm, // maximum lookup bits, returns actual\n\thp,// space for trees\n\thn,// hufts used in space\n\tv // working area: values in order of bit length\n\t) {\n\t\t// Given a list of code lengths and a maximum table size, make a set of\n\t\t// tables to decode that set of codes. Return Z_OK on success,\n\t\t// Z_BUF_ERROR\n\t\t// if the given code set is incomplete (the tables are still built in\n\t\t// this\n\t\t// case), Z_DATA_ERROR if the input is invalid (an over-subscribed set\n\t\t// of\n\t\t// lengths), or Z_MEM_ERROR if not enough memory.\n\n\t\tvar a; // counter for codes of length k\n\t\tvar f; // i repeats in table every f entries\n\t\tvar g; // maximum code length\n\t\tvar h; // table level\n\t\tvar i; // counter, current code\n\t\tvar j; // counter\n\t\tvar k; // number of bits in current code\n\t\tvar l; // bits per table (returned in m)\n\t\tvar mask; // (1 << w) - 1, to avoid cc -O bug on HP\n\t\tvar p; // pointer into c[], b[], or v[]\n\t\tvar q; // points to current table\n\t\tvar w; // bits before this table == (l * h)\n\t\tvar xp; // pointer into x\n\t\tvar y; // number of dummy codes added\n\t\tvar z; // number of entries in current table\n\n\t\t// Generate counts for each bit length\n\n\t\tp = 0;\n\t\ti = n;\n\t\tdo {\n\t\t\tc[b[bindex + p]]++;\n\t\t\tp++;\n\t\t\ti--; // assume all entries <= BMAX\n\t\t} while (i !== 0);\n\n\t\tif (c[0] == n) { // null input--all zero length codes\n\t\t\tt[0] = -1;\n\t\t\tm[0] = 0;\n\t\t\treturn Z_OK;\n\t\t}\n\n\t\t// Find minimum and maximum length, bound *m by those\n\t\tl = m[0];\n\t\tfor (j = 1; j <= BMAX; j++)\n\t\t\tif (c[j] !== 0)\n\t\t\t\tbreak;\n\t\tk = j; // minimum code length\n\t\tif (l < j) {\n\t\t\tl = j;\n\t\t}\n\t\tfor (i = BMAX; i !== 0; i--) {\n\t\t\tif (c[i] !== 0)\n\t\t\t\tbreak;\n\t\t}\n\t\tg = i; // maximum code length\n\t\tif (l > i) {\n\t\t\tl = i;\n\t\t}\n\t\tm[0] = l;\n\n\t\t// Adjust last length count to fill out codes, if needed\n\t\tfor (y = 1 << j; j < i; j++, y <<= 1) {\n\t\t\tif ((y -= c[j]) < 0) {\n\t\t\t\treturn Z_DATA_ERROR;\n\t\t\t}\n\t\t}\n\t\tif ((y -= c[i]) < 0) {\n\t\t\treturn Z_DATA_ERROR;\n\t\t}\n\t\tc[i] += y;\n\n\t\t// Generate starting offsets into the value table for each length\n\t\tx[1] = j = 0;\n\t\tp = 1;\n\t\txp = 2;\n\t\twhile (--i !== 0) { // note that i == g from above\n\t\t\tx[xp] = (j += c[p]);\n\t\t\txp++;\n\t\t\tp++;\n\t\t}\n\n\t\t// Make a table of values in order of bit lengths\n\t\ti = 0;\n\t\tp = 0;\n\t\tdo {\n\t\t\tif ((j = b[bindex + p]) !== 0) {\n\t\t\t\tv[x[j]++] = i;\n\t\t\t}\n\t\t\tp++;\n\t\t} while (++i < n);\n\t\tn = x[g]; // set n to length of v\n\n\t\t// Generate the Huffman codes and for each, make the table entries\n\t\tx[0] = i = 0; // first Huffman code is zero\n\t\tp = 0; // grab values in bit order\n\t\th = -1; // no tables yet--level -1\n\t\tw = -l; // bits decoded == (l * h)\n\t\tu[0] = 0; // just to keep compilers happy\n\t\tq = 0; // ditto\n\t\tz = 0; // ditto\n\n\t\t// go through the bit lengths (k already is bits in shortest code)\n\t\tfor (; k <= g; k++) {\n\t\t\ta = c[k];\n\t\t\twhile (a-- !== 0) {\n\t\t\t\t// here i is the Huffman code of length k bits for value *p\n\t\t\t\t// make tables up to required level\n\t\t\t\twhile (k > w + l) {\n\t\t\t\t\th++;\n\t\t\t\t\tw += l; // previous table always l bits\n\t\t\t\t\t// compute minimum size table less than or equal to l bits\n\t\t\t\t\tz = g - w;\n\t\t\t\t\tz = (z > l) ? l : z; // table size upper limit\n\t\t\t\t\tif ((f = 1 << (j = k - w)) > a + 1) { // try a k-w bit table\n\t\t\t\t\t\t// too few codes for\n\t\t\t\t\t\t// k-w bit table\n\t\t\t\t\t\tf -= a + 1; // deduct codes from patterns left\n\t\t\t\t\t\txp = k;\n\t\t\t\t\t\tif (j < z) {\n\t\t\t\t\t\t\twhile (++j < z) { // try smaller tables up to z bits\n\t\t\t\t\t\t\t\tif ((f <<= 1) <= c[++xp])\n\t\t\t\t\t\t\t\t\tbreak; // enough codes to use up j bits\n\t\t\t\t\t\t\t\tf -= c[xp]; // else deduct codes from patterns\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tz = 1 << j; // table entries for j-bit table\n\n\t\t\t\t\t// allocate new table\n\t\t\t\t\tif (hn[0] + z > MANY) { // (note: doesn't matter for fixed)\n\t\t\t\t\t\treturn Z_DATA_ERROR; // overflow of MANY\n\t\t\t\t\t}\n\t\t\t\t\tu[h] = q = /* hp+ */hn[0]; // DEBUG\n\t\t\t\t\thn[0] += z;\n\n\t\t\t\t\t// connect to last table, if there is one\n\t\t\t\t\tif (h !== 0) {\n\t\t\t\t\t\tx[h] = i; // save pattern for backing up\n\t\t\t\t\t\tr[0] = /* (byte) */j; // bits in this table\n\t\t\t\t\t\tr[1] = /* (byte) */l; // bits to dump before this table\n\t\t\t\t\t\tj = i >>> (w - l);\n\t\t\t\t\t\tr[2] = /* (int) */(q - u[h - 1] - j); // offset to this table\n\t\t\t\t\t\thp.set(r, (u[h - 1] + j) * 3);\n\t\t\t\t\t\t// to\n\t\t\t\t\t\t// last\n\t\t\t\t\t\t// table\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt[0] = q; // first table is returned result\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// set up table entry in r\n\t\t\t\tr[1] = /* (byte) */(k - w);\n\t\t\t\tif (p >= n) {\n\t\t\t\t\tr[0] = 128 + 64; // out of values--invalid code\n\t\t\t\t} else if (v[p] < s) {\n\t\t\t\t\tr[0] = /* (byte) */(v[p] < 256 ? 0 : 32 + 64); // 256 is\n\t\t\t\t\t// end-of-block\n\t\t\t\t\tr[2] = v[p++]; // simple code is just the value\n\t\t\t\t} else {\n\t\t\t\t\tr[0] = /* (byte) */(e[v[p] - s] + 16 + 64); // non-simple--look\n\t\t\t\t\t// up in lists\n\t\t\t\t\tr[2] = d[v[p++] - s];\n\t\t\t\t}\n\n\t\t\t\t// fill code-like entries with r\n\t\t\t\tf = 1 << (k - w);\n\t\t\t\tfor (j = i >>> w; j < z; j += f) {\n\t\t\t\t\thp.set(r, (q + j) * 3);\n\t\t\t\t}\n\n\t\t\t\t// backwards increment the k-bit code i\n\t\t\t\tfor (j = 1 << (k - 1); (i & j) !== 0; j >>>= 1) {\n\t\t\t\t\ti ^= j;\n\t\t\t\t}\n\t\t\t\ti ^= j;\n\n\t\t\t\t// backup over finished tables\n\t\t\t\tmask = (1 << w) - 1; // needed on HP, cc -O bug\n\t\t\t\twhile ((i & mask) != x[h]) {\n\t\t\t\t\th--; // don't need to update q\n\t\t\t\t\tw -= l;\n\t\t\t\t\tmask = (1 << w) - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Return Z_BUF_ERROR if we were given an incomplete table\n\t\treturn y !== 0 && g != 1 ? Z_BUF_ERROR : Z_OK;\n\t}\n\n\tfunction initWorkArea(vsize) {\n\t\tvar i;\n\t\tif (!hn) {\n\t\t\thn = []; // []; //new Array(1);\n\t\t\tv = []; // new Array(vsize);\n\t\t\tc = new Int32Array(BMAX + 1); // new Array(BMAX + 1);\n\t\t\tr = []; // new Array(3);\n\t\t\tu = new Int32Array(BMAX); // new Array(BMAX);\n\t\t\tx = new Int32Array(BMAX + 1); // new Array(BMAX + 1);\n\t\t}\n\t\tif (v.length < vsize) {\n\t\t\tv = []; // new Array(vsize);\n\t\t}\n\t\tfor (i = 0; i < vsize; i++) {\n\t\t\tv[i] = 0;\n\t\t}\n\t\tfor (i = 0; i < BMAX + 1; i++) {\n\t\t\tc[i] = 0;\n\t\t}\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tr[i] = 0;\n\t\t}\n\t\t// for(int i=0; i<BMAX; i++){u[i]=0;}\n\t\tu.set(c.subarray(0, BMAX), 0);\n\t\t// for(int i=0; i<BMAX+1; i++){x[i]=0;}\n\t\tx.set(c.subarray(0, BMAX + 1), 0);\n\t}\n\n\tthat.inflate_trees_bits = function(c, // 19 code lengths\n\tbb, // bits tree desired/actual depth\n\ttb, // bits tree result\n\thp, // space for trees\n\tz // for messages\n\t) {\n\t\tvar result;\n\t\tinitWorkArea(19);\n\t\thn[0] = 0;\n\t\tresult = huft_build(c, 0, 19, 19, null, null, tb, bb, hp, hn, v);\n\n\t\tif (result == Z_DATA_ERROR) {\n\t\t\tz.msg = \"oversubscribed dynamic bit lengths tree\";\n\t\t} else if (result == Z_BUF_ERROR || bb[0] === 0) {\n\t\t\tz.msg = \"incomplete dynamic bit lengths tree\";\n\t\t\tresult = Z_DATA_ERROR;\n\t\t}\n\t\treturn result;\n\t};\n\n\tthat.inflate_trees_dynamic = function(nl, // number of literal/length codes\n\tnd, // number of distance codes\n\tc, // that many (total) code lengths\n\tbl, // literal desired/actual bit depth\n\tbd, // distance desired/actual bit depth\n\ttl, // literal/length tree result\n\ttd, // distance tree result\n\thp, // space for trees\n\tz // for messages\n\t) {\n\t\tvar result;\n\n\t\t// build literal/length tree\n\t\tinitWorkArea(288);\n\t\thn[0] = 0;\n\t\tresult = huft_build(c, 0, nl, 257, cplens, cplext, tl, bl, hp, hn, v);\n\t\tif (result != Z_OK || bl[0] === 0) {\n\t\t\tif (result == Z_DATA_ERROR) {\n\t\t\t\tz.msg = \"oversubscribed literal/length tree\";\n\t\t\t} else if (result != Z_MEM_ERROR) {\n\t\t\t\tz.msg = \"incomplete literal/length tree\";\n\t\t\t\tresult = Z_DATA_ERROR;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\t// build distance tree\n\t\tinitWorkArea(288);\n\t\tresult = huft_build(c, nl, nd, 0, cpdist, cpdext, td, bd, hp, hn, v);\n\n\t\tif (result != Z_OK || (bd[0] === 0 && nl > 257)) {\n\t\t\tif (result == Z_DATA_ERROR) {\n\t\t\t\tz.msg = \"oversubscribed distance tree\";\n\t\t\t} else if (result == Z_BUF_ERROR) {\n\t\t\t\tz.msg = \"incomplete distance tree\";\n\t\t\t\tresult = Z_DATA_ERROR;\n\t\t\t} else if (result != Z_MEM_ERROR) {\n\t\t\t\tz.msg = \"empty distance tree with lengths\";\n\t\t\t\tresult = Z_DATA_ERROR;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\treturn Z_OK;\n\t};\n\n}\n\nInfTree.inflate_trees_fixed = function(bl, // literal desired/actual bit depth\nbd, // distance desired/actual bit depth\ntl,// literal/length tree result\ntd// distance tree result\n) {\n\tbl[0] = fixed_bl;\n\tbd[0] = fixed_bd;\n\ttl[0] = fixed_tl;\n\ttd[0] = fixed_td;\n\treturn Z_OK;\n};\n\n// InfCodes\n\n// waiting for \"i:\"=input,\n// \"o:\"=output,\n// \"x:\"=nothing\nvar START = 0; // x: set up for LEN\nvar LEN = 1; // i: get length/literal/eob next\nvar LENEXT = 2; // i: getting length extra (have base)\nvar DIST = 3; // i: get distance next\nvar DISTEXT = 4;// i: getting distance extra\nvar COPY = 5; // o: copying bytes in window, waiting\n// for space\nvar LIT = 6; // o: got literal, waiting for output\n// space\nvar WASH = 7; // o: got eob, possibly still output\n// waiting\nvar END = 8; // x: got eob and all data flushed\nvar BADCODE = 9;// x: got error\n\nfunction InfCodes() {\n\tvar that = this;\n\n\tvar mode; // current inflate_codes mode\n\n\t// mode dependent information\n\tvar len = 0;\n\n\tvar tree; // pointer into tree\n\tvar tree_index = 0;\n\tvar need = 0; // bits needed\n\n\tvar lit = 0;\n\n\t// if EXT or COPY, where and how much\n\tvar get = 0; // bits to get for extra\n\tvar dist = 0; // distance back to copy from\n\n\tvar lbits = 0; // ltree bits decoded per branch\n\tvar dbits = 0; // dtree bits decoder per branch\n\tvar ltree; // literal/length/eob tree\n\tvar ltree_index = 0; // literal/length/eob tree\n\tvar dtree; // distance tree\n\tvar dtree_index = 0; // distance tree\n\n\t// Called with number of bytes left to write in window at least 258\n\t// (the maximum string length) and number of input bytes available\n\t// at least ten. The ten bytes are six bytes for the longest length/\n\t// distance pair plus four bytes for overloading the bit buffer.\n\n\tfunction inflate_fast(bl, bd, tl, tl_index, td, td_index, s, z) {\n\t\tvar t; // temporary pointer\n\t\tvar tp; // temporary pointer\n\t\tvar tp_index; // temporary pointer\n\t\tvar e; // extra bits or operation\n\t\tvar b; // bit buffer\n\t\tvar k; // bits in bit buffer\n\t\tvar p; // input data pointer\n\t\tvar n; // bytes available there\n\t\tvar q; // output window write pointer\n\t\tvar m; // bytes to end of window or read pointer\n\t\tvar ml; // mask for literal/length tree\n\t\tvar md; // mask for distance tree\n\t\tvar c; // bytes to copy\n\t\tvar d; // distance back to copy from\n\t\tvar r; // copy source pointer\n\n\t\tvar tp_index_t_3; // (tp_index+t)*3\n\n\t\t// load input, output, bit values\n\t\tp = z.next_in_index;\n\t\tn = z.avail_in;\n\t\tb = s.bitb;\n\t\tk = s.bitk;\n\t\tq = s.write;\n\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t// initialize masks\n\t\tml = inflate_mask[bl];\n\t\tmd = inflate_mask[bd];\n\n\t\t// do until not enough input or output space for fast loop\n\t\tdo { // assume called with m >= 258 && n >= 10\n\t\t\t// get literal/length code\n\t\t\twhile (k < (20)) { // max bits for literal/length code\n\t\t\t\tn--;\n\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\tk += 8;\n\t\t\t}\n\n\t\t\tt = b & ml;\n\t\t\ttp = tl;\n\t\t\ttp_index = tl_index;\n\t\t\ttp_index_t_3 = (tp_index + t) * 3;\n\t\t\tif ((e = tp[tp_index_t_3]) === 0) {\n\t\t\t\tb >>= (tp[tp_index_t_3 + 1]);\n\t\t\t\tk -= (tp[tp_index_t_3 + 1]);\n\n\t\t\t\ts.window[q++] = /* (byte) */tp[tp_index_t_3 + 2];\n\t\t\t\tm--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tdo {\n\n\t\t\t\tb >>= (tp[tp_index_t_3 + 1]);\n\t\t\t\tk -= (tp[tp_index_t_3 + 1]);\n\n\t\t\t\tif ((e & 16) !== 0) {\n\t\t\t\t\te &= 15;\n\t\t\t\t\tc = tp[tp_index_t_3 + 2] + (/* (int) */b & inflate_mask[e]);\n\n\t\t\t\t\tb >>= e;\n\t\t\t\t\tk -= e;\n\n\t\t\t\t\t// decode distance base of block to copy\n\t\t\t\t\twhile (k < (15)) { // max bits for distance code\n\t\t\t\t\t\tn--;\n\t\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\t\tk += 8;\n\t\t\t\t\t}\n\n\t\t\t\t\tt = b & md;\n\t\t\t\t\ttp = td;\n\t\t\t\t\ttp_index = td_index;\n\t\t\t\t\ttp_index_t_3 = (tp_index + t) * 3;\n\t\t\t\t\te = tp[tp_index_t_3];\n\n\t\t\t\t\tdo {\n\n\t\t\t\t\t\tb >>= (tp[tp_index_t_3 + 1]);\n\t\t\t\t\t\tk -= (tp[tp_index_t_3 + 1]);\n\n\t\t\t\t\t\tif ((e & 16) !== 0) {\n\t\t\t\t\t\t\t// get extra bits to add to distance base\n\t\t\t\t\t\t\te &= 15;\n\t\t\t\t\t\t\twhile (k < (e)) { // get extra bits (up to 13)\n\t\t\t\t\t\t\t\tn--;\n\t\t\t\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\t\t\t\tk += 8;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\td = tp[tp_index_t_3 + 2] + (b & inflate_mask[e]);\n\n\t\t\t\t\t\t\tb >>= (e);\n\t\t\t\t\t\t\tk -= (e);\n\n\t\t\t\t\t\t\t// do the copy\n\t\t\t\t\t\t\tm -= c;\n\t\t\t\t\t\t\tif (q >= d) { // offset before dest\n\t\t\t\t\t\t\t\t// just copy\n\t\t\t\t\t\t\t\tr = q - d;\n\t\t\t\t\t\t\t\tif (q - r > 0 && 2 > (q - r)) {\n\t\t\t\t\t\t\t\t\ts.window[q++] = s.window[r++]; // minimum\n\t\t\t\t\t\t\t\t\t// count is\n\t\t\t\t\t\t\t\t\t// three,\n\t\t\t\t\t\t\t\t\ts.window[q++] = s.window[r++]; // so unroll\n\t\t\t\t\t\t\t\t\t// loop a\n\t\t\t\t\t\t\t\t\t// little\n\t\t\t\t\t\t\t\t\tc -= 2;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ts.window.set(s.window.subarray(r, r + 2), q);\n\t\t\t\t\t\t\t\t\tq += 2;\n\t\t\t\t\t\t\t\t\tr += 2;\n\t\t\t\t\t\t\t\t\tc -= 2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else { // else offset after destination\n\t\t\t\t\t\t\t\tr = q - d;\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\tr += s.end; // force pointer in window\n\t\t\t\t\t\t\t\t} while (r < 0); // covers invalid distances\n\t\t\t\t\t\t\t\te = s.end - r;\n\t\t\t\t\t\t\t\tif (c > e) { // if source crosses,\n\t\t\t\t\t\t\t\t\tc -= e; // wrapped copy\n\t\t\t\t\t\t\t\t\tif (q - r > 0 && e > (q - r)) {\n\t\t\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\t\t\ts.window[q++] = s.window[r++];\n\t\t\t\t\t\t\t\t\t\t} while (--e !== 0);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\ts.window.set(s.window.subarray(r, r + e), q);\n\t\t\t\t\t\t\t\t\t\tq += e;\n\t\t\t\t\t\t\t\t\t\tr += e;\n\t\t\t\t\t\t\t\t\t\te = 0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tr = 0; // copy rest from start of window\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// copy all or what's left\n\t\t\t\t\t\t\tif (q - r > 0 && c > (q - r)) {\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\ts.window[q++] = s.window[r++];\n\t\t\t\t\t\t\t\t} while (--c !== 0);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ts.window.set(s.window.subarray(r, r + c), q);\n\t\t\t\t\t\t\t\tq += c;\n\t\t\t\t\t\t\t\tr += c;\n\t\t\t\t\t\t\t\tc = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else if ((e & 64) === 0) {\n\t\t\t\t\t\t\tt += tp[tp_index_t_3 + 2];\n\t\t\t\t\t\t\tt += (b & inflate_mask[e]);\n\t\t\t\t\t\t\ttp_index_t_3 = (tp_index + t) * 3;\n\t\t\t\t\t\t\te = tp[tp_index_t_3];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tz.msg = \"invalid distance code\";\n\n\t\t\t\t\t\t\tc = z.avail_in - n;\n\t\t\t\t\t\t\tc = (k >> 3) < c ? k >> 3 : c;\n\t\t\t\t\t\t\tn += c;\n\t\t\t\t\t\t\tp -= c;\n\t\t\t\t\t\t\tk -= c << 3;\n\n\t\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\ts.write = q;\n\n\t\t\t\t\t\t\treturn Z_DATA_ERROR;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while (true);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ((e & 64) === 0) {\n\t\t\t\t\tt += tp[tp_index_t_3 + 2];\n\t\t\t\t\tt += (b & inflate_mask[e]);\n\t\t\t\t\ttp_index_t_3 = (tp_index + t) * 3;\n\t\t\t\t\tif ((e = tp[tp_index_t_3]) === 0) {\n\n\t\t\t\t\t\tb >>= (tp[tp_index_t_3 + 1]);\n\t\t\t\t\t\tk -= (tp[tp_index_t_3 + 1]);\n\n\t\t\t\t\t\ts.window[q++] = /* (byte) */tp[tp_index_t_3 + 2];\n\t\t\t\t\t\tm--;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else if ((e & 32) !== 0) {\n\n\t\t\t\t\tc = z.avail_in - n;\n\t\t\t\t\tc = (k >> 3) < c ? k >> 3 : c;\n\t\t\t\t\tn += c;\n\t\t\t\t\tp -= c;\n\t\t\t\t\tk -= c << 3;\n\n\t\t\t\t\ts.bitb = b;\n\t\t\t\t\ts.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\ts.write = q;\n\n\t\t\t\t\treturn Z_STREAM_END;\n\t\t\t\t} else {\n\t\t\t\t\tz.msg = \"invalid literal/length code\";\n\n\t\t\t\t\tc = z.avail_in - n;\n\t\t\t\t\tc = (k >> 3) < c ? k >> 3 : c;\n\t\t\t\t\tn += c;\n\t\t\t\t\tp -= c;\n\t\t\t\t\tk -= c << 3;\n\n\t\t\t\t\ts.bitb = b;\n\t\t\t\t\ts.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\ts.write = q;\n\n\t\t\t\t\treturn Z_DATA_ERROR;\n\t\t\t\t}\n\t\t\t} while (true);\n\t\t} while (m >= 258 && n >= 10);\n\n\t\t// not enough input or output--restore pointers and return\n\t\tc = z.avail_in - n;\n\t\tc = (k >> 3) < c ? k >> 3 : c;\n\t\tn += c;\n\t\tp -= c;\n\t\tk -= c << 3;\n\n\t\ts.bitb = b;\n\t\ts.bitk = k;\n\t\tz.avail_in = n;\n\t\tz.total_in += p - z.next_in_index;\n\t\tz.next_in_index = p;\n\t\ts.write = q;\n\n\t\treturn Z_OK;\n\t}\n\n\tthat.init = function(bl, bd, tl, tl_index, td, td_index) {\n\t\tmode = START;\n\t\tlbits = /* (byte) */bl;\n\t\tdbits = /* (byte) */bd;\n\t\tltree = tl;\n\t\tltree_index = tl_index;\n\t\tdtree = td;\n\t\tdtree_index = td_index;\n\t\ttree = null;\n\t};\n\n\tthat.proc = function(s, z, r) {\n\t\tvar j; // temporary storage\n\t\tvar tindex; // temporary pointer\n\t\tvar e; // extra bits or operation\n\t\tvar b = 0; // bit buffer\n\t\tvar k = 0; // bits in bit buffer\n\t\tvar p = 0; // input data pointer\n\t\tvar n; // bytes available there\n\t\tvar q; // output window write pointer\n\t\tvar m; // bytes to end of window or read pointer\n\t\tvar f; // pointer to copy strings from\n\n\t\t// copy input/output information to locals (UPDATE macro restores)\n\t\tp = z.next_in_index;\n\t\tn = z.avail_in;\n\t\tb = s.bitb;\n\t\tk = s.bitk;\n\t\tq = s.write;\n\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t// process input and output based on current state\n\t\twhile (true) {\n\t\t\tswitch (mode) {\n\t\t\t// waiting for \"i:\"=input, \"o:\"=output, \"x:\"=nothing\n\t\t\tcase START: // x: set up for LEN\n\t\t\t\tif (m >= 258 && n >= 10) {\n\n\t\t\t\t\ts.bitb = b;\n\t\t\t\t\ts.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\ts.write = q;\n\t\t\t\t\tr = inflate_fast(lbits, dbits, ltree, ltree_index, dtree, dtree_index, s, z);\n\n\t\t\t\t\tp = z.next_in_index;\n\t\t\t\t\tn = z.avail_in;\n\t\t\t\t\tb = s.bitb;\n\t\t\t\t\tk = s.bitk;\n\t\t\t\t\tq = s.write;\n\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t\t\t\tif (r != Z_OK) {\n\t\t\t\t\t\tmode = r == Z_STREAM_END ? WASH : BADCODE;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tneed = lbits;\n\t\t\t\ttree = ltree;\n\t\t\t\ttree_index = ltree_index;\n\n\t\t\t\tmode = LEN;\n\t\t\t\t/* falls through */\n\t\t\tcase LEN: // i: get length/literal/eob next\n\t\t\t\tj = need;\n\n\t\t\t\twhile (k < (j)) {\n\t\t\t\t\tif (n !== 0)\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\telse {\n\n\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\ttindex = (tree_index + (b & inflate_mask[j])) * 3;\n\n\t\t\t\tb >>>= (tree[tindex + 1]);\n\t\t\t\tk -= (tree[tindex + 1]);\n\n\t\t\t\te = tree[tindex];\n\n\t\t\t\tif (e === 0) { // literal\n\t\t\t\t\tlit = tree[tindex + 2];\n\t\t\t\t\tmode = LIT;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif ((e & 16) !== 0) { // length\n\t\t\t\t\tget = e & 15;\n\t\t\t\t\tlen = tree[tindex + 2];\n\t\t\t\t\tmode = LENEXT;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif ((e & 64) === 0) { // next table\n\t\t\t\t\tneed = e;\n\t\t\t\t\ttree_index = tindex / 3 + tree[tindex + 2];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif ((e & 32) !== 0) { // end of block\n\t\t\t\t\tmode = WASH;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tmode = BADCODE; // invalid code\n\t\t\t\tz.msg = \"invalid literal/length code\";\n\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\ts.bitb = b;\n\t\t\t\ts.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\ts.write = q;\n\t\t\t\treturn s.inflate_flush(z, r);\n\n\t\t\tcase LENEXT: // i: getting length extra (have base)\n\t\t\t\tj = get;\n\n\t\t\t\twhile (k < (j)) {\n\t\t\t\t\tif (n !== 0)\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\telse {\n\n\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\tlen += (b & inflate_mask[j]);\n\n\t\t\t\tb >>= j;\n\t\t\t\tk -= j;\n\n\t\t\t\tneed = dbits;\n\t\t\t\ttree = dtree;\n\t\t\t\ttree_index = dtree_index;\n\t\t\t\tmode = DIST;\n\t\t\t\t/* falls through */\n\t\t\tcase DIST: // i: get distance next\n\t\t\t\tj = need;\n\n\t\t\t\twhile (k < (j)) {\n\t\t\t\t\tif (n !== 0)\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\telse {\n\n\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\ttindex = (tree_index + (b & inflate_mask[j])) * 3;\n\n\t\t\t\tb >>= tree[tindex + 1];\n\t\t\t\tk -= tree[tindex + 1];\n\n\t\t\t\te = (tree[tindex]);\n\t\t\t\tif ((e & 16) !== 0) { // distance\n\t\t\t\t\tget = e & 15;\n\t\t\t\t\tdist = tree[tindex + 2];\n\t\t\t\t\tmode = DISTEXT;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif ((e & 64) === 0) { // next table\n\t\t\t\t\tneed = e;\n\t\t\t\t\ttree_index = tindex / 3 + tree[tindex + 2];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tmode = BADCODE; // invalid code\n\t\t\t\tz.msg = \"invalid distance code\";\n\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\ts.bitb = b;\n\t\t\t\ts.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\ts.write = q;\n\t\t\t\treturn s.inflate_flush(z, r);\n\n\t\t\tcase DISTEXT: // i: getting distance extra\n\t\t\t\tj = get;\n\n\t\t\t\twhile (k < (j)) {\n\t\t\t\t\tif (n !== 0)\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\telse {\n\n\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\tdist += (b & inflate_mask[j]);\n\n\t\t\t\tb >>= j;\n\t\t\t\tk -= j;\n\n\t\t\t\tmode = COPY;\n\t\t\t\t/* falls through */\n\t\t\tcase COPY: // o: copying bytes in window, waiting for space\n\t\t\t\tf = q - dist;\n\t\t\t\twhile (f < 0) { // modulo window size-\"while\" instead\n\t\t\t\t\tf += s.end; // of \"if\" handles invalid distances\n\t\t\t\t}\n\t\t\t\twhile (len !== 0) {\n\n\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\tif (q == s.end && s.read !== 0) {\n\t\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\t\tr = s.inflate_flush(z, r);\n\t\t\t\t\t\t\tq = s.write;\n\t\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t\t\t\t\t\tif (q == s.end && s.read !== 0) {\n\t\t\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ts.window[q++] = s.window[f++];\n\t\t\t\t\tm--;\n\n\t\t\t\t\tif (f == s.end)\n\t\t\t\t\t\tf = 0;\n\t\t\t\t\tlen--;\n\t\t\t\t}\n\t\t\t\tmode = START;\n\t\t\t\tbreak;\n\t\t\tcase LIT: // o: got literal, waiting for output space\n\t\t\t\tif (m === 0) {\n\t\t\t\t\tif (q == s.end && s.read !== 0) {\n\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\t\t\t\t\t}\n\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\tr = s.inflate_flush(z, r);\n\t\t\t\t\t\tq = s.write;\n\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t\t\t\t\tif (q == s.end && s.read !== 0) {\n\t\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\t\ts.bitb = b;\n\t\t\t\t\t\t\ts.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\ts.write = q;\n\t\t\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = Z_OK;\n\n\t\t\t\ts.window[q++] = /* (byte) */lit;\n\t\t\t\tm--;\n\n\t\t\t\tmode = START;\n\t\t\t\tbreak;\n\t\t\tcase WASH: // o: got eob, possibly more output\n\t\t\t\tif (k > 7) { // return unused byte, if any\n\t\t\t\t\tk -= 8;\n\t\t\t\t\tn++;\n\t\t\t\t\tp--; // can always return one\n\t\t\t\t}\n\n\t\t\t\ts.write = q;\n\t\t\t\tr = s.inflate_flush(z, r);\n\t\t\t\tq = s.write;\n\t\t\t\tm = q < s.read ? s.read - q - 1 : s.end - q;\n\n\t\t\t\tif (s.read != s.write) {\n\t\t\t\t\ts.bitb = b;\n\t\t\t\t\ts.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\ts.write = q;\n\t\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tmode = END;\n\t\t\t\t/* falls through */\n\t\t\tcase END:\n\t\t\t\tr = Z_STREAM_END;\n\t\t\t\ts.bitb = b;\n\t\t\t\ts.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\ts.write = q;\n\t\t\t\treturn s.inflate_flush(z, r);\n\n\t\t\tcase BADCODE: // x: got error\n\n\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\ts.bitb = b;\n\t\t\t\ts.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\ts.write = q;\n\t\t\t\treturn s.inflate_flush(z, r);\n\n\t\t\tdefault:\n\t\t\t\tr = Z_STREAM_ERROR;\n\n\t\t\t\ts.bitb = b;\n\t\t\t\ts.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\ts.write = q;\n\t\t\t\treturn s.inflate_flush(z, r);\n\t\t\t}\n\t\t}\n\t};\n\n\tthat.free = function() {\n\t\t// ZFREE(z, c);\n\t};\n\n}\n\n// InfBlocks\n\n// Table for deflate from PKZIP's appnote.txt.\nvar border = [ // Order of the bit length code lengths\n16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];\n\nvar TYPE = 0; // get type bits (3, including end bit)\nvar LENS = 1; // get lengths for stored\nvar STORED = 2;// processing stored block\nvar TABLE = 3; // get table lengths\nvar BTREE = 4; // get bit lengths tree for a dynamic\n// block\nvar DTREE = 5; // get length, distance trees for a\n// dynamic block\nvar CODES = 6; // processing fixed or dynamic block\nvar DRY = 7; // output remaining window bytes\nvar DONELOCKS = 8; // finished last block, done\nvar BADBLOCKS = 9; // ot a data error--stuck here\n\nfunction InfBlocks(z, w) {\n\tvar that = this;\n\n\tvar mode = TYPE; // current inflate_block mode\n\n\tvar left = 0; // if STORED, bytes left to copy\n\n\tvar table = 0; // table lengths (14 bits)\n\tvar index = 0; // index into blens (or border)\n\tvar blens; // bit lengths of codes\n\tvar bb = [ 0 ]; // bit length tree depth\n\tvar tb = [ 0 ]; // bit length decoding tree\n\n\tvar codes = new InfCodes(); // if CODES, current state\n\n\tvar last = 0; // true if this block is the last block\n\n\tvar hufts = new Int32Array(MANY * 3); // single malloc for tree space\n\tvar check = 0; // check on output\n\tvar inftree = new InfTree();\n\n\tthat.bitk = 0; // bits in bit buffer\n\tthat.bitb = 0; // bit buffer\n\tthat.window = new Uint8Array(w); // sliding window\n\tthat.end = w; // one byte after sliding window\n\tthat.read = 0; // window read pointer\n\tthat.write = 0; // window write pointer\n\n\tthat.reset = function(z, c) {\n\t\tif (c)\n\t\t\tc[0] = check;\n\t\t// if (mode == BTREE || mode == DTREE) {\n\t\t// }\n\t\tif (mode == CODES) {\n\t\t\tcodes.free(z);\n\t\t}\n\t\tmode = TYPE;\n\t\tthat.bitk = 0;\n\t\tthat.bitb = 0;\n\t\tthat.read = that.write = 0;\n\t};\n\n\tthat.reset(z, null);\n\n\t// copy as much as possible from the sliding window to the output area\n\tthat.inflate_flush = function(z, r) {\n\t\tvar n;\n\t\tvar p;\n\t\tvar q;\n\n\t\t// local copies of source and destination pointers\n\t\tp = z.next_out_index;\n\t\tq = that.read;\n\n\t\t// compute number of bytes to copy as far as end of window\n\t\tn = /* (int) */((q <= that.write ? that.write : that.end) - q);\n\t\tif (n > z.avail_out)\n\t\t\tn = z.avail_out;\n\t\tif (n !== 0 && r == Z_BUF_ERROR)\n\t\t\tr = Z_OK;\n\n\t\t// update counters\n\t\tz.avail_out -= n;\n\t\tz.total_out += n;\n\n\t\t// copy as far as end of window\n\t\tz.next_out.set(that.window.subarray(q, q + n), p);\n\t\tp += n;\n\t\tq += n;\n\n\t\t// see if more to copy at beginning of window\n\t\tif (q == that.end) {\n\t\t\t// wrap pointers\n\t\t\tq = 0;\n\t\t\tif (that.write == that.end)\n\t\t\t\tthat.write = 0;\n\n\t\t\t// compute bytes to copy\n\t\t\tn = that.write - q;\n\t\t\tif (n > z.avail_out)\n\t\t\t\tn = z.avail_out;\n\t\t\tif (n !== 0 && r == Z_BUF_ERROR)\n\t\t\t\tr = Z_OK;\n\n\t\t\t// update counters\n\t\t\tz.avail_out -= n;\n\t\t\tz.total_out += n;\n\n\t\t\t// copy\n\t\t\tz.next_out.set(that.window.subarray(q, q + n), p);\n\t\t\tp += n;\n\t\t\tq += n;\n\t\t}\n\n\t\t// update pointers\n\t\tz.next_out_index = p;\n\t\tthat.read = q;\n\n\t\t// done\n\t\treturn r;\n\t};\n\n\tthat.proc = function(z, r) {\n\t\tvar t; // temporary storage\n\t\tvar b; // bit buffer\n\t\tvar k; // bits in bit buffer\n\t\tvar p; // input data pointer\n\t\tvar n; // bytes available there\n\t\tvar q; // output window write pointer\n\t\tvar m; // bytes to end of window or read pointer\n\n\t\tvar i;\n\n\t\t// copy input/output information to locals (UPDATE macro restores)\n\t\t// {\n\t\tp = z.next_in_index;\n\t\tn = z.avail_in;\n\t\tb = that.bitb;\n\t\tk = that.bitk;\n\t\t// }\n\t\t// {\n\t\tq = that.write;\n\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\t\t// }\n\n\t\t// process input based on current state\n\t\t// DEBUG dtree\n\t\twhile (true) {\n\t\t\tswitch (mode) {\n\t\t\tcase TYPE:\n\n\t\t\t\twhile (k < (3)) {\n\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\t\t\t\tt = /* (int) */(b & 7);\n\t\t\t\tlast = t & 1;\n\n\t\t\t\tswitch (t >>> 1) {\n\t\t\t\tcase 0: // stored\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (3);\n\t\t\t\t\tk -= (3);\n\t\t\t\t\t// }\n\t\t\t\t\tt = k & 7; // go to byte boundary\n\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (t);\n\t\t\t\t\tk -= (t);\n\t\t\t\t\t// }\n\t\t\t\t\tmode = LENS; // get length of stored block\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1: // fixed\n\t\t\t\t\t// {\n\t\t\t\t\tvar bl = []; // new Array(1);\n\t\t\t\t\tvar bd = []; // new Array(1);\n\t\t\t\t\tvar tl = [ [] ]; // new Array(1);\n\t\t\t\t\tvar td = [ [] ]; // new Array(1);\n\n\t\t\t\t\tInfTree.inflate_trees_fixed(bl, bd, tl, td);\n\t\t\t\t\tcodes.init(bl[0], bd[0], tl[0], 0, td[0], 0);\n\t\t\t\t\t// }\n\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (3);\n\t\t\t\t\tk -= (3);\n\t\t\t\t\t// }\n\n\t\t\t\t\tmode = CODES;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2: // dynamic\n\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (3);\n\t\t\t\t\tk -= (3);\n\t\t\t\t\t// }\n\n\t\t\t\t\tmode = TABLE;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3: // illegal\n\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (3);\n\t\t\t\t\tk -= (3);\n\t\t\t\t\t// }\n\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\tz.msg = \"invalid block type\";\n\t\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase LENS:\n\n\t\t\t\twhile (k < (32)) {\n\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t}\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\tif ((((~b) >>> 16) & 0xffff) != (b & 0xffff)) {\n\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\tz.msg = \"invalid stored block lengths\";\n\t\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tleft = (b & 0xffff);\n\t\t\t\tb = k = 0; // dump bits\n\t\t\t\tmode = left !== 0 ? STORED : (last !== 0 ? DRY : TYPE);\n\t\t\t\tbreak;\n\t\t\tcase STORED:\n\t\t\t\tif (n === 0) {\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\n\t\t\t\tif (m === 0) {\n\t\t\t\t\tif (q == that.end && that.read !== 0) {\n\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\t\t\t\t\t}\n\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\tr = that.inflate_flush(z, r);\n\t\t\t\t\t\tq = that.write;\n\t\t\t\t\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\t\t\t\t\t\tif (q == that.end && that.read !== 0) {\n\t\t\t\t\t\t\tq = 0;\n\t\t\t\t\t\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (m === 0) {\n\t\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = Z_OK;\n\n\t\t\t\tt = left;\n\t\t\t\tif (t > n)\n\t\t\t\t\tt = n;\n\t\t\t\tif (t > m)\n\t\t\t\t\tt = m;\n\t\t\t\tthat.window.set(z.read_buf(p, t), q);\n\t\t\t\tp += t;\n\t\t\t\tn -= t;\n\t\t\t\tq += t;\n\t\t\t\tm -= t;\n\t\t\t\tif ((left -= t) !== 0)\n\t\t\t\t\tbreak;\n\t\t\t\tmode = last !== 0 ? DRY : TYPE;\n\t\t\t\tbreak;\n\t\t\tcase TABLE:\n\n\t\t\t\twhile (k < (14)) {\n\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t}\n\n\t\t\t\t\tn--;\n\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\tk += 8;\n\t\t\t\t}\n\n\t\t\t\ttable = t = (b & 0x3fff);\n\t\t\t\tif ((t & 0x1f) > 29 || ((t >> 5) & 0x1f) > 29) {\n\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\tz.msg = \"too many length or distance symbols\";\n\t\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tt = 258 + (t & 0x1f) + ((t >> 5) & 0x1f);\n\t\t\t\tif (!blens || blens.length < t) {\n\t\t\t\t\tblens = []; // new Array(t);\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < t; i++) {\n\t\t\t\t\t\tblens[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// {\n\t\t\t\tb >>>= (14);\n\t\t\t\tk -= (14);\n\t\t\t\t// }\n\n\t\t\t\tindex = 0;\n\t\t\t\tmode = BTREE;\n\t\t\t\t/* falls through */\n\t\t\tcase BTREE:\n\t\t\t\twhile (index < 4 + (table >>> 10)) {\n\t\t\t\t\twhile (k < (3)) {\n\t\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tn--;\n\t\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\t\tk += 8;\n\t\t\t\t\t}\n\n\t\t\t\t\tblens[border[index++]] = b & 7;\n\n\t\t\t\t\t// {\n\t\t\t\t\tb >>>= (3);\n\t\t\t\t\tk -= (3);\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\twhile (index < 19) {\n\t\t\t\t\tblens[border[index++]] = 0;\n\t\t\t\t}\n\n\t\t\t\tbb[0] = 7;\n\t\t\t\tt = inftree.inflate_trees_bits(blens, bb, tb, hufts, z);\n\t\t\t\tif (t != Z_OK) {\n\t\t\t\t\tr = t;\n\t\t\t\t\tif (r == Z_DATA_ERROR) {\n\t\t\t\t\t\tblens = null;\n\t\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\t}\n\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\n\t\t\t\tindex = 0;\n\t\t\t\tmode = DTREE;\n\t\t\t\t/* falls through */\n\t\t\tcase DTREE:\n\t\t\t\twhile (true) {\n\t\t\t\t\tt = table;\n\t\t\t\t\tif (index >= 258 + (t & 0x1f) + ((t >> 5) & 0x1f)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar j, c;\n\n\t\t\t\t\tt = bb[0];\n\n\t\t\t\t\twhile (k < (t)) {\n\t\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tn--;\n\t\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\t\tk += 8;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if (tb[0] == -1) {\n\t\t\t\t\t// System.err.println(\"null...\");\n\t\t\t\t\t// }\n\n\t\t\t\t\tt = hufts[(tb[0] + (b & inflate_mask[t])) * 3 + 1];\n\t\t\t\t\tc = hufts[(tb[0] + (b & inflate_mask[t])) * 3 + 2];\n\n\t\t\t\t\tif (c < 16) {\n\t\t\t\t\t\tb >>>= (t);\n\t\t\t\t\t\tk -= (t);\n\t\t\t\t\t\tblens[index++] = c;\n\t\t\t\t\t} else { // c == 16..18\n\t\t\t\t\t\ti = c == 18 ? 7 : c - 14;\n\t\t\t\t\t\tj = c == 18 ? 11 : 3;\n\n\t\t\t\t\t\twhile (k < (t + i)) {\n\t\t\t\t\t\t\tif (n !== 0) {\n\t\t\t\t\t\t\t\tr = Z_OK;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tn--;\n\t\t\t\t\t\t\tb |= (z.read_byte(p++) & 0xff) << k;\n\t\t\t\t\t\t\tk += 8;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tb >>>= (t);\n\t\t\t\t\t\tk -= (t);\n\n\t\t\t\t\t\tj += (b & inflate_mask[i]);\n\n\t\t\t\t\t\tb >>>= (i);\n\t\t\t\t\t\tk -= (i);\n\n\t\t\t\t\t\ti = index;\n\t\t\t\t\t\tt = table;\n\t\t\t\t\t\tif (i + j > 258 + (t & 0x1f) + ((t >> 5) & 0x1f) || (c == 16 && i < 1)) {\n\t\t\t\t\t\t\tblens = null;\n\t\t\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\t\t\tz.msg = \"invalid bit length repeat\";\n\t\t\t\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\t\t\tthat.write = q;\n\t\t\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tc = c == 16 ? blens[i - 1] : 0;\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tblens[i++] = c;\n\t\t\t\t\t\t} while (--j !== 0);\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttb[0] = -1;\n\t\t\t\t// {\n\t\t\t\tvar bl_ = []; // new Array(1);\n\t\t\t\tvar bd_ = []; // new Array(1);\n\t\t\t\tvar tl_ = []; // new Array(1);\n\t\t\t\tvar td_ = []; // new Array(1);\n\t\t\t\tbl_[0] = 9; // must be <= 9 for lookahead assumptions\n\t\t\t\tbd_[0] = 6; // must be <= 9 for lookahead assumptions\n\n\t\t\t\tt = table;\n\t\t\t\tt = inftree.inflate_trees_dynamic(257 + (t & 0x1f), 1 + ((t >> 5) & 0x1f), blens, bl_, bd_, tl_, td_, hufts, z);\n\n\t\t\t\tif (t != Z_OK) {\n\t\t\t\t\tif (t == Z_DATA_ERROR) {\n\t\t\t\t\t\tblens = null;\n\t\t\t\t\t\tmode = BADBLOCKS;\n\t\t\t\t\t}\n\t\t\t\t\tr = t;\n\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tcodes.init(bl_[0], bd_[0], hufts, tl_[0], hufts, td_[0]);\n\t\t\t\t// }\n\t\t\t\tmode = CODES;\n\t\t\t\t/* falls through */\n\t\t\tcase CODES:\n\t\t\t\tthat.bitb = b;\n\t\t\t\tthat.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\tthat.write = q;\n\n\t\t\t\tif ((r = codes.proc(that, z, r)) != Z_STREAM_END) {\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tr = Z_OK;\n\t\t\t\tcodes.free(z);\n\n\t\t\t\tp = z.next_in_index;\n\t\t\t\tn = z.avail_in;\n\t\t\t\tb = that.bitb;\n\t\t\t\tk = that.bitk;\n\t\t\t\tq = that.write;\n\t\t\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\n\t\t\t\tif (last === 0) {\n\t\t\t\t\tmode = TYPE;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tmode = DRY;\n\t\t\t\t/* falls through */\n\t\t\tcase DRY:\n\t\t\t\tthat.write = q;\n\t\t\t\tr = that.inflate_flush(z, r);\n\t\t\t\tq = that.write;\n\t\t\t\tm = /* (int) */(q < that.read ? that.read - q - 1 : that.end - q);\n\t\t\t\tif (that.read != that.write) {\n\t\t\t\t\tthat.bitb = b;\n\t\t\t\t\tthat.bitk = k;\n\t\t\t\t\tz.avail_in = n;\n\t\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\t\tz.next_in_index = p;\n\t\t\t\t\tthat.write = q;\n\t\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t\t}\n\t\t\t\tmode = DONELOCKS;\n\t\t\t\t/* falls through */\n\t\t\tcase DONELOCKS:\n\t\t\t\tr = Z_STREAM_END;\n\n\t\t\t\tthat.bitb = b;\n\t\t\t\tthat.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\tthat.write = q;\n\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\tcase BADBLOCKS:\n\t\t\t\tr = Z_DATA_ERROR;\n\n\t\t\t\tthat.bitb = b;\n\t\t\t\tthat.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\tthat.write = q;\n\t\t\t\treturn that.inflate_flush(z, r);\n\n\t\t\tdefault:\n\t\t\t\tr = Z_STREAM_ERROR;\n\n\t\t\t\tthat.bitb = b;\n\t\t\t\tthat.bitk = k;\n\t\t\t\tz.avail_in = n;\n\t\t\t\tz.total_in += p - z.next_in_index;\n\t\t\t\tz.next_in_index = p;\n\t\t\t\tthat.write = q;\n\t\t\t\treturn that.inflate_flush(z, r);\n\t\t\t}\n\t\t}\n\t};\n\n\tthat.free = function(z) {\n\t\tthat.reset(z, null);\n\t\tthat.window = null;\n\t\thufts = null;\n\t\t// ZFREE(z, s);\n\t};\n\n\tthat.set_dictionary = function(d, start, n) {\n\t\tthat.window.set(d.subarray(start, start + n), 0);\n\t\tthat.read = that.write = n;\n\t};\n\n\t// Returns true if inflate is currently at the end of a block generated\n\t// by Z_SYNC_FLUSH or Z_FULL_FLUSH.\n\tthat.sync_point = function() {\n\t\treturn mode == LENS ? 1 : 0;\n\t};\n\n}\n\n// Inflate\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT = 0x20;\n\nvar Z_DEFLATED = 8;\n\nvar METHOD = 0; // waiting for method byte\nvar FLAG = 1; // waiting for flag byte\nvar DICT4 = 2; // four dictionary check bytes to go\nvar DICT3 = 3; // three dictionary check bytes to go\nvar DICT2 = 4; // two dictionary check bytes to go\nvar DICT1 = 5; // one dictionary check byte to go\nvar DICT0 = 6; // waiting for inflateSetDictionary\nvar BLOCKS = 7; // decompressing blocks\nvar DONE = 12; // finished check, done\nvar BAD = 13; // got an error--stay here\n\nvar mark = [ 0, 0, 0xff, 0xff ];\n\nfunction Inflate() {\n\tvar that = this;\n\n\tthat.mode = 0; // current inflate mode\n\n\t// mode dependent information\n\tthat.method = 0; // if FLAGS, method byte\n\n\t// if CHECK, check values to compare\n\tthat.was = [ 0 ]; // new Array(1); // computed check value\n\tthat.need = 0; // stream check value\n\n\t// if BAD, inflateSync's marker bytes count\n\tthat.marker = 0;\n\n\t// mode independent information\n\tthat.wbits = 0; // log2(window size) (8..15, defaults to 15)\n\n\t// this.blocks; // current inflate_blocks state\n\n\tfunction inflateReset(z) {\n\t\tif (!z || !z.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\n\t\tz.total_in = z.total_out = 0;\n\t\tz.msg = null;\n\t\tz.istate.mode = BLOCKS;\n\t\tz.istate.blocks.reset(z, null);\n\t\treturn Z_OK;\n\t}\n\n\tthat.inflateEnd = function(z) {\n\t\tif (that.blocks)\n\t\t\tthat.blocks.free(z);\n\t\tthat.blocks = null;\n\t\t// ZFREE(z, z->state);\n\t\treturn Z_OK;\n\t};\n\n\tthat.inflateInit = function(z, w) {\n\t\tz.msg = null;\n\t\tthat.blocks = null;\n\n\t\t// set window size\n\t\tif (w < 8 || w > 15) {\n\t\t\tthat.inflateEnd(z);\n\t\t\treturn Z_STREAM_ERROR;\n\t\t}\n\t\tthat.wbits = w;\n\n\t\tz.istate.blocks = new InfBlocks(z, 1 << w);\n\n\t\t// reset state\n\t\tinflateReset(z);\n\t\treturn Z_OK;\n\t};\n\n\tthat.inflate = function(z, f) {\n\t\tvar r;\n\t\tvar b;\n\n\t\tif (!z || !z.istate || !z.next_in)\n\t\t\treturn Z_STREAM_ERROR;\n\t\tf = f == Z_FINISH ? Z_BUF_ERROR : Z_OK;\n\t\tr = Z_BUF_ERROR;\n\t\twhile (true) {\n\t\t\t// System.out.println(\"mode: \"+z.istate.mode);\n\t\t\tswitch (z.istate.mode) {\n\t\t\tcase METHOD:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tif (((z.istate.method = z.read_byte(z.next_in_index++)) & 0xf) != Z_DEFLATED) {\n\t\t\t\t\tz.istate.mode = BAD;\n\t\t\t\t\tz.msg = \"unknown compression method\";\n\t\t\t\t\tz.istate.marker = 5; // can't try inflateSync\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif ((z.istate.method >> 4) + 8 > z.istate.wbits) {\n\t\t\t\t\tz.istate.mode = BAD;\n\t\t\t\t\tz.msg = \"invalid window size\";\n\t\t\t\t\tz.istate.marker = 5; // can't try inflateSync\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tz.istate.mode = FLAG;\n\t\t\t\t/* falls through */\n\t\t\tcase FLAG:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tb = (z.read_byte(z.next_in_index++)) & 0xff;\n\n\t\t\t\tif ((((z.istate.method << 8) + b) % 31) !== 0) {\n\t\t\t\t\tz.istate.mode = BAD;\n\t\t\t\t\tz.msg = \"incorrect header check\";\n\t\t\t\t\tz.istate.marker = 5; // can't try inflateSync\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ((b & PRESET_DICT) === 0) {\n\t\t\t\t\tz.istate.mode = BLOCKS;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tz.istate.mode = DICT4;\n\t\t\t\t/* falls through */\n\t\t\tcase DICT4:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tz.istate.need = ((z.read_byte(z.next_in_index++) & 0xff) << 24) & 0xff000000;\n\t\t\t\tz.istate.mode = DICT3;\n\t\t\t\t/* falls through */\n\t\t\tcase DICT3:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tz.istate.need += ((z.read_byte(z.next_in_index++) & 0xff) << 16) & 0xff0000;\n\t\t\t\tz.istate.mode = DICT2;\n\t\t\t\t/* falls through */\n\t\t\tcase DICT2:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tz.istate.need += ((z.read_byte(z.next_in_index++) & 0xff) << 8) & 0xff00;\n\t\t\t\tz.istate.mode = DICT1;\n\t\t\t\t/* falls through */\n\t\t\tcase DICT1:\n\n\t\t\t\tif (z.avail_in === 0)\n\t\t\t\t\treturn r;\n\t\t\t\tr = f;\n\n\t\t\t\tz.avail_in--;\n\t\t\t\tz.total_in++;\n\t\t\t\tz.istate.need += (z.read_byte(z.next_in_index++) & 0xff);\n\t\t\t\tz.istate.mode = DICT0;\n\t\t\t\treturn Z_NEED_DICT;\n\t\t\tcase DICT0:\n\t\t\t\tz.istate.mode = BAD;\n\t\t\t\tz.msg = \"need dictionary\";\n\t\t\t\tz.istate.marker = 0; // can try inflateSync\n\t\t\t\treturn Z_STREAM_ERROR;\n\t\t\tcase BLOCKS:\n\n\t\t\t\tr = z.istate.blocks.proc(z, r);\n\t\t\t\tif (r == Z_DATA_ERROR) {\n\t\t\t\t\tz.istate.mode = BAD;\n\t\t\t\t\tz.istate.marker = 0; // can try inflateSync\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (r == Z_OK) {\n\t\t\t\t\tr = f;\n\t\t\t\t}\n\t\t\t\tif (r != Z_STREAM_END) {\n\t\t\t\t\treturn r;\n\t\t\t\t}\n\t\t\t\tr = f;\n\t\t\t\tz.istate.blocks.reset(z, z.istate.was);\n\t\t\t\tz.istate.mode = DONE;\n\t\t\t\t/* falls through */\n\t\t\tcase DONE:\n\t\t\t\treturn Z_STREAM_END;\n\t\t\tcase BAD:\n\t\t\t\treturn Z_DATA_ERROR;\n\t\t\tdefault:\n\t\t\t\treturn Z_STREAM_ERROR;\n\t\t\t}\n\t\t}\n\t};\n\n\tthat.inflateSetDictionary = function(z, dictionary, dictLength) {\n\t\tvar index = 0;\n\t\tvar length = dictLength;\n\t\tif (!z || !z.istate || z.istate.mode != DICT0)\n\t\t\treturn Z_STREAM_ERROR;\n\n\t\tif (length >= (1 << z.istate.wbits)) {\n\t\t\tlength = (1 << z.istate.wbits) - 1;\n\t\t\tindex = dictLength - length;\n\t\t}\n\t\tz.istate.blocks.set_dictionary(dictionary, index, length);\n\t\tz.istate.mode = BLOCKS;\n\t\treturn Z_OK;\n\t};\n\n\tthat.inflateSync = function(z) {\n\t\tvar n; // number of bytes to look at\n\t\tvar p; // pointer to bytes\n\t\tvar m; // number of marker bytes found in a row\n\t\tvar r, w; // temporaries to save total_in and total_out\n\n\t\t// set up\n\t\tif (!z || !z.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\tif (z.istate.mode != BAD) {\n\t\t\tz.istate.mode = BAD;\n\t\t\tz.istate.marker = 0;\n\t\t}\n\t\tif ((n = z.avail_in) === 0)\n\t\t\treturn Z_BUF_ERROR;\n\t\tp = z.next_in_index;\n\t\tm = z.istate.marker;\n\n\t\t// search\n\t\twhile (n !== 0 && m < 4) {\n\t\t\tif (z.read_byte(p) == mark[m]) {\n\t\t\t\tm++;\n\t\t\t} else if (z.read_byte(p) !== 0) {\n\t\t\t\tm = 0;\n\t\t\t} else {\n\t\t\t\tm = 4 - m;\n\t\t\t}\n\t\t\tp++;\n\t\t\tn--;\n\t\t}\n\n\t\t// restore\n\t\tz.total_in += p - z.next_in_index;\n\t\tz.next_in_index = p;\n\t\tz.avail_in = n;\n\t\tz.istate.marker = m;\n\n\t\t// return no joy or set up to restart on a new block\n\t\tif (m != 4) {\n\t\t\treturn Z_DATA_ERROR;\n\t\t}\n\t\tr = z.total_in;\n\t\tw = z.total_out;\n\t\tinflateReset(z);\n\t\tz.total_in = r;\n\t\tz.total_out = w;\n\t\tz.istate.mode = BLOCKS;\n\t\treturn Z_OK;\n\t};\n\n\t// Returns true if inflate is currently at the end of a block generated\n\t// by Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP\n\t// implementation to provide an additional safety check. PPP uses\n\t// Z_SYNC_FLUSH\n\t// but removes the length bytes of the resulting empty stored block. When\n\t// decompressing, PPP checks that at the end of input packet, inflate is\n\t// waiting for these length bytes.\n\tthat.inflateSyncPoint = function(z) {\n\t\tif (!z || !z.istate || !z.istate.blocks)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn z.istate.blocks.sync_point();\n\t};\n}\n\n// ZStream\n\nfunction ZStream() {\n}\n\nZStream.prototype = {\n\tinflateInit : function(bits) {\n\t\tvar that = this;\n\t\tthat.istate = new Inflate();\n\t\tif (!bits)\n\t\t\tbits = MAX_BITS;\n\t\treturn that.istate.inflateInit(that, bits);\n\t},\n\n\tinflate : function(f) {\n\t\tvar that = this;\n\t\tif (!that.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn that.istate.inflate(that, f);\n\t},\n\n\tinflateEnd : function() {\n\t\tvar that = this;\n\t\tif (!that.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\tvar ret = that.istate.inflateEnd(that);\n\t\tthat.istate = null;\n\t\treturn ret;\n\t},\n\n\tinflateSync : function() {\n\t\tvar that = this;\n\t\tif (!that.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn that.istate.inflateSync(that);\n\t},\n\tinflateSetDictionary : function(dictionary, dictLength) {\n\t\tvar that = this;\n\t\tif (!that.istate)\n\t\t\treturn Z_STREAM_ERROR;\n\t\treturn that.istate.inflateSetDictionary(that, dictionary, dictLength);\n\t},\n\tread_byte : function(start) {\n\t\tvar that = this;\n\t\treturn that.next_in.subarray(start, start + 1)[0];\n\t},\n\tread_buf : function(start, size) {\n\t\tvar that = this;\n\t\treturn that.next_in.subarray(start, start + size);\n\t}\n};\n\n// Inflater\n\nexport function Inflater() {\n\tvar that = this;\n\tvar z = new ZStream();\n\tvar bufsize = 512;\n\tvar flush = Z_NO_FLUSH;\n\tvar buf = new Uint8Array(bufsize);\n\tvar nomoreinput = false;\n\n\tz.inflateInit();\n\tz.next_out = buf;\n\n\tthat.append = function(data, onprogress) {\n\t\tvar err, buffers = [], lastIndex = 0, bufferIndex = 0, bufferSize = 0, array;\n\t\tif (data.length === 0)\n\t\t\treturn;\n\t\tz.next_in_index = 0;\n\t\tz.next_in = data;\n\t\tz.avail_in = data.length;\n\t\tdo {\n\t\t\tz.next_out_index = 0;\n\t\t\tz.avail_out = bufsize;\n\t\t\tif ((z.avail_in === 0) && (!nomoreinput)) { // if buffer is empty and more input is available, refill it\n\t\t\t\tz.next_in_index = 0;\n\t\t\t\tnomoreinput = true;\n\t\t\t}\n\t\t\terr = z.inflate(flush);\n\t\t\tif (nomoreinput && (err === Z_BUF_ERROR)) {\n\t\t\t\tif (z.avail_in !== 0)\n\t\t\t\t\tthrow new Error(\"inflating: bad input\");\n\t\t\t} else if (err !== Z_OK && err !== Z_STREAM_END)\n\t\t\t\tthrow new Error(\"inflating: \" + z.msg);\n\t\t\tif ((nomoreinput || err === Z_STREAM_END) && (z.avail_in === data.length))\n\t\t\t\tthrow new Error(\"inflating: bad input\");\n\t\t\tif (z.next_out_index)\n\t\t\t\tif (z.next_out_index === bufsize)\n\t\t\t\t\tbuffers.push(new Uint8Array(buf));\n\t\t\t\telse\n\t\t\t\t\tbuffers.push(new Uint8Array(buf.subarray(0, z.next_out_index)));\n\t\t\tbufferSize += z.next_out_index;\n\t\t\tif (onprogress && z.next_in_index > 0 && z.next_in_index != lastIndex) {\n\t\t\t\tonprogress(z.next_in_index);\n\t\t\t\tlastIndex = z.next_in_index;\n\t\t\t}\n\t\t} while (z.avail_in > 0 || z.avail_out === 0);\n\t\tarray = new Uint8Array(bufferSize);\n\t\tbuffers.forEach(function(chunk) {\n\t\t\tarray.set(chunk, bufferIndex);\n\t\t\tbufferIndex += chunk.length;\n\t\t});\n\t\treturn array;\n\t};\n\tthat.flush = function() {\n\t\tz.inflateEnd();\n\t};\n}\n\n// 'zip' may not be defined in z-worker and some tests\nself._zipjs_Inflater = Inflater;","/*\nCopyright (c) 2013 Gildas Lormeau. All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice,\nthis list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright\nnotice, this list of conditions and the following disclaimer in\nthe documentation and/or other materials provided with the distribution.\n\n3. The names of the authors may not be used to endorse or promote products\nderived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\nINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\nFITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\nINC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\nOR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\nLIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\nNEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\nEVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport {Deflater} from \"./deflate\";\nimport {Inflater} from \"./inflate\";\n\nvar ERR_BAD_FORMAT = \"File format is not recognized.\";\nvar ERR_CRC = \"CRC failed.\";\nvar ERR_ENCRYPTED = \"File contains encrypted entry.\";\nvar ERR_ZIP64 = \"File is using Zip64 (4gb+ file size).\";\nvar ERR_READ = \"Error while reading zip file.\";\nvar ERR_WRITE = \"Error while writing zip file.\";\nvar ERR_WRITE_DATA = \"Error while writing file data.\";\nvar ERR_READ_DATA = \"Error while reading file data.\";\nvar ERR_DUPLICATED_NAME = \"File already exists.\";\nvar CHUNK_SIZE = 512 * 1024;\n\nvar TEXT_PLAIN = \"text/plain\";\n\nvar appendABViewSupported;\ntry {\n\tappendABViewSupported = new Blob([ new DataView(new ArrayBuffer(0)) ]).size === 0;\n} catch (e) {\n}\n\nfunction Crc32() {\n\tthis.crc = -1;\n}\nCrc32.prototype.append = function append(data) {\n\tvar crc = this.crc | 0, table = this.table;\n\tfor (var offset = 0, len = data.length | 0; offset < len; offset++)\n\t\tcrc = (crc >>> 8) ^ table[(crc ^ data[offset]) & 0xFF];\n\tthis.crc = crc;\n};\nCrc32.prototype.get = function get() {\n\treturn ~this.crc;\n};\nCrc32.prototype.table = (function() {\n\tvar i, j, t, table = []; // Uint32Array is actually slower than []\n\tfor (i = 0; i < 256; i++) {\n\t\tt = i;\n\t\tfor (j = 0; j < 8; j++)\n\t\t\tif (t & 1)\n\t\t\t\tt = (t >>> 1) ^ 0xEDB88320;\n\t\t\telse\n\t\t\t\tt = t >>> 1;\n\t\ttable[i] = t;\n\t}\n\treturn table;\n})();\n\n// \"no-op\" codec\nfunction NOOP() {}\nNOOP.prototype.append = function append(bytes, onprogress) {\n\treturn bytes;\n};\nNOOP.prototype.flush = function flush() {};\n\nfunction blobSlice(blob, index, length) {\n\tif (index < 0 || length < 0 || index + length > blob.size)\n\t\tthrow new RangeError('offset:' + index + ', length:' + length + ', size:' + blob.size);\n\tif (blob.slice)\n\t\treturn blob.slice(index, index + length);\n\telse if (blob.webkitSlice)\n\t\treturn blob.webkitSlice(index, index + length);\n\telse if (blob.mozSlice)\n\t\treturn blob.mozSlice(index, index + length);\n\telse if (blob.msSlice)\n\t\treturn blob.msSlice(index, index + length);\n}\n\nfunction getDataHelper(byteLength, bytes) {\n\tvar dataBuffer, dataArray;\n\tdataBuffer = new ArrayBuffer(byteLength);\n\tdataArray = new Uint8Array(dataBuffer);\n\tif (bytes)\n\t\tdataArray.set(bytes, 0);\n\treturn {\n\t\tbuffer : dataBuffer,\n\t\tarray : dataArray,\n\t\tview : new DataView(dataBuffer)\n\t};\n}\n\n// Readers\nfunction Reader() {\n}\n\nfunction TextReader(text) {\n\tvar that = this, blobReader;\n\n\tfunction init(callback, onerror) {\n\t\tvar blob = new Blob([ text ], {\n\t\t\ttype : TEXT_PLAIN\n\t\t});\n\t\tblobReader = new BlobReader(blob);\n\t\tblobReader.init(function() {\n\t\t\tthat.size = blobReader.size;\n\t\t\tcallback();\n\t\t}, onerror);\n\t}\n\n\tfunction readUint8Array(index, length, callback, onerror) {\n\t\tblobReader.readUint8Array(index, length, callback, onerror);\n\t}\n\n\tthat.size = 0;\n\tthat.init = init;\n\tthat.readUint8Array = readUint8Array;\n}\nTextReader.prototype = new Reader();\nTextReader.prototype.constructor = TextReader;\n\nfunction Data64URIReader(dataURI) {\n\tvar that = this, dataStart;\n\n\tfunction init(callback) {\n\t\tvar dataEnd = dataURI.length;\n\t\twhile (dataURI.charAt(dataEnd - 1) == \"=\")\n\t\t\tdataEnd--;\n\t\tdataStart = dataURI.indexOf(\",\") + 1;\n\t\tthat.size = Math.floor((dataEnd - dataStart) * 0.75);\n\t\tcallback();\n\t}\n\n\tfunction readUint8Array(index, length, callback) {\n\t\tvar i, data = getDataHelper(length);\n\t\tvar start = Math.floor(index / 3) * 4;\n\t\tvar end = Math.ceil((index + length) / 3) * 4;\n\t\tvar bytes = self.atob(dataURI.substring(start + dataStart, end + dataStart));\n\t\tvar delta = index - Math.floor(start / 4) * 3;\n\t\tfor (i = delta; i < delta + length; i++)\n\t\t\tdata.array[i - delta] = bytes.charCodeAt(i);\n\t\tcallback(data.array);\n\t}\n\n\tthat.size = 0;\n\tthat.init = init;\n\tthat.readUint8Array = readUint8Array;\n}\nData64URIReader.prototype = new Reader();\nData64URIReader.prototype.constructor = Data64URIReader;\n\nfunction BlobReader(blob) {\n\tvar that = this;\n\n\tfunction init(callback) {\n\t\tthat.size = blob.size;\n\t\tcallback();\n\t}\n\n\tfunction readUint8Array(index, length, callback, onerror) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tcallback(new Uint8Array(e.target.result));\n\t\t};\n\t\treader.onerror = onerror;\n\t\ttry {\n\t\t\treader.readAsArrayBuffer(blobSlice(blob, index, length));\n\t\t} catch (e) {\n\t\t\tonerror(e);\n\t\t}\n\t}\n\n\tthat.size = 0;\n\tthat.init = init;\n\tthat.readUint8Array = readUint8Array;\n}\nBlobReader.prototype = new Reader();\nBlobReader.prototype.constructor = BlobReader;\n\n// Writers\n\nfunction Writer() {\n}\nWriter.prototype.getData = function(callback) {\n\tcallback(this.data);\n};\n\nfunction TextWriter(encoding) {\n\tvar that = this, blob;\n\n\tfunction init(callback) {\n\t\tblob = new Blob([], {\n\t\t\ttype : TEXT_PLAIN\n\t\t});\n\t\tcallback();\n\t}\n\n\tfunction writeUint8Array(array, callback) {\n\t\tblob = new Blob([ blob, appendABViewSupported ? array : array.buffer ], {\n\t\t\ttype : TEXT_PLAIN\n\t\t});\n\t\tcallback();\n\t}\n\n\tfunction getData(callback, onerror) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tcallback(e.target.result);\n\t\t};\n\t\treader.onerror = onerror;\n\t\treader.readAsText(blob, encoding);\n\t}\n\n\tthat.init = init;\n\tthat.writeUint8Array = writeUint8Array;\n\tthat.getData = getData;\n}\nTextWriter.prototype = new Writer();\nTextWriter.prototype.constructor = TextWriter;\n\nfunction Data64URIWriter(contentType) {\n\tvar that = this, data = \"\", pending = \"\";\n\n\tfunction init(callback) {\n\t\tdata += \"data:\" + (contentType || \"\") + \";base64,\";\n\t\tcallback();\n\t}\n\n\tfunction writeUint8Array(array, callback) {\n\t\tvar i, delta = pending.length, dataString = pending;\n\t\tpending = \"\";\n\t\tfor (i = 0; i < (Math.floor((delta + array.length) / 3) * 3) - delta; i++)\n\t\t\tdataString += String.fromCharCode(array[i]);\n\t\tfor (; i < array.length; i++)\n\t\t\tpending += String.fromCharCode(array[i]);\n\t\tif (dataString.length > 2)\n\t\t\tdata += self.btoa(dataString);\n\t\telse\n\t\t\tpending = dataString;\n\t\tcallback();\n\t}\n\n\tfunction getData(callback) {\n\t\tcallback(data + self.btoa(pending));\n\t}\n\n\tthat.init = init;\n\tthat.writeUint8Array = writeUint8Array;\n\tthat.getData = getData;\n}\nData64URIWriter.prototype = new Writer();\nData64URIWriter.prototype.constructor = Data64URIWriter;\n\nfunction BlobWriter(contentType) {\n\tvar blob, that = this;\n\n\tfunction init(callback) {\n\t\tblob = new Blob([], {\n\t\t\ttype : contentType\n\t\t});\n\t\tcallback();\n\t}\n\n\tfunction writeUint8Array(array, callback) {\n\t\tblob = new Blob([ blob, appendABViewSupported ? array : array.buffer ], {\n\t\t\ttype : contentType\n\t\t});\n\t\tcallback();\n\t}\n\n\tfunction getData(callback) {\n\t\tcallback(blob);\n\t}\n\n\tthat.init = init;\n\tthat.writeUint8Array = writeUint8Array;\n\tthat.getData = getData;\n}\nBlobWriter.prototype = new Writer();\nBlobWriter.prototype.constructor = BlobWriter;\n\n/** \n * inflate/deflate core functions\n * @param worker {Worker} web worker for the task.\n * @param initialMessage {Object} initial message to be sent to the worker. should contain\n *   sn(serial number for distinguishing multiple tasks sent to the worker), and codecClass.\n *   This function may add more properties before sending.\n */\nfunction launchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror) {\n\tvar chunkIndex = 0, index, outputSize, sn = initialMessage.sn, crc;\n\n\tfunction onflush() {\n\t\tworker.removeEventListener('message', onmessage, false);\n\t\tonend(outputSize, crc);\n\t}\n\n\tfunction onmessage(event) {\n\t\tvar message = event.data, data = message.data, err = message.error;\n\t\tif (err) {\n\t\t\terr.toString = function () { return 'Error: ' + this.message; };\n\t\t\tonreaderror(err);\n\t\t\treturn;\n\t\t}\n\t\tif (message.sn !== sn)\n\t\t\treturn;\n\t\tif (typeof message.codecTime === 'number')\n\t\t\tworker.codecTime += message.codecTime; // should be before onflush()\n\t\tif (typeof message.crcTime === 'number')\n\t\t\tworker.crcTime += message.crcTime;\n\n\t\tswitch (message.type) {\n\t\t\tcase 'append':\n\t\t\t\tif (data) {\n\t\t\t\t\toutputSize += data.length;\n\t\t\t\t\twriter.writeUint8Array(data, function() {\n\t\t\t\t\t\tstep();\n\t\t\t\t\t}, onwriteerror);\n\t\t\t\t} else\n\t\t\t\t\tstep();\n\t\t\t\tbreak;\n\t\t\tcase 'flush':\n\t\t\t\tcrc = message.crc;\n\t\t\t\tif (data) {\n\t\t\t\t\toutputSize += data.length;\n\t\t\t\t\twriter.writeUint8Array(data, function() {\n\t\t\t\t\t\tonflush();\n\t\t\t\t\t}, onwriteerror);\n\t\t\t\t} else\n\t\t\t\t\tonflush();\n\t\t\t\tbreak;\n\t\t\tcase 'progress':\n\t\t\t\tif (onprogress)\n\t\t\t\t\tonprogress(index + message.loaded, size);\n\t\t\t\tbreak;\n\t\t\tcase 'importScripts': //no need to handle here\n\t\t\tcase 'newTask':\n\t\t\tcase 'echo':\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn('zip.js:launchWorkerProcess: unknown message: ', message);\n\t\t}\n\t}\n\n\tfunction step() {\n\t\tindex = chunkIndex * CHUNK_SIZE;\n\t\t// use `<=` instead of `<`, because `size` may be 0.\n\t\tif (index <= size) {\n\t\t\treader.readUint8Array(offset + index, Math.min(CHUNK_SIZE, size - index), function(array) {\n\t\t\t\tif (onprogress)\n\t\t\t\t\tonprogress(index, size);\n\t\t\t\tvar msg = index === 0 ? initialMessage : {sn : sn};\n\t\t\t\tmsg.type = 'append';\n\t\t\t\tmsg.data = array;\n\t\t\t\t\n\t\t\t\t// posting a message with transferables will fail on IE10\n\t\t\t\ttry {\n\t\t\t\t\tworker.postMessage(msg, [array.buffer]);\n\t\t\t\t} catch(ex) {\n\t\t\t\t\tworker.postMessage(msg); // retry without transferables\n\t\t\t\t}\n\t\t\t\tchunkIndex++;\n\t\t\t}, onreaderror);\n\t\t} else {\n\t\t\tworker.postMessage({\n\t\t\t\tsn: sn,\n\t\t\t\ttype: 'flush'\n\t\t\t});\n\t\t}\n\t}\n\n\toutputSize = 0;\n\tworker.addEventListener('message', onmessage, false);\n\tstep();\n}\n\nfunction launchProcess(process, reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror) {\n\tvar chunkIndex = 0, index, outputSize = 0,\n\t\tcrcInput = crcType === 'input',\n\t\tcrcOutput = crcType === 'output',\n\t\tcrc = new Crc32();\n\tfunction step() {\n\t\tvar outputData;\n\t\tindex = chunkIndex * CHUNK_SIZE;\n\t\tif (index < size)\n\t\t\treader.readUint8Array(offset + index, Math.min(CHUNK_SIZE, size - index), function(inputData) {\n\t\t\t\tvar outputData;\n\t\t\t\ttry {\n\t\t\t\t\toutputData = process.append(inputData, function(loaded) {\n\t\t\t\t\t\tif (onprogress)\n\t\t\t\t\t\t\tonprogress(index + loaded, size);\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tonreaderror(e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (outputData) {\n\t\t\t\t\toutputSize += outputData.length;\n\t\t\t\t\twriter.writeUint8Array(outputData, function() {\n\t\t\t\t\t\tchunkIndex++;\n\t\t\t\t\t\tsetTimeout(step, 1);\n\t\t\t\t\t}, onwriteerror);\n\t\t\t\t\tif (crcOutput)\n\t\t\t\t\t\tcrc.append(outputData);\n\t\t\t\t} else {\n\t\t\t\t\tchunkIndex++;\n\t\t\t\t\tsetTimeout(step, 1);\n\t\t\t\t}\n\t\t\t\tif (crcInput)\n\t\t\t\t\tcrc.append(inputData);\n\t\t\t\tif (onprogress)\n\t\t\t\t\tonprogress(index, size);\n\t\t\t}, onreaderror);\n\t\telse {\n\t\t\ttry {\n\t\t\t\toutputData = process.flush();\n\t\t\t} catch (e) {\n\t\t\t\tonreaderror(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (outputData) {\n\t\t\t\tif (crcOutput)\n\t\t\t\t\tcrc.append(outputData);\n\t\t\t\toutputSize += outputData.length;\n\t\t\t\twriter.writeUint8Array(outputData, function() {\n\t\t\t\t\tonend(outputSize, crc.get());\n\t\t\t\t}, onwriteerror);\n\t\t\t} else\n\t\t\t\tonend(outputSize, crc.get());\n\t\t}\n\t}\n\n\tstep();\n}\n\nfunction inflate(worker, sn, reader, writer, offset, size, computeCrc32, onend, onprogress, onreaderror, onwriteerror) {\n\tvar crcType = computeCrc32 ? 'output' : 'none';\n\tif (Zip.useWebWorkers) {\n\t\tvar initialMessage = {\n\t\t\tsn: sn,\n\t\t\tcodecClass: '_zipjs_Inflater',\n\t\t\tcrcType: crcType,\n\t\t};\n\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror);\n\t} else\n\t\tlaunchProcess(new Inflater(), reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror);\n}\n\nfunction deflate(worker, sn, reader, writer, level, onend, onprogress, onreaderror, onwriteerror) {\n\tvar crcType = 'input';\n\tif (Zip.useWebWorkers) {\n\t\tvar initialMessage = {\n\t\t\tsn: sn,\n\t\t\toptions: {level: level},\n\t\t\tcodecClass: '_zipjs_Deflater',\n\t\t\tcrcType: crcType,\n\t\t};\n\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, 0, reader.size, onprogress, onend, onreaderror, onwriteerror);\n\t} else\n\t\tlaunchProcess(new Deflater(), reader, writer, 0, reader.size, crcType, onprogress, onend, onreaderror, onwriteerror);\n}\n\nfunction copy(worker, sn, reader, writer, offset, size, computeCrc32, onend, onprogress, onreaderror, onwriteerror) {\n\tvar crcType = 'input';\n\tif (Zip.useWebWorkers && computeCrc32) {\n\t\tvar initialMessage = {\n\t\t\tsn: sn,\n\t\t\tcodecClass: '_zipjs_NOOP',\n\t\t\tcrcType: crcType,\n\t\t};\n\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror);\n\t} else\n\t\tlaunchProcess(new NOOP(), reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror);\n}\n\n// ZipReader\n\nfunction decodeASCII(str) {\n\tvar i, out = \"\", charCode, extendedASCII = [ '\\u00C7', '\\u00FC', '\\u00E9', '\\u00E2', '\\u00E4', '\\u00E0', '\\u00E5', '\\u00E7', '\\u00EA', '\\u00EB',\n\t\t\t'\\u00E8', '\\u00EF', '\\u00EE', '\\u00EC', '\\u00C4', '\\u00C5', '\\u00C9', '\\u00E6', '\\u00C6', '\\u00F4', '\\u00F6', '\\u00F2', '\\u00FB', '\\u00F9',\n\t\t\t'\\u00FF', '\\u00D6', '\\u00DC', '\\u00F8', '\\u00A3', '\\u00D8', '\\u00D7', '\\u0192', '\\u00E1', '\\u00ED', '\\u00F3', '\\u00FA', '\\u00F1', '\\u00D1',\n\t\t\t'\\u00AA', '\\u00BA', '\\u00BF', '\\u00AE', '\\u00AC', '\\u00BD', '\\u00BC', '\\u00A1', '\\u00AB', '\\u00BB', '_', '_', '_', '\\u00A6', '\\u00A6',\n\t\t\t'\\u00C1', '\\u00C2', '\\u00C0', '\\u00A9', '\\u00A6', '\\u00A6', '+', '+', '\\u00A2', '\\u00A5', '+', '+', '-', '-', '+', '-', '+', '\\u00E3',\n\t\t\t'\\u00C3', '+', '+', '-', '-', '\\u00A6', '-', '+', '\\u00A4', '\\u00F0', '\\u00D0', '\\u00CA', '\\u00CB', '\\u00C8', 'i', '\\u00CD', '\\u00CE',\n\t\t\t'\\u00CF', '+', '+', '_', '_', '\\u00A6', '\\u00CC', '_', '\\u00D3', '\\u00DF', '\\u00D4', '\\u00D2', '\\u00F5', '\\u00D5', '\\u00B5', '\\u00FE',\n\t\t\t'\\u00DE', '\\u00DA', '\\u00DB', '\\u00D9', '\\u00FD', '\\u00DD', '\\u00AF', '\\u00B4', '\\u00AD', '\\u00B1', '_', '\\u00BE', '\\u00B6', '\\u00A7',\n\t\t\t'\\u00F7', '\\u00B8', '\\u00B0', '\\u00A8', '\\u00B7', '\\u00B9', '\\u00B3', '\\u00B2', '_', ' ' ];\n\tfor (i = 0; i < str.length; i++) {\n\t\tcharCode = str.charCodeAt(i) & 0xFF;\n\t\tif (charCode > 127)\n\t\t\tout += extendedASCII[charCode - 128];\n\t\telse\n\t\t\tout += String.fromCharCode(charCode);\n\t}\n\treturn out;\n}\n\nfunction decodeUTF8(string) {\n\treturn decodeURIComponent(escape(string));\n}\n\nfunction getString(bytes) {\n\tvar i, str = \"\";\n\tfor (i = 0; i < bytes.length; i++)\n\t\tstr += String.fromCharCode(bytes[i]);\n\treturn str;\n}\n\nfunction getDate(timeRaw) {\n\tvar date = (timeRaw & 0xffff0000) >> 16, time = timeRaw & 0x0000ffff;\n\ttry {\n\t\treturn new Date(1980 + ((date & 0xFE00) >> 9), ((date & 0x01E0) >> 5) - 1, date & 0x001F, (time & 0xF800) >> 11, (time & 0x07E0) >> 5,\n\t\t\t\t(time & 0x001F) * 2, 0);\n\t} catch (e) {\n\t}\n}\n\nfunction readCommonHeader(entry, data, index, centralDirectory, onerror) {\n\tentry.version = data.view.getUint16(index, true);\n\tentry.bitFlag = data.view.getUint16(index + 2, true);\n\tentry.compressionMethod = data.view.getUint16(index + 4, true);\n\tentry.lastModDateRaw = data.view.getUint32(index + 6, true);\n\tentry.lastModDate = getDate(entry.lastModDateRaw);\n\tif ((entry.bitFlag & 0x01) === 0x01) {\n\t\tonerror(ERR_ENCRYPTED);\n\t\treturn;\n\t}\n\tif (centralDirectory || (entry.bitFlag & 0x0008) != 0x0008) {\n\t\tentry.crc32 = data.view.getUint32(index + 10, true);\n\t\tentry.compressedSize = data.view.getUint32(index + 14, true);\n\t\tentry.uncompressedSize = data.view.getUint32(index + 18, true);\n\t}\n\tif (entry.compressedSize === 0xFFFFFFFF || entry.uncompressedSize === 0xFFFFFFFF) {\n\t\tonerror(ERR_ZIP64);\n\t\treturn;\n\t}\n\tentry.filenameLength = data.view.getUint16(index + 22, true);\n\tentry.extraFieldLength = data.view.getUint16(index + 24, true);\n}\n\nfunction createZipReader(reader, callback, onerror) {\n\tvar inflateSN = 0;\n\n\tfunction Entry() {\n\t}\n\n\tEntry.prototype.getData = function(writer, onend, onprogress, checkCrc32) {\n\t\tvar that = this;\n\n\t\tfunction testCrc32(crc32) {\n\t\t\tvar dataCrc32 = getDataHelper(4);\n\t\t\tdataCrc32.view.setUint32(0, crc32);\n\t\t\treturn that.crc32 == dataCrc32.view.getUint32(0);\n\t\t}\n\n\t\tfunction getWriterData(uncompressedSize, crc32) {\n\t\t\tif (checkCrc32 && !testCrc32(crc32))\n\t\t\t\tonerror(ERR_CRC);\n\t\t\telse\n\t\t\t\twriter.getData(function(data) {\n\t\t\t\t\tonend(data);\n\t\t\t\t});\n\t\t}\n\n\t\tfunction onreaderror(err) {\n\t\t\tonerror(err || ERR_READ_DATA);\n\t\t}\n\n\t\tfunction onwriteerror(err) {\n\t\t\tonerror(err || ERR_WRITE_DATA);\n\t\t}\n\n\t\treader.readUint8Array(that.offset, 30, function(bytes) {\n\t\t\tvar data = getDataHelper(bytes.length, bytes), dataOffset;\n\t\t\tif (data.view.getUint32(0) != 0x504b0304) {\n\t\t\t\tonerror(ERR_BAD_FORMAT);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treadCommonHeader(that, data, 4, false, onerror);\n\t\t\tdataOffset = that.offset + 30 + that.filenameLength + that.extraFieldLength;\n\t\t\twriter.init(function() {\n\t\t\t\tif (that.compressionMethod === 0)\n\t\t\t\t\tcopy(that._worker, inflateSN++, reader, writer, dataOffset, that.compressedSize, checkCrc32, getWriterData, onprogress, onreaderror, onwriteerror);\n\t\t\t\telse\n\t\t\t\t\tinflate(that._worker, inflateSN++, reader, writer, dataOffset, that.compressedSize, checkCrc32, getWriterData, onprogress, onreaderror, onwriteerror);\n\t\t\t}, onwriteerror);\n\t\t}, onreaderror);\n\t};\n\n\tfunction seekEOCDR(eocdrCallback) {\n\t\t// \"End of central directory record\" is the last part of a zip archive, and is at least 22 bytes long.\n\t\t// Zip file comment is the last part of EOCDR and has max length of 64KB,\n\t\t// so we only have to search the last 64K + 22 bytes of a archive for EOCDR signature (0x06054b50).\n\t\tvar EOCDR_MIN = 22;\n\t\tif (reader.size < EOCDR_MIN) {\n\t\t\tonerror(ERR_BAD_FORMAT);\n\t\t\treturn;\n\t\t}\n\t\tvar ZIP_COMMENT_MAX = 256 * 256, EOCDR_MAX = EOCDR_MIN + ZIP_COMMENT_MAX;\n\n\t\t// In most cases, the EOCDR is EOCDR_MIN bytes long\n\t\tdoSeek(EOCDR_MIN, function() {\n\t\t\t// If not found, try within EOCDR_MAX bytes\n\t\t\tdoSeek(Math.min(EOCDR_MAX, reader.size), function() {\n\t\t\t\tonerror(ERR_BAD_FORMAT);\n\t\t\t});\n\t\t});\n\n\t\t// seek last length bytes of file for EOCDR\n\t\tfunction doSeek(length, eocdrNotFoundCallback) {\n\t\t\treader.readUint8Array(reader.size - length, length, function(bytes) {\n\t\t\t\tfor (var i = bytes.length - EOCDR_MIN; i >= 0; i--) {\n\t\t\t\t\tif (bytes[i] === 0x50 && bytes[i + 1] === 0x4b && bytes[i + 2] === 0x05 && bytes[i + 3] === 0x06) {\n\t\t\t\t\t\teocdrCallback(new DataView(bytes.buffer, i, EOCDR_MIN));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\teocdrNotFoundCallback();\n\t\t\t}, function() {\n\t\t\t\tonerror(ERR_READ);\n\t\t\t});\n\t\t}\n\t}\n\n\tvar zipReader = {\n\t\tgetEntries : function(callback) {\n\t\t\tvar worker = this._worker;\n\t\t\t// look for End of central directory record\n\t\t\tseekEOCDR(function(dataView) {\n\t\t\t\tvar datalength, fileslength;\n\t\t\t\tdatalength = dataView.getUint32(16, true);\n\t\t\t\tfileslength = dataView.getUint16(8, true);\n\t\t\t\tif (datalength < 0 || datalength >= reader.size) {\n\t\t\t\t\tonerror(ERR_BAD_FORMAT);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treader.readUint8Array(datalength, reader.size - datalength, function(bytes) {\n\t\t\t\t\tvar i, index = 0, entries = [], entry, filename, comment, data = getDataHelper(bytes.length, bytes);\n\t\t\t\t\tfor (i = 0; i < fileslength; i++) {\n\t\t\t\t\t\tentry = new Entry();\n\t\t\t\t\t\tentry._worker = worker;\n\t\t\t\t\t\tif (data.view.getUint32(index) != 0x504b0102) {\n\t\t\t\t\t\t\tonerror(ERR_BAD_FORMAT);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treadCommonHeader(entry, data, index + 6, true, onerror);\n\t\t\t\t\t\tentry.commentLength = data.view.getUint16(index + 32, true);\n\t\t\t\t\t\tentry.directory = ((data.view.getUint8(index + 38) & 0x10) == 0x10);\n\t\t\t\t\t\tentry.offset = data.view.getUint32(index + 42, true);\n\t\t\t\t\t\tfilename = getString(data.array.subarray(index + 46, index + 46 + entry.filenameLength));\n\t\t\t\t\t\tentry.filename = ((entry.bitFlag & 0x0800) === 0x0800) ? decodeUTF8(filename) : decodeASCII(filename);\n\t\t\t\t\t\tif (!entry.directory && entry.filename.charAt(entry.filename.length - 1) == \"/\")\n\t\t\t\t\t\t\tentry.directory = true;\n\t\t\t\t\t\tcomment = getString(data.array.subarray(index + 46 + entry.filenameLength + entry.extraFieldLength, index + 46\n\t\t\t\t\t\t\t\t+ entry.filenameLength + entry.extraFieldLength + entry.commentLength));\n\t\t\t\t\t\tentry.comment = ((entry.bitFlag & 0x0800) === 0x0800) ? decodeUTF8(comment) : decodeASCII(comment);\n\t\t\t\t\t\tentries.push(entry);\n\t\t\t\t\t\tindex += 46 + entry.filenameLength + entry.extraFieldLength + entry.commentLength;\n\t\t\t\t\t}\n\t\t\t\t\tcallback(entries);\n\t\t\t\t}, function() {\n\t\t\t\t\tonerror(ERR_READ);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tclose : function(callback) {\n\t\t\tif (this._worker) {\n\t\t\t\tthis._worker.terminate();\n\t\t\t\tthis._worker = null;\n\t\t\t}\n\t\t\tif (callback)\n\t\t\t\tcallback();\n\t\t},\n\t\t_worker: null\n\t};\n\n\tif (!Zip.useWebWorkers)\n\t\tcallback(zipReader);\n\telse {\n\t\tcreateWorker('inflater',\n\t\t\tfunction(worker) {\n\t\t\t\tzipReader._worker = worker;\n\t\t\t\tcallback(zipReader);\n\t\t\t},\n\t\t\tfunction(err) {\n\t\t\t\tonerror(err);\n\t\t\t}\n\t\t);\n\t}\n}\n\n// ZipWriter\n\nfunction encodeUTF8(string) {\n\treturn unescape(encodeURIComponent(string));\n}\n\nfunction getBytes(str) {\n\tvar i, array = [];\n\tfor (i = 0; i < str.length; i++)\n\t\tarray.push(str.charCodeAt(i));\n\treturn array;\n}\n\nfunction createZipWriter(writer, callback, onerror, dontDeflate) {\n\tvar files = {}, filenames = [], datalength = 0;\n\tvar deflateSN = 0;\n\n\tfunction onwriteerror(err) {\n\t\tonerror(err || ERR_WRITE);\n\t}\n\n\tfunction onreaderror(err) {\n\t\tonerror(err || ERR_READ_DATA);\n\t}\n\n\tvar zipWriter = {\n\t\tadd : function(name, reader, onend, onprogress, options) {\n\t\t\tvar header, filename, date;\n\t\t\tvar worker = this._worker;\n\n\t\t\tfunction writeHeader(callback) {\n\t\t\t\tvar data;\n\t\t\t\tdate = options.lastModDate || new Date();\n\t\t\t\theader = getDataHelper(26);\n\t\t\t\tfiles[name] = {\n\t\t\t\t\theaderArray : header.array,\n\t\t\t\t\tdirectory : options.directory,\n\t\t\t\t\tfilename : filename,\n\t\t\t\t\toffset : datalength,\n\t\t\t\t\tcomment : getBytes(encodeUTF8(options.comment || \"\"))\n\t\t\t\t};\n\t\t\t\theader.view.setUint32(0, 0x14000808);\n\t\t\t\tif (options.version)\n\t\t\t\t\theader.view.setUint8(0, options.version);\n\t\t\t\tif (!dontDeflate && options.level !== 0 && !options.directory)\n\t\t\t\t\theader.view.setUint16(4, 0x0800);\n\t\t\t\theader.view.setUint16(6, (((date.getHours() << 6) | date.getMinutes()) << 5) | date.getSeconds() / 2, true);\n\t\t\t\theader.view.setUint16(8, ((((date.getFullYear() - 1980) << 4) | (date.getMonth() + 1)) << 5) | date.getDate(), true);\n\t\t\t\theader.view.setUint16(22, filename.length, true);\n\t\t\t\tdata = getDataHelper(30 + filename.length);\n\t\t\t\tdata.view.setUint32(0, 0x504b0304);\n\t\t\t\tdata.array.set(header.array, 4);\n\t\t\t\tdata.array.set(filename, 30);\n\t\t\t\tdatalength += data.array.length;\n\t\t\t\twriter.writeUint8Array(data.array, callback, onwriteerror);\n\t\t\t}\n\n\t\t\tfunction writeFooter(compressedLength, crc32) {\n\t\t\t\tvar footer = getDataHelper(16);\n\t\t\t\tdatalength += compressedLength || 0;\n\t\t\t\tfooter.view.setUint32(0, 0x504b0708);\n\t\t\t\tif (typeof crc32 != \"undefined\") {\n\t\t\t\t\theader.view.setUint32(10, crc32, true);\n\t\t\t\t\tfooter.view.setUint32(4, crc32, true);\n\t\t\t\t}\n\t\t\t\tif (reader) {\n\t\t\t\t\tfooter.view.setUint32(8, compressedLength, true);\n\t\t\t\t\theader.view.setUint32(14, compressedLength, true);\n\t\t\t\t\tfooter.view.setUint32(12, reader.size, true);\n\t\t\t\t\theader.view.setUint32(18, reader.size, true);\n\t\t\t\t}\n\t\t\t\twriter.writeUint8Array(footer.array, function() {\n\t\t\t\t\tdatalength += 16;\n\t\t\t\t\tonend();\n\t\t\t\t}, onwriteerror);\n\t\t\t}\n\n\t\t\tfunction writeFile() {\n\t\t\t\toptions = options || {};\n\t\t\t\tname = name.trim();\n\t\t\t\tif (options.directory && name.charAt(name.length - 1) != \"/\")\n\t\t\t\t\tname += \"/\";\n\t\t\t\tif (files.hasOwnProperty(name)) {\n\t\t\t\t\tonerror(ERR_DUPLICATED_NAME);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfilename = getBytes(encodeUTF8(name));\n\t\t\t\tfilenames.push(name);\n\t\t\t\twriteHeader(function() {\n\t\t\t\t\tif (reader)\n\t\t\t\t\t\tif (dontDeflate || options.level === 0)\n\t\t\t\t\t\t\tcopy(worker, deflateSN++, reader, writer, 0, reader.size, true, writeFooter, onprogress, onreaderror, onwriteerror);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdeflate(worker, deflateSN++, reader, writer, options.level, writeFooter, onprogress, onreaderror, onwriteerror);\n\t\t\t\t\telse\n\t\t\t\t\t\twriteFooter();\n\t\t\t\t}, onwriteerror);\n\t\t\t}\n\n\t\t\tif (reader)\n\t\t\t\treader.init(writeFile, onreaderror);\n\t\t\telse\n\t\t\t\twriteFile();\n\t\t},\n\t\tclose : function(callback) {\n\t\t\tif (this._worker) {\n\t\t\t\tthis._worker.terminate();\n\t\t\t\tthis._worker = null;\n\t\t\t}\n\n\t\t\tvar data, length = 0, index = 0, indexFilename, file;\n\t\t\tfor (indexFilename = 0; indexFilename < filenames.length; indexFilename++) {\n\t\t\t\tfile = files[filenames[indexFilename]];\n\t\t\t\tlength += 46 + file.filename.length + file.comment.length;\n\t\t\t}\n\t\t\tdata = getDataHelper(length + 22);\n\t\t\tfor (indexFilename = 0; indexFilename < filenames.length; indexFilename++) {\n\t\t\t\tfile = files[filenames[indexFilename]];\n\t\t\t\tdata.view.setUint32(index, 0x504b0102);\n\t\t\t\tdata.view.setUint16(index + 4, 0x1400);\n\t\t\t\tdata.array.set(file.headerArray, index + 6);\n\t\t\t\tdata.view.setUint16(index + 32, file.comment.length, true);\n\t\t\t\tif (file.directory)\n\t\t\t\t\tdata.view.setUint8(index + 38, 0x10);\n\t\t\t\tdata.view.setUint32(index + 42, file.offset, true);\n\t\t\t\tdata.array.set(file.filename, index + 46);\n\t\t\t\tdata.array.set(file.comment, index + 46 + file.filename.length);\n\t\t\t\tindex += 46 + file.filename.length + file.comment.length;\n\t\t\t}\n\t\t\tdata.view.setUint32(index, 0x504b0506);\n\t\t\tdata.view.setUint16(index + 8, filenames.length, true);\n\t\t\tdata.view.setUint16(index + 10, filenames.length, true);\n\t\t\tdata.view.setUint32(index + 12, length, true);\n\t\t\tdata.view.setUint32(index + 16, datalength, true);\n\t\t\twriter.writeUint8Array(data.array, function() {\n\t\t\t\twriter.getData(callback);\n\t\t\t}, onwriteerror);\n\t\t},\n\t\t_worker: null\n\t};\n\n\tif (!Zip.useWebWorkers)\n\t\tcallback(zipWriter);\n\telse {\n\t\tcreateWorker('deflater',\n\t\t\tfunction(worker) {\n\t\t\t\tzipWriter._worker = worker;\n\t\t\t\tcallback(zipWriter);\n\t\t\t},\n\t\t\tfunction(err) {\n\t\t\t\tonerror(err);\n\t\t\t}\n\t\t);\n\t}\n}\n\nfunction resolveURLs(urls) {\n\tvar a = document.createElement('a');\n\treturn urls.map(function(url) {\n\t\ta.href = url;\n\t\treturn a.href;\n\t});\n}\n\nvar DEFAULT_WORKER_SCRIPTS = {\n\tdeflater: ['z-worker.js', 'deflate.js'],\n\tinflater: ['z-worker.js', 'inflate.js']\n};\nfunction createWorker(type, callback, onerror) {\n\tif (Zip.workerScripts !== null && Zip.workerScriptsPath !== null) {\n\t\tonerror(new Error('Either zip.workerScripts or zip.workerScriptsPath may be set, not both.'));\n\t\treturn;\n\t}\n\tvar scripts;\n\tif (Zip.workerScripts) {\n\t\tscripts = Zip.workerScripts[type];\n\t\tif (!Array.isArray(scripts)) {\n\t\t\tonerror(new Error('zip.workerScripts.' + type + ' is not an array!'));\n\t\t\treturn;\n\t\t}\n\t\tscripts = resolveURLs(scripts);\n\t} else {\n\t\tscripts = DEFAULT_WORKER_SCRIPTS[type].slice(0);\n\t\tscripts[0] = (Zip.workerScriptsPath || '') + scripts[0];\n\t}\n\tvar worker = new Worker(scripts[0]);\n\t// record total consumed time by inflater/deflater/crc32 in this worker\n\tworker.codecTime = worker.crcTime = 0;\n\tworker.postMessage({ type: 'importScripts', scripts: scripts.slice(1) });\n\tworker.addEventListener('message', onmessage);\n\tfunction onmessage(ev) {\n\t\tvar msg = ev.data;\n\t\tif (msg.error) {\n\t\t\tworker.terminate(); // should before onerror(), because onerror() may throw.\n\t\t\tonerror(msg.error);\n\t\t\treturn;\n\t\t}\n\t\tif (msg.type === 'importScripts') {\n\t\t\tworker.removeEventListener('message', onmessage);\n\t\t\tworker.removeEventListener('error', errorHandler);\n\t\t\tcallback(worker);\n\t\t}\n\t}\n\t// catch entry script loading error and other unhandled errors\n\tworker.addEventListener('error', errorHandler);\n\tfunction errorHandler(err) {\n\t\tworker.terminate();\n\t\tonerror(err);\n\t}\n}\n\nfunction onerror_default(error) {\n\tconsole.error(error);\n}\nconst Zip = {\n    Reader: Reader,\n    Writer: Writer,\n    BlobReader: BlobReader,\n    Data64URIReader: Data64URIReader,\n    TextReader: TextReader,\n    BlobWriter: BlobWriter,\n    Data64URIWriter: Data64URIWriter,\n    TextWriter: TextWriter,\n    createReader: function (reader, callback, onerror) {\n        onerror = onerror || onerror_default;\n\n        reader.init(function () {\n            createZipReader(reader, callback, onerror);\n        }, onerror);\n    },\n    createWriter: function (writer, callback, onerror, dontDeflate) {\n        onerror = onerror || onerror_default;\n        dontDeflate = !!dontDeflate;\n\n        writer.init(function () {\n            createZipWriter(writer, callback, onerror, dontDeflate);\n        }, onerror);\n    },\n    useWebWorkers: true,\n    /**\n     * Directory containing the default worker scripts (z-worker.js, deflate.js, and inflate.js), relative to current base url.\n     * E.g.: zip.workerScripts = './';\n     */\n    workerScriptsPath: null,\n    /**\n     * Advanced option to control which scripts are loaded in the Web worker. If this option is specified, then workerScriptsPath must not be set.\n     * workerScripts.deflater/workerScripts.inflater should be arrays of urls to scripts for deflater/inflater, respectively.\n     * Scripts in the array are executed in order, and the first one should be z-worker.js, which is used to start the worker.\n     * All urls are relative to current base url.\n     * E.g.:\n     * zip.workerScripts = {\n     *   deflater: ['z-worker.js', 'deflate.js'],\n     *   inflater: ['z-worker.js', 'inflate.js']\n     * };\n     */\n    workerScripts: null,\n};\nexport default Zip;\n","import zip from 'zip-js-esm';\n\n/*\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are met:\n 1. Redistributions of source code must retain the above copyright notice,\n this list of conditions and the following disclaimer.\n 2. Redistributions in binary form must reproduce the above copyright\n notice, this list of conditions and the following disclaimer in\n the documentation and/or other materials provided with the distribution.\n 3. The names of the authors may not be used to endorse or promote products\n derived from this software without specific prior written permission.\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nvar CHUNK_SIZE = 512 * 1024;\n\nvar TextWriter = zip.TextWriter, //\nBlobWriter = zip.BlobWriter, //\nData64URIWriter = zip.Data64URIWriter, //\nReader = zip.Reader, //\nTextReader = zip.TextReader, //\nBlobReader = zip.BlobReader, //\nData64URIReader = zip.Data64URIReader, //\ncreateReader = zip.createReader, //\ncreateWriter = zip.createWriter;\n\nfunction ZipBlobReader(entry) {\n  var that = this, blobReader;\n\n  function init(callback) {\n    that.size = entry.uncompressedSize;\n    callback();\n  }\n\n  function getData(callback) {\n    if (that.data)\n      callback();\n    else\n      entry.getData(new BlobWriter(), function(data) {\n        that.data = data;\n        blobReader = new BlobReader(data);\n        callback();\n      }, null, that.checkCrc32);\n  }\n\n  function readUint8Array(index, length, callback, onerror) {\n    getData(function() {\n      blobReader.readUint8Array(index, length, callback, onerror);\n    }, onerror);\n  }\n\n  that.size = 0;\n  that.init = init;\n  that.readUint8Array = readUint8Array;\n}\nZipBlobReader.prototype = new Reader();\nZipBlobReader.prototype.constructor = ZipBlobReader;\nZipBlobReader.prototype.checkCrc32 = false;\n\nfunction getTotalSize(entry) {\n  var size = 0;\n\n  function process(entry) {\n    size += entry.uncompressedSize || 0;\n    entry.children.forEach(process);\n  }\n\n  process(entry);\n  return size;\n}\n\nfunction initReaders(entry, onend, onerror) {\n  var index = 0;\n\n  function next() {\n    index++;\n    if (index < entry.children.length)\n      process(entry.children[index]);\n    else\n      onend();\n  }\n\n  function process(child) {\n    if (child.directory)\n      initReaders(child, next, onerror);\n    else {\n      child.reader = new child.Reader(child.data, onerror);\n      child.reader.init(function() {\n        child.uncompressedSize = child.reader.size;\n        next();\n      });\n    }\n  }\n\n  if (entry.children.length)\n    process(entry.children[index]);\n  else\n    onend();\n}\n\nfunction detach(entry) {\n  var children = entry.parent.children;\n  children.forEach(function(child, index) {\n    if (child.id == entry.id)\n      children.splice(index, 1);\n  });\n}\n\nfunction exportZip(zipWriter, entry, onend, onprogress, totalSize) {\n  var currentIndex = 0;\n\n  function process(zipWriter, entry, onend, onprogress, totalSize) {\n    var childIndex = 0;\n\n    function exportChild() {\n      var child = entry.children[childIndex];\n      if (child)\n        zipWriter.add(child.getFullname(), child.reader, function() {\n          currentIndex += child.uncompressedSize || 0;\n          process(zipWriter, child, function() {\n            childIndex++;\n            exportChild();\n          }, onprogress, totalSize);\n        }, function(index) {\n          if (onprogress)\n            onprogress(currentIndex + index, totalSize);\n        }, {\n          directory : child.directory,\n          version : child.zipVersion\n        });\n      else\n        onend();\n    }\n\n    exportChild();\n  }\n\n  process(zipWriter, entry, onend, onprogress, totalSize);\n}\n\nfunction addFileEntry(zipEntry, fileEntry, onend, onerror) {\n  function getChildren(fileEntry, callback) {\n    if (fileEntry.isDirectory)\n      fileEntry.createReader().readEntries(callback);\n    if (fileEntry.isFile)\n      callback([]);\n  }\n\n  function process(zipEntry, fileEntry, onend) {\n    getChildren(fileEntry, function(children) {\n      var childIndex = 0;\n\n      function addChild(child) {\n        function nextChild(childFileEntry) {\n          process(childFileEntry, child, function() {\n            childIndex++;\n            processChild();\n          });\n        }\n\n        if (child.isDirectory)\n          nextChild(zipEntry.addDirectory(child.name));\n        if (child.isFile)\n          child.file(function(file) {\n            var childZipEntry = zipEntry.addBlob(child.name, file);\n            childZipEntry.uncompressedSize = file.size;\n            nextChild(childZipEntry);\n          }, onerror);\n      }\n\n      function processChild() {\n        var child = children[childIndex];\n        if (child)\n          addChild(child);\n        else\n          onend();\n      }\n\n      processChild();\n    });\n  }\n\n  if (fileEntry.isDirectory)\n    process(zipEntry, fileEntry, onend);\n  else\n    fileEntry.file(function(file) {\n      zipEntry.addBlob(fileEntry.name, file);\n      onend();\n    }, onerror);\n}\n\nfunction getFileEntry(fileEntry, entry, onend, onprogress, onerror, totalSize, checkCrc32) {\n  var currentIndex = 0;\n\n  function process(fileEntry, entry, onend, onprogress, onerror, totalSize) {\n    var childIndex = 0;\n\n    function addChild(child) {\n      function nextChild(childFileEntry) {\n        currentIndex += child.uncompressedSize || 0;\n        process(childFileEntry, child, function() {\n          childIndex++;\n          processChild();\n        }, onprogress, onerror, totalSize);\n      }\n\n      if (child.directory)\n        fileEntry.getDirectory(child.name, {\n          create : true\n        }, nextChild, onerror);\n      else\n        fileEntry.getFile(child.name, {\n          create : true\n        }, function(file) {\n          child.getData(new zip.FileWriter(file, zip.getMimeType(child.name)), nextChild, function(index) {\n            if (onprogress)\n              onprogress(currentIndex + index, totalSize);\n          }, checkCrc32);\n        }, onerror);\n    }\n\n    function processChild() {\n      var child = entry.children[childIndex];\n      if (child)\n        addChild(child);\n      else\n        onend();\n    }\n\n    processChild();\n  }\n\n  if (entry.directory)\n    process(fileEntry, entry, onend, onprogress, onerror, totalSize);\n  else\n    entry.getData(new zip.FileWriter(fileEntry, zip.getMimeType(entry.name)), onend, onprogress, checkCrc32);\n}\n\nfunction resetFS(fs) {\n  fs.entries = [];\n  fs.root = new ZipDirectoryEntry(fs);\n}\n\nfunction bufferedCopy(reader, writer, onend, onprogress, onerror) {\n  var chunkIndex = 0;\n\n  function stepCopy() {\n    var index = chunkIndex * CHUNK_SIZE;\n    if (onprogress)\n      onprogress(index, reader.size);\n    if (index < reader.size)\n      reader.readUint8Array(index, Math.min(CHUNK_SIZE, reader.size - index), function(array) {\n        writer.writeUint8Array(new Uint8Array(array), function() {\n          chunkIndex++;\n          stepCopy();\n        });\n      }, onerror);\n    else\n      writer.getData(onend);\n  }\n\n  stepCopy();\n}\n\nfunction addChild(parent, name, params, directory) {\n  if (parent.directory)\n    return directory ? new ZipDirectoryEntry(parent.fs, name, params, parent) : new ZipFileEntry(parent.fs, name, params, parent);\n  else\n    throw \"Parent entry is not a directory.\";\n}\n\nfunction ZipEntry() {\n}\n\nZipEntry.prototype = {\n  init : function(fs, name, params, parent) {\n    var that = this;\n    if (fs.root && parent && parent.getChildByName(name))\n      throw \"Entry filename already exists.\";\n    if (!params)\n      params = {};\n    that.fs = fs;\n    that.name = name;\n    that.id = fs.entries.length;\n    that.parent = parent;\n    that.children = [];\n    that.zipVersion = params.zipVersion || 0x14;\n    that.uncompressedSize = 0;\n    fs.entries.push(that);\n    if (parent)\n      that.parent.children.push(that);\n  },\n  getFileEntry : function(fileEntry, onend, onprogress, onerror, checkCrc32) {\n    var that = this;\n    initReaders(that, function() {\n      getFileEntry(fileEntry, that, onend, onprogress, onerror, getTotalSize(that), checkCrc32);\n    }, onerror);\n  },\n  moveTo : function(target) {\n    var that = this;\n    if (target.directory) {\n      if (!target.isDescendantOf(that)) {\n        if (that != target) {\n          if (target.getChildByName(that.name))\n            throw \"Entry filename already exists.\";\n          detach(that);\n          that.parent = target;\n          target.children.push(that);\n        }\n      } else\n        throw \"Entry is a ancestor of target entry.\";\n    } else\n      throw \"Target entry is not a directory.\";\n  },\n  getFullname : function() {\n    var that = this, fullname = that.name, entry = that.parent;\n    while (entry) {\n      fullname = (entry.name ? entry.name + \"/\" : \"\") + fullname;\n      entry = entry.parent;\n    }\n    return fullname;\n  },\n  isDescendantOf : function(ancestor) {\n    var entry = this.parent;\n    while (entry && entry.id != ancestor.id)\n      entry = entry.parent;\n    return !!entry;\n  }\n};\nZipEntry.prototype.constructor = ZipEntry;\n\nvar ZipFileEntryProto;\n\nfunction ZipFileEntry(fs, name, params, parent) {\n  var that = this;\n  ZipEntry.prototype.init.call(that, fs, name, params, parent);\n  that.Reader = params.Reader;\n  that.Writer = params.Writer;\n  that.data = params.data;\n  if (params.getData) {\n    that.getData = params.getData;\n  }\n}\n\nZipFileEntry.prototype = ZipFileEntryProto = new ZipEntry();\nZipFileEntryProto.constructor = ZipFileEntry;\nZipFileEntryProto.getData = function(writer, onend, onprogress, onerror) {\n  var that = this;\n  if (!writer || (writer.constructor == that.Writer && that.data))\n    onend(that.data);\n  else {\n    if (!that.reader)\n      that.reader = new that.Reader(that.data, onerror);\n    that.reader.init(function() {\n      writer.init(function() {\n        bufferedCopy(that.reader, writer, onend, onprogress, onerror);\n      }, onerror);\n    });\n  }\n};\n\nZipFileEntryProto.getText = function(onend, onprogress, checkCrc32, encoding) {\n  this.getData(new TextWriter(encoding), onend, onprogress, checkCrc32);\n};\nZipFileEntryProto.getBlob = function(mimeType, onend, onprogress, checkCrc32) {\n  this.getData(new BlobWriter(mimeType), onend, onprogress, checkCrc32);\n};\nZipFileEntryProto.getData64URI = function(mimeType, onend, onprogress, checkCrc32) {\n  this.getData(new Data64URIWriter(mimeType), onend, onprogress, checkCrc32);\n};\n\nvar ZipDirectoryEntryProto;\n\nfunction ZipDirectoryEntry(fs, name, params, parent) {\n  var that = this;\n  ZipEntry.prototype.init.call(that, fs, name, params, parent);\n  that.directory = true;\n}\n\nZipDirectoryEntry.prototype = ZipDirectoryEntryProto = new ZipEntry();\nZipDirectoryEntryProto.constructor = ZipDirectoryEntry;\nZipDirectoryEntryProto.addDirectory = function(name) {\n  return addChild(this, name, null, true);\n};\nZipDirectoryEntryProto.addText = function(name, text) {\n  return addChild(this, name, {\n    data : text,\n    Reader : TextReader,\n    Writer : TextWriter\n  });\n};\nZipDirectoryEntryProto.addBlob = function(name, blob) {\n  return addChild(this, name, {\n    data : blob,\n    Reader : BlobReader,\n    Writer : BlobWriter\n  });\n};\nZipDirectoryEntryProto.addData64URI = function(name, dataURI) {\n  return addChild(this, name, {\n    data : dataURI,\n    Reader : Data64URIReader,\n    Writer : Data64URIWriter\n  });\n};\nZipDirectoryEntryProto.addFileEntry = function(fileEntry, onend, onerror) {\n  addFileEntry(this, fileEntry, onend, onerror);\n};\nZipDirectoryEntryProto.addData = function(name, params) {\n  return addChild(this, name, params);\n};\nZipDirectoryEntryProto.importBlob = function(blob, onend, onerror) {\n  this.importZip(new BlobReader(blob), onend, onerror);\n};\nZipDirectoryEntryProto.importText = function(text, onend, onerror) {\n  this.importZip(new TextReader(text), onend, onerror);\n};\nZipDirectoryEntryProto.importData64URI = function(dataURI, onend, onerror) {\n  this.importZip(new Data64URIReader(dataURI), onend, onerror);\n};\nZipDirectoryEntryProto.exportBlob = function(onend, onprogress, onerror) {\n  this.exportZip(new BlobWriter(\"application/zip\"), onend, onprogress, onerror);\n};\nZipDirectoryEntryProto.exportText = function(onend, onprogress, onerror) {\n  this.exportZip(new TextWriter(), onend, onprogress, onerror);\n};\nZipDirectoryEntryProto.exportFileEntry = function(fileEntry, onend, onprogress, onerror) {\n  this.exportZip(new zip.FileWriter(fileEntry, \"application/zip\"), onend, onprogress, onerror);\n};\nZipDirectoryEntryProto.exportData64URI = function(onend, onprogress, onerror) {\n  this.exportZip(new Data64URIWriter(\"application/zip\"), onend, onprogress, onerror);\n};\nZipDirectoryEntryProto.importZip = function(reader, onend, onerror) {\n  var that = this;\n  createReader(reader, function(zipReader) {\n    zipReader.getEntries(function(entries) {\n      entries.forEach(function(entry) {\n        var parent = that, path = entry.filename.split(\"/\"), name = path.pop();\n        path.forEach(function(pathPart) {\n          parent = parent.getChildByName(pathPart) || new ZipDirectoryEntry(that.fs, pathPart, null, parent);\n        });\n        if (!entry.directory)\n          addChild(parent, name, {\n            data : entry,\n            Reader : ZipBlobReader\n          });\n      });\n      onend();\n    });\n  }, onerror);\n};\nZipDirectoryEntryProto.exportZip = function(writer, onend, onprogress, onerror) {\n  var that = this;\n  initReaders(that, function() {\n    createWriter(writer, function(zipWriter) {\n      exportZip(zipWriter, that, function() {\n        zipWriter.close(onend);\n      }, onprogress, getTotalSize(that));\n    }, onerror);\n  }, onerror);\n};\nZipDirectoryEntryProto.getChildByName = function(name) {\n  var childIndex, child, that = this;\n  for (childIndex = 0; childIndex < that.children.length; childIndex++) {\n    child = that.children[childIndex];\n    if (child.name == name)\n      return child;\n  }\n};\n\nfunction FS() {\n  resetFS(this);\n}\nFS.prototype = {\n  remove : function(entry) {\n    detach(entry);\n    this.entries[entry.id] = null;\n  },\n  find : function(fullname) {\n    var index, path = fullname.split(\"/\"), node = this.root;\n    for (index = 0; node && index < path.length; index++)\n      node = node.getChildByName(path[index]);\n    return node;\n  },\n  getById : function(id) {\n    return this.entries[id];\n  },\n  importBlob : function(blob, onend, onerror) {\n    resetFS(this);\n    this.root.importBlob(blob, onend, onerror);\n  },\n  importText : function(text, onend, onerror) {\n    resetFS(this);\n    this.root.importText(text, onend, onerror);\n  },\n  importData64URI : function(dataURI, onend, onerror) {\n    resetFS(this);\n    this.root.importData64URI(dataURI, onend, onerror);\n  },\n  exportBlob : function(onend, onprogress, onerror) {\n    this.root.exportBlob(onend, onprogress, onerror);\n  },\n  exportText : function(onend, onprogress, onerror) {\n    this.root.exportText(onend, onprogress, onerror);\n  },\n  exportFileEntry : function(fileEntry, onend, onprogress, onerror) {\n    this.root.exportFileEntry(fileEntry, onend, onprogress, onerror);\n  },\n  exportData64URI : function(onend, onprogress, onerror) {\n    this.root.exportData64URI(onend, onprogress, onerror);\n  }\n};\n\nzip.getMimeType = function() {\n  return \"application/octet-stream\";\n};\n\nexport const fs = {\n  FS : FS,\n  ZipDirectoryEntry : ZipDirectoryEntry,\n  ZipFileEntry : ZipFileEntry\n};\n","import zip from 'zip-js-esm';\nimport { fs } from './lib/zip-fs.js';\n\nzip.useWebWorkers = false;\n\n/**\n * Watches an element for file drops, parses to create a filemap hierarchy,\n * and emits the result.\n */\nclass SimpleDropzone {\n\n  /**\n   * @param  {Element} el\n   * @param  {Element} inputEl\n   */\n  constructor (el, inputEl) {\n    this.el = el;\n    this.inputEl = inputEl;\n\n    this.listeners = {\n      drop: [],\n      dropstart: [],\n      droperror: []\n    };\n\n    this._onDragover = this._onDragover.bind(this);\n    this._onDrop = this._onDrop.bind(this);\n    this._onSelect = this._onSelect.bind(this);\n\n    el.addEventListener('dragover', this._onDragover, false);\n    el.addEventListener('drop', this._onDrop, false);\n    inputEl.addEventListener('change', this._onSelect);\n  }\n\n  /**\n   * @param  {string}   type\n   * @param  {Function} callback\n   * @return {SimpleDropzone}\n   */\n  on (type, callback) {\n    this.listeners[type].push(callback);\n    return this;\n  }\n\n  /**\n   * @param  {string} type\n   * @param  {Object} data\n   * @return {SimpleDropzone}\n   */\n  _emit (type, data) {\n    this.listeners[type]\n      .forEach((callback) => callback(data));\n    return this;\n  }\n\n  /**\n   * Destroys the instance.\n   */\n  destroy () {\n    const el = this.el;\n    const inputEl = this.inputEl;\n\n    el.removeEventListener('dragover', this._onDragover, false);\n    el.removeEventListener('drop', this._onDrop, false);\n    inputEl.removeEventListener('change', this._onSelect);\n\n    delete this.el;\n    delete this.inputEl;\n    delete this.listeners;\n  }\n\n  /**\n   * References (and horror):\n   * - https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/items\n   * - https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/files\n   * - https://code.flickr.net/2012/12/10/drag-n-drop/\n   * - https://stackoverflow.com/q/44842247/1314762\n   *\n   * @param  {Event} e\n   */\n  _onDrop (e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    this._emit('dropstart');\n\n    const files = Array.from(e.dataTransfer.files || []);\n    const items = Array.from(e.dataTransfer.items || []);\n\n    if (files.length === 0 && items.length === 0) {\n      this._fail('Required drag-and-drop APIs are not supported in this browser.');\n      return;\n    }\n\n    // Prefer .items, which allow folder traversal if necessary.\n    if (items.length > 0) {\n      const entries = items.map((item) => item.webkitGetAsEntry());\n\n      if (entries[0].name.match(/\\.zip$/)) {\n        this._loadZip(items[0].getAsFile());\n      } else {\n        this._loadNextEntry(new Map(), entries);\n      }\n\n      return;\n    }\n\n    // Fall back to .files, since folders can't be traversed.\n    if (files.length === 1 && files[0].name.match(/\\.zip$/)) {\n      this._loadZip(files[0]);\n    }\n    this._emit('drop', {files: new Map(files.map((file) => [file.name, file]))});\n  }\n\n  /**\n   * @param  {Event} e\n   */\n  _onDragover (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.\n  }\n\n  /**\n   * @param  {Event} e\n   */\n  _onSelect (e) {\n    this._emit('dropstart');\n\n    // HTML file inputs do not seem to support folders, so assume this is a flat file list.\n    const files = [].slice.call(this.inputEl.files);\n\n    // Automatically decompress a zip archive if it is the only file given.\n    if (files.length === 1 && this._isZip(files[0])) {\n      this._loadZip(files[0]);\n      return;\n    }\n\n    const fileMap = new Map();\n    files.forEach((file) => fileMap.set(file.webkitRelativePath || file.name, file));\n    this._emit('drop', {files: fileMap});\n  }\n\n  /**\n   * Iterates through a list of FileSystemEntry objects, creates the fileMap\n   * tree, and emits the result.\n   * @param  {Map<string, File>} fileMap\n   * @param  {Array<FileSystemEntry>} entries\n   */\n  _loadNextEntry (fileMap, entries) {\n    const entry = entries.pop();\n\n    if (!entry) {\n      this._emit('drop', {files: fileMap});\n      return;\n    }\n\n    if (entry.isFile) {\n      entry.file((file) => {\n        fileMap.set(entry.fullPath, file);\n        this._loadNextEntry(fileMap, entries);\n      }, () => console.error('Could not load file: %s', entry.fullPath));\n    } else if (entry.isDirectory) {\n      // readEntries() must be called repeatedly until it stops returning results.\n      // https://www.w3.org/TR/2012/WD-file-system-api-20120417/#the-directoryreader-interface\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=378883\n      const reader = entry.createReader();\n      const readerCallback = (newEntries) => {\n        if (newEntries.length) {\n          entries = entries.concat(newEntries);\n          reader.readEntries(readerCallback);\n        } else {\n          this._loadNextEntry(fileMap, entries);\n        }\n      };\n      reader.readEntries(readerCallback);\n    } else {\n      console.warn('Unknown asset type: ' + entry.fullPath);\n      this._loadNextEntry(fileMap, entries);\n    }\n  }\n\n  /**\n   * Inflates a File in .ZIP format, creates the fileMap tree, and emits the\n   * result.\n   * @param  {File} file\n   */\n  _loadZip (file) {\n    const pending = [];\n    const fileMap = new Map();\n    const archive = new fs.FS();\n\n    const traverse = (node) => {\n      if (node.directory) {\n        node.children.forEach(traverse);\n      } else if (node.name[0] !== '.') {\n        pending.push(new Promise((resolve) => {\n          node.getData(new zip.BlobWriter(), (blob) => {\n            blob.name = node.name;\n            fileMap.set(node.getFullname(), blob);\n            resolve();\n          });\n        }));\n      }\n    };\n\n    archive.importBlob(file, () => {\n      traverse(archive.root);\n      Promise.all(pending).then(() => {\n        this._emit('drop', {files: fileMap, archive: file});\n      });\n    });\n  }\n\n  /**\n   * @param  {File} file\n   * @return {Boolean}\n   */\n  _isZip (file) {\n    return file.type === 'application/zip' || file.name.match(/\\.zip$/);\n  }\n\n  /**\n   * @param {string} message\n   * @throws\n   */\n  _fail (message) {\n    this._emit('droperror', {message: message});\n  }\n}\n\nexport { SimpleDropzone };\n","\nimport * as THREE from 'three';\n\nexport class ThreeRenderer {\n  private gl: any;\n  private canvas: any | undefined;\n\n  private ibl?: THREE.Texture;\n  private pmremGenerator: THREE.PMREMGenerator;\n  private scene?: THREE.Scene;\n  private renderer: THREE.WebGLRenderer;\n\n  private isRendering = false;\n\n  private dirty = false;\n\n  public set exposure(val: number) {\n    this.renderer.toneMappingExposure = val;\n    this.setBackground();\n  }\n  public get exposure() {\n    return this.renderer.toneMappingExposure;\n  }\n\n  private tonemappingModes = new Map<string, THREE.ToneMapping>([\n    [\"None\", THREE.LinearToneMapping],\n    [\"Reinhard\", THREE.ReinhardToneMapping],\n    [\"Cineon\", THREE.CineonToneMapping],\n    [\"AcesFilm\", THREE.ACESFilmicToneMapping]\n  ]);\n\n  set tonemapping(val: string) {\n    if(this.tonemappingModes.has(val)) {\n      this.renderer.toneMapping = this.tonemappingModes.get(val)!;\n      this.dirty = true;\n    }\n  }\n\n  private _backgroundColor = [0.0, 0.0, 0.0];\n  public get backgroundColor() {\n    return this._backgroundColor;\n  }\n  public set backgroundColor(val) {\n    this._backgroundColor = val;\n    this.setBackground();\n  }\n\n  private _showBackground = true;\n  public get showBackground() {\n    return this._showBackground;\n  }\n  public set showBackground(val) {\n    this._showBackground = val;\n    this.setBackground();\n  }\n\n  private setBackground() {\n    if (!this.scene) {\n      return;\n    }\n    if(this._showBackground) {\n      this.scene.background = this.ibl!;\n    }\n    else {\n      this.scene.background = new THREE.Color(\n        this._backgroundColor[0] * this.renderer.toneMappingExposure,\n        this._backgroundColor[1] * this.renderer.toneMappingExposure,\n        this._backgroundColor[2] * this.renderer.toneMappingExposure);\n    }\n  }\n\n  useIBL(flag: boolean) {\n    if (!this.scene) {\n      return;\n    }\n    if (flag) {\n      this.scene!.environment = this.ibl!;\n      this.showBackground = true ;\n    } else {\n      this.scene.environment = null;\n      this.showBackground = false ;\n    }\n  }\n\n  setPixelRatio(val: number) {\n    this.renderer.setPixelRatio(val);\n  }\n\n  constructor(parameters?: THREE.WebGLRendererParameters) {\n    this.renderer = new THREE.WebGLRenderer(parameters);\n    // this.renderer.setSize(canvas.width, canvas.height);'\n    this.renderer.toneMapping = THREE.LinearToneMapping;\n    this.renderer.outputEncoding = THREE.sRGBEncoding;\n    this.renderer.physicallyCorrectLights = true;\n\n    this.pmremGenerator = new THREE.PMREMGenerator(this.renderer);\n    this.pmremGenerator.compileEquirectangularShader();\n  }\n\n  stopRendering() {\n    this.isRendering = false;\n  }\n\n  render(camera: THREE.PerspectiveCamera, frameFinishedCB?: Function) {\n    if (camera instanceof THREE.Camera === false) {\n      console.error('PathtracingRenderer.render: camera is not an instance of THREE.Camera.');\n      return;\n    }\n    this.isRendering = true;\n\n    let renderFrame = () => {\n      if (!this.isRendering) {\n        return;\n      }\n\n      if(this.dirty) {\n        this.renderer.compile(this.scene!, camera);\n        this.dirty = false;\n      }\n\n      this.renderer.render(this.scene!, camera);\n      if (frameFinishedCB) {\n        frameFinishedCB();\n      }\n      requestAnimationFrame(renderFrame);\n    };\n\n    requestAnimationFrame(renderFrame); // start render loop\n  }\n\n  resize(width: number, height: number) {\n    this.renderer.setSize(width, height);\n  }\n\n  private updateSceneIbl() {\n    if(!this.scene || !this.ibl) return;\n    this.scene.background = this.ibl;\n    this.scene.environment  = this.ibl;\n  }\n\n  setIBL(tex: any) {\n    if (this.ibl !== undefined) {\n      this.ibl.dispose();\n    }\n\n    this.ibl = this.pmremGenerator.fromEquirectangular(tex).texture;\n\n    this.updateSceneIbl();\n  }\n\n  setScene(scene: THREE.Scene) {\n    this.scene = scene;\n    this.updateSceneIbl();\n  }\n\n}","\nimport * as THREE from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { KTX2Loader } from 'three/examples/jsm/loaders/KTX2Loader';\nimport { WebIO, VertexLayout, Document } from '@gltf-transform/core';\nimport { ALL_EXTENSIONS } from '@gltf-transform/extensions';\nimport { weld, dequantize, reorder } from '@gltf-transform/functions';\nimport { MeshoptDecoder, MeshoptEncoder } from 'meshoptimizer';\n\n\nexport async function loadSceneFromBlobs(files: [string, File][], autoscale?: boolean) {\n  await MeshoptDecoder.ready;\n  await MeshoptEncoder.ready;\n\n  const io = new WebIO()\n    .registerExtensions(ALL_EXTENSIONS)\n    .setVertexLayout(VertexLayout.SEPARATE) // INTERLEAVED (default) or SEPARATE\n    .registerDependencies({\n      'meshopt.decoder': MeshoptDecoder,\n      'meshopt.encoder': MeshoptEncoder,\n    });\n\n  function getFileExtension(filename: string) {\n    return filename.split('.').pop();\n  }\n\n  async function createJSONDocument(uris: [string, File][]) {\n    const binaries: { [id: string]: Uint8Array; } = {};\n    let json: any = {}\n\n    for (let [path, file] of uris) {\n      const buffer = await file.arrayBuffer();\n      const ext = getFileExtension(file.name);\n\n      if (ext == \"gltf\") {\n        const data = await file.text();\n        json = JSON.parse(data);\n      } else {\n        binaries[path.slice(1)] = new Uint8Array(buffer);\n      }\n    }\n    const jsonDocument = {\n      json: json,\n      resources: binaries\n    };\n\n    return jsonDocument;\n  }\n\n  let doc = {} as Document\n  for (let f of files) {\n    const file = f[1];\n    if (getFileExtension(file.name) === \"glb\") {\n      const buffer = await file.arrayBuffer();\n      doc = await io.readBinary(new Uint8Array(buffer));\n    }\n\n    if (getFileExtension(file.name) === \"gltf\") {\n      const jsonDoc = await createJSONDocument(files);\n      doc = await io.readJSON(jsonDoc);\n    }\n  }\n\n  await doc.transform(\n    dequantize(),\n    weld()\n  );\n\n  const processed_glb = await io.writeBinary(doc);\n  return loadScene(processed_glb.buffer, autoscale);\n}\n\nexport async function loadSceneFromUrl(url: string, autoscale?: boolean) {\n  await MeshoptDecoder.ready;\n  await MeshoptEncoder.ready;\n\n  const io = new WebIO()\n    .registerExtensions(ALL_EXTENSIONS)\n    .setVertexLayout(VertexLayout.SEPARATE) // INTERLEAVED (default) or SEPARATE\n    .registerDependencies({\n      'meshopt.decoder': MeshoptDecoder,\n      'meshopt.encoder': MeshoptEncoder,\n    });\n\n  const doc = await io.read(url);\n  await doc.transform(\n    dequantize(),\n    weld()\n  );\n  const glb = await io.writeBinary(doc);\n  return loadScene(glb.buffer, autoscale);\n}\n\nfunction loadScene(glb: ArrayBuffer, autoscale?: boolean) {\n  var loader = new GLTFLoader();\n  loader.setMeshoptDecoder(MeshoptDecoder);\n\n  var ktx2Loader = new KTX2Loader();\n  ktx2Loader.setTranscoderPath( 'three/examples/js/libs/basis/' );\n  loader.setKTX2Loader(ktx2Loader);\n\n  return new Promise((resolve, reject) => {\n\n    loader.parse(glb, \"\", (gltf) => {\n\n      const scene = gltf.scene || gltf.scenes[0];\n\n      if (!scene) {\n        // Valid, but not supported by this viewer.\n        reject(new Error(\n          'This model contains no scene, and cannot be viewed.'\n        ));\n      }\n\n      // Normalize scene dimensions (needed for easy rt precision control)\n      if (autoscale) {\n        var bbox = new THREE.Box3().setFromObject(scene);\n        const minValue = Math.min(bbox.min.x, Math.min(bbox.min.y, bbox.min.z));\n        const maxValue = Math.max(bbox.max.x, Math.max(bbox.max.y, bbox.max.z));\n        const deltaValue = maxValue - minValue;\n        let scale = 1.0 / deltaValue;\n        scene.scale.set(scale, scale, scale);\n      }\n\n      // scene.matrixAutoUpdate = false;\n      scene.updateMatrixWorld();\n      resolve(gltf);\n    }, (error) => {\n      reject(new Error('Error loading glTF scene: ' + error));\n    });\n  });\n}","/**\n * Loader for KTX 2.0 GPU Texture containers.\n *\n * KTX 2.0 is a container format for various GPU texture formats. The loader\n * supports Basis Universal GPU textures, which can be quickly transcoded to\n * a wide variety of GPU texture compression formats. While KTX 2.0 also allows\n * other hardware-specific formats, this loader does not yet parse them.\n *\n * References:\n * - KTX: http://github.khronos.org/KTX-Specification/\n * - DFD: https://www.khronos.org/registry/DataFormat/specs/1.3/dataformat.1.3.html#basicdescriptor\n */\n\nimport {\n\tCompressedTexture,\n\tFileLoader,\n\tLinearEncoding,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLoader,\n\tRGBAFormat,\n\tRGBA_ASTC_4x4_Format,\n\tRGBA_BPTC_Format,\n\tRGBA_ETC2_EAC_Format,\n\tRGBA_PVRTC_4BPPV1_Format,\n\tRGBA_S3TC_DXT5_Format,\n\tRGB_ETC1_Format,\n\tRGB_ETC2_Format,\n\tRGB_PVRTC_4BPPV1_Format,\n\tRGB_S3TC_DXT1_Format,\n\tsRGBEncoding,\n\tUnsignedByteType\n} from 'three';\nimport { WorkerPool } from '../utils/WorkerPool.js';\n\nconst KTX2TransferSRGB = 2;\nconst KTX2_ALPHA_PREMULTIPLIED = 1;\nconst _taskCache = new WeakMap();\n\nlet _activeLoaders = 0;\n\nclass KTX2Loader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.transcoderPath = '';\n\t\tthis.transcoderBinary = null;\n\t\tthis.transcoderPending = null;\n\n\t\tthis.workerPool = new WorkerPool();\n\t\tthis.workerSourceURL = '';\n\t\tthis.workerConfig = null;\n\n\t\tif ( typeof MSC_TRANSCODER !== 'undefined' ) {\n\n\t\t\tconsole.warn(\n\n\t\t\t\t'THREE.KTX2Loader: Please update to latest \"basis_transcoder\".'\n\t\t\t\t+ ' \"msc_basis_transcoder\" is no longer supported in three.js r125+.'\n\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\tsetTranscoderPath( path ) {\n\n\t\tthis.transcoderPath = path;\n\n\t\treturn this;\n\n\t}\n\n\tsetWorkerLimit( num ) {\n\n\t\tthis.workerPool.setWorkerLimit( num );\n\n\t\treturn this;\n\n\t}\n\n\tdetectSupport( renderer ) {\n\n\t\tthis.workerConfig = {\n\t\t\tastcSupported: renderer.extensions.has( 'WEBGL_compressed_texture_astc' ),\n\t\t\tetc1Supported: renderer.extensions.has( 'WEBGL_compressed_texture_etc1' ),\n\t\t\tetc2Supported: renderer.extensions.has( 'WEBGL_compressed_texture_etc' ),\n\t\t\tdxtSupported: renderer.extensions.has( 'WEBGL_compressed_texture_s3tc' ),\n\t\t\tbptcSupported: renderer.extensions.has( 'EXT_texture_compression_bptc' ),\n\t\t\tpvrtcSupported: renderer.extensions.has( 'WEBGL_compressed_texture_pvrtc' )\n\t\t\t\t|| renderer.extensions.has( 'WEBKIT_WEBGL_compressed_texture_pvrtc' )\n\t\t};\n\n\n\t\tif ( renderer.capabilities.isWebGL2 ) {\n\n\t\t\t// https://github.com/mrdoob/three.js/pull/22928\n\t\t\tthis.workerConfig.etc1Supported = false;\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tinit() {\n\n\t\tif ( ! this.transcoderPending ) {\n\n\t\t\t// Load transcoder wrapper.\n\t\t\tconst jsLoader = new FileLoader( this.manager );\n\t\t\tjsLoader.setPath( this.transcoderPath );\n\t\t\tjsLoader.setWithCredentials( this.withCredentials );\n\t\t\tconst jsContent = jsLoader.loadAsync( 'basis_transcoder.js' );\n\n\t\t\t// Load transcoder WASM binary.\n\t\t\tconst binaryLoader = new FileLoader( this.manager );\n\t\t\tbinaryLoader.setPath( this.transcoderPath );\n\t\t\tbinaryLoader.setResponseType( 'arraybuffer' );\n\t\t\tbinaryLoader.setWithCredentials( this.withCredentials );\n\t\t\tconst binaryContent = binaryLoader.loadAsync( 'basis_transcoder.wasm' );\n\n\t\t\tthis.transcoderPending = Promise.all( [ jsContent, binaryContent ] )\n\t\t\t\t.then( ( [ jsContent, binaryContent ] ) => {\n\n\t\t\t\t\tconst fn = KTX2Loader.BasisWorker.toString();\n\n\t\t\t\t\tconst body = [\n\t\t\t\t\t\t'/* constants */',\n\t\t\t\t\t\t'let _EngineFormat = ' + JSON.stringify( KTX2Loader.EngineFormat ),\n\t\t\t\t\t\t'let _TranscoderFormat = ' + JSON.stringify( KTX2Loader.TranscoderFormat ),\n\t\t\t\t\t\t'let _BasisFormat = ' + JSON.stringify( KTX2Loader.BasisFormat ),\n\t\t\t\t\t\t'/* basis_transcoder.js */',\n\t\t\t\t\t\tjsContent,\n\t\t\t\t\t\t'/* worker */',\n\t\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t\t].join( '\\n' );\n\n\t\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\t\t\t\t\tthis.transcoderBinary = binaryContent;\n\n\t\t\t\t\tthis.workerPool.setWorkerCreator( () => {\n\n\t\t\t\t\t\tconst worker = new Worker( this.workerSourceURL );\n\t\t\t\t\t\tconst transcoderBinary = this.transcoderBinary.slice( 0 );\n\n\t\t\t\t\t\tworker.postMessage( { type: 'init', config: this.workerConfig, transcoderBinary }, [ transcoderBinary ] );\n\n\t\t\t\t\t\treturn worker;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\tif ( _activeLoaders > 0 ) {\n\n\t\t\t\t// Each instance loads a transcoder and allocates workers, increasing network and memory cost.\n\n\t\t\t\tconsole.warn(\n\n\t\t\t\t\t'THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues.'\n\t\t\t\t\t+ ' Use a single KTX2Loader instance, or call .dispose() on old instances.'\n\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\t_activeLoaders ++;\n\n\t\t}\n\n\t\treturn this.transcoderPending;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tif ( this.workerConfig === null ) {\n\n\t\t\tthrow new Error( 'THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.' );\n\n\t\t}\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tconst texture = new CompressedTexture();\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\n\t\t\t// again from this thread.\n\t\t\tif ( _taskCache.has( buffer ) ) {\n\n\t\t\t\tconst cachedTask = _taskCache.get( buffer );\n\n\t\t\t\treturn cachedTask.promise.then( onLoad ).catch( onError );\n\n\t\t\t}\n\n\t\t\tthis._createTexture( [ buffer ] )\n\t\t\t\t.then( function ( _texture ) {\n\n\t\t\t\t\ttexture.copy( _texture );\n\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\tif ( onLoad ) onLoad( texture );\n\n\t\t\t\t} )\n\t\t\t\t.catch( onError );\n\n\t\t}, onProgress, onError );\n\n\t\treturn texture;\n\n\t}\n\n\t_createTextureFrom( transcodeResult ) {\n\n\t\tconst { mipmaps, width, height, format, type, error, dfdTransferFn, dfdFlags } = transcodeResult;\n\n\t\tif ( type === 'error' ) return Promise.reject( error );\n\n\t\tconst texture = new CompressedTexture( mipmaps, width, height, format, UnsignedByteType );\n\t\ttexture.minFilter = mipmaps.length === 1 ? LinearFilter : LinearMipmapLinearFilter;\n\t\ttexture.magFilter = LinearFilter;\n\t\ttexture.generateMipmaps = false;\n\t\ttexture.needsUpdate = true;\n\t\ttexture.encoding = dfdTransferFn === KTX2TransferSRGB ? sRGBEncoding : LinearEncoding;\n\t\ttexture.premultiplyAlpha = !! ( dfdFlags & KTX2_ALPHA_PREMULTIPLIED );\n\n\t\treturn texture;\n\n\t}\n\n\t/**\n\t * @param {ArrayBuffer[]} buffers\n\t * @param {object?} config\n\t * @return {Promise<CompressedTexture>}\n\t */\n\t_createTexture( buffers, config = {} ) {\n\n\t\tconst taskConfig = config;\n\t\tconst texturePending = this.init().then( () => {\n\n\t\t\treturn this.workerPool.postMessage( { type: 'transcode', buffers, taskConfig: taskConfig }, buffers );\n\n\t\t} ).then( ( e ) => this._createTextureFrom( e.data ) );\n\n\t\t// Cache the task result.\n\t\t_taskCache.set( buffers[ 0 ], { promise: texturePending } );\n\n\t\treturn texturePending;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.workerPool.dispose();\n\t\tif ( this.workerSourceURL ) URL.revokeObjectURL( this.workerSourceURL );\n\n\t\t_activeLoaders --;\n\n\t\treturn this;\n\n\t}\n\n}\n\n\n/* CONSTANTS */\n\nKTX2Loader.BasisFormat = {\n\tETC1S: 0,\n\tUASTC_4x4: 1,\n};\n\nKTX2Loader.TranscoderFormat = {\n\tETC1: 0,\n\tETC2: 1,\n\tBC1: 2,\n\tBC3: 3,\n\tBC4: 4,\n\tBC5: 5,\n\tBC7_M6_OPAQUE_ONLY: 6,\n\tBC7_M5: 7,\n\tPVRTC1_4_RGB: 8,\n\tPVRTC1_4_RGBA: 9,\n\tASTC_4x4: 10,\n\tATC_RGB: 11,\n\tATC_RGBA_INTERPOLATED_ALPHA: 12,\n\tRGBA32: 13,\n\tRGB565: 14,\n\tBGR565: 15,\n\tRGBA4444: 16,\n};\n\nKTX2Loader.EngineFormat = {\n\tRGBAFormat: RGBAFormat,\n\tRGBA_ASTC_4x4_Format: RGBA_ASTC_4x4_Format,\n\tRGBA_BPTC_Format: RGBA_BPTC_Format,\n\tRGBA_ETC2_EAC_Format: RGBA_ETC2_EAC_Format,\n\tRGBA_PVRTC_4BPPV1_Format: RGBA_PVRTC_4BPPV1_Format,\n\tRGBA_S3TC_DXT5_Format: RGBA_S3TC_DXT5_Format,\n\tRGB_ETC1_Format: RGB_ETC1_Format,\n\tRGB_ETC2_Format: RGB_ETC2_Format,\n\tRGB_PVRTC_4BPPV1_Format: RGB_PVRTC_4BPPV1_Format,\n\tRGB_S3TC_DXT1_Format: RGB_S3TC_DXT1_Format,\n};\n\n\n/* WEB WORKER */\n\nKTX2Loader.BasisWorker = function () {\n\n\tlet config;\n\tlet transcoderPending;\n\tlet BasisModule;\n\n\tconst EngineFormat = _EngineFormat; // eslint-disable-line no-undef\n\tconst TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef\n\tconst BasisFormat = _BasisFormat; // eslint-disable-line no-undef\n\n\tself.addEventListener( 'message', function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tconfig = message.config;\n\t\t\t\tinit( message.transcoderBinary );\n\t\t\t\tbreak;\n\n\t\t\tcase 'transcode':\n\t\t\t\ttranscoderPending.then( () => {\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffers[ 0 ] );\n\n\t\t\t\t\t\tconst buffers = [];\n\n\t\t\t\t\t\tfor ( let i = 0; i < mipmaps.length; ++ i ) {\n\n\t\t\t\t\t\t\tbuffers.push( mipmaps[ i ].data.buffer );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\tfunction init( wasmBinary ) {\n\n\t\ttranscoderPending = new Promise( ( resolve ) => {\n\n\t\t\tBasisModule = { wasmBinary, onRuntimeInitialized: resolve };\n\t\t\tBASIS( BasisModule ); // eslint-disable-line no-undef\n\n\t\t} ).then( () => {\n\n\t\t\tBasisModule.initializeBasis();\n\n\t\t\tif ( BasisModule.KTX2File === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tfunction transcode( buffer ) {\n\n\t\tconst ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );\n\n\t\tfunction cleanup() {\n\n\t\t\tktx2File.close();\n\t\t\tktx2File.delete();\n\n\t\t}\n\n\t\tif ( ! ktx2File.isValid() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file' );\n\n\t\t}\n\n\t\tconst basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;\n\t\tconst width = ktx2File.getWidth();\n\t\tconst height = ktx2File.getHeight();\n\t\tconst levels = ktx2File.getLevels();\n\t\tconst hasAlpha = ktx2File.getHasAlpha();\n\t\tconst dfdTransferFn = ktx2File.getDFDTransferFunc();\n\t\tconst dfdFlags = ktx2File.getDFDFlags();\n\n\t\tconst { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );\n\n\t\tif ( ! width || ! height || ! levels ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader:\tInvalid texture' );\n\n\t\t}\n\n\t\tif ( ! ktx2File.startTranscoding() ) {\n\n\t\t\tcleanup();\n\t\t\tthrow new Error( 'THREE.KTX2Loader: .startTranscoding failed' );\n\n\t\t}\n\n\t\tconst mipmaps = [];\n\n\t\tfor ( let mip = 0; mip < levels; mip ++ ) {\n\n\t\t\tconst levelInfo = ktx2File.getImageLevelInfo( mip, 0, 0 );\n\t\t\tconst mipWidth = levelInfo.origWidth;\n\t\t\tconst mipHeight = levelInfo.origHeight;\n\t\t\tconst dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, 0, 0, transcoderFormat ) );\n\n\t\t\tconst status = ktx2File.transcodeImage(\n\t\t\t\tdst,\n\t\t\t\tmip,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\ttranscoderFormat,\n\t\t\t\t0,\n\t\t\t\t- 1,\n\t\t\t\t- 1,\n\t\t\t);\n\n\t\t\tif ( ! status ) {\n\n\t\t\t\tcleanup();\n\t\t\t\tthrow new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );\n\n\t\t\t}\n\n\t\t\tmipmaps.push( { data: dst, width: mipWidth, height: mipHeight } );\n\n\t\t}\n\n\t\tcleanup();\n\n\t\treturn { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };\n\n\t}\n\n\t//\n\n\t// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),\n\t// device capabilities, and texture dimensions. The list below ranks the formats separately\n\t// for ETC1S and UASTC.\n\t//\n\t// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at\n\t// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently\n\t// chooses RGBA32 only as a last resort and does not expose that option to the caller.\n\tconst FORMAT_OPTIONS = [\n\t\t{\n\t\t\tif: 'astcSupported',\n\t\t\tbasisFormat: [ BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],\n\t\t\tpriorityETC1S: Infinity,\n\t\t\tpriorityUASTC: 1,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'bptcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],\n\t\t\tengineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],\n\t\t\tpriorityETC1S: 3,\n\t\t\tpriorityUASTC: 2,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'dxtSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],\n\t\t\tpriorityETC1S: 4,\n\t\t\tpriorityUASTC: 5,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc2Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],\n\t\t\tpriorityETC1S: 1,\n\t\t\tpriorityUASTC: 3,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'etc1Supported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.ETC1 ],\n\t\t\tengineFormat: [ EngineFormat.RGB_ETC1_Format ],\n\t\t\tpriorityETC1S: 2,\n\t\t\tpriorityUASTC: 4,\n\t\t\tneedsPowerOfTwo: false,\n\t\t},\n\t\t{\n\t\t\tif: 'pvrtcSupported',\n\t\t\tbasisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],\n\t\t\ttranscoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],\n\t\t\tengineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],\n\t\t\tpriorityETC1S: 5,\n\t\t\tpriorityUASTC: 6,\n\t\t\tneedsPowerOfTwo: true,\n\t\t},\n\t];\n\n\tconst ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityETC1S - b.priorityETC1S;\n\n\t} );\n\tconst UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {\n\n\t\treturn a.priorityUASTC - b.priorityUASTC;\n\n\t} );\n\n\tfunction getTranscoderFormat( basisFormat, width, height, hasAlpha ) {\n\n\t\tlet transcoderFormat;\n\t\tlet engineFormat;\n\n\t\tconst options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;\n\n\t\tfor ( let i = 0; i < options.length; i ++ ) {\n\n\t\t\tconst opt = options[ i ];\n\n\t\t\tif ( ! config[ opt.if ] ) continue;\n\t\t\tif ( ! opt.basisFormat.includes( basisFormat ) ) continue;\n\t\t\tif ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;\n\t\t\tif ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;\n\n\t\t\ttranscoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];\n\t\t\tengineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];\n\n\t\t\treturn { transcoderFormat, engineFormat };\n\n\t\t}\n\n\t\tconsole.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );\n\n\t\ttranscoderFormat = TranscoderFormat.RGBA32;\n\t\tengineFormat = EngineFormat.RGBAFormat;\n\n\t\treturn { transcoderFormat, engineFormat };\n\n\t}\n\n\tfunction isPowerOfTwo( value ) {\n\n\t\tif ( value <= 2 ) return true;\n\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n\t}\n\n};\n\nexport { KTX2Loader };\n","/**\n * @author Deepkolos / https://github.com/deepkolos\n */\n\nexport class WorkerPool {\n\n\tconstructor( pool = 4 ) {\n\n\t\tthis.pool = pool;\n\t\tthis.queue = [];\n\t\tthis.workers = [];\n\t\tthis.workersResolve = [];\n\t\tthis.workerStatus = 0;\n\n\t}\n\n\t_initWorker( workerId ) {\n\n\t\tif ( ! this.workers[ workerId ] ) {\n\n\t\t\tconst worker = this.workerCreator();\n\t\t\tworker.addEventListener( 'message', this._onMessage.bind( this, workerId ) );\n\t\t\tthis.workers[ workerId ] = worker;\n\n\t\t}\n\n\t}\n\n\t_getIdleWorker() {\n\n\t\tfor ( let i = 0; i < this.pool; i ++ )\n\t\t\tif ( ! ( this.workerStatus & ( 1 << i ) ) ) return i;\n\n\t\treturn - 1;\n\n\t}\n\n\t_onMessage( workerId, msg ) {\n\n\t\tconst resolve = this.workersResolve[ workerId ];\n\t\tresolve && resolve( msg );\n\n\t\tif ( this.queue.length ) {\n\n\t\t\tconst { resolve, msg, transfer } = this.queue.shift();\n\t\t\tthis.workersResolve[ workerId ] = resolve;\n\t\t\tthis.workers[ workerId ].postMessage( msg, transfer );\n\n\t\t} else {\n\n\t\t\tthis.workerStatus ^= 1 << workerId;\n\n\t\t}\n\n\t}\n\n\tsetWorkerCreator( workerCreator ) {\n\n\t\tthis.workerCreator = workerCreator;\n\n\t}\n\n\tsetWorkerLimit( pool ) {\n\n\t\tthis.pool = pool;\n\n\t}\n\n\tpostMessage( msg, transfer ) {\n\n\t\treturn new Promise( ( resolve ) => {\n\n\t\t\tconst workerId = this._getIdleWorker();\n\n\t\t\tif ( workerId !== - 1 ) {\n\n\t\t\t\tthis._initWorker( workerId );\n\t\t\t\tthis.workerStatus |= 1 << workerId;\n\t\t\t\tthis.workersResolve[ workerId ] = resolve;\n\t\t\t\tthis.workers[ workerId ].postMessage( msg, transfer );\n\n\t\t\t} else {\n\n\t\t\t\tthis.queue.push( { resolve, msg, transfer } );\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.workers.forEach( ( worker ) => worker.terminate() );\n\t\tthis.workersResolve.length = 0;\n\t\tthis.workers.length = 0;\n\t\tthis.queue.length = 0;\n\t\tthis.workerStatus = 0;\n\n\t}\n\n}\n","import type { Graph } from './graph';\nimport type { GraphNode } from './graph-node';\nimport type { GraphEdge } from './graph-edge';\n\nexport interface BaseEvent {\n\ttype: string;\n\t[attachment: string]: unknown;\n}\n\nexport interface GraphEvent extends BaseEvent {\n\ttarget: Graph<GraphNode>;\n}\n\nexport interface GraphNodeEvent extends BaseEvent {\n\ttarget: GraphNode;\n}\n\nexport interface GraphEdgeEvent extends BaseEvent {\n\ttarget: GraphEdge<GraphNode, GraphNode>;\n}\n\nexport type EventListener<E> = (event: E) => void;\n\nexport class EventDispatcher<T extends BaseEvent> {\n\tprivate _listeners = {} as Record<string, EventListener<T>[]>;\n\n\taddEventListener(type: string, listener: EventListener<T>): this {\n\t\tconst listeners = this._listeners;\n\n\t\tif (listeners[type] === undefined) {\n\t\t\tlisteners[type] = [] as EventListener<T>[];\n\t\t}\n\n\t\tif (listeners[type].indexOf(listener) === -1) {\n\t\t\tlisteners[type].push(listener);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveEventListener(type: string, listener: EventListener<T>): this {\n\t\tif (this._listeners === undefined) return this;\n\n\t\tconst listeners = this._listeners;\n\t\tconst listenerArray = listeners[type];\n\n\t\tif (listenerArray !== undefined) {\n\t\t\tconst index = listenerArray.indexOf(listener);\n\n\t\t\tif (index !== -1) {\n\t\t\t\tlistenerArray.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tdispatchEvent(event: T): this {\n\t\tif (this._listeners === undefined) return this;\n\n\t\tconst listeners = this._listeners;\n\t\tconst listenerArray = listeners[event.type];\n\n\t\tif (listenerArray !== undefined) {\n\t\t\t// Make a copy, in case listeners are removed while iterating.\n\t\t\tconst array = listenerArray.slice(0);\n\n\t\t\tfor (let i = 0, l = array.length; i < l; i++) {\n\t\t\t\tarray[i].call(this, event as T);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tdispose(): void {\n\t\tfor (const key in this._listeners) {\n\t\t\tdelete this._listeners[key];\n\t\t}\n\t}\n}\n","import { EventDispatcher, GraphEdgeEvent } from './event-dispatcher';\nimport { GraphNode } from './graph-node';\n\n/**\n * Represents a connection between two {@link GraphNode} resources in a {@link Graph}.\n *\n * The left node is considered the owner, and the right node the resource. The\n * owner is responsible for being able find and remove a reference to a resource, given\n * that link. The resource does not hold a reference to the link or to the owner,\n * although that reverse lookup can be done on the graph.\n *\n * @category Graph\n */\nexport class GraphEdge<Parent extends GraphNode, Child extends GraphNode> extends EventDispatcher<GraphEdgeEvent> {\n\tprivate _disposed = false;\n\n\tconstructor(\n\t\tprivate readonly _name: string,\n\t\tprivate readonly _parent: Parent,\n\t\tprivate _child: Child,\n\t\tprivate _attributes: Record<string, unknown> = {}\n\t) {\n\t\tsuper();\n\t\tif (!_parent.isOnGraph(_child)) {\n\t\t\tthrow new Error('Cannot connect disconnected graphs.');\n\t\t}\n\t}\n\n\t/** Name. */\n\tgetName(): string {\n\t\treturn this._name;\n\t}\n\n\t/** Owner node. */\n\tgetParent(): Parent {\n\t\treturn this._parent;\n\t}\n\n\t/** Resource node. */\n\tgetChild(): Child {\n\t\treturn this._child;\n\t}\n\n\t/**\n\t * Sets the child node.\n\t *\n\t * @internal Only {@link Graph} implementations may safely call this method directly. Use\n\t * \t{@link Property.swap} or {@link Graph.swapChild} instead.\n\t */\n\tsetChild(child: Child): this {\n\t\tthis._child = child;\n\t\treturn this;\n\t}\n\n\t/** Attributes of the graph node relationship. */\n\tgetAttributes(): Record<string, unknown> {\n\t\treturn this._attributes;\n\t}\n\n\t/** Destroys a (currently intact) edge, updating both the graph and the owner. */\n\tdispose(): void {\n\t\tif (this._disposed) return;\n\t\tthis._disposed = true;\n\t\tthis.dispatchEvent({ type: 'dispose', target: this });\n\t\tsuper.dispose();\n\t}\n\n\t/** Whether this link has been destroyed. */\n\tisDisposed(): boolean {\n\t\treturn this._disposed;\n\t}\n}\n","import { GraphNodeEvent } from '.';\nimport { EventDispatcher, GraphEdgeEvent, GraphEvent } from './event-dispatcher';\nimport { GraphEdge } from './graph-edge';\nimport { GraphNode } from './graph-node';\n\n/**\n * A graph manages a network of {@link GraphNode} nodes, connected\n * by {@link @Link} edges.\n *\n * @category Graph\n */\nexport class Graph<T extends GraphNode> extends EventDispatcher<GraphEvent | GraphNodeEvent | GraphEdgeEvent> {\n\tprivate _emptySet: Set<GraphEdge<T, T>> = new Set();\n\n\tprivate _edges: Set<GraphEdge<T, T>> = new Set();\n\tprivate _parentEdges: Map<T, Set<GraphEdge<T, T>>> = new Map();\n\tprivate _childEdges: Map<T, Set<GraphEdge<T, T>>> = new Map();\n\n\t/** Returns a list of all parent->child edges on this graph. */\n\tpublic listEdges(): GraphEdge<T, T>[] {\n\t\treturn Array.from(this._edges);\n\t}\n\n\t/** Returns a list of all edges on the graph having the given node as their child. */\n\tpublic listParentEdges(node: T): GraphEdge<T, T>[] {\n\t\treturn Array.from(this._childEdges.get(node) || this._emptySet);\n\t}\n\n\t/** Returns a list of parent nodes for the given child node. */\n\tpublic listParents(node: T): T[] {\n\t\treturn this.listParentEdges(node).map((edge) => edge.getParent());\n\t}\n\n\t/** Returns a list of all edges on the graph having the given node as their parent. */\n\tpublic listChildEdges(node: T): GraphEdge<T, T>[] {\n\t\treturn Array.from(this._parentEdges.get(node) || this._emptySet);\n\t}\n\n\t/** Returns a list of child nodes for the given parent node. */\n\tpublic listChildren(node: T): T[] {\n\t\treturn this.listChildEdges(node).map((edge) => edge.getChild());\n\t}\n\n\tpublic disconnectParents(node: T, filter?: (n: T) => boolean): this {\n\t\tlet edges = this.listParentEdges(node);\n\t\tif (filter) {\n\t\t\tedges = edges.filter((edge) => filter(edge.getParent()));\n\t\t}\n\t\tedges.forEach((edge) => edge.dispose());\n\t\treturn this;\n\t}\n\n\t/**\n\t * Creates a {@link GraphEdge} connecting two {@link GraphNode} instances. Edge is returned\n\t * for the caller to store.\n\t * @param a Owner\n\t * @param b Resource\n\t */\n\tpublic createEdge<A extends T, B extends T>(\n\t\tname: string,\n\t\ta: A,\n\t\tb: B,\n\t\tattributes?: Record<string, unknown>\n\t): GraphEdge<A, B> {\n\t\treturn this._registerEdge(new GraphEdge(name, a, b, attributes)) as GraphEdge<A, B>;\n\t}\n\n\t/**********************************************************************************************\n\t * Internal.\n\t */\n\n\tprivate _registerEdge(edge: GraphEdge<T, T>): GraphEdge<T, T> {\n\t\tthis._edges.add(edge);\n\n\t\tconst parent = edge.getParent();\n\t\tif (!this._parentEdges.has(parent)) this._parentEdges.set(parent, new Set());\n\t\tthis._parentEdges.get(parent)!.add(edge);\n\n\t\tconst child = edge.getChild();\n\t\tif (!this._childEdges.has(child)) this._childEdges.set(child, new Set());\n\t\tthis._childEdges.get(child)!.add(edge);\n\n\t\tedge.addEventListener('dispose', () => this._removeEdge(edge));\n\t\treturn edge;\n\t}\n\n\t/**\n\t * Removes the {@link GraphEdge} from the {@link Graph}. This method should only\n\t * be invoked by the onDispose() listener created in {@link _registerEdge()}. The\n\t * public method of removing an edge is {@link GraphEdge.dispose}.\n\t */\n\tprivate _removeEdge(edge: GraphEdge<T, T>): this {\n\t\tthis._edges.delete(edge);\n\t\tthis._parentEdges.get(edge.getParent())!.delete(edge);\n\t\tthis._childEdges.get(edge.getChild())!.delete(edge);\n\t\treturn this;\n\t}\n}\n","import type { Ref, RefMap } from './constants';\nimport { GraphEdge } from './graph-edge';\n\nexport function isRef(value: Ref | unknown): boolean {\n\treturn value instanceof GraphEdge;\n}\n\nexport function isRefList(value: Ref[] | unknown): boolean {\n\treturn Array.isArray(value) && value[0] instanceof GraphEdge;\n}\n\nexport function isRefMap(value: RefMap | unknown): boolean {\n\treturn !!(value && typeof value === 'object' && Object.values(value)[0] instanceof GraphEdge);\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/ban-types */\nimport { GraphNodeEvent } from '.';\nimport { LiteralKeys, Nullable, Ref, RefMap, RefKeys, RefListKeys, RefMapKeys } from './constants';\nimport { BaseEvent, EventDispatcher } from './event-dispatcher';\nimport { Graph } from './graph';\nimport { GraphEdge } from './graph-edge';\nimport { isRef, isRefList, isRefMap } from './utils';\n\n// References:\n// - https://stackoverflow.com/a/70163679/1314762\n// - https://stackoverflow.com/a/70201805/1314762\n\ntype GraphNodeAttributesInternal<Parent extends GraphNode, Attributes extends {}> = {\n\t[Key in keyof Attributes]: Attributes[Key] extends GraphNode\n\t\t? GraphEdge<Parent, Attributes[Key]>\n\t\t: Attributes[Key] extends GraphNode[]\n\t\t? GraphEdge<Parent, Attributes[Key][number]>[]\n\t\t: Attributes[Key] extends { [key: string]: GraphNode }\n\t\t? Record<string, GraphEdge<Parent, Attributes[Key][string]>>\n\t\t: Attributes[Key];\n};\n\nexport const $attributes = Symbol('attributes');\nexport const $immutableKeys = Symbol('immutableKeys');\n\n/**\n * Represents a node in a {@link Graph}.\n *\n * @category Graph\n */\nexport abstract class GraphNode<Attributes extends {} = {}> extends EventDispatcher<GraphNodeEvent> {\n\tprivate _disposed = false;\n\n\t/**\n\t * Internal graph used to search and maintain references.\n\t * @hidden\n\t */\n\tprotected readonly graph: Graph<GraphNode>;\n\n\t/**\n\t * Attributes (literal values and GraphNode references) associated with this instance. For each\n\t * GraphNode reference, the attributes stores a {@link GraphEdge}. List and Map references are\n\t * stored as arrays and dictionaries of edges.\n\t * @internal\n\t */\n\tprotected readonly [$attributes]: GraphNodeAttributesInternal<this, Attributes>;\n\n\t/**\n\t * Attributes included with `getDefaultAttributes` are considered immutable, and cannot be\n\t * modifed by `.setRef()`, `.copy()`, or other GraphNode methods. Both the edges and the\n\t * properties will be disposed with the parent GraphNode.\n\t *\n\t * Currently, only single-edge references (getRef/setRef) are supported as immutables.\n\t *\n\t * @internal\n\t */\n\tprotected readonly [$immutableKeys]: Set<string>;\n\n\tconstructor(graph: Graph<GraphNode>) {\n\t\tsuper();\n\t\tthis.graph = graph;\n\t\tthis[$immutableKeys] = new Set();\n\t\tthis[$attributes] = this._createAttributes();\n\t}\n\n\t/**\n\t * Returns default attributes for the graph node. Subclasses having any attributes (either\n\t * literal values or references to other graph nodes) must override this method. Literal\n\t * attributes should be given their default values, if any. References should generally be\n\t * initialized as empty (Ref  null, RefList  [], RefMap  {}) and then modified by setters.\n\t *\n\t * Any single-edge references (setRef) returned by this method will be considered immutable,\n\t * to be owned by and disposed with the parent node. Multi-edge references (addRef, removeRef,\n\t * setRefMap) cannot be returned as default attributes.\n\t */\n\tprotected getDefaults(): Nullable<Attributes> {\n\t\treturn {} as Nullable<Attributes>;\n\t}\n\n\t/**\n\t * Constructs and returns an object used to store a graph nodes attributes. Compared to the\n\t * default Attributes interface, this has two distinctions:\n\t *\n\t * 1. Slots for GraphNode<T> objects are replaced with slots for GraphEdge<this, GraphNode<T>>\n\t * 2. GraphNode<T> objects provided as defaults are considered immutable\n\t *\n\t * @internal\n\t */\n\tprivate _createAttributes(): GraphNodeAttributesInternal<this, Attributes> {\n\t\tconst defaultAttributes = this.getDefaults();\n\t\tconst attributes = {} as GraphNodeAttributesInternal<this, Attributes>;\n\t\tfor (const key in defaultAttributes) {\n\t\t\tconst value = defaultAttributes[key] as any;\n\t\t\tif (value instanceof GraphNode) {\n\t\t\t\tconst ref = this.graph.createEdge(key, this, value);\n\t\t\t\tref.addEventListener('dispose', () => value.dispose());\n\t\t\t\tthis[$immutableKeys].add(key);\n\t\t\t\tattributes[key] = ref as any;\n\t\t\t} else {\n\t\t\t\tattributes[key] = value as any;\n\t\t\t}\n\t\t}\n\t\treturn attributes;\n\t}\n\n\t/** @internal Returns true if two nodes are on the same {@link Graph}. */\n\tpublic isOnGraph(other: GraphNode): boolean {\n\t\treturn this.graph === other.graph;\n\t}\n\n\t/** Returns true if the node has been permanently removed from the graph. */\n\tpublic isDisposed(): boolean {\n\t\treturn this._disposed;\n\t}\n\n\t/**\n\t * Removes both inbound references to and outbound references from this object. At the end\n\t * of the process the object holds no references, and nothing holds references to it. A\n\t * disposed object is not reusable.\n\t */\n\tpublic dispose(): void {\n\t\tif (this._disposed) return;\n\t\tthis.graph.listChildEdges(this).forEach((edge) => edge.dispose());\n\t\tthis.graph.disconnectParents(this);\n\t\tthis._disposed = true;\n\t\tthis.dispatchEvent({ type: 'dispose' });\n\t}\n\n\t/**\n\t * Removes all inbound references to this object. At the end of the process the object is\n\t * considered 'detached': it may hold references to child resources, but nothing holds\n\t * references to it. A detached object may be re-attached.\n\t */\n\tpublic detach(): this {\n\t\tthis.graph.disconnectParents(this);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Transfers this object's references from the old node to the new one. The old node is fully\n\t * detached from this parent at the end of the process.\n\t *\n\t * @hidden This method works imperfectly with Root, Scene, and Node properties, which may\n\t * already hold equivalent references to the replacement object.\n\t */\n\tpublic swap(old: GraphNode, replacement: GraphNode): this {\n\t\tfor (const attribute in this[$attributes]) {\n\t\t\tconst value = this[$attributes][attribute] as Ref | Ref[] | RefMap;\n\t\t\tif (isRef(value)) {\n\t\t\t\tconst ref = value as Ref;\n\t\t\t\tif (ref.getChild() === old) {\n\t\t\t\t\tthis.setRef(attribute as any, replacement, ref.getAttributes());\n\t\t\t\t}\n\t\t\t} else if (isRefList(value)) {\n\t\t\t\tconst refs = value as Ref[];\n\t\t\t\tconst ref = refs.find((ref) => ref.getChild() === old);\n\t\t\t\tif (ref) {\n\t\t\t\t\tconst refAttributes = ref.getAttributes();\n\t\t\t\t\tthis.removeRef(attribute as any, old).addRef(attribute as any, replacement, refAttributes);\n\t\t\t\t}\n\t\t\t} else if (isRefMap(value)) {\n\t\t\t\tconst refMap = value as RefMap;\n\t\t\t\tfor (const key in refMap) {\n\t\t\t\t\tconst ref = refMap[key];\n\t\t\t\t\tif (ref.getChild() === old) {\n\t\t\t\t\t\tthis.setRefMap(attribute as any, key, replacement, ref.getAttributes());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Literal attributes.\n\t */\n\n\t/** @hidden */\n\tprotected get<K extends LiteralKeys<Attributes>>(attribute: K): Attributes[K] {\n\t\treturn this[$attributes][attribute] as Attributes[K];\n\t}\n\n\t/** @hidden */\n\tprotected set<K extends LiteralKeys<Attributes>>(attribute: K, value: Attributes[K]): this {\n\t\t(this[$attributes][attribute] as Attributes[K]) = value;\n\t\treturn this.dispatchEvent({ type: 'change', attribute });\n\t}\n\n\t/**********************************************************************************************\n\t * Ref: 1:1 graph node references.\n\t */\n\n\t/** @hidden */\n\tprotected getRef<K extends RefKeys<Attributes>>(attribute: K): (GraphNode & Attributes[K]) | null {\n\t\tconst ref = this[$attributes][attribute] as Ref;\n\t\treturn ref ? (ref.getChild() as GraphNode & Attributes[K]) : null;\n\t}\n\n\t/** @hidden */\n\tprotected setRef<K extends RefKeys<Attributes>>(\n\t\tattribute: K,\n\t\tvalue: (GraphNode & Attributes[K]) | null,\n\t\tattributes?: Record<string, unknown>\n\t): this {\n\t\tif (this[$immutableKeys].has(attribute as string)) {\n\t\t\tthrow new Error(`Cannot overwrite immutable attribute, \"${attribute}\".`);\n\t\t}\n\n\t\tconst prevRef = this[$attributes][attribute] as Ref;\n\t\tif (prevRef) prevRef.dispose(); // TODO(cleanup): Possible duplicate event.\n\n\t\tif (!value) return this;\n\n\t\tconst ref = this.graph.createEdge(attribute as string, this, value, attributes);\n\t\tref.addEventListener('dispose', () => {\n\t\t\tdelete this[$attributes][attribute];\n\t\t\tthis.dispatchEvent({ type: 'change', attribute });\n\t\t});\n\t\t(this[$attributes][attribute] as Ref) = ref;\n\n\t\treturn this.dispatchEvent({ type: 'change', attribute });\n\t}\n\n\t/**********************************************************************************************\n\t * RefList: 1:many graph node references.\n\t */\n\n\t/** @hidden */\n\tprotected listRefs<K extends RefListKeys<Attributes>>(attribute: K): GraphNode[] & Attributes[K] {\n\t\tconst refs = this[$attributes][attribute] as Ref[];\n\t\treturn refs.map((ref) => ref.getChild()) as GraphNode[] & Attributes[K];\n\t}\n\n\t/** @hidden */\n\tprotected addRef<K extends RefListKeys<Attributes>>(\n\t\tattribute: K,\n\t\tvalue: GraphNode & Attributes[K][keyof Attributes[K]],\n\t\tattributes?: Record<string, unknown>\n\t): this {\n\t\tconst ref = this.graph.createEdge(attribute as string, this, value, attributes);\n\n\t\tconst refs = this[$attributes][attribute] as Ref[];\n\t\trefs.push(ref);\n\n\t\tref.addEventListener('dispose', () => {\n\t\t\tconst retained = refs.filter((l) => l !== ref);\n\t\t\trefs.length = 0;\n\t\t\tfor (const retainedRef of retained) refs.push(retainedRef);\n\t\t\tthis.dispatchEvent({ type: 'change', attribute });\n\t\t});\n\n\t\treturn this.dispatchEvent({ type: 'change', attribute });\n\t}\n\n\t/** @hidden */\n\tprotected removeRef<K extends RefListKeys<Attributes>>(\n\t\tattribute: K,\n\t\tvalue: GraphNode & Attributes[K][keyof Attributes[K]]\n\t): this {\n\t\tconst refs = this[$attributes][attribute] as Ref[];\n\t\tconst pruned = refs.filter((ref) => ref.getChild() === value);\n\t\tpruned.forEach((ref) => ref.dispose()); // TODO(cleanup): Possible duplicate event.\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * RefMap: Named 1:many (map) graph node references.\n\t */\n\n\t/** @hidden */\n\tprotected listRefMapKeys<K extends RefMapKeys<Attributes>>(key: K): string[] {\n\t\treturn Object.keys(this[$attributes][key]);\n\t}\n\n\t/** @hidden */\n\tprotected listRefMapValues<K extends RefMapKeys<Attributes>>(\n\t\tkey: K\n\t): GraphNode[] & Attributes[K][keyof Attributes[K]][] {\n\t\treturn Object.values(this[$attributes][key]).map((ref: any) => ref.getChild());\n\t}\n\n\t/** @hidden */\n\tprotected getRefMap<K extends RefMapKeys<Attributes>, SK extends keyof Attributes[K]>(\n\t\tattribute: K,\n\t\tkey: SK\n\t): (GraphNode & Attributes[K][SK]) | null {\n\t\tconst refMap = this[$attributes][attribute] as any;\n\t\treturn refMap[key] ? refMap[key].getChild() : null;\n\t}\n\n\t/** @hidden */\n\tprotected setRefMap<K extends RefMapKeys<Attributes>, SK extends keyof Attributes[K]>(\n\t\tattribute: K,\n\t\tkey: SK,\n\t\tvalue: (GraphNode & Attributes[K][SK]) | null,\n\t\tmetadata?: Record<string, unknown>\n\t): this {\n\t\tconst refMap = this[$attributes][attribute] as any;\n\n\t\tconst prevRef = refMap[key];\n\t\tif (prevRef) prevRef.dispose(); // TODO(cleanup): Possible duplicate event.\n\n\t\tif (!value) return this;\n\n\t\tmetadata = Object.assign(metadata || {}, { key: key });\n\t\tconst ref = this.graph.createEdge(attribute as string, this, value, { ...metadata, key });\n\t\tref.addEventListener('dispose', () => {\n\t\t\tdelete refMap[key];\n\t\t\tthis.dispatchEvent({ type: 'change', attribute, key });\n\t\t});\n\t\trefMap[key] = ref;\n\n\t\treturn this.dispatchEvent({ type: 'change', attribute, key });\n\t}\n\n\t/**********************************************************************************************\n\t * Events.\n\t */\n\n\tdispatchEvent(event: BaseEvent): this {\n\t\tsuper.dispatchEvent({ ...event, target: this });\n\t\tthis.graph.dispatchEvent({ ...event, target: this, type: `node:${event.type}` });\n\t\treturn this;\n\t}\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nconst base64 = require('base64-js')\nconst ieee754 = require('ieee754')\nconst customInspectSymbol =\n  (typeof Symbol === 'function' && typeof Symbol['for'] === 'function') // eslint-disable-line dot-notation\n    ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation\n    : null\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\nconst K_MAX_LENGTH = 0x7fffffff\nexports.kMaxLength = K_MAX_LENGTH\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Print warning and recommend using `buffer` v4.x which has an Object\n *               implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * We report that the browser does not support typed arrays if the are not subclassable\n * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`\n * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support\n * for __proto__ and has a buggy typed array implementation.\n */\nBuffer.TYPED_ARRAY_SUPPORT = typedArraySupport()\n\nif (!Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' &&\n    typeof console.error === 'function') {\n  console.error(\n    'This browser lacks typed array (Uint8Array) support which is required by ' +\n    '`buffer` v5.x. Use `buffer` v4.x if you require old browser support.'\n  )\n}\n\nfunction typedArraySupport () {\n  // Can typed array instances can be augmented?\n  try {\n    const arr = new Uint8Array(1)\n    const proto = { foo: function () { return 42 } }\n    Object.setPrototypeOf(proto, Uint8Array.prototype)\n    Object.setPrototypeOf(arr, proto)\n    return arr.foo() === 42\n  } catch (e) {\n    return false\n  }\n}\n\nObject.defineProperty(Buffer.prototype, 'parent', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.buffer\n  }\n})\n\nObject.defineProperty(Buffer.prototype, 'offset', {\n  enumerable: true,\n  get: function () {\n    if (!Buffer.isBuffer(this)) return undefined\n    return this.byteOffset\n  }\n})\n\nfunction createBuffer (length) {\n  if (length > K_MAX_LENGTH) {\n    throw new RangeError('The value \"' + length + '\" is invalid for option \"size\"')\n  }\n  // Return an augmented `Uint8Array` instance\n  const buf = new Uint8Array(length)\n  Object.setPrototypeOf(buf, Buffer.prototype)\n  return buf\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new TypeError(\n        'The \"string\" argument must be of type string. Received type number'\n      )\n    }\n    return allocUnsafe(arg)\n  }\n  return from(arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\nfunction from (value, encodingOrOffset, length) {\n  if (typeof value === 'string') {\n    return fromString(value, encodingOrOffset)\n  }\n\n  if (ArrayBuffer.isView(value)) {\n    return fromArrayView(value)\n  }\n\n  if (value == null) {\n    throw new TypeError(\n      'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n      'or Array-like Object. Received type ' + (typeof value)\n    )\n  }\n\n  if (isInstance(value, ArrayBuffer) ||\n      (value && isInstance(value.buffer, ArrayBuffer))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof SharedArrayBuffer !== 'undefined' &&\n      (isInstance(value, SharedArrayBuffer) ||\n      (value && isInstance(value.buffer, SharedArrayBuffer)))) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'number') {\n    throw new TypeError(\n      'The \"value\" argument must not be of type number. Received type number'\n    )\n  }\n\n  const valueOf = value.valueOf && value.valueOf()\n  if (valueOf != null && valueOf !== value) {\n    return Buffer.from(valueOf, encodingOrOffset, length)\n  }\n\n  const b = fromObject(value)\n  if (b) return b\n\n  if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null &&\n      typeof value[Symbol.toPrimitive] === 'function') {\n    return Buffer.from(value[Symbol.toPrimitive]('string'), encodingOrOffset, length)\n  }\n\n  throw new TypeError(\n    'The first argument must be one of type string, Buffer, ArrayBuffer, Array, ' +\n    'or Array-like Object. Received type ' + (typeof value)\n  )\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(value, encodingOrOffset, length)\n}\n\n// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:\n// https://github.com/feross/buffer/pull/148\nObject.setPrototypeOf(Buffer.prototype, Uint8Array.prototype)\nObject.setPrototypeOf(Buffer, Uint8Array)\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be of type number')\n  } else if (size < 0) {\n    throw new RangeError('The value \"' + size + '\" is invalid for option \"size\"')\n  }\n}\n\nfunction alloc (size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpreted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(size).fill(fill, encoding)\n      : createBuffer(size).fill(fill)\n  }\n  return createBuffer(size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(size, fill, encoding)\n}\n\nfunction allocUnsafe (size) {\n  assertSize(size)\n  return createBuffer(size < 0 ? 0 : checked(size) | 0)\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(size)\n}\n\nfunction fromString (string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('Unknown encoding: ' + encoding)\n  }\n\n  const length = byteLength(string, encoding) | 0\n  let buf = createBuffer(length)\n\n  const actual = buf.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    buf = buf.slice(0, actual)\n  }\n\n  return buf\n}\n\nfunction fromArrayLike (array) {\n  const length = array.length < 0 ? 0 : checked(array.length) | 0\n  const buf = createBuffer(length)\n  for (let i = 0; i < length; i += 1) {\n    buf[i] = array[i] & 255\n  }\n  return buf\n}\n\nfunction fromArrayView (arrayView) {\n  if (isInstance(arrayView, Uint8Array)) {\n    const copy = new Uint8Array(arrayView)\n    return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength)\n  }\n  return fromArrayLike(arrayView)\n}\n\nfunction fromArrayBuffer (array, byteOffset, length) {\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\"offset\" is outside of buffer bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\"length\" is outside of buffer bounds')\n  }\n\n  let buf\n  if (byteOffset === undefined && length === undefined) {\n    buf = new Uint8Array(array)\n  } else if (length === undefined) {\n    buf = new Uint8Array(array, byteOffset)\n  } else {\n    buf = new Uint8Array(array, byteOffset, length)\n  }\n\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(buf, Buffer.prototype)\n\n  return buf\n}\n\nfunction fromObject (obj) {\n  if (Buffer.isBuffer(obj)) {\n    const len = checked(obj.length) | 0\n    const buf = createBuffer(len)\n\n    if (buf.length === 0) {\n      return buf\n    }\n\n    obj.copy(buf, 0, 0, len)\n    return buf\n  }\n\n  if (obj.length !== undefined) {\n    if (typeof obj.length !== 'number' || numberIsNaN(obj.length)) {\n      return createBuffer(0)\n    }\n    return fromArrayLike(obj)\n  }\n\n  if (obj.type === 'Buffer' && Array.isArray(obj.data)) {\n    return fromArrayLike(obj.data)\n  }\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < K_MAX_LENGTH` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= K_MAX_LENGTH) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + K_MAX_LENGTH.toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return b != null && b._isBuffer === true &&\n    b !== Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false\n}\n\nBuffer.compare = function compare (a, b) {\n  if (isInstance(a, Uint8Array)) a = Buffer.from(a, a.offset, a.byteLength)\n  if (isInstance(b, Uint8Array)) b = Buffer.from(b, b.offset, b.byteLength)\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError(\n      'The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array'\n    )\n  }\n\n  if (a === b) return 0\n\n  let x = a.length\n  let y = b.length\n\n  for (let i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!Array.isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  let i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  const buffer = Buffer.allocUnsafe(length)\n  let pos = 0\n  for (i = 0; i < list.length; ++i) {\n    let buf = list[i]\n    if (isInstance(buf, Uint8Array)) {\n      if (pos + buf.length > buffer.length) {\n        if (!Buffer.isBuffer(buf)) buf = Buffer.from(buf)\n        buf.copy(buffer, pos)\n      } else {\n        Uint8Array.prototype.set.call(\n          buffer,\n          buf,\n          pos\n        )\n      }\n    } else if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    } else {\n      buf.copy(buffer, pos)\n    }\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    throw new TypeError(\n      'The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. ' +\n      'Received type ' + typeof string\n    )\n  }\n\n  const len = string.length\n  const mustMatch = (arguments.length > 2 && arguments[2] === true)\n  if (!mustMatch && len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) {\n          return mustMatch ? -1 : utf8ToBytes(string).length // assume utf8\n        }\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  let loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coercion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)\n// to detect a Buffer instance. It's not possible to use `instanceof Buffer`\n// reliably in a browserify context because there could be multiple different\n// copies of the 'buffer' package in use. This method works even for Buffer\n// instances that were created from another copy of the `buffer` package.\n// See: https://github.com/feross/buffer/issues/154\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  const i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  const len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (let i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  const len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (let i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  const len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (let i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  const length = this.length\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.toLocaleString = Buffer.prototype.toString\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  let str = ''\n  const max = exports.INSPECT_MAX_BYTES\n  str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim()\n  if (this.length > max) str += ' ... '\n  return '<Buffer ' + str + '>'\n}\nif (customInspectSymbol) {\n  Buffer.prototype[customInspectSymbol] = Buffer.prototype.inspect\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (isInstance(target, Uint8Array)) {\n    target = Buffer.from(target, target.offset, target.byteLength)\n  }\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError(\n      'The \"target\" argument must be one of type Buffer or Uint8Array. ' +\n      'Received type ' + (typeof target)\n    )\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  let x = thisEnd - thisStart\n  let y = end - start\n  const len = Math.min(x, y)\n\n  const thisCopy = this.slice(thisStart, thisEnd)\n  const targetCopy = target.slice(start, end)\n\n  for (let i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset // Coerce to Number.\n  if (numberIsNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [val], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  let indexSize = 1\n  let arrLength = arr.length\n  let valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  let i\n  if (dir) {\n    let foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      let found = true\n      for (let j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  const remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  const strLen = string.length\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  let i\n  for (i = 0; i < length; ++i) {\n    const parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (numberIsNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset >>> 0\n    if (isFinite(length)) {\n      length = length >>> 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  const remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  let loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return asciiWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  const res = []\n\n  let i = start\n  while (i < end) {\n    const firstByte = buf[i]\n    let codePoint = null\n    let bytesPerSequence = (firstByte > 0xEF)\n      ? 4\n      : (firstByte > 0xDF)\n          ? 3\n          : (firstByte > 0xBF)\n              ? 2\n              : 1\n\n    if (i + bytesPerSequence <= end) {\n      let secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nconst MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  const len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  let res = ''\n  let i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  let ret = ''\n  end = Math.min(buf.length, end)\n\n  for (let i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  const len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  let out = ''\n  for (let i = start; i < end; ++i) {\n    out += hexSliceLookupTable[buf[i]]\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  const bytes = buf.slice(start, end)\n  let res = ''\n  // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)\n  for (let i = 0; i < bytes.length - 1; i += 2) {\n    res += String.fromCharCode(bytes[i] + (bytes[i + 1] * 256))\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  const len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  const newBuf = this.subarray(start, end)\n  // Return an augmented `Uint8Array` instance\n  Object.setPrototypeOf(newBuf, Buffer.prototype)\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUintLE =\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUintBE =\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  let val = this[offset + --byteLength]\n  let mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUint8 =\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUint16LE =\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUint16BE =\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUint32LE =\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUint32BE =\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readBigUInt64LE = defineBigIntMethod(function readBigUInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const lo = first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24\n\n  const hi = this[++offset] +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    last * 2 ** 24\n\n  return BigInt(lo) + (BigInt(hi) << BigInt(32))\n})\n\nBuffer.prototype.readBigUInt64BE = defineBigIntMethod(function readBigUInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const hi = first * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  const lo = this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last\n\n  return (BigInt(hi) << BigInt(32)) + BigInt(lo)\n})\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let val = this[offset]\n  let mul = 1\n  let i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  let i = byteLength\n  let mul = 1\n  let val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  const val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readBigInt64LE = defineBigIntMethod(function readBigInt64LE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = this[offset + 4] +\n    this[offset + 5] * 2 ** 8 +\n    this[offset + 6] * 2 ** 16 +\n    (last << 24) // Overflow\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(first +\n    this[++offset] * 2 ** 8 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 24)\n})\n\nBuffer.prototype.readBigInt64BE = defineBigIntMethod(function readBigInt64BE (offset) {\n  offset = offset >>> 0\n  validateNumber(offset, 'offset')\n  const first = this[offset]\n  const last = this[offset + 7]\n  if (first === undefined || last === undefined) {\n    boundsError(offset, this.length - 8)\n  }\n\n  const val = (first << 24) + // Overflow\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    this[++offset]\n\n  return (BigInt(val) << BigInt(32)) +\n    BigInt(this[++offset] * 2 ** 24 +\n    this[++offset] * 2 ** 16 +\n    this[++offset] * 2 ** 8 +\n    last)\n})\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  offset = offset >>> 0\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUintLE =\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let mul = 1\n  let i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUintBE =\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    const maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUint8 =\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeUint16LE =\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint16BE =\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeUint32LE =\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset + 3] = (value >>> 24)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 1] = (value >>> 8)\n  this[offset] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeUint32BE =\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nfunction wrtBigUInt64LE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  lo = lo >> 8\n  buf[offset++] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  hi = hi >> 8\n  buf[offset++] = hi\n  return offset\n}\n\nfunction wrtBigUInt64BE (buf, value, offset, min, max) {\n  checkIntBI(value, min, max, buf, offset, 7)\n\n  let lo = Number(value & BigInt(0xffffffff))\n  buf[offset + 7] = lo\n  lo = lo >> 8\n  buf[offset + 6] = lo\n  lo = lo >> 8\n  buf[offset + 5] = lo\n  lo = lo >> 8\n  buf[offset + 4] = lo\n  let hi = Number(value >> BigInt(32) & BigInt(0xffffffff))\n  buf[offset + 3] = hi\n  hi = hi >> 8\n  buf[offset + 2] = hi\n  hi = hi >> 8\n  buf[offset + 1] = hi\n  hi = hi >> 8\n  buf[offset] = hi\n  return offset + 8\n}\n\nBuffer.prototype.writeBigUInt64LE = defineBigIntMethod(function writeBigUInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeBigUInt64BE = defineBigIntMethod(function writeBigUInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'))\n})\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = 0\n  let mul = 1\n  let sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    const limit = Math.pow(2, (8 * byteLength) - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  let i = byteLength - 1\n  let mul = 1\n  let sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  this[offset] = (value >>> 8)\n  this[offset + 1] = (value & 0xff)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  this[offset] = (value & 0xff)\n  this[offset + 1] = (value >>> 8)\n  this[offset + 2] = (value >>> 16)\n  this[offset + 3] = (value >>> 24)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  this[offset] = (value >>> 24)\n  this[offset + 1] = (value >>> 16)\n  this[offset + 2] = (value >>> 8)\n  this[offset + 3] = (value & 0xff)\n  return offset + 4\n}\n\nBuffer.prototype.writeBigInt64LE = defineBigIntMethod(function writeBigInt64LE (value, offset = 0) {\n  return wrtBigUInt64LE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nBuffer.prototype.writeBigInt64BE = defineBigIntMethod(function writeBigInt64BE (value, offset = 0) {\n  return wrtBigUInt64BE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'))\n})\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer')\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('Index out of range')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  const len = end - start\n\n  if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') {\n    // Use built-in when available, missing from IE11\n    this.copyWithin(targetStart, start, end)\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, end),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n    if (val.length === 1) {\n      const code = val.charCodeAt(0)\n      if ((encoding === 'utf8' && code < 128) ||\n          encoding === 'latin1') {\n        // Fast path: If `val` fits into a single byte, use that numeric value.\n        val = code\n      }\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  } else if (typeof val === 'boolean') {\n    val = Number(val)\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  let i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    const bytes = Buffer.isBuffer(val)\n      ? val\n      : Buffer.from(val, encoding)\n    const len = bytes.length\n    if (len === 0) {\n      throw new TypeError('The value \"' + val +\n        '\" is invalid for argument \"value\"')\n    }\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// CUSTOM ERRORS\n// =============\n\n// Simplified versions from Node, changed for Buffer-only usage\nconst errors = {}\nfunction E (sym, getMessage, Base) {\n  errors[sym] = class NodeError extends Base {\n    constructor () {\n      super()\n\n      Object.defineProperty(this, 'message', {\n        value: getMessage.apply(this, arguments),\n        writable: true,\n        configurable: true\n      })\n\n      // Add the error code to the name to include it in the stack trace.\n      this.name = `${this.name} [${sym}]`\n      // Access the stack to generate the error message including the error code\n      // from the name.\n      this.stack // eslint-disable-line no-unused-expressions\n      // Reset the name to the actual name.\n      delete this.name\n    }\n\n    get code () {\n      return sym\n    }\n\n    set code (value) {\n      Object.defineProperty(this, 'code', {\n        configurable: true,\n        enumerable: true,\n        value,\n        writable: true\n      })\n    }\n\n    toString () {\n      return `${this.name} [${sym}]: ${this.message}`\n    }\n  }\n}\n\nE('ERR_BUFFER_OUT_OF_BOUNDS',\n  function (name) {\n    if (name) {\n      return `${name} is outside of buffer bounds`\n    }\n\n    return 'Attempt to access memory outside buffer bounds'\n  }, RangeError)\nE('ERR_INVALID_ARG_TYPE',\n  function (name, actual) {\n    return `The \"${name}\" argument must be of type number. Received type ${typeof actual}`\n  }, TypeError)\nE('ERR_OUT_OF_RANGE',\n  function (str, range, input) {\n    let msg = `The value of \"${str}\" is out of range.`\n    let received = input\n    if (Number.isInteger(input) && Math.abs(input) > 2 ** 32) {\n      received = addNumericalSeparator(String(input))\n    } else if (typeof input === 'bigint') {\n      received = String(input)\n      if (input > BigInt(2) ** BigInt(32) || input < -(BigInt(2) ** BigInt(32))) {\n        received = addNumericalSeparator(received)\n      }\n      received += 'n'\n    }\n    msg += ` It must be ${range}. Received ${received}`\n    return msg\n  }, RangeError)\n\nfunction addNumericalSeparator (val) {\n  let res = ''\n  let i = val.length\n  const start = val[0] === '-' ? 1 : 0\n  for (; i >= start + 4; i -= 3) {\n    res = `_${val.slice(i - 3, i)}${res}`\n  }\n  return `${val.slice(0, i)}${res}`\n}\n\n// CHECK FUNCTIONS\n// ===============\n\nfunction checkBounds (buf, offset, byteLength) {\n  validateNumber(offset, 'offset')\n  if (buf[offset] === undefined || buf[offset + byteLength] === undefined) {\n    boundsError(offset, buf.length - (byteLength + 1))\n  }\n}\n\nfunction checkIntBI (value, min, max, buf, offset, byteLength) {\n  if (value > max || value < min) {\n    const n = typeof min === 'bigint' ? 'n' : ''\n    let range\n    if (byteLength > 3) {\n      if (min === 0 || min === BigInt(0)) {\n        range = `>= 0${n} and < 2${n} ** ${(byteLength + 1) * 8}${n}`\n      } else {\n        range = `>= -(2${n} ** ${(byteLength + 1) * 8 - 1}${n}) and < 2 ** ` +\n                `${(byteLength + 1) * 8 - 1}${n}`\n      }\n    } else {\n      range = `>= ${min}${n} and <= ${max}${n}`\n    }\n    throw new errors.ERR_OUT_OF_RANGE('value', range, value)\n  }\n  checkBounds(buf, offset, byteLength)\n}\n\nfunction validateNumber (value, name) {\n  if (typeof value !== 'number') {\n    throw new errors.ERR_INVALID_ARG_TYPE(name, 'number', value)\n  }\n}\n\nfunction boundsError (value, length, type) {\n  if (Math.floor(value) !== value) {\n    validateNumber(value, type)\n    throw new errors.ERR_OUT_OF_RANGE(type || 'offset', 'an integer', value)\n  }\n\n  if (length < 0) {\n    throw new errors.ERR_BUFFER_OUT_OF_BOUNDS()\n  }\n\n  throw new errors.ERR_OUT_OF_RANGE(type || 'offset',\n                                    `>= ${type ? 1 : 0} and <= ${length}`,\n                                    value)\n}\n\n// HELPER FUNCTIONS\n// ================\n\nconst INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node takes equal signs as end of the Base64 encoding\n  str = str.split('=')[0]\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = str.trim().replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  let codePoint\n  const length = string.length\n  let leadSurrogate = null\n  const bytes = []\n\n  for (let i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  let c, hi, lo\n  const byteArray = []\n  for (let i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  let i\n  for (i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\n// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass\n// the `instanceof` check but they should be treated as of that type.\n// See: https://github.com/feross/buffer/issues/166\nfunction isInstance (obj, type) {\n  return obj instanceof type ||\n    (obj != null && obj.constructor != null && obj.constructor.name != null &&\n      obj.constructor.name === type.name)\n}\nfunction numberIsNaN (obj) {\n  // For IE11 support\n  return obj !== obj // eslint-disable-line no-self-compare\n}\n\n// Create lookup table for `toString('hex')`\n// See: https://github.com/feross/buffer/issues/219\nconst hexSliceLookupTable = (function () {\n  const alphabet = '0123456789abcdef'\n  const table = new Array(256)\n  for (let i = 0; i < 16; ++i) {\n    const i16 = i * 16\n    for (let j = 0; j < 16; ++j) {\n      table[i16 + j] = alphabet[i] + alphabet[j]\n    }\n  }\n  return table\n})()\n\n// Return not function with Error if BigInt not supported\nfunction defineBigIntMethod (fn) {\n  return typeof BigInt === 'undefined' ? BufferBigIntNotDefined : fn\n}\n\nfunction BufferBigIntNotDefined () {\n  throw new Error('BigInt not supported')\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","// Injected at compile time, from $npm_package_version.\ndeclare const PACKAGE_VERSION: string;\n\n/**\n * Current version of the package.\n * @hidden\n */\nexport const VERSION = `v${PACKAGE_VERSION}`;\n\n/** @internal */\nexport const NAME = '@gltf-transform/core';\n\n/**\n * Interface allowing Accessor setter/getter methods to be used interchangeably with gl-matrix\n * arrays or with three.js math objects' fromArray/toArray methods. For example, THREE.Vector2,\n * THREE.Vector3, THREE.Vector4, THREE.Quaternion, THREE.Matrix3, THREE.Matrix4, and THREE.Color.\n *\n * @internal\n */\nexport interface ArrayProxy {\n\t/** Sets the value of the object from an array of values. */\n\tfromArray(array: number[]): ArrayProxy;\n\t/** Writes the value of the object into the given array. */\n\ttoArray(array: number[]): number[];\n}\n\n/**\n * TypeScript utility for nullable types.\n * @hidden\n */\nexport type Nullable<T> = { [P in keyof T]: T[P] | null };\n\n/**\n * 2-dimensional vector.\n * @hidden\n */\nexport type vec2 = [number, number];\n\n/**\n * 3-dimensional vector.\n * @hidden\n */\nexport type vec3 = [number, number, number];\n\n/**\n * 4-dimensional vector, e.g. RGBA or a quaternion.\n * @hidden\n */\nexport type vec4 = [number, number, number, number];\n\n// prettier-ignore\n/**\n * 3x3 matrix, e.g. an affine transform of a 2D vector.\n * @hidden\n */\nexport type mat3 = [\n\tnumber, number, number,\n\tnumber, number, number,\n\tnumber, number, number,\n];\n\n// prettier-ignore\n/**\n * 4x4 matrix, e.g. an affine transform of a 3D vector.\n * @hidden\n */\nexport type mat4 = [\n\tnumber, number, number, number,\n\tnumber, number, number, number,\n\tnumber, number, number, number,\n\tnumber, number, number, number,\n];\n\n/** @hidden */\nexport type bbox = { min: vec3; max: vec3 };\n\n/** @hidden */\nexport const GLB_BUFFER = '@glb.bin';\n\n/**\n * Abstraction representing any one of the typed array classes supported by glTF and JavaScript.\n * @hidden\n */\nexport type TypedArray = Float32Array | Uint32Array | Uint16Array | Uint8Array | Int16Array | Int8Array;\n\n/**\n * Abstraction representing the typed array constructors supported by glTF and JavaScript.\n * @hidden\n */\nexport type TypedArrayConstructor =\n\t| Float32ArrayConstructor\n\t| Uint32ArrayConstructor\n\t| Uint16ArrayConstructor\n\t| Uint8ArrayConstructor\n\t| Int16ArrayConstructor\n\t| Int8ArrayConstructor;\n\n/** String IDs for core {@link Property} types. */\nexport enum PropertyType {\n\tACCESSOR = 'Accessor',\n\tANIMATION = 'Animation',\n\tANIMATION_CHANNEL = 'AnimationChannel',\n\tANIMATION_SAMPLER = 'AnimationSampler',\n\tBUFFER = 'Buffer',\n\tCAMERA = 'Camera',\n\tMATERIAL = 'Material',\n\tMESH = 'Mesh',\n\tPRIMITIVE = 'Primitive',\n\tPRIMITIVE_TARGET = 'PrimitiveTarget',\n\tNODE = 'Node',\n\tROOT = 'Root',\n\tSCENE = 'Scene',\n\tSKIN = 'Skin',\n\tTEXTURE = 'Texture',\n\tTEXTURE_INFO = 'TextureInfo',\n}\n\n/** Vertex layout method. */\nexport enum VertexLayout {\n\t/**\n\t * Stores vertex attributes in a single buffer view per mesh primitive. Interleaving vertex\n\t * data may improve performance by reducing page-thrashing in GPU memory.\n\t */\n\tINTERLEAVED = 'interleaved',\n\n\t/**\n\t * Stores each vertex attribute in a separate buffer view. May decrease performance by causing\n\t * page-thrashing in GPU memory. Some 3D engines may prefer this layout, e.g. for simplicity.\n\t */\n\tSEPARATE = 'separate',\n}\n\n/** Accessor usage. */\nexport enum BufferViewUsage {\n\tARRAY_BUFFER = 'ARRAY_BUFFER',\n\tELEMENT_ARRAY_BUFFER = 'ELEMENT_ARRAY_BUFFER',\n\tINVERSE_BIND_MATRICES = 'INVERSE_BIND_MATRICES',\n\tOTHER = 'OTHER',\n}\n\n/** Texture channels. */\nexport enum TextureChannel {\n\tR = 0x1000,\n\tG = 0x0100,\n\tB = 0x0010,\n\tA = 0x0001,\n}\n\nexport enum Format {\n\tGLTF = 'GLTF',\n\tGLB = 'GLB',\n}\n","import { transformMat4 } from 'gl-matrix/vec3';\nimport { PropertyType, bbox, mat4, vec3 } from '../constants';\nimport type { Mesh, Node, Scene } from '../properties';\n\n/**\n * Computes bounding box (AABB) in world space for the given {@link Node} or {@link Scene}.\n *\n * Example:\n *\n * ```ts\n * const {min, max} = bounds(scene);\n * ```\n */\nexport function bounds(node: Node | Scene): bbox {\n\tconst resultBounds = createBounds();\n\tconst parents = node.propertyType === PropertyType.NODE ? [node] : node.listChildren();\n\n\tfor (const parent of parents) {\n\t\tparent.traverse((node) => {\n\t\t\tconst mesh = node.getMesh();\n\t\t\tif (!mesh) return;\n\n\t\t\t// Compute mesh bounds and update result.\n\t\t\tconst meshBounds = getMeshBounds(mesh, node.getWorldMatrix());\n\t\t\texpandBounds(meshBounds.min, resultBounds);\n\t\t\texpandBounds(meshBounds.max, resultBounds);\n\t\t});\n\t}\n\n\treturn resultBounds;\n}\n\n/** Computes mesh bounds in local space. */\nfunction getMeshBounds(mesh: Mesh, worldMatrix: mat4): bbox {\n\tconst meshBounds = createBounds();\n\n\t// We can't transform a local AABB into world space and still have a tight AABB in world space,\n\t// so we need to compute the world AABB vertex by vertex here.\n\tfor (const prim of mesh.listPrimitives()) {\n\t\tconst position = prim.getAttribute('POSITION');\n\t\tif (!position) continue;\n\n\t\tlet localPos: vec3 = [0, 0, 0];\n\t\tlet worldPos: vec3 = [0, 0, 0];\n\t\tfor (let i = 0; i < position.getCount(); i++) {\n\t\t\tlocalPos = position.getElement(i, localPos) as vec3;\n\t\t\tworldPos = transformMat4(worldPos, localPos, worldMatrix) as vec3;\n\t\t\texpandBounds(worldPos, meshBounds);\n\t\t}\n\t}\n\n\treturn meshBounds;\n}\n\n/** Expands bounds of target by given source. */\nfunction expandBounds(point: vec3, target: bbox): void {\n\tfor (let i = 0; i < 3; i++) {\n\t\ttarget.min[i] = Math.min(point[i], target.min[i]);\n\t\ttarget.max[i] = Math.max(point[i], target.max[i]);\n\t}\n}\n\n/** Creates new bounds with min=Infinity, max=-Infinity. */\nfunction createBounds(): bbox {\n\treturn {\n\t\tmin: [Infinity, Infinity, Infinity] as vec3,\n\t\tmax: [-Infinity, -Infinity, -Infinity] as vec3,\n\t};\n}\n","import type { TypedArray } from '../constants';\n\n/**\n * # BufferUtils\n *\n * *Common utilities for working with Uint8Array and Buffer objects.*\n *\n * @category Utilities\n */\nexport class BufferUtils {\n\t/** Creates a byte array from a Data URI. */\n\tstatic createBufferFromDataURI(dataURI: string): Uint8Array {\n\t\tif (typeof Buffer === 'undefined') {\n\t\t\t// Browser.\n\t\t\tconst byteString = atob(dataURI.split(',')[1]);\n\t\t\tconst ia = new Uint8Array(byteString.length);\n\t\t\tfor (let i = 0; i < byteString.length; i++) {\n\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t}\n\t\t\treturn ia;\n\t\t} else {\n\t\t\t// Node.js.\n\t\t\tconst data = dataURI.split(',')[1];\n\t\t\tconst isBase64 = dataURI.indexOf('base64') >= 0;\n\t\t\treturn Buffer.from(data, isBase64 ? 'base64' : 'utf8');\n\t\t}\n\t}\n\n\t/** Encodes text to a byte array. */\n\tstatic encodeText(text: string): Uint8Array {\n\t\tif (typeof TextEncoder !== 'undefined') {\n\t\t\treturn new TextEncoder().encode(text);\n\t\t}\n\t\treturn Buffer.from(text);\n\t}\n\n\t/** Decodes a byte array to text. */\n\tstatic decodeText(array: Uint8Array): string {\n\t\tif (typeof TextDecoder !== 'undefined') {\n\t\t\treturn new TextDecoder().decode(array);\n\t\t}\n\t\treturn Buffer.from(array).toString('utf8');\n\t}\n\n\t/**\n\t * Concatenates N byte arrays.\n\t */\n\tstatic concat(arrays: Uint8Array[]): Uint8Array {\n\t\tlet totalByteLength = 0;\n\t\tfor (const array of arrays) {\n\t\t\ttotalByteLength += array.byteLength;\n\t\t}\n\n\t\tconst result = new Uint8Array(totalByteLength);\n\t\tlet byteOffset = 0;\n\n\t\tfor (const array of arrays) {\n\t\t\tresult.set(array, byteOffset);\n\t\t\tbyteOffset += array.byteLength;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Pads a Uint8Array to the next 4-byte boundary.\n\t *\n\t * Reference: [glTF  Data Alignment](https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#data-alignment)\n\t */\n\tstatic pad(srcArray: Uint8Array, paddingByte = 0): Uint8Array {\n\t\tconst paddedLength = this.padNumber(srcArray.byteLength);\n\t\tif (paddedLength === srcArray.byteLength) return srcArray;\n\n\t\tconst dstArray = new Uint8Array(paddedLength);\n\t\tdstArray.set(srcArray);\n\n\t\tif (paddingByte !== 0) {\n\t\t\tfor (let i = srcArray.byteLength; i < paddedLength; i++) {\n\t\t\t\tdstArray[i] = paddingByte;\n\t\t\t}\n\t\t}\n\n\t\treturn dstArray;\n\t}\n\n\t/** Pads a number to 4-byte boundaries. */\n\tstatic padNumber(v: number): number {\n\t\treturn Math.ceil(v / 4) * 4;\n\t}\n\n\t/** Returns true if given byte array instances are equal. */\n\tstatic equals(a: Uint8Array, b: Uint8Array): boolean {\n\t\tif (a === b) return true;\n\n\t\tif (a.byteLength !== b.byteLength) return false;\n\n\t\tlet i = a.byteLength;\n\t\twhile (i--) {\n\t\t\tif (a[i] !== b[i]) return false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns a Uint8Array view of a typed array, with the same underlying ArrayBuffer.\n\t *\n\t * A shorthand for:\n\t *\n\t * ```js\n\t * const buffer = new Uint8Array(\n\t * \tarray.buffer,\n\t * \tarray.byteOffset + byteOffset,\n\t * \tMath.min(array.byteLength, byteLength)\n\t * );\n\t * ```\n\t *\n\t */\n\tstatic toView(a: TypedArray, byteOffset = 0, byteLength = Infinity): Uint8Array {\n\t\treturn new Uint8Array(a.buffer, a.byteOffset + byteOffset, Math.min(a.byteLength, byteLength));\n\t}\n\n\t/** @internal */\n\tstatic assertView(view: null): null;\n\tstatic assertView(view: Uint8Array): Uint8Array;\n\tstatic assertView(view: Uint8Array | null): Uint8Array | null;\n\tstatic assertView(view: Uint8Array | null): Uint8Array | null {\n\t\tif (view && !ArrayBuffer.isView(view)) {\n\t\t\tthrow new Error(`Method requires Uint8Array parameter; received \"${typeof view}\".`);\n\t\t}\n\t\treturn view as Uint8Array;\n\t}\n}\n","import type { vec3, vec4 } from '../constants';\n\n/**\n * # ColorUtils\n *\n * *Common utilities for working with colors in vec3, vec4, or hexadecimal form.*\n *\n * Provides methods to convert linear components (vec3, vec4) to sRGB hex values. All colors in\n * the glTF specification, excluding color textures, are linear. Hexadecimal values, in sRGB\n * colorspace, are accessible through helper functions in the API as a convenience.\n *\n * ```typescript\n * // Hex (sRGB) to factor (linear).\n * const factor = ColorUtils.hexToFactor(0xFFCCCC, []);\n *\n * // Factor (linear) to hex (sRGB).\n * const hex = ColorUtils.factorToHex([1, .25, .25])\n * ```\n *\n * @category Utilities\n */\nexport class ColorUtils {\n\t/**\n\t * Converts sRGB hexadecimal to linear components.\n\t * @typeParam T vec3 or vec4 linear components.\n\t */\n\tstatic hexToFactor<T = vec3 | vec4>(hex: number, target: T): T {\n\t\thex = Math.floor(hex);\n\t\tconst _target = target as unknown as vec3;\n\t\t_target[0] = ((hex >> 16) & 255) / 255;\n\t\t_target[1] = ((hex >> 8) & 255) / 255;\n\t\t_target[2] = (hex & 255) / 255;\n\t\treturn this.convertSRGBToLinear<T>(target, target);\n\t}\n\n\t/**\n\t * Converts linear components to sRGB hexadecimal.\n\t * @typeParam T vec3 or vec4 linear components.\n\t */\n\tstatic factorToHex<T = vec3 | vec4>(factor: T): number {\n\t\tconst target = [...(factor as unknown as number[])] as unknown as T;\n\t\tconst [r, g, b] = this.convertLinearToSRGB(factor, target) as unknown as number[];\n\t\treturn ((r * 255) << 16) ^ ((g * 255) << 8) ^ ((b * 255) << 0);\n\t}\n\n\t/**\n\t * Converts sRGB components to linear components.\n\t * @typeParam T vec3 or vec4 linear components.\n\t */\n\tstatic convertSRGBToLinear<T = vec3 | vec4>(source: T, target: T): T {\n\t\tconst _source = source as unknown as vec3;\n\t\tconst _target = target as unknown as vec3;\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t_target[i] =\n\t\t\t\t_source[i] < 0.04045\n\t\t\t\t\t? _source[i] * 0.0773993808\n\t\t\t\t\t: Math.pow(_source[i] * 0.9478672986 + 0.0521327014, 2.4);\n\t\t}\n\t\treturn target;\n\t}\n\n\t/**\n\t * Converts linear components to sRGB components.\n\t * @typeParam T vec3 or vec4 linear components.\n\t */\n\tstatic convertLinearToSRGB<T = vec3 | vec4>(source: T, target: T): T {\n\t\tconst _source = source as unknown as vec3;\n\t\tconst _target = target as unknown as vec3;\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t_target[i] = _source[i] < 0.0031308 ? _source[i] * 12.92 : 1.055 * Math.pow(_source[i], 0.41666) - 0.055;\n\t\t}\n\t\treturn target;\n\t}\n}\n","import type { vec2 } from '../constants';\nimport { BufferUtils } from './buffer-utils';\n\n/** Implements support for an image format in the {@link ImageUtils} class. */\nexport interface ImageUtilsFormat {\n\tmatch(buffer: Uint8Array): boolean;\n\tgetSize(buffer: Uint8Array): vec2 | null;\n\tgetChannels(buffer: Uint8Array): number | null;\n\tgetGPUByteLength?(buffer: Uint8Array): number | null;\n}\n\n/** JPEG image support. */\nclass JPEGImageUtils implements ImageUtilsFormat {\n\tmatch(array: Uint8Array): boolean {\n\t\treturn array.length >= 3 && array[0] === 255 && array[1] === 216 && array[2] === 255;\n\t}\n\tgetSize(array: Uint8Array): vec2 {\n\t\t// Skip 4 chars, they are for signature\n\t\tlet view = new DataView(array.buffer, array.byteOffset + 4);\n\n\t\tlet i: number, next: number;\n\t\twhile (view.byteLength) {\n\t\t\t// read length of the next block\n\t\t\ti = view.getUint16(0, false);\n\t\t\t// i = buffer.readUInt16BE(0);\n\n\t\t\t// ensure correct format\n\t\t\tvalidateJPEGBuffer(view, i);\n\n\t\t\t// 0xFFC0 is baseline standard(SOF)\n\t\t\t// 0xFFC1 is baseline optimized(SOF)\n\t\t\t// 0xFFC2 is progressive(SOF2)\n\t\t\tnext = view.getUint8(i + 1);\n\t\t\tif (next === 0xc0 || next === 0xc1 || next === 0xc2) {\n\t\t\t\treturn [view.getUint16(i + 7, false), view.getUint16(i + 5, false)];\n\t\t\t}\n\n\t\t\t// move to the next block\n\t\t\tview = new DataView(array.buffer, view.byteOffset + i + 2);\n\t\t}\n\n\t\tthrow new TypeError('Invalid JPG, no size found');\n\t}\n\n\tgetChannels(_buffer: Uint8Array): number {\n\t\treturn 3;\n\t}\n}\n\n/**\n * PNG image support.\n *\n * PNG signature: 'PNG\\r\\n\\x1a\\n'\n * PNG image header chunk name: 'IHDR'\n */\nclass PNGImageUtils implements ImageUtilsFormat {\n\t// Used to detect \"fried\" png's: http://www.jongware.com/pngdefry.html\n\tstatic PNG_FRIED_CHUNK_NAME = 'CgBI';\n\tmatch(array: Uint8Array): boolean {\n\t\treturn (\n\t\t\tarray.length >= 8 &&\n\t\t\tarray[0] === 0x89 &&\n\t\t\tarray[1] === 0x50 &&\n\t\t\tarray[2] === 0x4e &&\n\t\t\tarray[3] === 0x47 &&\n\t\t\tarray[4] === 0x0d &&\n\t\t\tarray[5] === 0x0a &&\n\t\t\tarray[6] === 0x1a &&\n\t\t\tarray[7] === 0x0a\n\t\t);\n\t}\n\tgetSize(array: Uint8Array): vec2 {\n\t\tconst view = new DataView(array.buffer, array.byteOffset);\n\t\tconst magic = BufferUtils.decodeText(array.slice(12, 16));\n\t\tif (magic === PNGImageUtils.PNG_FRIED_CHUNK_NAME) {\n\t\t\treturn [view.getUint32(32, false), view.getUint32(36, false)];\n\t\t}\n\t\treturn [view.getUint32(16, false), view.getUint32(20, false)];\n\t}\n\tgetChannels(_buffer: Uint8Array): number {\n\t\treturn 4;\n\t}\n}\n\n/**\n * # ImageUtils\n *\n * *Common utilities for working with image data.*\n *\n * @category Utilities\n */\nexport class ImageUtils {\n\tstatic impls: Record<string, ImageUtilsFormat> = {\n\t\t'image/jpeg': new JPEGImageUtils(),\n\t\t'image/png': new PNGImageUtils(),\n\t};\n\n\t/** Registers support for a new image format; useful for certain extensions. */\n\tpublic static registerFormat(mimeType: string, impl: ImageUtilsFormat): void {\n\t\tthis.impls[mimeType] = impl;\n\t}\n\n\t/**\n\t * Returns detected MIME type of the given image buffer. Note that for image\n\t * formats with support provided by extensions, the extension must be\n\t * registered with an I/O class before it can be detected by ImageUtils.\n\t */\n\tpublic static getMimeType(buffer: Uint8Array): string | null {\n\t\tfor (const mimeType in this.impls) {\n\t\t\tif (this.impls[mimeType].match(buffer)) {\n\t\t\t\treturn mimeType;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t/** Returns the dimensions of the image. */\n\tpublic static getSize(buffer: Uint8Array, mimeType: string): vec2 | null {\n\t\tif (!this.impls[mimeType]) return null;\n\t\treturn this.impls[mimeType].getSize(buffer);\n\t}\n\n\t/**\n\t * Returns a conservative estimate of the number of channels in the image. For some image\n\t * formats, the method may return 4 indicating the possibility of an alpha channel, without\n\t * the ability to guarantee that an alpha channel is present.\n\t */\n\tpublic static getChannels(buffer: Uint8Array, mimeType: string): number | null {\n\t\tif (!this.impls[mimeType]) return null;\n\t\treturn this.impls[mimeType].getChannels(buffer);\n\t}\n\n\t/** Returns a conservative estimate of the GPU memory required by this image. */\n\tpublic static getMemSize(buffer: Uint8Array, mimeType: string): number | null {\n\t\tif (!this.impls[mimeType]) return null;\n\n\t\tif (this.impls[mimeType].getGPUByteLength) {\n\t\t\treturn this.impls[mimeType].getGPUByteLength!(buffer);\n\t\t}\n\n\t\tlet uncompressedBytes = 0;\n\t\tconst channels = 4; // See https://github.com/donmccurdy/glTF-Transform/issues/151.\n\t\tconst resolution = this.getSize(buffer, mimeType);\n\t\tif (!resolution) return null;\n\n\t\twhile (resolution[0] > 1 || resolution[1] > 1) {\n\t\t\tuncompressedBytes += resolution[0] * resolution[1] * channels;\n\t\t\tresolution[0] = Math.max(Math.floor(resolution[0] / 2), 1);\n\t\t\tresolution[1] = Math.max(Math.floor(resolution[1] / 2), 1);\n\t\t}\n\t\tuncompressedBytes += 1 * 1 * channels;\n\t\treturn uncompressedBytes;\n\t}\n\n\t/** Returns the preferred file extension for the given MIME type. */\n\tpublic static mimeTypeToExtension(mimeType: string): string {\n\t\tif (mimeType === 'image/jpeg') return 'jpg';\n\t\treturn mimeType.split('/').pop()!;\n\t}\n\n\t/** Returns the MIME type for the given file extension. */\n\tpublic static extensionToMimeType(extension: string): string {\n\t\tif (extension === 'jpg') return 'image/jpeg';\n\t\treturn `image/${extension}`;\n\t}\n}\n\nfunction validateJPEGBuffer(view: DataView, i: number): DataView {\n\t// index should be within buffer limits\n\tif (i > view.byteLength) {\n\t\tthrow new TypeError('Corrupt JPG, exceeded buffer limits');\n\t}\n\t// Every JPEG block must begin with a 0xFF\n\tif (view.getUint8(i) !== 0xff) {\n\t\tthrow new TypeError('Invalid JPG, marker table corrupted');\n\t}\n\n\treturn view;\n}\n","import { ImageUtils } from './image-utils';\n\n/**\n * # FileUtils\n *\n * *Utility class for working with file systems and URI paths.*\n *\n * @category Utilities\n */\nexport class FileUtils {\n\t/**\n\t * Extracts the basename from a file path, e.g. \"folder/model.glb\" -> \"model\".\n\t * See: {@link HTTPUtils.basename}\n\t */\n\tstatic basename(uri: string): string {\n\t\tconst fileName = uri.split(/[\\\\/]/).pop()!;\n\t\treturn fileName.substring(0, fileName.lastIndexOf('.'));\n\t}\n\n\t/**\n\t * Extracts the extension from a file path, e.g. \"folder/model.glb\" -> \"glb\".\n\t * See: {@link HTTPUtils.extension}\n\t */\n\tstatic extension(uri: string): string {\n\t\tif (uri.startsWith('data:image/')) {\n\t\t\tconst mimeType = uri.match(/data:(image\\/\\w+)/)![1];\n\t\t\treturn ImageUtils.mimeTypeToExtension(mimeType);\n\t\t} else if (uri.startsWith('data:model/gltf+json')) {\n\t\t\treturn 'gltf';\n\t\t} else if (uri.startsWith('data:model/gltf-binary')) {\n\t\t\treturn 'glb';\n\t\t} else if (uri.startsWith('data:application/')) {\n\t\t\treturn 'bin';\n\t\t}\n\t\treturn uri.split(/[\\\\/]/).pop()!.split(/[.]/).pop()!;\n\t}\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n// Reference: https://github.com/jonschlinkert/is-plain-object\n\nfunction isObject(o: any) {\n\treturn Object.prototype.toString.call(o) === '[object Object]';\n}\n\nexport function isPlainObject(o: any) {\n\tif (isObject(o) === false) return false;\n\n\t// If has modified constructor\n\tconst ctor = o.constructor;\n\tif (ctor === undefined) return true;\n\n\t// If has modified prototype\n\tconst prot = ctor.prototype;\n\tif (isObject(prot) === false) return false;\n\n\t// If constructor does not have an Object-specific method\n\tif (Object.prototype.hasOwnProperty.call(prot, 'isPrototypeOf') === false) {\n\t\treturn false;\n\t}\n\n\t// Most likely a plain Object\n\treturn true;\n}\n","/**\n * # Logger\n *\n * *Logger utility class.*\n *\n * @category Utilities\n */\nclass Logger {\n\t/**\n\t * Log verbosity thresholds.\n\t */\n\tstatic Verbosity = {\n\t\t/** No events are logged. */\n\t\tSILENT: 4,\n\n\t\t/** Only error events are logged. */\n\t\tERROR: 3,\n\n\t\t/** Only error and warn events are logged. */\n\t\tWARN: 2,\n\n\t\t/** Only error, warn, and info events are logged. (DEFAULT) */\n\t\tINFO: 1,\n\n\t\t/** All events are logged. */\n\t\tDEBUG: 0,\n\t};\n\n\t/** Default logger instance. */\n\tpublic static DEFAULT_INSTANCE = new Logger(Logger.Verbosity.INFO);\n\n\t/** Constructs a new Logger instance. */\n\tconstructor(private readonly verbosity: number) {}\n\n\t/** Logs an event at level {@link Logger.Verbosity.DEBUG}. */\n\tdebug(text: string): void {\n\t\tif (this.verbosity <= Logger.Verbosity.DEBUG) {\n\t\t\tconsole.debug(text);\n\t\t}\n\t}\n\n\t/** Logs an event at level {@link Logger.Verbosity.INFO}. */\n\tinfo(text: string): void {\n\t\tif (this.verbosity <= Logger.Verbosity.INFO) {\n\t\t\tconsole.info(text);\n\t\t}\n\t}\n\n\t/** Logs an event at level {@link Logger.Verbosity.WARN}. */\n\twarn(text: string): void {\n\t\tif (this.verbosity <= Logger.Verbosity.WARN) {\n\t\t\tconsole.warn(text);\n\t\t}\n\t}\n\n\t/** Logs an event at level {@link Logger.Verbosity.ERROR}. */\n\terror(text: string): void {\n\t\tif (this.verbosity <= Logger.Verbosity.ERROR) {\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n}\n\nexport { Logger };\n","import { determinant, getRotation } from 'gl-matrix/mat4';\nimport { length } from 'gl-matrix/vec3';\nimport type { mat4, vec3, vec4 } from '../constants';\nimport type { GLTF } from '../types/gltf';\n\n/** @hidden */\nexport class MathUtils {\n\tpublic static identity(v: number): number {\n\t\treturn v;\n\t}\n\n\tpublic static eq(a: number[], b: number[]): boolean {\n\t\tif (a.length !== b.length) return false;\n\n\t\tconst eps = 10e-6;\n\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\tif (Math.abs(a[i] - b[i]) > eps) return false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic static denormalize(c: number, componentType: GLTF.AccessorComponentType): number {\n\t\t// Hardcode enums from accessor.ts to avoid a circular dependency.\n\t\tswitch (componentType) {\n\t\t\tcase 5126:\n\t\t\t\treturn c;\n\t\t\tcase 5123:\n\t\t\t\treturn c / 65535.0;\n\t\t\tcase 5121:\n\t\t\t\treturn c / 255.0;\n\t\t\tcase 5122:\n\t\t\t\treturn Math.max(c / 32767.0, -1.0);\n\t\t\tcase 5120:\n\t\t\t\treturn Math.max(c / 127.0, -1.0);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid component type.');\n\t\t}\n\t}\n\n\tpublic static normalize(f: number, componentType: GLTF.AccessorComponentType): number {\n\t\t// Hardcode enums from accessor.ts to avoid a circular dependency.\n\t\tswitch (componentType) {\n\t\t\tcase 5126:\n\t\t\t\treturn f;\n\t\t\tcase 5123:\n\t\t\t\treturn Math.round(f * 65535.0);\n\t\t\tcase 5121:\n\t\t\t\treturn Math.round(f * 255.0);\n\t\t\tcase 5122:\n\t\t\t\treturn Math.round(f * 32767.0);\n\t\t\tcase 5120:\n\t\t\t\treturn Math.round(f * 127.0);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid component type.');\n\t\t}\n\t}\n\n\t/**\n\t * Decompose a mat4 to TRS properties.\n\t *\n\t * Equivalent to the Matrix4 decompose() method in three.js, and intentionally not using the\n\t * gl-matrix version. See: https://github.com/toji/gl-matrix/issues/408\n\t *\n\t * @param srcMat Matrix element, to be decomposed to TRS properties.\n\t * @param dstTranslation Translation element, to be overwritten.\n\t * @param dstRotation Rotation element, to be overwritten.\n\t * @param dstScale Scale element, to be overwritten.\n\t */\n\tpublic static decompose(srcMat: mat4, dstTranslation: vec3, dstRotation: vec4, dstScale: vec3): void {\n\t\tlet sx = length([srcMat[0], srcMat[1], srcMat[2]]);\n\t\tconst sy = length([srcMat[4], srcMat[5], srcMat[6]]);\n\t\tconst sz = length([srcMat[8], srcMat[9], srcMat[10]]);\n\n\t\t// if determine is negative, we need to invert one scale\n\t\tconst det = determinant(srcMat);\n\t\tif (det < 0) sx = -sx;\n\n\t\tdstTranslation[0] = srcMat[12];\n\t\tdstTranslation[1] = srcMat[13];\n\t\tdstTranslation[2] = srcMat[14];\n\n\t\t// scale the rotation part\n\t\tconst _m1 = srcMat.slice();\n\n\t\tconst invSX = 1 / sx;\n\t\tconst invSY = 1 / sy;\n\t\tconst invSZ = 1 / sz;\n\n\t\t_m1[0] *= invSX;\n\t\t_m1[1] *= invSX;\n\t\t_m1[2] *= invSX;\n\n\t\t_m1[4] *= invSY;\n\t\t_m1[5] *= invSY;\n\t\t_m1[6] *= invSY;\n\n\t\t_m1[8] *= invSZ;\n\t\t_m1[9] *= invSZ;\n\t\t_m1[10] *= invSZ;\n\n\t\tgetRotation(dstRotation, _m1 as mat4);\n\n\t\tdstScale[0] = sx;\n\t\tdstScale[1] = sy;\n\t\tdstScale[2] = sz;\n\t}\n\n\t/**\n\t * Compose TRS properties to a mat4.\n\t *\n\t * Equivalent to the Matrix4 compose() method in three.js, and intentionally not using the\n\t * gl-matrix version. See: https://github.com/toji/gl-matrix/issues/408\n\t *\n\t * @param srcTranslation Translation element of matrix.\n\t * @param srcRotation Rotation element of matrix.\n\t * @param srcScale Scale element of matrix.\n\t * @param dstMat Matrix element, to be modified and returned.\n\t * @returns dstMat, overwritten to mat4 equivalent of given TRS properties.\n\t */\n\tpublic static compose(srcTranslation: vec3, srcRotation: vec4, srcScale: vec3, dstMat: mat4): mat4 {\n\t\tconst te = dstMat;\n\n\t\tconst x = srcRotation[0],\n\t\t\ty = srcRotation[1],\n\t\t\tz = srcRotation[2],\n\t\t\tw = srcRotation[3];\n\t\tconst x2 = x + x,\n\t\t\ty2 = y + y,\n\t\t\tz2 = z + z;\n\t\tconst xx = x * x2,\n\t\t\txy = x * y2,\n\t\t\txz = x * z2;\n\t\tconst yy = y * y2,\n\t\t\tyz = y * z2,\n\t\t\tzz = z * z2;\n\t\tconst wx = w * x2,\n\t\t\twy = w * y2,\n\t\t\twz = w * z2;\n\n\t\tconst sx = srcScale[0],\n\t\t\tsy = srcScale[1],\n\t\t\tsz = srcScale[2];\n\n\t\tte[0] = (1 - (yy + zz)) * sx;\n\t\tte[1] = (xy + wz) * sx;\n\t\tte[2] = (xz - wy) * sx;\n\t\tte[3] = 0;\n\n\t\tte[4] = (xy - wz) * sy;\n\t\tte[5] = (1 - (xx + zz)) * sy;\n\t\tte[6] = (yz + wx) * sy;\n\t\tte[7] = 0;\n\n\t\tte[8] = (xz + wy) * sz;\n\t\tte[9] = (yz - wx) * sz;\n\t\tte[10] = (1 - (xx + yy)) * sz;\n\t\tte[11] = 0;\n\n\t\tte[12] = srcTranslation[0];\n\t\tte[13] = srcTranslation[1];\n\t\tte[14] = srcTranslation[2];\n\t\tte[15] = 1;\n\n\t\treturn te;\n\t}\n}\n","import type { GraphEdge } from 'property-graph';\nimport { isPlainObject } from './is-plain-object';\nimport type { BufferViewUsage } from '../constants';\nimport type { Property } from '../properties';\n\nexport type Ref = GraphEdge<Property, Property>;\nexport type RefMap = { [key: string]: Ref };\nexport type UnknownRef = Ref | Ref[] | RefMap | unknown;\n\nexport function equalsRef(refA: Ref, refB: Ref): boolean {\n\tif (!!refA !== !!refB) return false;\n\n\tconst a = refA.getChild();\n\tconst b = refB.getChild();\n\n\treturn a === b || a.equals(b);\n}\n\nexport function equalsRefList(refListA: Ref[], refListB: Ref[]): boolean {\n\tif (!!refListA !== !!refListB) return false;\n\tif (refListA.length !== refListB.length) return false;\n\n\tfor (let i = 0; i < refListA.length; i++) {\n\t\tconst a = refListA[i];\n\t\tconst b = refListB[i];\n\n\t\tif (a.getChild() === b.getChild()) continue;\n\n\t\tif (!a.getChild().equals(b.getChild())) return false;\n\t}\n\n\treturn true;\n}\n\nexport function equalsRefMap(refMapA: RefMap, refMapB: RefMap): boolean {\n\tif (!!refMapA !== !!refMapB) return false;\n\n\tconst keysA = Object.keys(refMapA);\n\tconst keysB = Object.keys(refMapB);\n\tif (keysA.length !== keysB.length) return false;\n\n\tfor (const key in refMapA) {\n\t\tconst refA = refMapA[key];\n\t\tconst refB = refMapB[key];\n\t\tif (!!refA !== !!refB) return false;\n\n\t\tconst a = refA.getChild();\n\t\tconst b = refB.getChild();\n\t\tif (a === b) continue;\n\n\t\tif (!a.equals(b)) return false;\n\t}\n\n\treturn true;\n}\n\nexport function equalsArray(a: ArrayLike<unknown> | null, b: ArrayLike<unknown> | null): boolean {\n\tif (a === b) return true;\n\n\tif (!!a !== !!b || !a || !b) return false;\n\n\tif (a.length !== b.length) return false;\n\n\tfor (let i = 0; i < a.length; i++) {\n\t\tif (a[i] !== b[i]) return false;\n\t}\n\n\treturn true;\n}\n\nexport function equalsObject(_a: unknown, _b: unknown): boolean {\n\tif (_a === _b) return true;\n\tif (!!_a !== !!_b) return false;\n\tif (!isPlainObject(_a) || !isPlainObject(_b)) {\n\t\treturn _a === _b;\n\t}\n\n\tconst a = _a as Record<string, unknown>;\n\tconst b = _b as Record<string, unknown>;\n\n\tlet numKeysA = 0;\n\tlet numKeysB = 0;\n\n\tlet key: string;\n\n\tfor (key in a) numKeysA++;\n\tfor (key in b) numKeysB++;\n\tif (numKeysA !== numKeysB) return false;\n\n\tfor (key in a) {\n\t\tconst valueA = a[key];\n\t\tconst valueB = b[key];\n\t\tif (isArray(valueA) && isArray(valueB)) {\n\t\t\tif (!equalsArray(valueA as [], valueB as [])) return false;\n\t\t} else if (isPlainObject(valueA) && isPlainObject(valueB)) {\n\t\t\tif (!equalsObject(valueA, valueB)) return false;\n\t\t} else {\n\t\t\tif (valueA !== valueB) return false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport type RefAttributes = Record<string, unknown>;\n\nexport interface AccessorRefAttributes extends RefAttributes {\n\t/** Usage role of an accessor reference. */\n\tusage: BufferViewUsage | string;\n}\n\nexport interface TextureRefAttributes extends RefAttributes {\n\t/** Bitmask for {@link TextureChannel TextureChannels} used by a texture reference. */\n\tchannels: number;\n}\n\nexport function isArray(value: unknown): boolean {\n\treturn Array.isArray(value) || ArrayBuffer.isView(value);\n}\n","const ALPHABET = '23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ';\nconst UNIQUE_RETRIES = 999;\nconst ID_LENGTH = 6;\n\nconst previousIDs = new Set();\n\nconst generateOne = function (): string {\n\tlet rtn = '';\n\tfor (let i = 0; i < ID_LENGTH; i++) {\n\t\trtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));\n\t}\n\treturn rtn;\n};\n\n/**\n * Short ID generator.\n *\n * Generated IDs are short, easy to type, and unique for the duration of the program's execution.\n * Uniqueness across multiple program executions, or on other devices, is not guaranteed. Based on\n * [Short ID Generation in JavaScript](https://tomspencer.dev/blog/2014/11/16/short-id-generation-in-javascript/),\n * with alterations.\n *\n * @category Utilities\n * @hidden\n */\nexport const uuid = function (): string {\n\tfor (let retries = 0; retries < UNIQUE_RETRIES; retries++) {\n\t\tconst id = generateOne();\n\t\tif (!previousIDs.has(id)) {\n\t\t\tpreviousIDs.add(id);\n\t\t\treturn id;\n\t\t}\n\t}\n\treturn '';\n};\n","import { FileUtils } from './file-utils';\n\n// Need a placeholder domain to construct a URL from a relative path. We only\n// access `url.pathname`, so the domain doesn't matter.\nconst NULL_DOMAIN = 'https://null.example';\n\n/**\n * # HTTPUtils\n *\n * *Utility class for working with URLs.*\n *\n * @category Utilities\n */\nexport class HTTPUtils {\n\tstatic readonly DEFAULT_INIT: RequestInit = {};\n\tstatic readonly PROTOCOL_REGEXP = /^[a-zA-Z]+:\\/\\//;\n\n\tstatic dirname(path: string): string {\n\t\tconst index = path.lastIndexOf('/');\n\t\tif (index === -1) return './';\n\t\treturn path.substring(0, index + 1);\n\t}\n\n\t/**\n\t * Extracts the basename from a URL, e.g. \"folder/model.glb\" -> \"model\".\n\t * See: {@link FileUtils.basename}\n\t */\n\tstatic basename(uri: string): string {\n\t\treturn FileUtils.basename(new URL(uri, NULL_DOMAIN).pathname);\n\t}\n\n\t/**\n\t * Extracts the extension from a URL, e.g. \"folder/model.glb\" -> \"glb\".\n\t * See: {@link FileUtils.extension}\n\t */\n\tstatic extension(uri: string): string {\n\t\treturn FileUtils.extension(new URL(uri, NULL_DOMAIN).pathname);\n\t}\n\n\tstatic resolve(base: string, path: string) {\n\t\tif (!this.isRelativePath(path)) return path;\n\n\t\tconst stack = base.split('/');\n\t\tconst parts = path.split('/');\n\t\tstack.pop();\n\t\tfor (let i = 0; i < parts.length; i++) {\n\t\t\tif (parts[i] === '.') continue;\n\t\t\tif (parts[i] === '..') {\n\t\t\t\tstack.pop();\n\t\t\t} else {\n\t\t\t\tstack.push(parts[i]);\n\t\t\t}\n\t\t}\n\t\treturn stack.join('/');\n\t}\n\n\t/**\n\t * Returns true for URLs containing a protocol, and false for both\n\t * absolute and relative paths.\n\t */\n\tstatic isAbsoluteURL(path: string) {\n\t\treturn this.PROTOCOL_REGEXP.test(path);\n\t}\n\n\t/**\n\t * Returns true for paths that are declared relative to some unknown base\n\t * path. For example, \"foo/bar/\" is relative both \"/foo/bar/\" is not.\n\t */\n\tstatic isRelativePath(path: string): boolean {\n\t\treturn !/^(?:[a-zA-Z]+:)?\\//.test(path);\n\t}\n}\n","import type { Nullable } from '../constants';\nimport { $attributes, $immutableKeys, Graph, GraphNode, GraphEdge, isRef, isRefList, isRefMap } from 'property-graph';\nimport { equalsArray, equalsObject, equalsRef, equalsRefList, equalsRefMap, isArray, isPlainObject } from '../utils';\nimport type { Ref, RefMap, UnknownRef } from '../utils';\n\nexport type PropertyResolver<T extends Property> = (p: T) => T;\nexport const COPY_IDENTITY = <T extends Property>(t: T): T => t;\n\nexport interface IProperty {\n\tname: string;\n\textras: Record<string, unknown>;\n}\n\n/**\n * # Property\n *\n * *Properties represent distinct resources in a glTF asset, referenced by other properties.*\n *\n * For example, each material and texture is a property, with material properties holding\n * references to the textures. All properties are created with factory methods on the\n * {@link Document} in which they should be constructed. Properties are destroyed by calling\n * {@link dispose}().\n *\n * Usage:\n *\n * ```ts\n * const texture = doc.createTexture('myTexture');\n * doc.listTextures(); //  [texture x 1]\n *\n * // Attach a texture to a material.\n * material.setBaseColorTexture(texture);\n * material.getBaseColortexture(); //  texture\n *\n * // Detaching a texture removes any references to it, except from the doc.\n * texture.detach();\n * material.getBaseColorTexture(); //  null\n * doc.listTextures(); //  [texture x 1]\n *\n * // Disposing a texture removes all references to it, and its own references.\n * texture.dispose();\n * doc.listTextures(); //  []\n * ```\n *\n * Reference:\n * - [glTF  Concepts](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#concepts)\n *\n * @category Properties\n */\nexport abstract class Property<T extends IProperty = IProperty> extends GraphNode<T> {\n\t/** Property type. */\n\tpublic abstract readonly propertyType: string;\n\n\t/**\n\t * Internal graph used to search and maintain references.\n\t * @override\n\t * @hidden\n\t */\n\tprotected declare readonly graph: Graph<Property>;\n\n\t/** @hidden */\n\tconstructor(graph: Graph<Property>, name = '') {\n\t\tsuper(graph);\n\t\t(this as Property)[$attributes]['name'] = name;\n\t\tthis.init();\n\t\tthis.dispatchEvent({ type: 'create' });\n\t}\n\n\t/**\n\t * Initializes instance data for a subclass. Because subclass constructors run after the\n\t * constructor of the parent class, and 'create' events dispatched by the parent class\n\t * assume the instance is fully initialized, it's best to do any initialization here.\n\t * @hidden\n\t */\n\tprotected abstract init(): void;\n\n\t/**\n\t * Returns default attributes for the property. Empty lists and maps should be initialized\n\t * to empty arrays and objects. Always invoke `super.getDefaults()` and extend the result.\n\t */\n\tprotected getDefaults(): Nullable<T> {\n\t\treturn Object.assign(super.getDefaults(), { name: '', extras: {} });\n\t}\n\n\t/**********************************************************************************************\n\t * Name.\n\t */\n\n\t/**\n\t * Returns the name of this property. While names are not required to be unique, this is\n\t * encouraged, and non-unique names will be overwritten in some tools. For custom data about\n\t * a property, prefer to use Extras.\n\t */\n\tpublic getName(): string {\n\t\treturn (this as Property).get('name');\n\t}\n\n\t/**\n\t * Sets the name of this property. While names are not required to be unique, this is\n\t * encouraged, and non-unique names will be overwritten in some tools. For custom data about\n\t * a property, prefer to use Extras.\n\t */\n\tpublic setName(name: string): this {\n\t\treturn (this as Property).set('name', name) as this;\n\t}\n\n\t/**********************************************************************************************\n\t * Extras.\n\t */\n\n\t/**\n\t * Returns a reference to the Extras object, containing application-specific data for this\n\t * Property. Extras should be an Object, not a primitive value, for best portability.\n\t */\n\tpublic getExtras(): Record<string, unknown> {\n\t\treturn (this as Property).get('extras');\n\t}\n\n\t/**\n\t * Updates the Extras object, containing application-specific data for this Property. Extras\n\t * should be an Object, not a primitive value, for best portability.\n\t */\n\tpublic setExtras(extras: Record<string, unknown>): this {\n\t\treturn (this as Property).set('extras', extras) as this;\n\t}\n\n\t/**********************************************************************************************\n\t * Graph state.\n\t */\n\n\t/**\n\t * Makes a copy of this property, with the same resources (by reference) as the original.\n\t */\n\tpublic clone(): this {\n\t\tconst PropertyClass = this.constructor as new (g: Graph<Property>) => this;\n\t\treturn new PropertyClass(this.graph).copy(this, COPY_IDENTITY);\n\t}\n\n\t/**\n\t * Copies all data from another property to this one. Child properties are copied by reference,\n\t * unless a 'resolve' function is given to override that.\n\t * @param other Property to copy references from.\n\t * @param resolve Function to resolve each Property being transferred. Default is identity.\n\t */\n\tpublic copy(other: this, resolve: PropertyResolver<Property> = COPY_IDENTITY): this {\n\t\t// Remove previous references.\n\t\tfor (const key in this[$attributes]) {\n\t\t\tconst value = this[$attributes][key];\n\t\t\tif (value instanceof GraphEdge) {\n\t\t\t\tif (!this[$immutableKeys].has(key)) {\n\t\t\t\t\tvalue.dispose();\n\t\t\t\t}\n\t\t\t} else if (Array.isArray(value) && value[0] instanceof GraphEdge) {\n\t\t\t\tfor (const ref of value as Ref[]) {\n\t\t\t\t\tref.dispose();\n\t\t\t\t}\n\t\t\t} else if (isPlainObject(value) && Object.values(value)[0] instanceof GraphEdge) {\n\t\t\t\tfor (const subkey in value) {\n\t\t\t\t\tconst ref = value[subkey] as Ref;\n\t\t\t\t\tref.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add new references.\n\t\tfor (const key in other[$attributes]) {\n\t\t\tconst thisValue = this[$attributes][key];\n\t\t\tconst otherValue = other[$attributes][key];\n\t\t\tif (otherValue instanceof GraphEdge) {\n\t\t\t\tif (this[$immutableKeys].has(key)) {\n\t\t\t\t\tconst ref = thisValue as unknown as Ref;\n\t\t\t\t\tref.getChild().copy(resolve(otherValue.getChild()), resolve);\n\t\t\t\t} else {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\t\tthis.setRef(key as any, resolve(otherValue.getChild()), otherValue.getAttributes());\n\t\t\t\t}\n\t\t\t} else if (Array.isArray(otherValue) && otherValue[0] instanceof GraphEdge) {\n\t\t\t\tfor (const ref of otherValue as Ref[]) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\t\tthis.addRef(key as any, resolve(ref.getChild()), ref.getAttributes());\n\t\t\t\t}\n\t\t\t} else if (isPlainObject(otherValue) && Object.values(otherValue)[0] instanceof GraphEdge) {\n\t\t\t\tfor (const subkey in otherValue) {\n\t\t\t\t\tconst ref = otherValue[subkey] as Ref;\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\t\tthis.setRefMap(key as any, subkey, resolve(ref.getChild()), ref.getAttributes());\n\t\t\t\t}\n\t\t\t} else if (isPlainObject(otherValue)) {\n\t\t\t\tthis[$attributes][key] = JSON.parse(JSON.stringify(otherValue));\n\t\t\t} else if (\n\t\t\t\tArray.isArray(otherValue) ||\n\t\t\t\totherValue instanceof ArrayBuffer ||\n\t\t\t\tArrayBuffer.isView(otherValue)\n\t\t\t) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\tthis[$attributes][key] = (otherValue as unknown as Uint8Array).slice() as any;\n\t\t\t} else {\n\t\t\t\tthis[$attributes][key] = otherValue;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns true if two properties are deeply equivalent, recursively comparing the attributes\n\t * of the properties. For example, two {@link Primitive Primitives} are equivalent if they\n\t * have accessors and materials with equivalent content  but not necessarily the same specific\n\t * accessors and materials.\n\t */\n\tpublic equals(other: this): boolean {\n\t\tif (this === other) return true;\n\t\tif (this.propertyType !== other.propertyType) return false;\n\n\t\tfor (const key in this[$attributes]) {\n\t\t\tconst a = this[$attributes][key] as UnknownRef;\n\t\t\tconst b = other[$attributes][key] as UnknownRef;\n\n\t\t\tif (isRef(a) || isRef(b)) {\n\t\t\t\tif (!equalsRef(a as Ref, b as Ref)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (isRefList(a) || isRefList(b)) {\n\t\t\t\tif (!equalsRefList(a as Ref[], b as Ref[])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (isRefMap(a) || isRefMap(b)) {\n\t\t\t\tif (!equalsRefMap(a as RefMap, b as RefMap)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (isPlainObject(a) || isPlainObject(b)) {\n\t\t\t\tif (!equalsObject(a, b)) return false;\n\t\t\t} else if (isArray(a) || isArray(b)) {\n\t\t\t\tif (!equalsArray(a as [], b as [])) return false;\n\t\t\t} else {\n\t\t\t\t// Literal.\n\t\t\t\tif (a !== b) return false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic detach(): this {\n\t\t// Detaching should keep properties in the same Document, and attached to its root.\n\t\tthis.graph.disconnectParents(this, (n: Property) => n.propertyType !== 'Root');\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns a list of all properties that hold a reference to this property. For example, a\n\t * material may hold references to various textures, but a texture does not hold references\n\t * to the materials that use it.\n\t *\n\t * It is often necessary to filter the results for a particular type: some resources, like\n\t * {@link Accessor}s, may be referenced by different types of properties. Most properties\n\t * include the {@link Root} as a parent, which is usually not of interest.\n\t *\n\t * Usage:\n\t *\n\t * ```ts\n\t * const materials = texture\n\t * \t.listParents()\n\t * \t.filter((p) => p instanceof Material)\n\t * ```\n\t */\n\tpublic listParents(): Property[] {\n\t\treturn this.graph.listParents(this);\n\t}\n}\n","import type { Nullable } from '../constants';\nimport type { ExtensionProperty } from './extension-property';\nimport { Property, IProperty } from './property';\n\nexport interface IExtensibleProperty extends IProperty {\n\textensions: { [key: string]: ExtensionProperty };\n}\n\n/**\n * # ExtensibleProperty\n *\n * *A {@link Property} that can have {@link ExtensionProperty} instances attached.*\n *\n * Most properties are extensible. See the {@link Extension} documentation for information about\n * how to use extensions.\n *\n * @category Properties\n */\nexport abstract class ExtensibleProperty<T extends IExtensibleProperty = IExtensibleProperty> extends Property<T> {\n\tprotected getDefaults(): Nullable<T> {\n\t\treturn Object.assign(super.getDefaults(), { extensions: {} });\n\t}\n\n\t/** Returns an {@link ExtensionProperty} attached to this Property, if any. */\n\tpublic getExtension<Prop extends ExtensionProperty>(name: string): Prop | null {\n\t\treturn (this as ExtensibleProperty).getRefMap('extensions', name) as Prop;\n\t}\n\n\t/**\n\t * Attaches the given {@link ExtensionProperty} to this Property. For a given extension, only\n\t * one ExtensionProperty may be attached to any one Property at a time.\n\t */\n\tpublic setExtension<Prop extends ExtensionProperty>(name: string, extensionProperty: Prop | null): this {\n\t\tif (extensionProperty) extensionProperty._validateParent(this as ExtensibleProperty);\n\t\treturn (this as ExtensibleProperty).setRefMap('extensions', name, extensionProperty) as this;\n\t}\n\n\t/** Lists all {@link ExtensionProperty} instances attached to this Property. */\n\tpublic listExtensions(): ExtensionProperty[] {\n\t\treturn (this as ExtensibleProperty).listRefMapValues('extensions');\n\t}\n}\n","import { Nullable, PropertyType, TypedArray } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport { MathUtils } from '../utils';\nimport type { Buffer } from './buffer';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport { COPY_IDENTITY } from './property';\n\ninterface IAccessor extends IExtensibleProperty {\n\tarray: TypedArray | null;\n\ttype: GLTF.AccessorType;\n\tcomponentType: GLTF.AccessorComponentType;\n\tnormalized: boolean;\n\tbuffer: Buffer;\n}\n\n/**\n * # Accessor\n *\n * *Accessors store lists of numeric, vector, or matrix elements in a typed array.*\n *\n * All large data for {@link Mesh}, {@link Skin}, and {@link Animation} properties is stored in\n * {@link Accessor}s, organized into one or more {@link Buffer}s. Each accessor provides data in\n * typed arrays, with two abstractions:\n *\n * *Elements* are the logical divisions of the data into useful types: `\"SCALAR\"`, `\"VEC2\"`,\n * `\"VEC3\"`, `\"VEC4\"`, `\"MAT3\"`, or `\"MAT4\"`. The element type can be determined with the\n * {@link getType}() method, and the number of elements in the accessor determine its\n * {@link getCount}(). The number of components in an element  e.g. 9 for `\"MAT3\"`  are its\n * {@link getElementSize}(). See {@link Accessor.Type}.\n *\n * *Components* are the numeric values within an element  e.g. `.x` and `.y` for `\"VEC2\"`. Various\n * component types are available: `BYTE`, `UNSIGNED_BYTE`, `SHORT`, `UNSIGNED_SHORT`,\n * `UNSIGNED_INT`, and `FLOAT`. The component type can be determined with the\n * {@link getComponentType} method, and the number of bytes in each component determine its\n * {@link getComponentSize}. See {@link Accessor.ComponentType}.\n *\n * Usage:\n *\n * ```typescript\n * const accessor = doc.createAccessor('myData')\n * \t.setArray(new Float32Array([1,2,3,4,5,6,7,8,9,10,11,12]))\n * \t.setType(Accessor.Type.VEC3)\n * \t.setBuffer(doc.listBuffers()[0]);\n *\n * accessor.getCount();        //  4\n * accessor.getElementSize();  //  3\n * accessor.getByteLength();   //  48\n * accessor.getElement(1, []); //  [4, 5, 6]\n *\n * accessor.setElement(0, [10, 20, 30]);\n * ```\n *\n * Data access through the {@link getElement} and {@link setElement} methods reads or overwrites\n * the content of the underlying typed array. These methods use element arrays intended to be\n * compatible with the [gl-matrix](https://github.com/toji/gl-matrix) library, or with the\n * `toArray`/`fromArray` methods of libraries like three.js and babylon.js.\n *\n * Each Accessor must be assigned to a {@link Buffer}, which determines where the accessor's data\n * is stored in the final file. Assigning Accessors to different Buffers allows the data to be\n * written to different `.bin` files.\n *\n * glTF-Transform does not expose many details of sparse, normalized, or interleaved accessors\n * through its API. It reads files using those techniques, presents a simplified view of the data\n * for editing, and attempts to write data back out with optimizations. For example, vertex\n * attributes will typically be interleaved by default, regardless of the input file.\n *\n * References:\n * - [glTF  Accessors](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#accessors)\n *\n * @category Properties\n */\nexport class Accessor extends ExtensibleProperty<IAccessor> {\n\tpublic declare propertyType: PropertyType.ACCESSOR;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\t/** Element type contained by the accessor (SCALAR, VEC2, ...). */\n\tpublic static Type: Record<string, GLTF.AccessorType> = {\n\t\t/** Scalar, having 1 value per element. */\n\t\tSCALAR: 'SCALAR',\n\t\t/** 2-component vector, having 2 components per element. */\n\t\tVEC2: 'VEC2',\n\t\t/** 3-component vector, having 3 components per element. */\n\t\tVEC3: 'VEC3',\n\t\t/** 4-component vector, having 4 components per element. */\n\t\tVEC4: 'VEC4',\n\t\t/** 2x2 matrix, having 4 components per element. */\n\t\tMAT2: 'MAT2',\n\t\t/** 3x3 matrix, having 9 components per element. */\n\t\tMAT3: 'MAT3',\n\t\t/** 4x3 matrix, having 16 components per element. */\n\t\tMAT4: 'MAT4',\n\t};\n\n\t/** Data type of the values composing each element in the accessor. */\n\tpublic static ComponentType: Record<string, GLTF.AccessorComponentType> = {\n\t\t/**\n\t\t * 1-byte signed integer, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Int8Array Int8Array}.\n\t\t */\n\t\tBYTE: 5120,\n\t\t/**\n\t\t * 1-byte unsigned integer, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array Uint8Array}.\n\t\t */\n\t\tUNSIGNED_BYTE: 5121,\n\t\t/**\n\t\t * 2-byte signed integer, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array Uint16Array}.\n\t\t */\n\t\tSHORT: 5122,\n\t\t/**\n\t\t * 2-byte unsigned integer, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array Uint16Array}.\n\t\t */\n\t\tUNSIGNED_SHORT: 5123,\n\t\t/**\n\t\t * 4-byte unsigned integer, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array Uint32Array}.\n\t\t */\n\t\tUNSIGNED_INT: 5125,\n\t\t/**\n\t\t * 4-byte floating point number, stored as\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float32Array Float32Array}.\n\t\t */\n\t\tFLOAT: 5126,\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.ACCESSOR;\n\t}\n\n\tprotected getDefaults(): Nullable<IAccessor> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\tarray: null,\n\t\t\ttype: Accessor.Type.SCALAR,\n\t\t\tcomponentType: Accessor.ComponentType.FLOAT,\n\t\t\tnormalized: false,\n\t\t\tbuffer: null,\n\t\t});\n\t}\n\n\t/** @internal Inbound transform to normalized representation, if applicable. */\n\tprivate _in = MathUtils.identity;\n\n\t/** @internal Outbound transform from normalized representation, if applicable. */\n\tprivate _out = MathUtils.identity;\n\n\tpublic copy(other: this, resolve = COPY_IDENTITY): this {\n\t\tsuper.copy(other, resolve);\n\t\tthis._in = other._in;\n\t\tthis._out = other._out;\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Static.\n\t */\n\n\t/** Returns size of a given element type, in components. */\n\tpublic static getElementSize(type: GLTF.AccessorType): number {\n\t\tswitch (type) {\n\t\t\tcase Accessor.Type.SCALAR:\n\t\t\t\treturn 1;\n\t\t\tcase Accessor.Type.VEC2:\n\t\t\t\treturn 2;\n\t\t\tcase Accessor.Type.VEC3:\n\t\t\t\treturn 3;\n\t\t\tcase Accessor.Type.VEC4:\n\t\t\t\treturn 4;\n\t\t\tcase Accessor.Type.MAT2:\n\t\t\t\treturn 4;\n\t\t\tcase Accessor.Type.MAT3:\n\t\t\t\treturn 9;\n\t\t\tcase Accessor.Type.MAT4:\n\t\t\t\treturn 16;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unexpected type: ' + type);\n\t\t}\n\t}\n\n\t/** Returns size of a given component type, in bytes. */\n\tpublic static getComponentSize(componentType: GLTF.AccessorComponentType): number {\n\t\tswitch (componentType) {\n\t\t\tcase Accessor.ComponentType.BYTE:\n\t\t\t\treturn 1;\n\t\t\tcase Accessor.ComponentType.UNSIGNED_BYTE:\n\t\t\t\treturn 1;\n\t\t\tcase Accessor.ComponentType.SHORT:\n\t\t\t\treturn 2;\n\t\t\tcase Accessor.ComponentType.UNSIGNED_SHORT:\n\t\t\t\treturn 2;\n\t\t\tcase Accessor.ComponentType.UNSIGNED_INT:\n\t\t\t\treturn 4;\n\t\t\tcase Accessor.ComponentType.FLOAT:\n\t\t\t\treturn 4;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unexpected component type: ' + componentType);\n\t\t}\n\t}\n\n\t/**********************************************************************************************\n\t * Min/max bounds.\n\t */\n\n\t/**\n\t * Minimum value of each component in this attribute. Unlike in a final glTF file, values\n\t * returned by this method will reflect the minimum accounting for {@link .normalized}\n\t * state.\n\t */\n\tpublic getMinNormalized(target: number[]): number[] {\n\t\tconst elementSize = this.getElementSize();\n\n\t\tthis.getMin(target);\n\n\t\tfor (let j = 0; j < elementSize; j++) target[j] = this._out(target[j]);\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Minimum value of each component in this attribute. Values returned by this method do not\n\t * reflect normalization: use {@link .getMinNormalized} in that case.\n\t */\n\tpublic getMin(target: number[]): number[] {\n\t\tconst array = this.get('array');\n\t\tconst count = this.getCount();\n\t\tconst elementSize = this.getElementSize();\n\n\t\tfor (let j = 0; j < elementSize; j++) target[j] = Infinity;\n\n\t\tfor (let i = 0; i < count * elementSize; i += elementSize) {\n\t\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\t\tconst value = array![i + j];\n\t\t\t\tif (Number.isFinite(value)) {\n\t\t\t\t\ttarget[j] = Math.min(target[j], value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Maximum value of each component in this attribute. Unlike in a final glTF file, values\n\t * returned by this method will reflect the minimum accounting for {@link .normalized}\n\t * state.\n\t */\n\tpublic getMaxNormalized(target: number[]): number[] {\n\t\tconst elementSize = this.getElementSize();\n\n\t\tthis.getMax(target);\n\n\t\tfor (let j = 0; j < elementSize; j++) target[j] = this._out(target[j]);\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Maximum value of each component in this attribute. Values returned by this method do not\n\t * reflect normalization: use {@link .getMinNormalized} in that case.\n\t */\n\tpublic getMax(target: number[]): number[] {\n\t\tconst array = this.get('array');\n\t\tconst count = this.getCount();\n\t\tconst elementSize = this.getElementSize();\n\n\t\tfor (let j = 0; j < elementSize; j++) target[j] = -Infinity;\n\n\t\tfor (let i = 0; i < count * elementSize; i += elementSize) {\n\t\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\t\tconst value = array![i + j];\n\t\t\t\tif (Number.isFinite(value)) {\n\t\t\t\t\ttarget[j] = Math.max(target[j], value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**********************************************************************************************\n\t * Layout.\n\t */\n\n\t/**\n\t * Number of elements in the accessor. An array of length 30, containing 10 `VEC3` elements,\n\t * will have a count of 10.\n\t */\n\tpublic getCount(): number {\n\t\tconst array = this.get('array');\n\t\treturn array ? array.length / this.getElementSize() : 0;\n\t}\n\n\t/** Type of element stored in the accessor. `VEC2`, `VEC3`, etc. */\n\tpublic getType(): GLTF.AccessorType {\n\t\treturn this.get('type');\n\t}\n\n\t/**\n\t * Sets type of element stored in the accessor. `VEC2`, `VEC3`, etc. Array length must be a\n\t * multiple of the component size (`VEC2` = 2, `VEC3` = 3, ...) for the selected type.\n\t */\n\tpublic setType(type: GLTF.AccessorType): Accessor {\n\t\treturn this.set('type', type);\n\t}\n\n\t/**\n\t * Number of components in each element of the accessor. For example, the element size of a\n\t * `VEC2` accessor is 2. This value is determined automatically based on array length and\n\t * accessor type, specified with {@link setType}().\n\t */\n\tpublic getElementSize(): number {\n\t\treturn Accessor.getElementSize(this.get('type'));\n\t}\n\n\t/**\n\t * Size of each component (a value in the raw array), in bytes. For example, the\n\t * `componentSize` of data backed by a `float32` array is 4 bytes.\n\t */\n\tpublic getComponentSize(): number {\n\t\treturn this.get('array')!.BYTES_PER_ELEMENT;\n\t}\n\n\t/**\n\t * Component type (float32, uint16, etc.). This value is determined automatically, and can only\n\t * be modified by replacing the underlying array.\n\t */\n\tpublic getComponentType(): GLTF.AccessorComponentType {\n\t\treturn this.get('componentType');\n\t}\n\n\t/**********************************************************************************************\n\t * Normalization.\n\t */\n\n\t/**\n\t * Specifies whether integer data values should be normalized (true) to [0, 1] (for unsigned\n\t * types) or [-1, 1] (for signed types), or converted directly (false) when they are accessed.\n\t * This property is defined only for accessors that contain vertex attributes or animation\n\t * output data.\n\t */\n\tpublic getNormalized(): boolean {\n\t\treturn this.get('normalized');\n\t}\n\n\t/**\n\t * Specifies whether integer data values should be normalized (true) to [0, 1] (for unsigned\n\t * types) or [-1, 1] (for signed types), or converted directly (false) when they are accessed.\n\t * This property is defined only for accessors that contain vertex attributes or animation\n\t * output data.\n\t */\n\tpublic setNormalized(normalized: boolean): this {\n\t\tthis.set('normalized', normalized);\n\n\t\tif (normalized) {\n\t\t\tthis._out = (c: number): number => MathUtils.denormalize(c, this.get('componentType'));\n\t\t\tthis._in = (f: number): number => MathUtils.normalize(f, this.get('componentType'));\n\t\t} else {\n\t\t\tthis._out = MathUtils.identity;\n\t\t\tthis._in = MathUtils.identity;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Data access.\n\t */\n\n\t/**\n\t * Returns the scalar element value at the given index, accounting for normalization if\n\t * applicable.\n\t */\n\tpublic getScalar(index: number): number {\n\t\tconst elementSize = this.getElementSize();\n\t\treturn this._out(this.get('array')![index * elementSize]);\n\t}\n\n\t/**\n\t * Assigns the scalar element value at the given index, accounting for normalization if\n\t * applicable.\n\t */\n\tpublic setScalar(index: number, x: number): this {\n\t\tthis.get('array')![index * this.getElementSize()] = this._in(x);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns the vector or matrix element value at the given index, accounting for normalization\n\t * if applicable.\n\t */\n\tpublic getElement(index: number, target: number[]): number[] {\n\t\tconst elementSize = this.getElementSize();\n\t\tconst array = this.get('array')!;\n\t\tfor (let i = 0; i < elementSize; i++) {\n\t\t\ttarget[i] = this._out(array[index * elementSize + i]);\n\t\t}\n\t\treturn target;\n\t}\n\n\t/**\n\t * Assigns the vector or matrix element value at the given index, accounting for normalization\n\t * if applicable.\n\t */\n\tpublic setElement(index: number, value: number[]): this {\n\t\tconst elementSize = this.getElementSize();\n\t\tconst array = this.get('array')!;\n\t\tfor (let i = 0; i < elementSize; i++) {\n\t\t\tarray![index * elementSize + i] = this._in(value[i]);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Raw data storage.\n\t */\n\n\t/** Returns the {@link Buffer} into which this accessor will be organized. */\n\tpublic getBuffer(): Buffer | null {\n\t\treturn this.getRef('buffer');\n\t}\n\n\t/** Assigns the {@link Buffer} into which this accessor will be organized. */\n\tpublic setBuffer(buffer: Buffer | null): this {\n\t\treturn this.setRef('buffer', buffer);\n\t}\n\n\t/** Returns the raw typed array underlying this accessor. */\n\tpublic getArray(): TypedArray | null {\n\t\treturn this.get('array');\n\t}\n\n\t/** Assigns the raw typed array underlying this accessor. */\n\tpublic setArray(array: TypedArray): this {\n\t\tthis.set('componentType', array ? arrayToComponentType(array) : Accessor.ComponentType.FLOAT);\n\t\tthis.set('array', array);\n\t\treturn this;\n\t}\n\n\t/** Returns the total bytelength of this accessor, exclusive of padding. */\n\tpublic getByteLength(): number {\n\t\tconst array = this.get('array');\n\t\treturn array ? array.byteLength : 0;\n\t}\n}\n\n/**************************************************************************************************\n * Accessor utilities.\n */\n\n/** @internal */\nfunction arrayToComponentType(array: TypedArray): GLTF.AccessorComponentType {\n\tswitch (array.constructor) {\n\t\tcase Float32Array:\n\t\t\treturn Accessor.ComponentType.FLOAT;\n\t\tcase Uint32Array:\n\t\t\treturn Accessor.ComponentType.UNSIGNED_INT;\n\t\tcase Uint16Array:\n\t\t\treturn Accessor.ComponentType.UNSIGNED_SHORT;\n\t\tcase Uint8Array:\n\t\t\treturn Accessor.ComponentType.UNSIGNED_BYTE;\n\t\tcase Int16Array:\n\t\t\treturn Accessor.ComponentType.SHORT;\n\t\tcase Int8Array:\n\t\t\treturn Accessor.ComponentType.BYTE;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown accessor componentType.');\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport type { AnimationChannel } from './animation-channel';\nimport type { AnimationSampler } from './animation-sampler';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface IAnimation extends IExtensibleProperty {\n\tchannels: AnimationChannel[];\n\tsamplers: AnimationSampler[];\n}\n\n/**\n * # Animation\n *\n * *Reusable collections of {@link AnimationChannel}s, together representing a discrete animation\n * clip.*\n *\n * One Animation represents one playable unit in an animation system. Each may contain channels\n * affecting multiple paths (`translation`, `rotation`, `scale`, or `weights`) on multiple\n * {@link Node}s. An Animation's channels must be played together, and do not have any meaning in\n * isolation.\n *\n * Multiple Animations _may_ be played together: for example, one character's _Walk_ animation\n * might play while another character's _Run_ animation plays. Or a single character might have\n * both an _Idle_ and a _Talk_ animation playing at the same time. However, glTF does not define\n * any particular relationship between top-level Animations, or any particular playback behavior\n * like looping or sequences of Animations. General-purpose viewers typically autoplay the first\n * animation and provide UI controls for choosing another. Game engines may have significantly\n * more advanced methods of playing and blending animations.\n *\n * For example, a very simple skinned {@link Mesh} might have two Animations, _Idle_ and _Walk_.\n * Each of those Animations might affect the rotations of two bones, _LegL_ and _LegR_, where the\n * keyframes for each target-path pair are stored in {@link AnimationChannel} instances. In  total,\n * this model would contain two Animations and Four {@link AnimationChannel}s.\n *\n * Usage:\n *\n * ```ts\n * const animation = doc.createAnimation('machineRun')\n * \t.addChannel(rotateCog1)\n * \t.addChannel(rotateCog2)\n * \t.addChannel(rotateCog3);\n * ```\n *\n * Reference\n * - [glTF  Animations](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#animations)\n */\nexport class Animation extends ExtensibleProperty<IAnimation> {\n\tpublic declare propertyType: PropertyType.ANIMATION;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.ANIMATION;\n\t}\n\n\tprotected getDefaults(): Nullable<IAnimation> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { channels: [], samplers: [] });\n\t}\n\n\t/** Adds an {@link AnimationChannel} to this Animation. */\n\tpublic addChannel(channel: AnimationChannel): this {\n\t\treturn this.addRef('channels', channel);\n\t}\n\n\t/** Removes an {@link AnimationChannel} from this Animation. */\n\tpublic removeChannel(channel: AnimationChannel): this {\n\t\treturn this.removeRef('channels', channel);\n\t}\n\n\t/** Lists {@link AnimationChannel}s in this Animation. */\n\tpublic listChannels(): AnimationChannel[] {\n\t\treturn this.listRefs('channels');\n\t}\n\n\t/** Adds an {@link AnimationSampler} to this Animation. */\n\tpublic addSampler(sampler: AnimationSampler): this {\n\t\treturn this.addRef('samplers', sampler);\n\t}\n\n\t/** Removes an {@link AnimationSampler} from this Animation. */\n\tpublic removeSampler(sampler: AnimationSampler): this {\n\t\treturn this.removeRef('samplers', sampler);\n\t}\n\n\t/** Lists {@link AnimationSampler}s in this Animation. */\n\tpublic listSamplers(): AnimationSampler[] {\n\t\treturn this.listRefs('samplers');\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport type { AnimationSampler } from './animation-sampler';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Node } from './node';\n\ninterface IAnimationChannel extends IExtensibleProperty {\n\ttargetPath: GLTF.AnimationChannelTargetPath | null;\n\ttargetNode: Node;\n\tsampler: AnimationSampler;\n}\n\n/**\n * # AnimationChannel\n *\n * *A target-path pair within a larger {@link Animation}, which refers to an\n * {@link AnimationSampler} storing the keyframe data for that pair.*\n *\n * A _target_ is always a {@link Node}, in the core glTF spec. A _path_ is any property of that\n * Node that can be affected by animation: `translation`, `rotation`, `scale`, or `weights`. An\n * {@link Animation} affecting the positions and rotations of several {@link Node}s would contain\n * one channel for each Node-position or Node-rotation pair. The keyframe data for an\n * AnimationChannel is stored in an {@link AnimationSampler}, which must be attached to the same\n * {@link Animation}.\n *\n * Usage:\n *\n * ```ts\n * const node = doc.getRoot()\n * \t.listNodes()\n * \t.find((node) => node.getName() === 'Cog');\n *\n * const channel = doc.createAnimationChannel('cogRotation')\n * \t.setTargetPath('rotation')\n * \t.setTargetNode(node)\n * \t.setSampler(rotateSampler);\n * ```\n *\n * Reference\n * - [glTF  Animations](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#animations)\n */\nexport class AnimationChannel extends ExtensibleProperty<IAnimationChannel> {\n\tpublic declare propertyType: PropertyType.ANIMATION_CHANNEL;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\t/** Name of the property to be modified by an animation channel. */\n\tpublic static TargetPath: Record<string, GLTF.AnimationChannelTargetPath> = {\n\t\t/** Channel targets {@link Node.setTranslation}. */\n\t\tTRANSLATION: 'translation',\n\t\t/** Channel targets {@link Node.setRotation}. */\n\t\tROTATION: 'rotation',\n\t\t/** Channel targets {@link Node.setScale}. */\n\t\tSCALE: 'scale',\n\t\t/** Channel targets {@link Node.setWeights}, affecting {@link PrimitiveTarget} weights. */\n\t\tWEIGHTS: 'weights',\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.ANIMATION_CHANNEL;\n\t}\n\n\tprotected getDefaults(): Nullable<IAnimationChannel> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\ttargetPath: null,\n\t\t\ttargetNode: null,\n\t\t\tsampler: null,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Properties.\n\t */\n\n\t/**\n\t * Path (property) animated on the target {@link Node}. Supported values include:\n\t * `translation`, `rotation`, `scale`, or `weights`.\n\t */\n\tpublic getTargetPath(): GLTF.AnimationChannelTargetPath | null {\n\t\treturn this.get('targetPath');\n\t}\n\n\t/**\n\t * Path (property) animated on the target {@link Node}. Supported values include:\n\t * `translation`, `rotation`, `scale`, or `weights`.\n\t */\n\tpublic setTargetPath(targetPath: GLTF.AnimationChannelTargetPath): this {\n\t\treturn this.set('targetPath', targetPath);\n\t}\n\n\t/** Target {@link Node} animated by the channel. */\n\tpublic getTargetNode(): Node | null {\n\t\treturn this.getRef('targetNode');\n\t}\n\n\t/** Target {@link Node} animated by the channel. */\n\tpublic setTargetNode(targetNode: Node | null): this {\n\t\treturn this.setRef('targetNode', targetNode);\n\t}\n\n\t/**\n\t * Keyframe data input/output values for the channel. Must be attached to the same\n\t * {@link Animation}.\n\t */\n\tpublic getSampler(): AnimationSampler | null {\n\t\treturn this.getRef('sampler');\n\t}\n\n\t/**\n\t * Keyframe data input/output values for the channel. Must be attached to the same\n\t * {@link Animation}.\n\t */\n\tpublic setSampler(sampler: AnimationSampler | null): this {\n\t\treturn this.setRef('sampler', sampler);\n\t}\n}\n","import { BufferViewUsage, Nullable, PropertyType } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport type { Accessor } from './accessor';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface IAnimationSampler extends IExtensibleProperty {\n\tinterpolation: GLTF.AnimationSamplerInterpolation;\n\tinput: Accessor;\n\toutput: Accessor;\n}\n\n/**\n * # AnimationSampler\n *\n * *Reusable collection of keyframes affecting particular property of an object.*\n *\n * Each AnimationSampler refers to an input and an output {@link Accessor}. Input contains times\n * (in seconds) for each keyframe. Output contains values (of any {@link Accessor.Type}) for the\n * animated property at each keyframe. Samplers using `CUBICSPLINE` interpolation will also contain\n * in/out tangents in the output, with the layout:\n *\n * in<sub>1</sub>, value<sub>1</sub>, out<sub>1</sub>,\n * in<sub>2</sub>, value<sub>2</sub>, out<sub>2</sub>,\n * in<sub>3</sub>, value<sub>3</sub>, out<sub>3</sub>, ...\n *\n * Usage:\n *\n * ```ts\n * // Create accessor containing input times, in seconds.\n * const input = doc.createAccessor('bounceTimes')\n * \t.setArray(new Float32Array([0, 1, 2]))\n * \t.setType(Accessor.Type.SCALAR);\n *\n * // Create accessor containing output values, in local units.\n * const output = doc.createAccessor('bounceValues')\n * \t.setArray(new Float32Array([\n * \t\t0, 0, 0, // y = 0\n * \t\t0, 1, 0, // y = 1\n * \t\t0, 0, 0, // y = 0\n * \t]))\n * \t.setType(Accessor.Type.VEC3);\n *\n * // Create sampler.\n * const sampler = doc.createAnimationSampler('bounce')\n * \t.setInput(input)\n * \t.setOutput(output)\n * \t.setInterpolation('LINEAR');\n * ```\n *\n * Reference\n * - [glTF  Animations](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#animations)\n */\nexport class AnimationSampler extends ExtensibleProperty<IAnimationSampler> {\n\tpublic declare propertyType: PropertyType.ANIMATION_SAMPLER;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\t/** Interpolation method. */\n\tpublic static Interpolation: Record<string, GLTF.AnimationSamplerInterpolation> = {\n\t\t/** Animated values are linearly interpolated between keyframes. */\n\t\tLINEAR: 'LINEAR',\n\t\t/** Animated values remain constant from one keyframe until the next keyframe. */\n\t\tSTEP: 'STEP',\n\t\t/** Animated values are interpolated according to given cubic spline tangents. */\n\t\tCUBICSPLINE: 'CUBICSPLINE',\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.ANIMATION_SAMPLER;\n\t}\n\n\tprotected getDefaultAttributes(): Nullable<IAnimationSampler> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\tinterpolation: AnimationSampler.Interpolation.LINEAR,\n\t\t\tinput: null,\n\t\t\toutput: null,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Static.\n\t */\n\n\t/** Interpolation mode: `STEP`, `LINEAR`, or `CUBICSPLINE`. */\n\tpublic getInterpolation(): GLTF.AnimationSamplerInterpolation {\n\t\treturn this.get('interpolation');\n\t}\n\n\t/** Interpolation mode: `STEP`, `LINEAR`, or `CUBICSPLINE`. */\n\tpublic setInterpolation(interpolation: GLTF.AnimationSamplerInterpolation): this {\n\t\treturn this.set('interpolation', interpolation);\n\t}\n\n\t/** Times for each keyframe, in seconds. */\n\tpublic getInput(): Accessor | null {\n\t\treturn this.getRef('input');\n\t}\n\n\t/** Times for each keyframe, in seconds. */\n\tpublic setInput(input: Accessor | null): this {\n\t\treturn this.setRef('input', input, { usage: BufferViewUsage.OTHER });\n\t}\n\n\t/**\n\t * Values for each keyframe. For `CUBICSPLINE` interpolation, output also contains in/out\n\t * tangents.\n\t */\n\tpublic getOutput(): Accessor | null {\n\t\treturn this.getRef('output');\n\t}\n\n\t/**\n\t * Values for each keyframe. For `CUBICSPLINE` interpolation, output also contains in/out\n\t * tangents.\n\t */\n\tpublic setOutput(output: Accessor | null): this {\n\t\treturn this.setRef('output', output, { usage: BufferViewUsage.OTHER });\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface IBuffer extends IExtensibleProperty {\n\turi: string;\n}\n\n/**\n * # Buffer\n *\n * *Buffers are low-level storage units for binary data.*\n *\n * glTF 2.0 has three concepts relevant to binary storage: accessors, buffer views, and buffers.\n * In glTF-Transform, an {@link Accessor} is referenced by any property that requires numeric typed\n * array data. Meshes, Primitives, and Animations all reference Accessors. Buffers define how that\n * data is organized into transmitted file(s). A `.glb` file has only a single Buffer, and when\n * exporting to `.glb` your resources should be grouped accordingly. A `.gltf` file may reference\n * one or more `.bin` files  each `.bin` is a Buffer  and grouping Accessors under different\n * Buffers allow you to specify that structure.\n *\n * For engines that can dynamically load portions of a glTF file, splitting data into separate\n * buffers can allow you to avoid loading data until it is needed. For example, you might put\n * binary data for specific meshes into a different `.bin` buffer, or put each animation's binary\n * payload into its own `.bin`.\n *\n * Buffer Views define how Accessors are organized within a given Buffer. glTF-Transform creates an\n * efficient Buffer View layout automatically at export: there is no Buffer View property exposed\n * by the glTF-Transform API, simplifying data management.\n *\n * Usage:\n *\n * ```ts\n * // Create two buffers with custom filenames.\n * const buffer1 = doc.createBuffer('buffer1')\n * \t.setURI('part1.bin');\n * const buffer2 = doc.createBuffer('buffer2')\n * \t.setURI('part2.bin');\n *\n * // Assign the attributes of two meshes to different buffers. If the meshes\n * // had indices or morph target attributes, you would also want to relocate\n * // those accessors.\n * mesh1\n * \t.listPrimitives()\n * \t.forEach((primitive) => primitive.listAttributes()\n * \t\t.forEach((attribute) => attribute.setBuffer(buffer1)));\n * mesh2\n * \t.listPrimitives()\n * \t.forEach((primitive) => primitive.listAttributes()\n * \t\t.forEach((attribute) => attribute.setBuffer(buffer2)));\n *\n * // Write to disk. Each mesh's binary data will be in a separate binary file;\n * // any remaining accessors will be in a third (default) buffer.\n * await new NodeIO().write('scene.gltf', doc);\n * //  scene.gltf, part1.bin, part2.bin\n * ```\n *\n * References:\n * - [glTF  Buffers and Buffer Views](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#buffers-and-buffer-views)\n * - [glTF  Accessors](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#accessors)\n *\n * @category Properties\n */\nexport class Buffer extends ExtensibleProperty<IBuffer> {\n\tpublic declare propertyType: PropertyType.BUFFER;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.BUFFER;\n\t}\n\n\tprotected getDefaults(): Nullable<IBuffer> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { uri: '' });\n\t}\n\n\t/**\n\t * Returns the URI (or filename) of this buffer (e.g. 'myBuffer.bin'). URIs are strongly\n\t * encouraged to be relative paths, rather than absolute. Use of a protocol (like `file://`)\n\t * is possible for custom applications, but will limit the compatibility of the asset with most\n\t * tools.\n\t *\n\t * Buffers commonly use the extension `.bin`, though this is not required.\n\t */\n\tpublic getURI(): string {\n\t\treturn this.get('uri');\n\t}\n\n\t/**\n\t * Sets the URI (or filename) of this buffer (e.g. 'myBuffer.bin'). URIs are strongly\n\t * encouraged to be relative paths, rather than absolute. Use of a protocol (like `file://`)\n\t * is possible for custom applications, but will limit the compatibility of the asset with most\n\t * tools.\n\t *\n\t * Buffers commonly use the extension `.bin`, though this is not required.\n\t */\n\tpublic setURI(uri: string): this {\n\t\treturn this.set('uri', uri);\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface ICamera extends IExtensibleProperty {\n\ttype: GLTF.CameraType;\n\tznear: number;\n\tzfar: number;\n\taspectRatio: number | null;\n\tyfov: number;\n\txmag: number;\n\tymag: number;\n}\n\n/**\n * # Camera\n *\n * *Cameras are perspectives through which the {@link Scene} may be viewed.*\n *\n * Projection can be perspective or orthographic. Cameras are contained in nodes and thus can be\n * transformed. The camera is defined such that the local +X axis is to the right, the lens looks\n * towards the local -Z axis, and the top of the camera is aligned with the local +Y axis. If no\n * transformation is specified, the location of the camera is at the origin.\n *\n * Usage:\n *\n * ```typescript\n * const camera = doc.createCamera('myCamera')\n * \t.setType(GLTF.CameraType.PERSPECTIVE)\n * \t.setZNear(0.1)\n * \t.setZFar(100)\n * \t.setYFov(Math.PI / 4)\n * \t.setAspectRatio(1.5);\n *\n * node.setCamera(camera);\n * ```\n *\n * References:\n * - [glTF  Cameras](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#cameras)\n *\n * @category Properties\n */\nexport class Camera extends ExtensibleProperty<ICamera> {\n\tpublic declare propertyType: PropertyType.CAMERA;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\tpublic static Type: Record<string, GLTF.CameraType> = {\n\t\t/** A perspective camera representing a perspective projection matrix. */\n\t\tPERSPECTIVE: 'perspective',\n\t\t/** An orthographic camera representing an orthographic projection matrix. */\n\t\tORTHOGRAPHIC: 'orthographic',\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.CAMERA;\n\t}\n\n\tprotected getDefaults(): Nullable<ICamera> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\t// Common.\n\t\t\ttype: Camera.Type.PERSPECTIVE,\n\t\t\tznear: 0.1,\n\t\t\tzfar: 100,\n\t\t\t// Perspective.\n\t\t\taspectRatio: null,\n\t\t\tyfov: (Math.PI * 2 * 50) / 360, // 50\n\t\t\t// Orthographic.\n\t\t\txmag: 1,\n\t\t\tymag: 1,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Common.\n\t */\n\n\t/** Specifies if the camera uses a perspective or orthographic projection. */\n\tpublic getType(): GLTF.CameraType {\n\t\treturn this.get('type');\n\t}\n\n\t/** Specifies if the camera uses a perspective or orthographic projection. */\n\tpublic setType(type: GLTF.CameraType): this {\n\t\treturn this.set('type', type);\n\t}\n\n\t/** Floating-point distance to the near clipping plane. */\n\tpublic getZNear(): number {\n\t\treturn this.get('znear');\n\t}\n\n\t/** Floating-point distance to the near clipping plane. */\n\tpublic setZNear(znear: number): this {\n\t\treturn this.set('znear', znear);\n\t}\n\n\t/**\n\t * Floating-point distance to the far clipping plane. When defined, zfar must be greater than\n\t * znear. If zfar is undefined, runtime must use infinite projection matrix.\n\t */\n\tpublic getZFar(): number {\n\t\treturn this.get('zfar');\n\t}\n\n\t/**\n\t * Floating-point distance to the far clipping plane. When defined, zfar must be greater than\n\t * znear. If zfar is undefined, runtime must use infinite projection matrix.\n\t */\n\tpublic setZFar(zfar: number): this {\n\t\treturn this.set('zfar', zfar);\n\t}\n\n\t/**********************************************************************************************\n\t * Perspective.\n\t */\n\n\t/**\n\t * Floating-point aspect ratio of the field of view. When undefined, the aspect ratio of the\n\t * canvas is used.\n\t */\n\tpublic getAspectRatio(): number | null {\n\t\treturn this.get('aspectRatio');\n\t}\n\n\t/**\n\t * Floating-point aspect ratio of the field of view. When undefined, the aspect ratio of the\n\t * canvas is used.\n\t */\n\tpublic setAspectRatio(aspectRatio: number | null): this {\n\t\treturn this.set('aspectRatio', aspectRatio);\n\t}\n\n\t/** Floating-point vertical field of view in radians. */\n\tpublic getYFov(): number {\n\t\treturn this.get('yfov');\n\t}\n\n\t/** Floating-point vertical field of view in radians. */\n\tpublic setYFov(yfov: number): this {\n\t\treturn this.set('yfov', yfov);\n\t}\n\n\t/**********************************************************************************************\n\t * Orthographic.\n\t */\n\n\t/**\n\t * Floating-point horizontal magnification of the view, and half the view's width\n\t * in world units.\n\t */\n\tpublic getXMag(): number {\n\t\treturn this.get('xmag');\n\t}\n\n\t/**\n\t * Floating-point horizontal magnification of the view, and half the view's width\n\t * in world units.\n\t */\n\tpublic setXMag(xmag: number): this {\n\t\treturn this.set('xmag', xmag);\n\t}\n\n\t/**\n\t * Floating-point vertical magnification of the view, and half the view's height\n\t * in world units.\n\t */\n\tpublic getYMag(): number {\n\t\treturn this.get('ymag');\n\t}\n\n\t/**\n\t * Floating-point vertical magnification of the view, and half the view's height\n\t * in world units.\n\t */\n\tpublic setYMag(ymag: number): this {\n\t\treturn this.set('ymag', ymag);\n\t}\n}\n","import type { ExtensibleProperty } from './extensible-property';\nimport { Property, IProperty } from './property';\n\n/**\n * # ExtensionProperty\n *\n * *Base class for all {@link Property} types that can be attached by an {@link Extension}.*\n *\n * After an {@link Extension} is attached to a glTF {@link Document}, the Extension may be used to\n * construct ExtensionProperty instances, to be referenced throughout the document as prescribed by\n * the Extension. For example, the `KHR_materials_clearcoat` Extension defines a `Clearcoat`\n * ExtensionProperty, which is referenced by {@link Material} Properties in the Document, and may\n * contain references to {@link Texture} properties of its own.\n *\n * For more information on available extensions and their usage, see [Extensions](/extensions).\n *\n * Reference:\n * - [glTF  Extensions](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#specifying-extensions)\n */\nexport abstract class ExtensionProperty<T extends IProperty = IProperty> extends Property<T> {\n\tpublic static EXTENSION_NAME: string;\n\tpublic abstract readonly extensionName: string;\n\n\t/** List of supported {@link Property} types. */\n\tpublic abstract readonly parentTypes: string[];\n\n\t/** @hidden */\n\tpublic _validateParent(parent: ExtensibleProperty): void {\n\t\tif (!this.parentTypes.includes(parent.propertyType)) {\n\t\t\tthrow new Error(`Parent \"${parent.propertyType}\" invalid for child \"${this.propertyType}\".`);\n\t\t}\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface ITextureInfo extends IExtensibleProperty {\n\ttexCoord: number;\n\n\t// Sampler properties are also attached to TextureInfo, for simplicity.\n\tmagFilter: GLTF.TextureMagFilter | null;\n\tminFilter: GLTF.TextureMinFilter | null;\n\twrapS: GLTF.TextureWrapMode;\n\twrapT: GLTF.TextureWrapMode;\n}\n\n/**\n * # TextureInfo\n *\n * *Settings associated with a particular use of a {@link Texture}.*\n *\n * Different materials may reuse the same texture but with different texture coordinates,\n * minFilter/magFilter, or wrapS/wrapT settings. The TextureInfo class contains settings\n * derived from both the \"TextureInfo\" and \"Sampler\" properties in the glTF specification,\n * consolidated here for simplicity.\n *\n * TextureInfo properties cannot be directly created. For any material texture slot, such as\n * baseColorTexture, there will be a corresponding method to obtain the TextureInfo for that slot.\n * For example, see {@link Material.getBaseColorTextureInfo}.\n *\n * References:\n * - [glTF  Texture Info](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#reference-textureinfo)\n *\n * @category Properties\n */\nexport class TextureInfo extends ExtensibleProperty<ITextureInfo> {\n\tpublic declare propertyType: PropertyType.TEXTURE_INFO;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\t/** UV wrapping mode. Values correspond to WebGL enums. */\n\tpublic static WrapMode: Record<string, GLTF.TextureWrapMode> = {\n\t\t/** */\n\t\tCLAMP_TO_EDGE: 33071,\n\t\t/** */\n\t\tMIRRORED_REPEAT: 33648,\n\t\t/** */\n\t\tREPEAT: 10497,\n\t};\n\n\t/** Magnification filter. Values correspond to WebGL enums. */\n\tpublic static MagFilter: Record<string, GLTF.TextureMagFilter> = {\n\t\t/** */\n\t\tNEAREST: 9728,\n\t\t/** */\n\t\tLINEAR: 9729,\n\t};\n\n\t/** Minification filter. Values correspond to WebGL enums. */\n\tpublic static MinFilter: Record<string, GLTF.TextureMinFilter> = {\n\t\t/** */\n\t\tNEAREST: 9728,\n\t\t/** */\n\t\tLINEAR: 9729,\n\t\t/** */\n\t\tNEAREST_MIPMAP_NEAREST: 9984,\n\t\t/** */\n\t\tLINEAR_MIPMAP_NEAREST: 9985,\n\t\t/** */\n\t\tNEAREST_MIPMAP_LINEAR: 9986,\n\t\t/** */\n\t\tLINEAR_MIPMAP_LINEAR: 9987,\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.TEXTURE_INFO;\n\t}\n\n\tprotected getDefaults(): Nullable<ITextureInfo> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\ttexCoord: 0,\n\t\t\tmagFilter: null,\n\t\t\tminFilter: null,\n\t\t\twrapS: TextureInfo.WrapMode.REPEAT,\n\t\t\twrapT: TextureInfo.WrapMode.REPEAT,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Texture coordinates.\n\t */\n\n\t/** Returns the texture coordinate (UV set) index for the texture. */\n\tpublic getTexCoord(): number {\n\t\treturn this.get('texCoord');\n\t}\n\n\t/** Sets the texture coordinate (UV set) index for the texture. */\n\tpublic setTexCoord(texCoord: number): this {\n\t\treturn this.set('texCoord', texCoord);\n\t}\n\n\t/**********************************************************************************************\n\t * Min/mag filter.\n\t */\n\n\t/** Returns the magnification filter applied to the texture. */\n\tpublic getMagFilter(): GLTF.TextureMagFilter | null {\n\t\treturn this.get('magFilter');\n\t}\n\n\t/** Sets the magnification filter applied to the texture. */\n\tpublic setMagFilter(magFilter: GLTF.TextureMagFilter | null): this {\n\t\treturn this.set('magFilter', magFilter);\n\t}\n\n\t/** Sets the minification filter applied to the texture. */\n\tpublic getMinFilter(): GLTF.TextureMinFilter | null {\n\t\treturn this.get('minFilter');\n\t}\n\n\t/** Returns the minification filter applied to the texture. */\n\tpublic setMinFilter(minFilter: GLTF.TextureMinFilter | null): this {\n\t\treturn this.set('minFilter', minFilter);\n\t}\n\n\t/**********************************************************************************************\n\t * UV wrapping.\n\t */\n\n\t/** Returns the S (U) wrapping mode for UVs used by the texture. */\n\tpublic getWrapS(): GLTF.TextureWrapMode {\n\t\treturn this.get('wrapS');\n\t}\n\n\t/** Sets the S (U) wrapping mode for UVs used by the texture. */\n\tpublic setWrapS(wrapS: GLTF.TextureWrapMode): this {\n\t\treturn this.set('wrapS', wrapS);\n\t}\n\n\t/** Returns the T (V) wrapping mode for UVs used by the texture. */\n\tpublic getWrapT(): GLTF.TextureWrapMode {\n\t\treturn this.get('wrapT');\n\t}\n\n\t/** Sets the T (V) wrapping mode for UVs used by the texture. */\n\tpublic setWrapT(wrapT: GLTF.TextureWrapMode): this {\n\t\treturn this.set('wrapT', wrapT);\n\t}\n}\n","import { Nullable, PropertyType, TextureChannel, vec3, vec4 } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport { ColorUtils } from '../utils';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Texture } from './texture';\nimport { TextureInfo } from './texture-info';\n\nconst { R, G, B, A } = TextureChannel;\n\ninterface IMaterial extends IExtensibleProperty {\n\talphaMode: GLTF.MaterialAlphaMode;\n\talphaCutoff: number;\n\tdoubleSided: boolean;\n\tbaseColorFactor: vec4;\n\tbaseColorTexture: Texture;\n\tbaseColorTextureInfo: TextureInfo;\n\temissiveFactor: vec3;\n\temissiveTexture: Texture;\n\temissiveTextureInfo: TextureInfo;\n\tnormalScale: number;\n\tnormalTexture: Texture;\n\tnormalTextureInfo: TextureInfo;\n\tocclusionStrength: number;\n\tocclusionTexture: Texture;\n\tocclusionTextureInfo: TextureInfo;\n\troughnessFactor: number;\n\tmetallicFactor: number;\n\tmetallicRoughnessTexture: Texture;\n\tmetallicRoughnessTextureInfo: TextureInfo;\n}\n\n/**\n * # Material\n *\n * *Materials describe a surface's appearance and response to light.*\n *\n * Each {@link Primitive} within a {@link Mesh} may be assigned a single Material. The number of\n * GPU draw calls typically increases with both the numbers of Primitives and of Materials in an\n * asset; Materials should be reused wherever possible. Techniques like texture atlasing and vertex\n * colors allow objects to have varied appearances while technically sharing a single Material.\n *\n * Material properties are modified by both scalars (like `baseColorFactor`) and textures (like\n * `baseColorTexture`). When both are available, factors are considered linear multipliers against\n * textures of the same name. In the case of base color, vertex colors (`COLOR_0` attributes) are\n * also multiplied.\n *\n * Textures containing color data (`baseColorTexture`, `emissiveTexture`) are sRGB. All other\n * textures are linear. Like other resources, textures should be reused when possible.\n *\n * Usage:\n *\n * ```typescript\n * const material = doc.createMaterial('myMaterial')\n * \t.setBaseColorFactor([1, 0.5, 0.5, 1]) // RGBA\n * \t.setOcclusionTexture(aoTexture)\n * \t.setOcclusionStrength(0.5);\n *\n * mesh.listPrimitives()\n * \t.forEach((prim) => prim.setMaterial(material));\n * ```\n *\n * @category Properties\n */\nexport class Material extends ExtensibleProperty<IMaterial> {\n\tpublic declare propertyType: PropertyType.MATERIAL;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\tpublic static AlphaMode: Record<string, GLTF.MaterialAlphaMode> = {\n\t\t/**\n\t\t * The alpha value is ignored and the rendered output is fully opaque\n\t\t */\n\t\tOPAQUE: 'OPAQUE',\n\t\t/**\n\t\t * The rendered output is either fully opaque or fully transparent depending on the alpha\n\t\t * value and the specified alpha cutoff value\n\t\t */\n\t\tMASK: 'MASK',\n\t\t/**\n\t\t * The alpha value is used to composite the source and destination areas. The rendered\n\t\t * output is combined with the background using the normal painting operation (i.e. the\n\t\t * Porter and Duff over operator)\n\t\t */\n\t\tBLEND: 'BLEND',\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.MATERIAL;\n\t}\n\n\tprotected getDefaults(): Nullable<IMaterial> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\talphaMode: Material.AlphaMode.OPAQUE,\n\t\t\talphaCutoff: 0.5,\n\t\t\tdoubleSided: false,\n\t\t\tbaseColorFactor: [1, 1, 1, 1] as vec4,\n\t\t\tbaseColorTexture: null,\n\t\t\tbaseColorTextureInfo: new TextureInfo(this.graph, 'baseColorTextureInfo'),\n\t\t\temissiveFactor: [0, 0, 0] as vec3,\n\t\t\temissiveTexture: null,\n\t\t\temissiveTextureInfo: new TextureInfo(this.graph, 'emissiveTextureInfo'),\n\t\t\tnormalScale: 1,\n\t\t\tnormalTexture: null,\n\t\t\tnormalTextureInfo: new TextureInfo(this.graph, 'normalTextureInfo'),\n\t\t\tocclusionStrength: 1,\n\t\t\tocclusionTexture: null,\n\t\t\tocclusionTextureInfo: new TextureInfo(this.graph, 'occlusionTextureInfo'),\n\t\t\troughnessFactor: 1,\n\t\t\tmetallicFactor: 1,\n\t\t\tmetallicRoughnessTexture: null,\n\t\t\tmetallicRoughnessTextureInfo: new TextureInfo(this.graph, 'metallicRoughnessTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Double-sided / culling.\n\t */\n\n\t/** Returns true when both sides of triangles should be rendered. May impact performance. */\n\tpublic getDoubleSided(): boolean {\n\t\treturn this.get('doubleSided');\n\t}\n\n\t/** Sets whether to render both sides of triangles. May impact performance. */\n\tpublic setDoubleSided(doubleSided: boolean): this {\n\t\treturn this.set('doubleSided', doubleSided);\n\t}\n\n\t/**********************************************************************************************\n\t * Alpha.\n\t */\n\n\t/** Returns material alpha, equivalent to baseColorFactor[3]. */\n\tpublic getAlpha(): number {\n\t\treturn this.get('baseColorFactor')[3];\n\t}\n\n\t/** Sets material alpha, equivalent to baseColorFactor[3]. */\n\tpublic setAlpha(alpha: number): this {\n\t\tconst baseColorFactor = this.get('baseColorFactor').slice() as vec4;\n\t\tbaseColorFactor[3] = alpha;\n\t\treturn this.set('baseColorFactor', baseColorFactor);\n\t}\n\n\t/**\n\t * Returns the mode of the material's alpha channels, which are provided by `baseColorFactor`\n\t * and `baseColorTexture`.\n\t *\n\t * - `OPAQUE`: Alpha value is ignored and the rendered output is fully opaque.\n\t * - `BLEND`: Alpha value is used to determine the transparency each pixel on a surface, and\n\t * \tthe fraction of surface vs. background color in the final result. Alpha blending creates\n\t *\tsignificant edge cases in realtime renderers, and some care when structuring the model is\n\t * \tnecessary for good results. In particular, transparent geometry should be kept in separate\n\t * \tmeshes or primitives from opaque geometry. The `depthWrite` or `zWrite` settings in engines\n\t * \tshould usually be disabled on transparent materials.\n\t * - `MASK`: Alpha value is compared against `alphaCutoff` threshold for each pixel on a\n\t * \tsurface, and the pixel is either fully visible or fully discarded based on that cutoff.\n\t * \tThis technique is useful for things like leafs/foliage, grass, fabric meshes, and other\n\t * \tsurfaces where no semitransparency is needed. With a good choice of `alphaCutoff`, surfaces\n\t * \tthat don't require semitransparency can avoid the performance penalties and visual issues\n\t * \tinvolved with `BLEND` transparency.\n\t *\n\t * Reference:\n\t * - [glTF  material.alphaMode](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#materialalphamode)\n\t */\n\tpublic getAlphaMode(): GLTF.MaterialAlphaMode {\n\t\treturn this.get('alphaMode');\n\t}\n\n\t/** Sets the mode of the material's alpha channels. See {@link getAlphaMode} for details. */\n\tpublic setAlphaMode(alphaMode: GLTF.MaterialAlphaMode): this {\n\t\treturn this.set('alphaMode', alphaMode);\n\t}\n\n\t/** Returns the visibility threshold; applied only when `.alphaMode='MASK'`. */\n\tpublic getAlphaCutoff(): number {\n\t\treturn this.get('alphaCutoff');\n\t}\n\n\t/** Sets the visibility threshold; applied only when `.alphaMode='MASK'`. */\n\tpublic setAlphaCutoff(alphaCutoff: number): this {\n\t\treturn this.set('alphaCutoff', alphaCutoff);\n\t}\n\n\t/**********************************************************************************************\n\t * Base color.\n\t */\n\n\t/** Base color / albedo factor; Linear-sRGB components. See {@link getBaseColorTexture}. */\n\tpublic getBaseColorFactor(): vec4 {\n\t\treturn this.get('baseColorFactor');\n\t}\n\n\t/** Base color / albedo factor; Linear-sRGB components. See {@link getBaseColorTexture}. */\n\tpublic setBaseColorFactor(baseColorFactor: vec4): this {\n\t\treturn this.set('baseColorFactor', baseColorFactor);\n\t}\n\n\t/**\n\t * Base color / albedo; sRGB hexadecimal color. See {@link getBaseColorTexture}.\n\t */\n\tpublic getBaseColorHex(): number {\n\t\treturn ColorUtils.factorToHex(this.get('baseColorFactor'));\n\t}\n\n\t/**\n\t * Base color / albedo; sRGB hexadecimal color. See {@link getBaseColorTexture}.\n\t */\n\tpublic setBaseColorHex(hex: number): this {\n\t\tconst factor = this.get('baseColorFactor').slice() as vec4;\n\t\treturn this.set('baseColorFactor', ColorUtils.hexToFactor(hex, factor));\n\t}\n\n\t/**\n\t * Base color / albedo. The visible color of a non-metallic surface under constant ambient\n\t * light would be a linear combination (multiplication) of its vertex colors, base color\n\t * factor, and base color texture. Lighting, and reflections in metallic or smooth surfaces,\n\t * also effect the final color. The alpha (`.a`) channel of base color factors and textures\n\t * will have varying effects, based on the setting of {@link getAlphaMode}.\n\t *\n\t * Reference:\n\t * - [glTF  material.pbrMetallicRoughness.baseColorFactor](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#pbrmetallicroughnessbasecolorfactor)\n\t */\n\tpublic getBaseColorTexture(): Texture | null {\n\t\treturn this.getRef('baseColorTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its base color texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getBaseColorTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('baseColorTexture') ? this.getRef('baseColorTextureInfo') : null;\n\t}\n\n\t/** Sets base color / albedo texture. See {@link getBaseColorTexture}. */\n\tpublic setBaseColorTexture(texture: Texture | null): this {\n\t\treturn this.setRef('baseColorTexture', texture, { channels: R | G | B | A });\n\t}\n\n\t/**********************************************************************************************\n\t * Emissive.\n\t */\n\n\t/** Emissive color; Linear-sRGB components. See {@link getEmissiveTexture}. */\n\tpublic getEmissiveFactor(): vec3 {\n\t\treturn this.get('emissiveFactor');\n\t}\n\n\t/** Emissive color; Linear-sRGB components. See {@link getEmissiveTexture}. */\n\tpublic setEmissiveFactor(emissiveFactor: vec3): this {\n\t\treturn this.set('emissiveFactor', emissiveFactor);\n\t}\n\n\t/** Emissive; sRGB hexadecimal color. See {@link getBaseColorTexture}. */\n\tpublic getEmissiveHex(): number {\n\t\treturn ColorUtils.factorToHex(this.get('emissiveFactor'));\n\t}\n\n\t/** Emissive; sRGB hexadecimal color. See {@link getEmissiveTexture}. */\n\tpublic setEmissiveHex(hex: number): this {\n\t\tconst factor = this.get('emissiveFactor').slice() as vec3;\n\t\treturn this.set('emissiveFactor', ColorUtils.hexToFactor(hex, factor));\n\t}\n\n\t/**\n\t * Emissive texture. Emissive color is added to any base color of the material, after any\n\t * lighting/shadowing are applied. An emissive color does not inherently \"glow\", or affect\n\t * objects around it at all. To create that effect, most viewers must also enable a\n\t * post-processing effect called \"bloom\".\n\t *\n\t * Reference:\n\t * - [glTF  material.emissiveTexture](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#materialemissivetexture)\n\t */\n\tpublic getEmissiveTexture(): Texture | null {\n\t\treturn this.getRef('emissiveTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its emissive texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getEmissiveTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('emissiveTexture') ? this.getRef('emissiveTextureInfo') : null;\n\t}\n\n\t/** Sets emissive texture. See {@link getEmissiveTexture}. */\n\tpublic setEmissiveTexture(texture: Texture | null): this {\n\t\treturn this.setRef('emissiveTexture', texture, { channels: R | G | B });\n\t}\n\n\t/**********************************************************************************************\n\t * Normal.\n\t */\n\n\t/** Normal (surface detail) factor; linear multiplier. Affects `.normalTexture`. */\n\tpublic getNormalScale(): number {\n\t\treturn this.get('normalScale');\n\t}\n\n\t/** Normal (surface detail) factor; linear multiplier. Affects `.normalTexture`. */\n\tpublic setNormalScale(scale: number): this {\n\t\treturn this.set('normalScale', scale);\n\t}\n\n\t/**\n\t * Normal (surface detail) texture.\n\t *\n\t * A tangent space normal map. The texture contains RGB components. Each texel represents the\n\t * XYZ components of a normal vector in tangent space. Red [0 to 255] maps to X [-1 to 1].\n\t * Green [0 to 255] maps to Y [-1 to 1]. Blue [128 to 255] maps to Z [1/255 to 1]. The normal\n\t * vectors use OpenGL conventions where +X is right and +Y is up. +Z points toward the viewer.\n\t *\n\t * Reference:\n\t * - [glTF  material.normalTexture](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#materialnormaltexture)\n\t */\n\tpublic getNormalTexture(): Texture | null {\n\t\treturn this.getRef('normalTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its normal texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getNormalTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('normalTexture') ? this.getRef('normalTextureInfo') : null;\n\t}\n\n\t/** Sets normal (surface detail) texture. See {@link getNormalTexture}. */\n\tpublic setNormalTexture(texture: Texture | null): this {\n\t\treturn this.setRef('normalTexture', texture, { channels: R | G | B });\n\t}\n\n\t/**********************************************************************************************\n\t * Occlusion.\n\t */\n\n\t/** (Ambient) Occlusion factor; linear multiplier. Affects `.occlusionTexture`. */\n\tpublic getOcclusionStrength(): number {\n\t\treturn this.get('occlusionStrength');\n\t}\n\n\t/** Sets (ambient) occlusion factor; linear multiplier. Affects `.occlusionTexture`. */\n\tpublic setOcclusionStrength(strength: number): this {\n\t\treturn this.set('occlusionStrength', strength);\n\t}\n\n\t/**\n\t * (Ambient) Occlusion texture, generally used for subtle 'baked' shadowing effects that are\n\t * independent of an object's position, such as shading in inset areas and corners. Direct\n\t * lighting is not affected by occlusion, so at least one indirect light source must be present\n\t * in the scene for occlusion effects to be visible.\n\t *\n\t * The occlusion values are sampled from the R channel. Higher values indicate areas that\n\t * should receive full indirect lighting and lower values indicate no indirect lighting.\n\t *\n\t * Reference:\n\t * - [glTF  material.occlusionTexture](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#materialocclusiontexture)\n\t */\n\tpublic getOcclusionTexture(): Texture | null {\n\t\treturn this.getRef('occlusionTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its occlusion texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getOcclusionTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('occlusionTexture') ? this.getRef('occlusionTextureInfo') : null;\n\t}\n\n\t/** Sets (ambient) occlusion texture. See {@link getOcclusionTexture}. */\n\tpublic setOcclusionTexture(texture: Texture | null): this {\n\t\treturn this.setRef('occlusionTexture', texture, { channels: R });\n\t}\n\n\t/**********************************************************************************************\n\t * Metallic / roughness.\n\t */\n\n\t/**\n\t * Roughness factor; linear multiplier. Affects roughness channel of\n\t * `metallicRoughnessTexture`. See {@link getMetallicRoughnessTexture}.\n\t */\n\tpublic getRoughnessFactor(): number {\n\t\treturn this.get('roughnessFactor');\n\t}\n\n\t/**\n\t * Sets roughness factor; linear multiplier. Affects roughness channel of\n\t * `metallicRoughnessTexture`. See {@link getMetallicRoughnessTexture}.\n\t */\n\tpublic setRoughnessFactor(factor: number): this {\n\t\treturn this.set('roughnessFactor', factor);\n\t}\n\n\t/**\n\t * Metallic factor; linear multiplier. Affects roughness channel of\n\t * `metallicRoughnessTexture`. See {@link getMetallicRoughnessTexture}.\n\t */\n\tpublic getMetallicFactor(): number {\n\t\treturn this.get('metallicFactor');\n\t}\n\n\t/**\n\t * Sets metallic factor; linear multiplier. Affects roughness channel of\n\t * `metallicRoughnessTexture`. See {@link getMetallicRoughnessTexture}.\n\t */\n\tpublic setMetallicFactor(factor: number): this {\n\t\treturn this.set('metallicFactor', factor);\n\t}\n\n\t/**\n\t * Metallic roughness texture. The metalness values are sampled from the B channel. The\n\t * roughness values are sampled from the G channel. When a material is fully metallic,\n\t * or nearly so, it may require image-based lighting (i.e. an environment map) or global\n\t * illumination to appear well-lit.\n\t *\n\t * Reference:\n\t * - [glTF  material.pbrMetallicRoughness.metallicRoughnessTexture](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#pbrmetallicroughnessmetallicroughnesstexture)\n\t */\n\tpublic getMetallicRoughnessTexture(): Texture | null {\n\t\treturn this.getRef('metallicRoughnessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its metallic/roughness texture. If no texture is\n\t * attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getMetallicRoughnessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('metallicRoughnessTexture') ? this.getRef('metallicRoughnessTextureInfo') : null;\n\t}\n\n\t/** Sets metallic/roughness texture. See {@link getMetallicRoughnessTexture}. */\n\tpublic setMetallicRoughnessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('metallicRoughnessTexture', texture, { channels: G | B });\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Primitive } from './primitive';\n\ninterface IMesh extends IExtensibleProperty {\n\tweights: number[];\n\tprimitives: Primitive[];\n}\n\n/**\n * # Mesh\n *\n * *Meshes define reusable geometry (triangles, lines, or points) and are instantiated by\n * {@link Node}s.*\n *\n * Each draw call required to render a mesh is represented as a {@link Primitive}. Meshes typically\n * have only a single {@link Primitive}, but may have more for various reasons. A mesh manages only\n * a list of primitives  materials, morph targets, and other properties are managed on a per-\n * primitive basis.\n *\n * When the same geometry and material should be rendered at multiple places in the scene, reuse\n * the same Mesh instance and attach it to multiple nodes for better efficiency. Where the geometry\n * is shared but the material is not, reusing {@link Accessor}s under different meshes and\n * primitives can similarly improve transmission efficiency, although some rendering efficiency is\n * lost as the number of materials in a scene increases.\n *\n * Usage:\n *\n * ```ts\n * const primitive = doc.createPrimitive()\n * \t.setAttribute('POSITION', positionAccessor)\n * \t.setAttribute('TEXCOORD_0', uvAccessor);\n * const mesh = doc.createMesh('myMesh')\n * \t.addPrimitive(primitive);\n * node.setMesh(mesh);\n * ```\n *\n * References:\n * - [glTF  Geometry](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#geometry)\n *\n * @category Properties\n */\nexport class Mesh extends ExtensibleProperty<IMesh> {\n\tpublic declare propertyType: PropertyType.MESH;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.MESH;\n\t}\n\n\tprotected getDefaults(): Nullable<IMesh> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { weights: [], primitives: [] });\n\t}\n\n\t/** Adds a {@link Primitive} to the mesh's draw call list. */\n\tpublic addPrimitive(primitive: Primitive): this {\n\t\treturn this.addRef('primitives', primitive);\n\t}\n\n\t/** Removes a {@link Primitive} from the mesh's draw call list. */\n\tpublic removePrimitive(primitive: Primitive): this {\n\t\treturn this.removeRef('primitives', primitive);\n\t}\n\n\t/** Lists {@link Primitive} draw calls of the mesh. */\n\tpublic listPrimitives(): Primitive[] {\n\t\treturn this.listRefs('primitives');\n\t}\n\n\t/**\n\t * Initial weights of each {@link PrimitiveTarget} on this mesh. Each {@link Primitive} must\n\t * have the same number of targets. Most engines only support 4-8 active morph targets at a\n\t * time.\n\t */\n\tpublic getWeights(): number[] {\n\t\treturn this.get('weights');\n\t}\n\n\t/**\n\t * Initial weights of each {@link PrimitiveTarget} on this mesh. Each {@link Primitive} must\n\t * have the same number of targets. Most engines only support 4-8 active morph targets at a\n\t * time.\n\t */\n\tpublic setWeights(weights: number[]): this {\n\t\treturn this.set('weights', weights);\n\t}\n}\n","import { multiply } from 'gl-matrix/mat4';\nimport { PropertyType, mat4, vec3, vec4, Nullable } from '../constants';\nimport { $attributes } from 'property-graph';\nimport { MathUtils } from '../utils';\nimport type { Camera } from './camera';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Mesh } from './mesh';\nimport { COPY_IDENTITY } from './property';\nimport type { Skin } from './skin';\n\ninterface INode extends IExtensibleProperty {\n\ttranslation: vec3;\n\trotation: vec4;\n\tscale: vec3;\n\tweights: number[];\n\tcamera: Camera;\n\tmesh: Mesh;\n\tskin: Skin;\n\tchildren: Node[];\n}\n\n/**\n * # Node\n *\n * *Nodes are the objects that comprise a {@link Scene}.*\n *\n * Each node may have one or more children, and a transform (position, rotation, and scale) that\n * applies to all of its descendants. A node may also reference (or \"instantiate\") other resources\n * at its location, including {@link Mesh}, Camera, Light, and Skin properties. A node cannot be\n * part of more than one {@link Scene}.\n *\n * A node's local transform is represented with array-like objects, intended to be compatible with\n * [gl-matrix](https://github.com/toji/gl-matrix), or with the `toArray`/`fromArray` methods of\n * libraries like three.js and babylon.js.\n *\n * Usage:\n *\n * ```ts\n * const node = doc.createNode('myNode')\n * \t.setMesh(mesh)\n * \t.setTranslation([0, 0, 0])\n * \t.addChild(otherNode);\n * ```\n *\n * References:\n * - [glTF  Nodes and Hierarchy](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#nodes-and-hierarchy)\n *\n * @category Properties\n */\nexport class Node extends ExtensibleProperty<INode> {\n\tpublic declare propertyType: PropertyType.NODE;\n\n\t/** @internal Internal reference to node's parent, omitted from {@link Graph}. */\n\tpublic _parent: SceneNode | null = null;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.NODE;\n\t}\n\n\tprotected getDefaults(): Nullable<INode> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\ttranslation: [0, 0, 0] as vec3,\n\t\t\trotation: [0, 0, 0, 1] as vec4,\n\t\t\tscale: [1, 1, 1] as vec3,\n\t\t\tweights: [],\n\t\t\tcamera: null,\n\t\t\tmesh: null,\n\t\t\tskin: null,\n\t\t\tchildren: [],\n\t\t});\n\t}\n\n\tpublic copy(other: this, resolve = COPY_IDENTITY): this {\n\t\t// Node cannot be copied, only cloned. Copying is shallow, but nodes cannot have more than\n\t\t// one parent. Rather than leaving one of the two nodes without children, throw an error here.\n\t\tif (resolve === COPY_IDENTITY) throw new Error('Node cannot be copied.');\n\t\treturn super.copy(other, resolve);\n\t}\n\n\t/**********************************************************************************************\n\t * Local transform.\n\t */\n\n\t/** Returns the translation (position) of this node in local space. */\n\tpublic getTranslation(): vec3 {\n\t\treturn this.get('translation');\n\t}\n\n\t/** Returns the rotation (quaternion) of this node in local space. */\n\tpublic getRotation(): vec4 {\n\t\treturn this.get('rotation');\n\t}\n\n\t/** Returns the scale of this node in local space. */\n\tpublic getScale(): vec3 {\n\t\treturn this.get('scale');\n\t}\n\n\t/** Sets the translation (position) of this node in local space. */\n\tpublic setTranslation(translation: vec3): this {\n\t\treturn this.set('translation', translation);\n\t}\n\n\t/** Sets the rotation (quaternion) of this node in local space. */\n\tpublic setRotation(rotation: vec4): this {\n\t\treturn this.set('rotation', rotation);\n\t}\n\n\t/** Sets the scale of this node in local space. */\n\tpublic setScale(scale: vec3): this {\n\t\treturn this.set('scale', scale);\n\t}\n\n\t/** Returns the local matrix of this node. */\n\tpublic getMatrix(): mat4 {\n\t\treturn MathUtils.compose(\n\t\t\tthis.get('translation'),\n\t\t\tthis.get('rotation'),\n\t\t\tthis.get('scale'),\n\t\t\t[] as unknown as mat4\n\t\t);\n\t}\n\n\t/** Sets the local matrix of this node. Matrix will be decomposed to TRS properties. */\n\tpublic setMatrix(matrix: mat4): this {\n\t\tconst translation = this.get('translation').slice() as vec3;\n\t\tconst rotation = this.get('rotation').slice() as vec4;\n\t\tconst scale = this.get('scale').slice() as vec3;\n\t\tMathUtils.decompose(matrix, translation, rotation, scale);\n\t\treturn this.set('translation', translation).set('rotation', rotation).set('scale', scale);\n\t}\n\n\t/**********************************************************************************************\n\t * World transform.\n\t */\n\n\t/** Returns the translation (position) of this node in world space. */\n\tpublic getWorldTranslation(): vec3 {\n\t\tconst t = [0, 0, 0] as vec3;\n\t\tMathUtils.decompose(this.getWorldMatrix(), t, [0, 0, 0, 1], [1, 1, 1]);\n\t\treturn t;\n\t}\n\n\t/** Returns the rotation (quaternion) of this node in world space. */\n\tpublic getWorldRotation(): vec4 {\n\t\tconst r = [0, 0, 0, 1] as vec4;\n\t\tMathUtils.decompose(this.getWorldMatrix(), [0, 0, 0], r, [1, 1, 1]);\n\t\treturn r;\n\t}\n\n\t/** Returns the scale of this node in world space. */\n\tpublic getWorldScale(): vec3 {\n\t\tconst s = [1, 1, 1] as vec3;\n\t\tMathUtils.decompose(this.getWorldMatrix(), [0, 0, 0], [0, 0, 0, 1], s);\n\t\treturn s;\n\t}\n\n\t/** Returns the world matrix of this node. */\n\tpublic getWorldMatrix(): mat4 {\n\t\t// Build ancestor chain.\n\t\tconst ancestors: Node[] = [];\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tfor (let node: SceneNode | null = this; node instanceof Node; node = node._parent) {\n\t\t\tancestors.push(node);\n\t\t}\n\n\t\t// Compute world matrix.\n\t\tlet ancestor: Node | undefined;\n\t\tconst worldMatrix = ancestors.pop()!.getMatrix();\n\t\twhile ((ancestor = ancestors.pop())) {\n\t\t\tmultiply(worldMatrix, worldMatrix, ancestor.getMatrix());\n\t\t}\n\n\t\treturn worldMatrix;\n\t}\n\n\t/**********************************************************************************************\n\t * Scene hierarchy.\n\t */\n\n\t/** Adds another node as a child of this one. Nodes cannot have multiple parents. */\n\tpublic addChild(child: Node): this {\n\t\t// Remove existing parent.\n\t\tif (child._parent) child._parent.removeChild(child);\n\n\t\t// Edge in graph.\n\t\tthis.addRef('children', child);\n\n\t\t// Set new parent.\n\t\t// TODO(cleanup): Avoid using $attributes here?\n\t\tchild._parent = this;\n\t\tconst childrenRefs = this[$attributes]['children'];\n\t\tconst ref = childrenRefs[childrenRefs.length - 1];\n\t\tref.addEventListener('dispose', () => (child._parent = null));\n\t\treturn this;\n\t}\n\n\t/** Removes a node from this node's child node list. */\n\tpublic removeChild(child: Node): this {\n\t\treturn this.removeRef('children', child);\n\t}\n\n\t/** Lists all child nodes of this node. */\n\tpublic listChildren(): Node[] {\n\t\treturn this.listRefs('children');\n\t}\n\n\t/**\n\t * Returns the unique parent ({@link Scene}, {@link Node}, or null) of this node in the scene\n\t * hierarchy. Unrelated to {@link Property.listParents}, which lists all resource references.\n\t */\n\tpublic getParent(): SceneNode | null {\n\t\treturn this._parent;\n\t}\n\n\t/**********************************************************************************************\n\t * Attachments.\n\t */\n\n\t/** Returns the {@link Mesh}, if any, instantiated at this node. */\n\tpublic getMesh(): Mesh | null {\n\t\treturn this.getRef('mesh');\n\t}\n\n\t/**\n\t * Sets a {@link Mesh} to be instantiated at this node. A single mesh may be instatiated by\n\t * multiple nodes; reuse of this sort is strongly encouraged.\n\t */\n\tpublic setMesh(mesh: Mesh | null): this {\n\t\treturn this.setRef('mesh', mesh);\n\t}\n\n\t/** Returns the {@link Camera}, if any, instantiated at this node. */\n\tpublic getCamera(): Camera | null {\n\t\treturn this.getRef('camera');\n\t}\n\n\t/** Sets a {@link Camera} to be instantiated at this node. */\n\tpublic setCamera(camera: Camera | null): this {\n\t\treturn this.setRef('camera', camera);\n\t}\n\n\t/** Returns the {@link Skin}, if any, instantiated at this node. */\n\tpublic getSkin(): Skin | null {\n\t\treturn this.getRef('skin');\n\t}\n\n\t/** Sets a {@link Skin} to be instantiated at this node. */\n\tpublic setSkin(skin: Skin | null): this {\n\t\treturn this.setRef('skin', skin);\n\t}\n\n\t/**\n\t * Initial weights of each {@link PrimitiveTarget} for the mesh instance at this node.\n\t * Most engines only support 4-8 active morph targets at a time.\n\t */\n\tpublic getWeights(): number[] {\n\t\treturn this.get('weights');\n\t}\n\n\t/**\n\t * Initial weights of each {@link PrimitiveTarget} for the mesh instance at this node.\n\t * Most engines only support 4-8 active morph targets at a time.\n\t */\n\tpublic setWeights(weights: number[]): this {\n\t\treturn this.set('weights', weights);\n\t}\n\n\t/**********************************************************************************************\n\t * Helpers.\n\t */\n\n\t/** Visits this {@link Node} and its descendants, top-down. */\n\tpublic traverse(fn: (node: Node) => void): this {\n\t\tfn(this);\n\t\tfor (const child of this.listChildren()) child.traverse(fn);\n\t\treturn this;\n\t}\n}\n\ninterface SceneNode {\n\tpropertyType: PropertyType;\n\t_parent?: SceneNode | null;\n\taddChild(node: Node): this;\n\tremoveChild(node: Node): this;\n}\n","import { BufferViewUsage, Nullable, PropertyType } from '../constants';\nimport type { GLTF } from '../types/gltf';\nimport type { Accessor } from './accessor';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Material } from './material';\nimport type { PrimitiveTarget } from './primitive-target';\n\ninterface IPrimitive extends IExtensibleProperty {\n\tmode: GLTF.MeshPrimitiveMode;\n\tmaterial: Material;\n\tindices: Accessor;\n\tattributes: { [key: string]: Accessor };\n\ttargets: PrimitiveTarget[];\n}\n\n/**\n * # Primitive\n *\n * *Primitives are individual GPU draw calls comprising a {@link Mesh}.*\n *\n * Meshes typically have only a single Primitive, although various cases may require more. Each\n * primitive may be assigned vertex attributes, morph target attributes, and a material. Any of\n * these properties should be reused among multiple primitives where feasible.\n *\n * Primitives cannot be moved independently of other primitives within the same mesh, except\n * through the use of morph targets and skinning. If independent movement or other runtime\n * behavior is necessary (like raycasting or collisions) prefer to assign each primitive to a\n * different mesh. The number of GPU draw calls is typically not affected by grouping or\n * ungrouping primitives to a mesh.\n *\n * Each primitive may optionally be deformed by one or more morph targets, stored in a\n * {@link PrimitiveTarget}.\n *\n * Usage:\n *\n * ```ts\n * const primitive = doc.createPrimitive()\n * \t.setAttribute('POSITION', positionAccessor)\n * \t.setAttribute('TEXCOORD_0', uvAccessor)\n * \t.setMaterial(material);\n * mesh.addPrimitive(primitive);\n * node.setMesh(mesh);\n * ```\n *\n * References:\n * - [glTF  Geometry](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#geometry)\n *\n * @category Properties\n */\nexport class Primitive extends ExtensibleProperty<IPrimitive> {\n\tpublic declare propertyType: PropertyType.PRIMITIVE;\n\n\t/**********************************************************************************************\n\t * Constants.\n\t */\n\n\t/** Type of primitives to render. All valid values correspond to WebGL enums. */\n\tpublic static Mode: Record<string, GLTF.MeshPrimitiveMode> = {\n\t\t/** Draw single points. */\n\t\tPOINTS: 0,\n\t\t/** Draw lines. Each vertex connects to the one after it. */\n\t\tLINES: 1,\n\t\t/**\n\t\t * Draw lines. Each set of two vertices is treated as a separate line segment.\n\t\t * @deprecated See {@link https://github.com/KhronosGroup/glTF/issues/1883 KhronosGroup/glTF#1883}.\n\t\t */\n\t\tLINE_LOOP: 2,\n\t\t/** Draw a connected group of line segments from the first vertex to the last,  */\n\t\tLINE_STRIP: 3,\n\t\t/** Draw triangles. Each set of three vertices creates a separate triangle. */\n\t\tTRIANGLES: 4,\n\t\t/** Draw a connected strip of triangles. */\n\t\tTRIANGLE_STRIP: 5,\n\t\t/**\n\t\t * Draw a connected group of triangles. Each vertex connects to the previous and the first\n\t\t * vertex in the fan.\n\t\t * @deprecated See {@link https://github.com/KhronosGroup/glTF/issues/1883 KhronosGroup/glTF#1883}.\n\t\t */\n\t\tTRIANGLE_FAN: 6,\n\t};\n\n\t/**********************************************************************************************\n\t * Instance.\n\t */\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.PRIMITIVE;\n\t}\n\n\tprotected getDefaults(): Nullable<IPrimitive> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\tmode: Primitive.Mode.TRIANGLES,\n\t\t\tmaterial: null,\n\t\t\tindices: null,\n\t\t\tattributes: {},\n\t\t\ttargets: [],\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Primitive data.\n\t */\n\n\t/** Returns an {@link Accessor} with indices of vertices to be drawn. */\n\tpublic getIndices(): Accessor | null {\n\t\treturn this.getRef('indices');\n\t}\n\n\t/**\n\t * Sets an {@link Accessor} with indices of vertices to be drawn. In `TRIANGLES` draw mode,\n\t * each set of three indices define a triangle. The front face has a counter-clockwise (CCW)\n\t * winding order.\n\t */\n\tpublic setIndices(indices: Accessor | null): this {\n\t\treturn this.setRef('indices', indices, { usage: BufferViewUsage.ELEMENT_ARRAY_BUFFER });\n\t}\n\n\t/** Returns a vertex attribute as an {@link Accessor}. */\n\tpublic getAttribute(semantic: string): Accessor | null {\n\t\treturn this.getRefMap('attributes', semantic);\n\t}\n\n\t/**\n\t * Sets a vertex attribute to an {@link Accessor}. All attributes must have the same vertex\n\t * count.\n\t */\n\tpublic setAttribute(semantic: string, accessor: Accessor | null): this {\n\t\treturn this.setRefMap('attributes', semantic, accessor, { usage: BufferViewUsage.ARRAY_BUFFER });\n\t}\n\n\t/**\n\t * Lists all vertex attribute {@link Accessor}s associated with the primitive, excluding any\n\t * attributes used for morph targets. For example, `[positionAccessor, normalAccessor,\n\t * uvAccessor]`. Order will be consistent with the order returned by {@link .listSemantics}().\n\t */\n\tpublic listAttributes(): Accessor[] {\n\t\treturn this.listRefMapValues('attributes');\n\t}\n\n\t/**\n\t * Lists all vertex attribute semantics associated with the primitive, excluding any semantics\n\t * used for morph targets. For example, `['POSITION', 'NORMAL', 'TEXCOORD_0']`. Order will be\n\t * consistent with the order returned by {@link .listAttributes}().\n\t */\n\tpublic listSemantics(): string[] {\n\t\treturn this.listRefMapKeys('attributes');\n\t}\n\n\t/** Returns the material used to render the primitive. */\n\tpublic getMaterial(): Material | null {\n\t\treturn this.getRef('material');\n\t}\n\n\t/** Sets the material used to render the primitive. */\n\tpublic setMaterial(material: Material | null): this {\n\t\treturn this.setRef('material', material);\n\t}\n\n\t/**********************************************************************************************\n\t * Mode.\n\t */\n\n\t/**\n\t * Returns the GPU draw mode (`TRIANGLES`, `LINES`, `POINTS`...) as a WebGL enum value.\n\t *\n\t * Reference:\n\t * - [glTF  `primitive.mode`](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#primitivemode)\n\t */\n\tpublic getMode(): GLTF.MeshPrimitiveMode {\n\t\treturn this.get('mode');\n\t}\n\n\t/**\n\t * Sets the GPU draw mode (`TRIANGLES`, `LINES`, `POINTS`...) as a WebGL enum value.\n\t *\n\t * Reference:\n\t * - [glTF  `primitive.mode`](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#primitivemode)\n\t */\n\tpublic setMode(mode: GLTF.MeshPrimitiveMode): this {\n\t\treturn this.set('mode', mode);\n\t}\n\n\t/**********************************************************************************************\n\t * Morph targets.\n\t */\n\n\t/** Lists all morph targets associated with the primitive. */\n\tpublic listTargets(): PrimitiveTarget[] {\n\t\treturn this.listRefs('targets');\n\t}\n\n\t/**\n\t * Adds a morph target to the primitive. All primitives in the same mesh must have the same\n\t * number of targets.\n\t */\n\tpublic addTarget(target: PrimitiveTarget): this {\n\t\treturn this.addRef('targets', target);\n\t}\n\n\t/**\n\t * Removes a morph target from the primitive. All primitives in the same mesh must have the same\n\t * number of targets.\n\t */\n\tpublic removeTarget(target: PrimitiveTarget): this {\n\t\treturn this.removeRef('targets', target);\n\t}\n}\n","import { BufferViewUsage, Nullable, PropertyType } from '../constants';\nimport type { Accessor } from './accessor';\nimport type { IExtensibleProperty } from './extensible-property';\nimport { Property } from './property';\n\ninterface IPrimitiveTarget extends IExtensibleProperty {\n\tattributes: { [key: string]: Accessor };\n}\n\n/**\n * # PrimitiveTarget\n *\n * *Morph target or shape key used to deform one {@link Primitive} in a {@link Mesh}.*\n *\n * A PrimitiveTarget contains a `POSITION` attribute (and optionally `NORMAL` and `TANGENT`) that\n * can additively deform the base attributes on a {@link Mesh} {@link Primitive}. Vertex values\n * of `0, 0, 0` in the target will have no effect, whereas a value of `0, 1, 0` would offset that\n * vertex in the base geometry by y+=1. Morph targets can be fully or partially applied: their\n * default state is controlled by {@link Mesh.getWeights}, which can also be overridden for a\n * particular instantiation of a {@link Mesh}, using {@link Node.getWeights}.\n *\n * Reference:\n * - [glTF  Morph Targets](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#morph-targets)\n */\nexport class PrimitiveTarget extends Property<IPrimitiveTarget> {\n\tpublic declare propertyType: PropertyType.PRIMITIVE_TARGET;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.PRIMITIVE_TARGET;\n\t}\n\n\tprotected getDefaults(): Nullable<IPrimitiveTarget> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { attributes: {} });\n\t}\n\n\t/** Returns a morph target vertex attribute as an {@link Accessor}. */\n\tpublic getAttribute(semantic: string): Accessor | null {\n\t\treturn this.getRefMap('attributes', semantic);\n\t}\n\n\t/**\n\t * Sets a morph target vertex attribute to an {@link Accessor}.\n\t */\n\tpublic setAttribute(semantic: string, accessor: Accessor | null): this {\n\t\treturn this.setRefMap('attributes', semantic, accessor, { usage: BufferViewUsage.ARRAY_BUFFER });\n\t}\n\n\t/**\n\t * Lists all morph target vertex attribute {@link Accessor}s associated. Order will be\n\t * consistent with the order returned by {@link .listSemantics}().\n\t */\n\tpublic listAttributes(): Accessor[] {\n\t\treturn this.listRefMapValues('attributes');\n\t}\n\n\t/**\n\t * Lists all morph target vertex attribute semantics associated. Order will be\n\t * consistent with the order returned by {@link .listAttributes}().\n\t */\n\tpublic listSemantics(): string[] {\n\t\treturn this.listRefMapKeys('attributes');\n\t}\n}\n","import { Nullable, PropertyType } from '../constants';\nimport { $attributes } from 'property-graph';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Node } from './node';\nimport { COPY_IDENTITY } from './property';\n\ninterface IScene extends IExtensibleProperty {\n\tchildren: Node[];\n}\n\n/**\n * # Scene\n *\n * *Scenes represent a set of visual objects to render.*\n *\n * Typically a glTF file contains only a single scene, although more are allowed and useful in some\n * cases. No particular meaning is associated with additional scenes, except as defined by the\n * application. Scenes reference {@link Node}s, and a single node cannot be a member of more than\n * one scene.\n *\n * References:\n * - [glTF  Scenes](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#scenes)\n * - [glTF  Coordinate System and Units](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#coordinate-system-and-units)\n *\n * @category Properties\n */\nexport class Scene extends ExtensibleProperty<IScene> {\n\tpublic declare propertyType: PropertyType.SCENE;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.SCENE;\n\t}\n\n\tprotected getDefaults(): Nullable<IScene> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { children: [] });\n\t}\n\n\tpublic copy(other: this, resolve = COPY_IDENTITY): this {\n\t\t// Scene cannot be copied, only cloned. Copying is shallow, but nodes cannot have more than\n\t\t// one parent. Rather than leaving one of the two scenes without children, throw an error here.\n\t\tif (resolve === COPY_IDENTITY) throw new Error('Scene cannot be copied.');\n\t\treturn super.copy(other, resolve);\n\t}\n\n\t/** Adds a {@link Node} to the scene. */\n\tpublic addChild(node: Node): this {\n\t\t// Remove existing parent.\n\t\tif (node._parent) node._parent.removeChild(node);\n\n\t\t// Edge in graph.\n\t\tthis.addRef('children', node);\n\n\t\t// Set new parent.\n\t\t// TODO(cleanup): Avoid using $attributes here?\n\t\tnode._parent = this;\n\t\tconst childrenRefs = this[$attributes]['children'];\n\t\tconst ref = childrenRefs[childrenRefs.length - 1];\n\t\tref.addEventListener('dispose', () => (node._parent = null));\n\t\treturn this;\n\t}\n\n\t/** Removes a {@link Node} from the scene. */\n\tpublic removeChild(node: Node): this {\n\t\treturn this.removeRef('children', node);\n\t}\n\n\t/** Lists all root {@link Node}s in the scene. */\n\tpublic listChildren(): Node[] {\n\t\treturn this.listRefs('children');\n\t}\n\n\t/** Visits each {@link Node} in the scene, including descendants, top-down. */\n\tpublic traverse(fn: (node: Node) => void): this {\n\t\tfor (const node of this.listChildren()) node.traverse(fn);\n\t\treturn this;\n\t}\n}\n","import { BufferViewUsage, Nullable, PropertyType } from '../constants';\nimport type { Accessor } from './accessor';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { Node } from './node';\n\ninterface ISkin extends IExtensibleProperty {\n\tskeleton: Node;\n\tinverseBindMatrices: Accessor;\n\tjoints: Node[];\n}\n\n/**\n * # Skin\n *\n * *Collection of {@link Node} joints and inverse bind matrices used with skinned {@link Mesh}\n * instances.*\n *\n * Reference\n * - [glTF  Skins](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#skins)\n *\n * @category Properties\n */\nexport class Skin extends ExtensibleProperty<ISkin> {\n\tpublic declare propertyType: PropertyType.SKIN;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.SKIN;\n\t}\n\n\tprotected getDefaults(): Nullable<ISkin> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\tskeleton: null,\n\t\t\tinverseBindMatrices: null,\n\t\t\tjoints: [],\n\t\t});\n\t}\n\n\t/**\n\t * {@link Node} used as a skeleton root. The node must be the closest common root of the joints\n\t * hierarchy or a direct or indirect parent node of the closest common root.\n\t */\n\tpublic getSkeleton(): Node | null {\n\t\treturn this.getRef('skeleton');\n\t}\n\n\t/**\n\t * {@link Node} used as a skeleton root. The node must be the closest common root of the joints\n\t * hierarchy or a direct or indirect parent node of the closest common root.\n\t */\n\tpublic setSkeleton(skeleton: Node | null): this {\n\t\treturn this.setRef('skeleton', skeleton);\n\t}\n\n\t/**\n\t * {@link Accessor} containing the floating-point 4x4 inverse-bind matrices. The default is\n\t * that each matrix is a 4x4 identity matrix, which implies that inverse-bind matrices were\n\t * pre-applied.\n\t */\n\tpublic getInverseBindMatrices(): Accessor | null {\n\t\treturn this.getRef('inverseBindMatrices');\n\t}\n\n\t/**\n\t * {@link Accessor} containing the floating-point 4x4 inverse-bind matrices. The default is\n\t * that each matrix is a 4x4 identity matrix, which implies that inverse-bind matrices were\n\t * pre-applied.\n\t */\n\tpublic setInverseBindMatrices(inverseBindMatrices: Accessor | null): this {\n\t\treturn this.setRef('inverseBindMatrices', inverseBindMatrices, {\n\t\t\tusage: BufferViewUsage.INVERSE_BIND_MATRICES,\n\t\t});\n\t}\n\n\t/** Adds a joint {@link Node} to this {@link Skin}. */\n\tpublic addJoint(joint: Node): this {\n\t\treturn this.addRef('joints', joint);\n\t}\n\n\t/** Removes a joint {@link Node} from this {@link Skin}. */\n\tpublic removeJoint(joint: Node): this {\n\t\treturn this.removeRef('joints', joint);\n\t}\n\n\t/** Lists joints ({@link Node}s used as joints or bones) in this {@link Skin}. */\n\tpublic listJoints(): Node[] {\n\t\treturn this.listRefs('joints');\n\t}\n}\n","import { Nullable, PropertyType, vec2 } from '../constants';\nimport { BufferUtils, FileUtils, ImageUtils } from '../utils';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\n\ninterface ITexture extends IExtensibleProperty {\n\timage: Uint8Array | null;\n\tmimeType: string;\n\turi: string;\n}\n\n/**\n * # Texture\n *\n * *Texture, or images, referenced by {@link Material} properties.*\n *\n * Textures in glTF-Transform are a combination of glTF's `texture` and `image` properties, and\n * should be unique within a document, such that no other texture contains the same\n * {@link getImage}() data. Where duplicates may already exist, the `dedup({textures: true})`\n * transform can remove them. A {@link Document} with N texture properties will be exported to a\n * glTF file with N `image` properties, and the minimum number of `texture` properties necessary\n * for the materials that use it.\n *\n * For properties associated with a particular _use_ of a texture, see {@link TextureInfo}.\n *\n * Reference:\n * - [glTF  Textures](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#textures)\n * - [glTF  Images](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#images)\n *\n * @category Properties\n */\nexport class Texture extends ExtensibleProperty<ITexture> {\n\tpublic declare propertyType: PropertyType.TEXTURE;\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.TEXTURE;\n\t}\n\n\tprotected getDefaults(): Nullable<ITexture> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, { image: null, mimeType: '', uri: '' });\n\t}\n\n\t/**********************************************************************************************\n\t * MIME type / format.\n\t */\n\n\t/** Returns the MIME type for this texture ('image/jpeg' or 'image/png'). */\n\tpublic getMimeType(): string {\n\t\treturn this.get('mimeType') || ImageUtils.extensionToMimeType(FileUtils.extension(this.get('uri')));\n\t}\n\n\t/**\n\t * Sets the MIME type for this texture ('image/jpeg' or 'image/png'). If the texture does not\n\t * have a URI, a MIME type is required for correct export.\n\t */\n\tpublic setMimeType(mimeType: string): this {\n\t\treturn this.set('mimeType', mimeType);\n\t}\n\n\t/**********************************************************************************************\n\t * URI / filename.\n\t */\n\n\t/** Returns the URI (e.g. 'path/to/file.png') for this texture. */\n\tpublic getURI(): string {\n\t\treturn this.get('uri');\n\t}\n\n\t/**\n\t * Sets the URI (e.g. 'path/to/file.png') for this texture. If the texture does not have a MIME\n\t * type, a URI is required for correct export.\n\t */\n\tpublic setURI(uri: string): this {\n\t\tthis.set('uri', uri);\n\t\tthis.set('mimeType', ImageUtils.extensionToMimeType(FileUtils.extension(uri)));\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Image data.\n\t */\n\n\t/** Returns the raw image data for this texture. */\n\tpublic getImage(): Uint8Array | null {\n\t\treturn this.get('image');\n\t}\n\n\t/** Sets the raw image data for this texture. */\n\tpublic setImage(image: Uint8Array): this {\n\t\treturn this.set('image', BufferUtils.assertView(image));\n\t}\n\n\t/** Returns the size, in pixels, of this texture. */\n\tpublic getSize(): vec2 | null {\n\t\tconst image = this.get('image');\n\t\tif (!image) return null;\n\t\treturn ImageUtils.getSize(image, this.getMimeType());\n\t}\n}\n","import { Nullable, PropertyType, VERSION } from '../constants';\nimport type { Extension } from '../extension';\nimport type { Graph } from 'property-graph';\nimport { Accessor } from './accessor';\nimport { Animation } from './animation';\nimport { Buffer } from './buffer';\nimport { Camera } from './camera';\nimport { Material } from './material';\nimport { Mesh } from './mesh';\nimport { Node } from './node';\nimport { COPY_IDENTITY, Property } from './property';\nimport { Scene } from './scene';\nimport { Skin } from './skin';\nimport { Texture } from './texture';\nimport { ExtensibleProperty, IExtensibleProperty } from './extensible-property';\nimport type { ExtensionProperty } from './extension-property';\n\ninterface IAsset {\n\tversion: string;\n\tminVersion?: string;\n\tgenerator?: string;\n\tcopyright?: string;\n\t[key: string]: unknown;\n}\n\ninterface IRoot extends IExtensibleProperty {\n\tasset: IAsset;\n\tdefaultScene: Scene;\n\n\taccessors: Accessor[];\n\tanimations: Animation[];\n\tbuffers: Buffer[];\n\tcameras: Camera[];\n\tmaterials: Material[];\n\tmeshes: Mesh[];\n\tnodes: Node[];\n\tscenes: Scene[];\n\tskins: Skin[];\n\ttextures: Texture[];\n}\n\n/**\n * # Root\n *\n * *Root property of a glTF asset.*\n *\n * Any properties to be exported with a particular asset must be referenced (directly or\n * indirectly) by the root. Metadata about the asset's license, generator, and glTF specification\n * version are stored in the asset, accessible with {@link .getAsset}().\n *\n * Properties are added to the root with factory methods on its {@link Document}, and removed by\n * calling {@link Property.dispose}() on the resource. Any properties that have been created but\n * not disposed will be included when calling the various `root.list*()` methods.\n *\n * A document's root cannot be removed, and no other root may be created. Unlike other\n * {@link Property} types, the `.dispose()`, `.detach()` methods have no useful function on a\n * Root property.\n *\n * Usage:\n *\n * ```ts\n * const root = document.getRoot();\n * const scene = document.createScene('myScene');\n * const node = document.createNode('myNode');\n * scene.addChild(node);\n *\n * console.log(root.listScenes()); //  [scene x 1]\n * ```\n *\n * Reference: [glTF  Concepts](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#concepts)\n *\n * @category Properties\n */\nexport class Root extends ExtensibleProperty<IRoot> {\n\tpublic declare propertyType: PropertyType.ROOT;\n\n\tprivate readonly _extensions: Set<Extension> = new Set();\n\n\tprotected init(): void {\n\t\tthis.propertyType = PropertyType.ROOT;\n\t}\n\n\tprotected getDefaults(): Nullable<IRoot> {\n\t\treturn Object.assign(super.getDefaults() as IExtensibleProperty, {\n\t\t\tasset: {\n\t\t\t\tgenerator: `glTF-Transform ${VERSION}`,\n\t\t\t\tversion: '2.0',\n\t\t\t},\n\t\t\tdefaultScene: null,\n\t\t\taccessors: [],\n\t\t\tanimations: [],\n\t\t\tbuffers: [],\n\t\t\tcameras: [],\n\t\t\tmaterials: [],\n\t\t\tmeshes: [],\n\t\t\tnodes: [],\n\t\t\tscenes: [],\n\t\t\tskins: [],\n\t\t\ttextures: [],\n\t\t});\n\t}\n\n\t/** @internal */\n\tconstructor(graph: Graph<Property>) {\n\t\tsuper(graph);\n\t\tgraph.addEventListener('node:create', (event) => {\n\t\t\tthis._addChildOfRoot(event.target as Property);\n\t\t});\n\t}\n\n\tpublic clone(): this {\n\t\tthrow new Error('Root cannot be cloned.');\n\t}\n\n\tpublic copy(other: this, resolve = COPY_IDENTITY): this {\n\t\t// Root cannot be cloned in isolation: only with its Document. Extensions are managed by\n\t\t// the Document during cloning. The Root, and only the Root, should keep existing\n\t\t// references while copying to avoid overwriting during a merge.\n\t\tif (resolve === COPY_IDENTITY) throw new Error('Root cannot be copied.');\n\n\t\t// IMPORTANT: Root cannot call super.copy(), which removes existing references.\n\n\t\tthis.set('asset', { ...other.get('asset') });\n\t\tthis.setName(other.getName());\n\t\tthis.setExtras({ ...other.getExtras() });\n\t\tthis.setDefaultScene(other.getDefaultScene() ? resolve(other.getDefaultScene()!) : null);\n\n\t\tfor (const extensionName of other.listRefMapKeys('extensions')) {\n\t\t\tconst otherExtension = other.getExtension(extensionName) as ExtensionProperty;\n\t\t\tthis.setExtension(extensionName, resolve(otherExtension));\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tprivate _addChildOfRoot(child: Property): this {\n\t\tif (child instanceof Scene) {\n\t\t\tthis.addRef('scenes', child);\n\t\t} else if (child instanceof Node) {\n\t\t\tthis.addRef('nodes', child);\n\t\t} else if (child instanceof Camera) {\n\t\t\tthis.addRef('cameras', child);\n\t\t} else if (child instanceof Skin) {\n\t\t\tthis.addRef('skins', child);\n\t\t} else if (child instanceof Mesh) {\n\t\t\tthis.addRef('meshes', child);\n\t\t} else if (child instanceof Material) {\n\t\t\tthis.addRef('materials', child);\n\t\t} else if (child instanceof Texture) {\n\t\t\tthis.addRef('textures', child);\n\t\t} else if (child instanceof Animation) {\n\t\t\tthis.addRef('animations', child);\n\t\t} else if (child instanceof Accessor) {\n\t\t\tthis.addRef('accessors', child);\n\t\t} else if (child instanceof Buffer) {\n\t\t\tthis.addRef('buffers', child);\n\t\t}\n\t\t// No error for untracked property types.\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns the `asset` object, which specifies the target glTF version of the asset. Additional\n\t * metadata can be stored in optional properties such as `generator` or `copyright`.\n\t *\n\t * Reference: [glTF  Asset](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#asset)\n\t */\n\tpublic getAsset(): IAsset {\n\t\treturn this.get('asset');\n\t}\n\n\t/**********************************************************************************************\n\t * Extensions.\n\t */\n\n\t/** Lists all {@link Extension} properties enabled for this root. */\n\tpublic listExtensionsUsed(): Extension[] {\n\t\treturn Array.from(this._extensions);\n\t}\n\n\t/** Lists all {@link Extension} properties enabled and required for this root. */\n\tpublic listExtensionsRequired(): Extension[] {\n\t\treturn this.listExtensionsUsed().filter((extension) => extension.isRequired());\n\t}\n\n\t/** @internal */\n\tpublic _enableExtension(extension: Extension): this {\n\t\tthis._extensions.add(extension);\n\t\treturn this;\n\t}\n\n\t/** @internal */\n\tpublic _disableExtension(extension: Extension): this {\n\t\tthis._extensions.delete(extension);\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Properties.\n\t */\n\n\t/** Lists all {@link Scene} properties associated with this root. */\n\tpublic listScenes(): Scene[] {\n\t\treturn this.listRefs('scenes');\n\t}\n\n\t/** Default {@link Scene} associated with this root. */\n\tpublic setDefaultScene(defaultScene: Scene | null): this {\n\t\treturn this.setRef('defaultScene', defaultScene);\n\t}\n\n\t/** Default {@link Scene} associated with this root. */\n\tpublic getDefaultScene(): Scene | null {\n\t\treturn this.getRef('defaultScene');\n\t}\n\n\t/** Lists all {@link Node} properties associated with this root. */\n\tpublic listNodes(): Node[] {\n\t\treturn this.listRefs('nodes');\n\t}\n\n\t/** Lists all {@link Camera} properties associated with this root. */\n\tpublic listCameras(): Camera[] {\n\t\treturn this.listRefs('cameras');\n\t}\n\n\t/** Lists all {@link Skin} properties associated with this root. */\n\tpublic listSkins(): Skin[] {\n\t\treturn this.listRefs('skins');\n\t}\n\n\t/** Lists all {@link Mesh} properties associated with this root. */\n\tpublic listMeshes(): Mesh[] {\n\t\treturn this.listRefs('meshes');\n\t}\n\n\t/** Lists all {@link Material} properties associated with this root. */\n\tpublic listMaterials(): Material[] {\n\t\treturn this.listRefs('materials');\n\t}\n\n\t/** Lists all {@link Texture} properties associated with this root. */\n\tpublic listTextures(): Texture[] {\n\t\treturn this.listRefs('textures');\n\t}\n\n\t/** Lists all {@link Animation} properties associated with this root. */\n\tpublic listAnimations(): Animation[] {\n\t\treturn this.listRefs('animations');\n\t}\n\n\t/** Lists all {@link Accessor} properties associated with this root. */\n\tpublic listAccessors(): Accessor[] {\n\t\treturn this.listRefs('accessors');\n\t}\n\n\t/** Lists all {@link Buffer} properties associated with this root. */\n\tpublic listBuffers(): Buffer[] {\n\t\treturn this.listRefs('buffers');\n\t}\n}\n","import { PropertyType } from './constants';\nimport type { Extension } from './extension';\nimport { Graph } from 'property-graph';\nimport {\n\tAccessor,\n\tAnimation,\n\tAnimationChannel,\n\tAnimationSampler,\n\tBuffer,\n\tCamera,\n\tMaterial,\n\tMesh,\n\tNode,\n\tPrimitive,\n\tPrimitiveTarget,\n\tProperty,\n\tRoot,\n\tScene,\n\tSkin,\n\tTexture,\n} from './properties';\nimport { Logger } from './utils';\n\nexport interface TransformContext {\n\tstack: string[];\n}\n\nexport type Transform = (doc: Document, context?: TransformContext) => void;\n\n/**\n * # Document\n *\n * *Wraps a glTF asset and its resources for easier modification.*\n *\n * Documents manage glTF assets and the relationships among dependencies. The document wrapper\n * allow tools to read and write changes without dealing with array indices or byte offsets, which\n * would otherwise require careful management over the course of a file modification. An internal\n * graph structure allows any property in the glTF file to maintain references to its dependencies,\n * and makes it easy to determine where a particular property dependency is being used. For\n * example, finding a list of materials that use a particular texture is as simple as calling\n * {@link Texture.listParents}().\n *\n * A new resource {@link Property} (e.g. a {@link Mesh} or {@link Material}) is created by calling\n * 'create' methods on the document. Resources are destroyed by calling {@link Property.dispose}().\n *\n * ```ts\n * import fs from 'fs/promises';\n * import { Document } from '@gltf-transform/core';\n * import { dedup } from '@gltf-transform/functions';\n *\n * const doc = new Document();\n *\n * const texture1 = doc.createTexture('myTexture')\n * \t.setImage(await fs.readFile('path/to/image.png'))\n * \t.setMimeType('image/png');\n * const texture2 = doc.createTexture('myTexture2')\n * \t.setImage(await fs.readFile('path/to/image2.png'))\n * \t.setMimeType('image/png');\n *\n * // Document containing duplicate copies of the same texture.\n * doc.getRoot().listTextures(); //  [texture x 2]\n *\n * await doc.transform(\n * \tdedup({textures: true}),\n * \t// ...\n * );\n *\n * // Document with duplicate textures removed.\n * doc.getRoot().listTextures(); //  [texture x 1]\n * ```\n *\n * Reference:\n * - [glTF  Basics](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#gltf-basics)\n * - [glTF  Concepts](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#concepts)\n *\n * @category Documents\n */\nexport class Document {\n\tprivate _graph: Graph<Property> = new Graph<Property>();\n\tprivate _root: Root = new Root(this._graph);\n\tprivate _logger = Logger.DEFAULT_INSTANCE;\n\n\t/** Returns the glTF {@link Root} property. */\n\tpublic getRoot(): Root {\n\t\treturn this._root;\n\t}\n\n\t/**\n\t * Returns the {@link Graph} representing connectivity of resources within this document.\n\t *\n\t * @hidden\n\t */\n\tpublic getGraph(): Graph<Property> {\n\t\treturn this._graph;\n\t}\n\n\t/** Returns the {@link Logger} instance used for any operations performed on this document. */\n\tpublic getLogger(): Logger {\n\t\treturn this._logger;\n\t}\n\n\t/**\n\t * Overrides the {@link Logger} instance used for any operations performed on this document.\n\t *\n\t * Usage:\n\t *\n\t * ```ts\n\t * doc\n\t * \t.setLogger(new Logger(Logger.Verbosity.SILENT))\n\t * \t.transform(dedup(), weld());\n\t * ```\n\t */\n\tpublic setLogger(logger: Logger): Document {\n\t\tthis._logger = logger;\n\t\treturn this;\n\t}\n\n\t/** Clones this Document, copying all resources within it. */\n\tpublic clone(): Document {\n\t\treturn new Document().setLogger(this._logger).merge(this);\n\t}\n\n\t/** Merges the content of another Document into this one, without affecting the original. */\n\tpublic merge(other: Document): this {\n\t\t// 1. Attach extensions.\n\t\tconst thisExtensions: { [key: string]: Extension } = {};\n\t\tfor (const otherExtension of other.getRoot().listExtensionsUsed()) {\n\t\t\tconst thisExtension = this.createExtension(otherExtension.constructor as new (doc: Document) => Extension);\n\t\t\tif (otherExtension.isRequired()) thisExtension.setRequired(true);\n\t\t\tthisExtensions[thisExtension.extensionName] = thisExtension;\n\t\t}\n\n\t\t// 2. Preconfigure the Root and merge history.\n\t\tconst visited = new Set<Property>();\n\t\tconst propertyMap = new Map<Property, Property>();\n\t\tvisited.add(other._root);\n\t\tpropertyMap.set(other._root, this._root);\n\n\t\t// 3. Create stub classes for every Property in other Document.\n\t\tfor (const edge of other._graph.listEdges()) {\n\t\t\tfor (const thisProp of [edge.getParent() as Property, edge.getChild() as Property]) {\n\t\t\t\tif (visited.has(thisProp)) continue;\n\n\t\t\t\tlet otherProp: Property;\n\t\t\t\tif (thisProp.propertyType === PropertyType.TEXTURE_INFO) {\n\t\t\t\t\t// TextureInfo lifecycle is bound to a Material or ExtensionProperty.\n\t\t\t\t\totherProp = thisProp as Property;\n\t\t\t\t} else {\n\t\t\t\t\t// For other property types, create stub classes.\n\t\t\t\t\tconst PropertyClass = thisProp.constructor as new (g: Graph<Property>) => Property;\n\t\t\t\t\totherProp = new PropertyClass(this._graph);\n\t\t\t\t}\n\n\t\t\t\tpropertyMap.set(thisProp as Property, otherProp);\n\t\t\t\tvisited.add(thisProp);\n\t\t\t}\n\t\t}\n\n\t\t// 4. Assemble the edges between Properties.\n\t\tconst resolve = (p: Property): Property => {\n\t\t\tconst resolved = propertyMap.get(p);\n\t\t\tif (!resolved) throw new Error('Could resolve property.');\n\t\t\treturn resolved;\n\t\t};\n\t\tfor (const otherProp of visited) {\n\t\t\tconst thisProp = propertyMap.get(otherProp);\n\t\t\tif (!thisProp) throw new Error('Could resolve property.');\n\t\t\tthisProp.copy(otherProp, resolve);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Applies a series of modifications to this document. Each transformation is asynchronous,\n\t * takes the {@link Document} as input, and returns nothing. Transforms are applied in the\n\t * order given, which may affect the final result.\n\t *\n\t * Usage:\n\t *\n\t * ```ts\n\t * await doc.transform(\n\t * \tdedup(),\n\t * \tprune()\n\t * );\n\t * ```\n\t *\n\t * @param transforms List of synchronous transformation functions to apply.\n\t */\n\tpublic async transform(...transforms: Transform[]): Promise<this> {\n\t\tconst stack = transforms.map((fn) => fn.name);\n\t\tfor (const transform of transforms) {\n\t\t\tawait transform(this, { stack });\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Extension factory method.\n\t */\n\n\t/**\n\t * Creates a new {@link Extension}, for the extension type of the given constructor. If the\n\t * extension is already enabled for this Document, the previous Extension reference is reused.\n\t */\n\tcreateExtension<T extends Extension>(ctor: new (doc: Document) => T): T {\n\t\tconst extensionName = (ctor as unknown as { EXTENSION_NAME: 'string' }).EXTENSION_NAME;\n\t\tconst prevExtension = this.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.find((ext) => ext.extensionName === extensionName);\n\t\treturn (prevExtension || new ctor(this)) as T;\n\t}\n\n\t/**********************************************************************************************\n\t * Property factory methods.\n\t */\n\n\t/** Creates a new {@link Scene} attached to this document's {@link Root}. */\n\tcreateScene(name = ''): Scene {\n\t\treturn new Scene(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Node} attached to this document's {@link Root}. */\n\tcreateNode(name = ''): Node {\n\t\treturn new Node(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Camera} attached to this document's {@link Root}. */\n\tcreateCamera(name = ''): Camera {\n\t\treturn new Camera(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Skin} attached to this document's {@link Root}. */\n\tcreateSkin(name = ''): Skin {\n\t\treturn new Skin(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Mesh} attached to this document's {@link Root}. */\n\tcreateMesh(name = ''): Mesh {\n\t\treturn new Mesh(this._graph, name);\n\t}\n\n\t/**\n\t * Creates a new {@link Primitive}. Primitives must be attached to a {@link Mesh}\n\t * for use and export; they are not otherwise associated with a {@link Root}.\n\t */\n\tcreatePrimitive(): Primitive {\n\t\treturn new Primitive(this._graph);\n\t}\n\n\t/**\n\t * Creates a new {@link PrimitiveTarget}, or morph target. Targets must be attached to a\n\t * {@link Primitive} for use and export; they are not otherwise associated with a {@link Root}.\n\t */\n\tcreatePrimitiveTarget(name = ''): PrimitiveTarget {\n\t\treturn new PrimitiveTarget(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Material} attached to this document's {@link Root}. */\n\tcreateMaterial(name = ''): Material {\n\t\treturn new Material(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Texture} attached to this document's {@link Root}. */\n\tcreateTexture(name = ''): Texture {\n\t\treturn new Texture(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Animation} attached to this document's {@link Root}. */\n\tcreateAnimation(name = ''): Animation {\n\t\treturn new Animation(this._graph, name);\n\t}\n\n\t/**\n\t * Creates a new {@link AnimationChannel}. Channels must be attached to an {@link Animation}\n\t * for use and export; they are not otherwise associated with a {@link Root}.\n\t */\n\tcreateAnimationChannel(name = ''): AnimationChannel {\n\t\treturn new AnimationChannel(this._graph, name);\n\t}\n\n\t/**\n\t * Creates a new {@link AnimationSampler}. Samplers must be attached to an {@link Animation}\n\t * for use and export; they are not otherwise associated with a {@link Root}.\n\t */\n\tcreateAnimationSampler(name = ''): AnimationSampler {\n\t\treturn new AnimationSampler(this._graph, name);\n\t}\n\n\t/** Creates a new {@link Accessor} attached to this document's {@link Root}. */\n\tcreateAccessor(name = '', buffer: Buffer | null = null): Accessor {\n\t\tif (!buffer) {\n\t\t\tbuffer = this.getRoot().listBuffers()[0];\n\t\t}\n\t\treturn new Accessor(this._graph, name).setBuffer(buffer);\n\t}\n\n\t/** Creates a new {@link Buffer} attached to this document's {@link Root}. */\n\tcreateBuffer(name = ''): Buffer {\n\t\treturn new Buffer(this._graph, name);\n\t}\n}\n","import type { GraphEdgeEvent, GraphEvent, GraphNodeEvent } from 'property-graph';\nimport type { PropertyType } from './constants';\nimport type { Document } from './document';\nimport type { ReaderContext, WriterContext } from './io';\nimport { ExtensionProperty } from './properties';\n\n/**\n * # Extension\n *\n * *Base class for all Extensions.*\n *\n * Extensions enhance a glTF {@link Document} with additional features and schema, beyond the core\n * glTF specification. Common extensions may be imported from the `@gltf-transform/extensions`\n * package, or custom extensions may be created by extending this base class.\n *\n * An extension is added to a Document by calling {@link Document.createExtension} with the\n * extension constructor. The extension object may then be used to construct\n * {@link ExtensionProperty} instances, which are attached to properties throughout the Document\n * as prescribed by the extension itself.\n *\n * For more information on available extensions and their usage, see [Extensions](/extensions).\n *\n * Reference:\n * - [glTF  Extensions](https://github.com/KhronosGroup/gltf/blob/main/specification/2.0/README.md#specifying-extensions)\n * - [glTF Extension Registry](https://github.com/KhronosGroup/gltf/blob/main/extensions)\n *\n * @category Extensions\n */\nexport abstract class Extension {\n\t/** Official name of the extension. */\n\tpublic static EXTENSION_NAME: string;\n\t/** Official name of the extension. */\n\tpublic readonly extensionName: string = '';\n\t/**\n\t * Before reading, extension should be called for these {@link Property} types. *Most\n\t * extensions don't need to implement this.*\n\t * @hidden\n\t */\n\tpublic readonly prereadTypes: PropertyType[] = [];\n\t/**\n\t * Before writing, extension should be called for these {@link Property} types. *Most\n\t * extensions don't need to implement this.*\n\t * @hidden\n\t */\n\tpublic readonly prewriteTypes: PropertyType[] = [];\n\n\t/** @hidden Dependency IDs needed to read this extension, to be installed before I/O. */\n\tpublic readonly readDependencies: string[] = [];\n\t/** @hidden Dependency IDs needed to write this extension, to be installed before I/O. */\n\tpublic readonly writeDependencies: string[] = [];\n\n\t/** @hidden */\n\tprotected readonly document: Document;\n\n\t/** @hidden */\n\tprotected required = false;\n\n\t/** @hidden */\n\tprotected properties: Set<ExtensionProperty> = new Set();\n\n\t/** @hidden */\n\tprivate _listener: (event: unknown) => void;\n\n\t/** @hidden */\n\tconstructor(document: Document) {\n\t\tthis.document = document;\n\n\t\tdocument.getRoot()._enableExtension(this);\n\n\t\tthis._listener = (_event: unknown): void => {\n\t\t\tconst event = _event as GraphNodeEvent | GraphEdgeEvent | GraphEvent;\n\t\t\tconst target = event.target as ExtensionProperty | unknown;\n\t\t\tif (target instanceof ExtensionProperty && target.extensionName === this.extensionName) {\n\t\t\t\tif (event.type === 'node:create') this._addExtensionProperty(target);\n\t\t\t\tif (event.type === 'node:dispose') this._removeExtensionProperty(target);\n\t\t\t}\n\t\t};\n\n\t\tconst graph = document.getGraph();\n\t\tgraph.addEventListener('node:create', this._listener);\n\t\tgraph.addEventListener('node:dispose', this._listener);\n\t}\n\n\t/** Disables and removes the extension from the Document. */\n\tpublic dispose(): void {\n\t\tthis.document.getRoot()._disableExtension(this);\n\t\tconst graph = this.document.getGraph();\n\t\tgraph.removeEventListener('node:create', this._listener);\n\t\tgraph.removeEventListener('node:dispose', this._listener);\n\t\tfor (const property of this.properties) {\n\t\t\tproperty.dispose();\n\t\t}\n\t}\n\n\t/** @hidden Performs first-time setup for the extension. Must be idempotent. */\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tpublic static register(): void {}\n\n\t/**\n\t * Indicates to the client whether it is OK to load the asset when this extension is not\n\t * recognized. Optional extensions are generally preferred, if there is not a good reason\n\t * to require a client to completely fail when an extension isn't known.\n\t */\n\tpublic isRequired(): boolean {\n\t\treturn this.required;\n\t}\n\n\t/**\n\t * Indicates to the client whether it is OK to load the asset when this extension is not\n\t * recognized. Optional extensions are generally preferred, if there is not a good reason\n\t * to require a client to completely fail when an extension isn't known.\n\t */\n\tpublic setRequired(required: boolean): this {\n\t\tthis.required = required;\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * ExtensionProperty management.\n\t */\n\n\t/** @internal */\n\tprivate _addExtensionProperty(property: ExtensionProperty): this {\n\t\tthis.properties.add(property);\n\t\treturn this;\n\t}\n\n\t/** @internal */\n\tprivate _removeExtensionProperty(property: ExtensionProperty): this {\n\t\tthis.properties.delete(property);\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * I/O implementation.\n\t */\n\n\t/** @hidden Installs dependencies required by the extension. */\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tpublic install(key: string, dependency: unknown): this {\n\t\treturn this;\n\t}\n\n\t/**\n\t * Used by the {@link PlatformIO} utilities when reading a glTF asset. This method may\n\t * optionally be implemented by an extension, and should then support any property type\n\t * declared by the Extension's {@link Extension.prereadTypes} list. The Extension will\n\t * be given a ReaderContext instance, and is expected to update either the context or its\n\t * {@link JSONDocument} with resources known to the Extension. *Most extensions don't need to\n\t * implement this.*\n\t * @hidden\n\t */\n\tpublic preread(_readerContext: ReaderContext, _propertyType: PropertyType): this {\n\t\treturn this;\n\t}\n\n\t/**\n\t * Used by the {@link PlatformIO} utilities when writing a glTF asset. This method may\n\t * optionally be implemented by an extension, and should then support any property type\n\t * declared by the Extension's {@link Extension.prewriteTypes} list. The Extension will\n\t * be given a WriterContext instance, and is expected to update either the context or its\n\t * {@link JSONDocument} with resources known to the Extension. *Most extensions don't need to\n\t * implement this.*\n\t * @hidden\n\t */\n\tpublic prewrite(_writerContext: WriterContext, _propertyType: PropertyType): this {\n\t\treturn this;\n\t}\n\n\t/**\n\t * Used by the {@link PlatformIO} utilities when reading a glTF asset. This method must be\n\t * implemented by each extension in order to support reading files. The extension will be\n\t * given a ReaderContext instance, and should update the current {@link Document} accordingly.\n\t * @hidden\n\t */\n\tpublic abstract read(readerContext: ReaderContext): this;\n\n\t/**\n\t * Used by the {@link PlatformIO} utilities when writing a glTF asset. This method must be\n\t * implemented by each extension in order to support writing files. The extension will be\n\t * given a WriterContext instance, and should modify the {@link JSONDocument} output\n\t * accordingly. Adding the extension name to the `extensionsUsed` and `extensionsRequired` list\n\t * is done automatically, and should not be included here.\n\t * @hidden\n\t */\n\tpublic abstract write(writerContext: WriterContext): this;\n}\n","import type { JSONDocument } from '../json-document';\nimport type {\n\tAccessor,\n\tAnimation,\n\tBuffer,\n\tCamera,\n\tMaterial,\n\tMesh,\n\tNode,\n\tScene,\n\tSkin,\n\tTexture,\n\tTextureInfo,\n} from '../properties';\nimport type { GLTF } from '../types/gltf';\n\n/**\n * Model class providing glTF-Transform objects representing each definition in the glTF file, used\n * by a {@link Writer} and its {@link Extension} implementations. Indices of all properties will be\n * consistent with the glTF file.\n *\n * @hidden\n */\nexport class ReaderContext {\n\tpublic buffers: Buffer[] = [];\n\tpublic bufferViews: Uint8Array[] = [];\n\tpublic bufferViewBuffers: Buffer[] = [];\n\tpublic accessors: Accessor[] = [];\n\tpublic textures: Texture[] = [];\n\tpublic textureInfos: Map<TextureInfo, GLTF.ITextureInfo> = new Map();\n\tpublic materials: Material[] = [];\n\tpublic meshes: Mesh[] = [];\n\tpublic cameras: Camera[] = [];\n\tpublic nodes: Node[] = [];\n\tpublic skins: Skin[] = [];\n\tpublic animations: Animation[] = [];\n\tpublic scenes: Scene[] = [];\n\n\tconstructor(public readonly jsonDoc: JSONDocument) {}\n\n\tpublic setTextureInfo(textureInfo: TextureInfo, textureInfoDef: GLTF.ITextureInfo): void {\n\t\tthis.textureInfos.set(textureInfo, textureInfoDef);\n\n\t\tif (textureInfoDef.texCoord !== undefined) {\n\t\t\ttextureInfo.setTexCoord(textureInfoDef.texCoord);\n\t\t}\n\n\t\tconst textureDef = this.jsonDoc.json.textures![textureInfoDef.index];\n\n\t\tif (textureDef.sampler === undefined) return;\n\n\t\tconst samplerDef = this.jsonDoc.json.samplers![textureDef.sampler];\n\n\t\tif (samplerDef.magFilter !== undefined) {\n\t\t\ttextureInfo.setMagFilter(samplerDef.magFilter);\n\t\t}\n\t\tif (samplerDef.minFilter !== undefined) {\n\t\t\ttextureInfo.setMinFilter(samplerDef.minFilter);\n\t\t}\n\t\tif (samplerDef.wrapS !== undefined) {\n\t\t\ttextureInfo.setWrapS(samplerDef.wrapS);\n\t\t}\n\t\tif (samplerDef.wrapT !== undefined) {\n\t\t\ttextureInfo.setWrapT(samplerDef.wrapT);\n\t\t}\n\t}\n}\n","import { GLB_BUFFER, PropertyType, TypedArray, mat4, vec3, vec4 } from '../constants';\nimport { Document } from '../document';\nimport type { Extension } from '../extension';\nimport type { JSONDocument } from '../json-document';\nimport { Accessor, AnimationSampler, Camera } from '../properties';\nimport type { GLTF } from '../types/gltf';\nimport { BufferUtils, FileUtils, ImageUtils, Logger, MathUtils } from '../utils';\nimport { ReaderContext } from './reader-context';\n\nconst ComponentTypeToTypedArray = {\n\t'5120': Int8Array,\n\t'5121': Uint8Array,\n\t'5122': Int16Array,\n\t'5123': Uint16Array,\n\t'5125': Uint32Array,\n\t'5126': Float32Array,\n};\n\nexport interface ReaderOptions {\n\tlogger?: Logger;\n\textensions: typeof Extension[];\n\tdependencies: { [key: string]: unknown };\n}\n\nconst DEFAULT_OPTIONS: ReaderOptions = {\n\tlogger: Logger.DEFAULT_INSTANCE,\n\textensions: [],\n\tdependencies: {},\n};\n\n/** @internal */\nexport class GLTFReader {\n\tpublic static read(jsonDoc: JSONDocument, _options: ReaderOptions = DEFAULT_OPTIONS): Document {\n\t\tconst options = { ...DEFAULT_OPTIONS, ..._options } as Required<ReaderOptions>;\n\t\tconst { json } = jsonDoc;\n\t\tconst doc = new Document();\n\n\t\tthis.validate(jsonDoc, options);\n\n\t\t/* Reader context. */\n\n\t\tconst context = new ReaderContext(jsonDoc);\n\n\t\t/** Asset. */\n\n\t\tconst assetDef = json.asset;\n\t\tconst asset = doc.getRoot().getAsset();\n\n\t\tif (assetDef.copyright) asset.copyright = assetDef.copyright;\n\t\tif (assetDef.extras) asset.extras = assetDef.extras;\n\n\t\tif (json.extras !== undefined) {\n\t\t\tdoc.getRoot().setExtras({ ...json.extras });\n\t\t}\n\n\t\t/** Extensions (1/2). */\n\n\t\tconst extensionsUsed = json.extensionsUsed || [];\n\t\tconst extensionsRequired = json.extensionsRequired || [];\n\t\tfor (const Extension of options.extensions) {\n\t\t\tif (extensionsUsed.includes(Extension.EXTENSION_NAME)) {\n\t\t\t\tconst extension = doc\n\t\t\t\t\t.createExtension(Extension as unknown as new (doc: Document) => Extension)\n\t\t\t\t\t.setRequired(extensionsRequired.includes(Extension.EXTENSION_NAME));\n\n\t\t\t\tfor (const key of extension.readDependencies) {\n\t\t\t\t\textension.install(key, options.dependencies[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/** Buffers. */\n\n\t\tconst bufferDefs = json.buffers || [];\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((extension) => extension.prereadTypes.includes(PropertyType.BUFFER))\n\t\t\t.forEach((extension) => extension.preread(context, PropertyType.BUFFER));\n\t\tcontext.buffers = bufferDefs.map((bufferDef) => {\n\t\t\tconst buffer = doc.createBuffer(bufferDef.name);\n\n\t\t\tif (bufferDef.extras) buffer.setExtras(bufferDef.extras);\n\n\t\t\tif (bufferDef.uri && bufferDef.uri.indexOf('__') !== 0) {\n\t\t\t\tbuffer.setURI(bufferDef.uri);\n\t\t\t}\n\n\t\t\treturn buffer;\n\t\t});\n\n\t\t/** Buffer views. */\n\n\t\tconst bufferViewDefs = json.bufferViews || [];\n\t\tcontext.bufferViewBuffers = bufferViewDefs.map((bufferViewDef, index) => {\n\t\t\tif (!context.bufferViews[index]) {\n\t\t\t\tconst bufferDef = jsonDoc.json.buffers![bufferViewDef.buffer];\n\t\t\t\tconst resource = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\n\t\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\t\tcontext.bufferViews[index] = BufferUtils.toView(resource, byteOffset, bufferViewDef.byteLength);\n\t\t\t}\n\n\t\t\treturn context.buffers[bufferViewDef.buffer];\n\t\t});\n\n\t\t/** Accessors. */\n\n\t\t// Accessor .count and .componentType properties are inferred dynamically.\n\t\tconst accessorDefs = json.accessors || [];\n\t\tcontext.accessors = accessorDefs.map((accessorDef) => {\n\t\t\tconst buffer = context.bufferViewBuffers[accessorDef.bufferView!];\n\t\t\tconst accessor = doc.createAccessor(accessorDef.name, buffer).setType(accessorDef.type);\n\n\t\t\tif (accessorDef.extras) accessor.setExtras(accessorDef.extras);\n\n\t\t\tif (accessorDef.normalized !== undefined) {\n\t\t\t\taccessor.setNormalized(accessorDef.normalized);\n\t\t\t}\n\n\t\t\t// KHR_draco_mesh_compression and EXT_meshopt_compression.\n\t\t\tif (accessorDef.bufferView === undefined && !accessorDef.sparse) return accessor;\n\n\t\t\tlet array: TypedArray;\n\n\t\t\tif (accessorDef.sparse !== undefined) {\n\t\t\t\tarray = getSparseArray(accessorDef, context);\n\t\t\t} else {\n\t\t\t\tarray = getAccessorArray(accessorDef, context);\n\t\t\t}\n\n\t\t\taccessor.setArray(array);\n\t\t\treturn accessor;\n\t\t});\n\n\t\t/** Textures. */\n\n\t\t// glTF-Transform's \"Texture\" properties correspond 1:1 with glTF \"Image\" properties, and\n\t\t// with image files. The glTF file may contain more one texture per image, where images\n\t\t// are reused with different sampler properties.\n\t\tconst imageDefs = json.images || [];\n\t\tconst textureDefs = json.textures || [];\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((extension) => extension.prereadTypes.includes(PropertyType.TEXTURE))\n\t\t\t.forEach((extension) => extension.preread(context, PropertyType.TEXTURE));\n\t\tcontext.textures = imageDefs.map((imageDef) => {\n\t\t\tconst texture = doc.createTexture(imageDef.name);\n\n\t\t\t// glTF Image corresponds 1:1 with glTF-Transform Texture. See `writer.ts`.\n\t\t\tif (imageDef.extras) texture.setExtras(imageDef.extras);\n\n\t\t\tif (imageDef.bufferView !== undefined) {\n\t\t\t\tconst bufferViewDef = json.bufferViews![imageDef.bufferView];\n\t\t\t\tconst bufferDef = jsonDoc.json.buffers![bufferViewDef.buffer];\n\t\t\t\tconst bufferData = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\n\t\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\t\tconst byteLength = bufferViewDef.byteLength;\n\t\t\t\tconst imageData = bufferData.slice(byteOffset, byteOffset + byteLength);\n\t\t\t\ttexture.setImage(imageData);\n\t\t\t} else if (imageDef.uri !== undefined) {\n\t\t\t\ttexture.setImage(jsonDoc.resources[imageDef.uri]);\n\t\t\t\tif (imageDef.uri.indexOf('__') !== 0) {\n\t\t\t\t\ttexture.setURI(imageDef.uri);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (imageDef.mimeType !== undefined) {\n\t\t\t\ttexture.setMimeType(imageDef.mimeType);\n\t\t\t} else if (imageDef.uri) {\n\t\t\t\tconst extension = FileUtils.extension(imageDef.uri);\n\t\t\t\ttexture.setMimeType(ImageUtils.extensionToMimeType(extension));\n\t\t\t}\n\n\t\t\treturn texture;\n\t\t});\n\n\t\t/** Materials. */\n\n\t\tconst materialDefs = json.materials || [];\n\t\tcontext.materials = materialDefs.map((materialDef) => {\n\t\t\tconst material = doc.createMaterial(materialDef.name);\n\n\t\t\tif (materialDef.extras) material.setExtras(materialDef.extras);\n\n\t\t\t// Program state & blending.\n\n\t\t\tif (materialDef.alphaMode !== undefined) {\n\t\t\t\tmaterial.setAlphaMode(materialDef.alphaMode);\n\t\t\t}\n\n\t\t\tif (materialDef.alphaCutoff !== undefined) {\n\t\t\t\tmaterial.setAlphaCutoff(materialDef.alphaCutoff);\n\t\t\t}\n\n\t\t\tif (materialDef.doubleSided !== undefined) {\n\t\t\t\tmaterial.setDoubleSided(materialDef.doubleSided);\n\t\t\t}\n\n\t\t\t// Factors.\n\n\t\t\tconst pbrDef = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tif (pbrDef.baseColorFactor !== undefined) {\n\t\t\t\tmaterial.setBaseColorFactor(pbrDef.baseColorFactor as vec4);\n\t\t\t}\n\n\t\t\tif (materialDef.emissiveFactor !== undefined) {\n\t\t\t\tmaterial.setEmissiveFactor(materialDef.emissiveFactor as vec3);\n\t\t\t}\n\n\t\t\tif (pbrDef.metallicFactor !== undefined) {\n\t\t\t\tmaterial.setMetallicFactor(pbrDef.metallicFactor);\n\t\t\t}\n\n\t\t\tif (pbrDef.roughnessFactor !== undefined) {\n\t\t\t\tmaterial.setRoughnessFactor(pbrDef.roughnessFactor);\n\t\t\t}\n\n\t\t\t// Textures.\n\n\t\t\tif (pbrDef.baseColorTexture !== undefined) {\n\t\t\t\tconst textureInfoDef = pbrDef.baseColorTexture;\n\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\tmaterial.setBaseColorTexture(texture);\n\t\t\t\tcontext.setTextureInfo(material.getBaseColorTextureInfo()!, textureInfoDef);\n\t\t\t}\n\n\t\t\tif (materialDef.emissiveTexture !== undefined) {\n\t\t\t\tconst textureInfoDef = materialDef.emissiveTexture;\n\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\tmaterial.setEmissiveTexture(texture);\n\t\t\t\tcontext.setTextureInfo(material.getEmissiveTextureInfo()!, textureInfoDef);\n\t\t\t}\n\n\t\t\tif (materialDef.normalTexture !== undefined) {\n\t\t\t\tconst textureInfoDef = materialDef.normalTexture;\n\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\tmaterial.setNormalTexture(texture);\n\t\t\t\tcontext.setTextureInfo(material.getNormalTextureInfo()!, textureInfoDef);\n\t\t\t\tif (materialDef.normalTexture.scale !== undefined) {\n\t\t\t\t\tmaterial.setNormalScale(materialDef.normalTexture.scale);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (materialDef.occlusionTexture !== undefined) {\n\t\t\t\tconst textureInfoDef = materialDef.occlusionTexture;\n\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\tmaterial.setOcclusionTexture(texture);\n\t\t\t\tcontext.setTextureInfo(material.getOcclusionTextureInfo()!, textureInfoDef);\n\t\t\t\tif (materialDef.occlusionTexture.strength !== undefined) {\n\t\t\t\t\tmaterial.setOcclusionStrength(materialDef.occlusionTexture.strength);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (pbrDef.metallicRoughnessTexture !== undefined) {\n\t\t\t\tconst textureInfoDef = pbrDef.metallicRoughnessTexture;\n\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\tmaterial.setMetallicRoughnessTexture(texture);\n\t\t\t\tcontext.setTextureInfo(material.getMetallicRoughnessTextureInfo()!, textureInfoDef);\n\t\t\t}\n\n\t\t\treturn material;\n\t\t});\n\n\t\t/** Meshes. */\n\n\t\tconst meshDefs = json.meshes || [];\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((extension) => extension.prereadTypes.includes(PropertyType.PRIMITIVE))\n\t\t\t.forEach((extension) => extension.preread(context, PropertyType.PRIMITIVE));\n\t\tcontext.meshes = meshDefs.map((meshDef) => {\n\t\t\tconst mesh = doc.createMesh(meshDef.name);\n\n\t\t\tif (meshDef.extras) mesh.setExtras(meshDef.extras);\n\n\t\t\tif (meshDef.weights !== undefined) {\n\t\t\t\tmesh.setWeights(meshDef.weights);\n\t\t\t}\n\n\t\t\tconst primitiveDefs = meshDef.primitives || [];\n\t\t\tprimitiveDefs.forEach((primitiveDef) => {\n\t\t\t\tconst primitive = doc.createPrimitive();\n\n\t\t\t\tif (primitiveDef.extras) primitive.setExtras(primitiveDef.extras);\n\n\t\t\t\tif (primitiveDef.material !== undefined) {\n\t\t\t\t\tprimitive.setMaterial(context.materials[primitiveDef.material]);\n\t\t\t\t}\n\n\t\t\t\tif (primitiveDef.mode !== undefined) {\n\t\t\t\t\tprimitive.setMode(primitiveDef.mode);\n\t\t\t\t}\n\n\t\t\t\tfor (const [semantic, index] of Object.entries(primitiveDef.attributes || {})) {\n\t\t\t\t\tprimitive.setAttribute(semantic, context.accessors[index]);\n\t\t\t\t}\n\n\t\t\t\tif (primitiveDef.indices !== undefined) {\n\t\t\t\t\tprimitive.setIndices(context.accessors[primitiveDef.indices]);\n\t\t\t\t}\n\n\t\t\t\tconst targetNames: string[] = (meshDef.extras && (meshDef.extras.targetNames as string[])) || [];\n\t\t\t\tconst targetDefs = primitiveDef.targets || [];\n\t\t\t\ttargetDefs.forEach((targetDef, targetIndex) => {\n\t\t\t\t\tconst targetName = targetNames[targetIndex] || targetIndex.toString();\n\t\t\t\t\tconst target = doc.createPrimitiveTarget(targetName);\n\n\t\t\t\t\tfor (const [semantic, accessorIndex] of Object.entries(targetDef)) {\n\t\t\t\t\t\ttarget.setAttribute(semantic, context.accessors[accessorIndex]);\n\t\t\t\t\t}\n\n\t\t\t\t\tprimitive.addTarget(target);\n\t\t\t\t});\n\n\t\t\t\tmesh.addPrimitive(primitive);\n\t\t\t});\n\n\t\t\treturn mesh;\n\t\t});\n\n\t\t/** Cameras. */\n\n\t\tconst cameraDefs = json.cameras || [];\n\t\tcontext.cameras = cameraDefs.map((cameraDef) => {\n\t\t\tconst camera = doc.createCamera(cameraDef.name).setType(cameraDef.type);\n\n\t\t\tif (cameraDef.extras) camera.setExtras(cameraDef.extras);\n\n\t\t\tif (cameraDef.type === Camera.Type.PERSPECTIVE) {\n\t\t\t\tconst perspectiveDef = cameraDef.perspective!;\n\t\t\t\tcamera.setYFov(perspectiveDef.yfov);\n\t\t\t\tcamera.setZNear(perspectiveDef.znear);\n\t\t\t\tif (perspectiveDef.zfar !== undefined) {\n\t\t\t\t\tcamera.setZFar(perspectiveDef.zfar);\n\t\t\t\t}\n\t\t\t\tif (perspectiveDef.aspectRatio !== undefined) {\n\t\t\t\t\tcamera.setAspectRatio(perspectiveDef.aspectRatio);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst orthoDef = cameraDef.orthographic!;\n\t\t\t\tcamera.setZNear(orthoDef.znear).setZFar(orthoDef.zfar).setXMag(orthoDef.xmag).setYMag(orthoDef.ymag);\n\t\t\t}\n\t\t\treturn camera;\n\t\t});\n\n\t\t/** Nodes. */\n\n\t\tconst nodeDefs = json.nodes || [];\n\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((extension) => extension.prereadTypes.includes(PropertyType.NODE))\n\t\t\t.forEach((extension) => extension.preread(context, PropertyType.NODE));\n\n\t\tcontext.nodes = nodeDefs.map((nodeDef) => {\n\t\t\tconst node = doc.createNode(nodeDef.name);\n\n\t\t\tif (nodeDef.extras) node.setExtras(nodeDef.extras);\n\n\t\t\tif (nodeDef.translation !== undefined) {\n\t\t\t\tnode.setTranslation(nodeDef.translation as vec3);\n\t\t\t}\n\n\t\t\tif (nodeDef.rotation !== undefined) {\n\t\t\t\tnode.setRotation(nodeDef.rotation as vec4);\n\t\t\t}\n\n\t\t\tif (nodeDef.scale !== undefined) {\n\t\t\t\tnode.setScale(nodeDef.scale as vec3);\n\t\t\t}\n\n\t\t\tif (nodeDef.matrix !== undefined) {\n\t\t\t\tconst translation = [0, 0, 0] as vec3;\n\t\t\t\tconst rotation = [0, 0, 0, 1] as vec4;\n\t\t\t\tconst scale = [1, 1, 1] as vec3;\n\n\t\t\t\tMathUtils.decompose(nodeDef.matrix as mat4, translation, rotation, scale);\n\n\t\t\t\tnode.setTranslation(translation);\n\t\t\t\tnode.setRotation(rotation);\n\t\t\t\tnode.setScale(scale);\n\t\t\t}\n\n\t\t\tif (nodeDef.weights !== undefined) {\n\t\t\t\tnode.setWeights(nodeDef.weights);\n\t\t\t}\n\n\t\t\t// Attachments (mesh, camera, skin) defined later in reading process.\n\n\t\t\treturn node;\n\t\t});\n\n\t\t/** Skins. */\n\n\t\tconst skinDefs = json.skins || [];\n\t\tcontext.skins = skinDefs.map((skinDef) => {\n\t\t\tconst skin = doc.createSkin(skinDef.name);\n\n\t\t\tif (skinDef.extras) skin.setExtras(skinDef.extras);\n\n\t\t\tif (skinDef.inverseBindMatrices !== undefined) {\n\t\t\t\tskin.setInverseBindMatrices(context.accessors[skinDef.inverseBindMatrices]);\n\t\t\t}\n\n\t\t\tif (skinDef.skeleton !== undefined) {\n\t\t\t\tskin.setSkeleton(context.nodes[skinDef.skeleton]);\n\t\t\t}\n\n\t\t\tfor (const nodeIndex of skinDef.joints) {\n\t\t\t\tskin.addJoint(context.nodes[nodeIndex]);\n\t\t\t}\n\n\t\t\treturn skin;\n\t\t});\n\n\t\t/** Node attachments. */\n\n\t\tnodeDefs.map((nodeDef, nodeIndex) => {\n\t\t\tconst node = context.nodes[nodeIndex];\n\n\t\t\tconst children = nodeDef.children || [];\n\t\t\tchildren.forEach((childIndex) => node.addChild(context.nodes[childIndex]));\n\n\t\t\tif (nodeDef.mesh !== undefined) node.setMesh(context.meshes[nodeDef.mesh]);\n\n\t\t\tif (nodeDef.camera !== undefined) node.setCamera(context.cameras[nodeDef.camera]);\n\n\t\t\tif (nodeDef.skin !== undefined) node.setSkin(context.skins[nodeDef.skin]);\n\t\t});\n\n\t\t/** Animations. */\n\n\t\tconst animationDefs = json.animations || [];\n\t\tcontext.animations = animationDefs.map((animationDef) => {\n\t\t\tconst animation = doc.createAnimation(animationDef.name);\n\n\t\t\tif (animationDef.extras) animation.setExtras(animationDef.extras);\n\n\t\t\tconst samplerDefs = animationDef.samplers || [];\n\t\t\tconst samplers = samplerDefs.map((samplerDef) => {\n\t\t\t\tconst sampler = doc\n\t\t\t\t\t.createAnimationSampler()\n\t\t\t\t\t.setInput(context.accessors[samplerDef.input])\n\t\t\t\t\t.setOutput(context.accessors[samplerDef.output])\n\t\t\t\t\t.setInterpolation(samplerDef.interpolation || AnimationSampler.Interpolation.LINEAR);\n\n\t\t\t\tif (samplerDef.extras) sampler.setExtras(samplerDef.extras);\n\n\t\t\t\tanimation.addSampler(sampler);\n\t\t\t\treturn sampler;\n\t\t\t});\n\n\t\t\tconst channels = animationDef.channels || [];\n\t\t\tchannels.forEach((channelDef) => {\n\t\t\t\tconst channel = doc\n\t\t\t\t\t.createAnimationChannel()\n\t\t\t\t\t.setSampler(samplers[channelDef.sampler])\n\t\t\t\t\t.setTargetNode(context.nodes[channelDef.target.node])\n\t\t\t\t\t.setTargetPath(channelDef.target.path);\n\n\t\t\t\tif (channelDef.extras) channel.setExtras(channelDef.extras);\n\n\t\t\t\tanimation.addChannel(channel);\n\t\t\t});\n\n\t\t\treturn animation;\n\t\t});\n\n\t\t/** Scenes. */\n\n\t\tconst sceneDefs = json.scenes || [];\n\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((extension) => extension.prereadTypes.includes(PropertyType.SCENE))\n\t\t\t.forEach((extension) => extension.preread(context, PropertyType.SCENE));\n\n\t\tcontext.scenes = sceneDefs.map((sceneDef) => {\n\t\t\tconst scene = doc.createScene(sceneDef.name);\n\n\t\t\tif (sceneDef.extras) scene.setExtras(sceneDef.extras);\n\n\t\t\tconst children = sceneDef.nodes || [];\n\n\t\t\tchildren.map((nodeIndex) => context.nodes[nodeIndex]).forEach((node) => scene.addChild(node));\n\n\t\t\treturn scene;\n\t\t});\n\n\t\tif (json.scene !== undefined) {\n\t\t\tdoc.getRoot().setDefaultScene(context.scenes[json.scene]);\n\t\t}\n\n\t\t/** Extensions (2/2). */\n\n\t\tdoc.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.forEach((extension) => extension.read(context));\n\n\t\treturn doc;\n\t}\n\n\tprivate static validate(jsonDoc: JSONDocument, options: Required<ReaderOptions>): void {\n\t\tconst json = jsonDoc.json;\n\n\t\tif (json.asset.version !== '2.0') {\n\t\t\tthrow new Error(`Unsupported glTF version, \"${json.asset.version}\".`);\n\t\t}\n\n\t\tif (json.extensionsRequired) {\n\t\t\tfor (const extensionName of json.extensionsRequired) {\n\t\t\t\tif (!options.extensions.find((extension) => extension.EXTENSION_NAME === extensionName)) {\n\t\t\t\t\tthrow new Error(`Missing required extension, \"${extensionName}\".`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (json.extensionsUsed) {\n\t\t\tfor (const extensionName of json.extensionsUsed) {\n\t\t\t\tif (!options.extensions.find((extension) => extension.EXTENSION_NAME === extensionName)) {\n\t\t\t\t\toptions.logger.warn(`Missing optional extension, \"${extensionName}\".`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Returns the contents of an interleaved accessor, as a typed array.\n * @internal\n */\nfunction getInterleavedArray(accessorDef: GLTF.IAccessor, context: ReaderContext): TypedArray {\n\tconst jsonDoc = context.jsonDoc;\n\tconst bufferView = context.bufferViews[accessorDef.bufferView!];\n\tconst bufferViewDef = jsonDoc.json.bufferViews![accessorDef.bufferView!];\n\n\tconst TypedArray = ComponentTypeToTypedArray[accessorDef.componentType];\n\tconst elementSize = Accessor.getElementSize(accessorDef.type);\n\tconst componentSize = TypedArray.BYTES_PER_ELEMENT;\n\tconst accessorByteOffset = accessorDef.byteOffset || 0;\n\n\tconst array = new TypedArray(accessorDef.count * elementSize);\n\tconst view = new DataView(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);\n\tconst byteStride = bufferViewDef.byteStride!;\n\n\tfor (let i = 0; i < accessorDef.count; i++) {\n\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\tconst byteOffset = accessorByteOffset + i * byteStride + j * componentSize;\n\t\t\tlet value: number;\n\t\t\tswitch (accessorDef.componentType) {\n\t\t\t\tcase Accessor.ComponentType.FLOAT:\n\t\t\t\t\tvalue = view.getFloat32(byteOffset, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Accessor.ComponentType.UNSIGNED_INT:\n\t\t\t\t\tvalue = view.getUint32(byteOffset, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Accessor.ComponentType.UNSIGNED_SHORT:\n\t\t\t\t\tvalue = view.getUint16(byteOffset, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Accessor.ComponentType.UNSIGNED_BYTE:\n\t\t\t\t\tvalue = view.getUint8(byteOffset);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Accessor.ComponentType.SHORT:\n\t\t\t\t\tvalue = view.getInt16(byteOffset, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Accessor.ComponentType.BYTE:\n\t\t\t\t\tvalue = view.getInt8(byteOffset);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unexpected componentType \"${accessorDef.componentType}\".`);\n\t\t\t}\n\t\t\tarray[i * elementSize + j] = value;\n\t\t}\n\t}\n\n\treturn array;\n}\n\n/**\n * Returns the contents of an accessor, as a typed array.\n * @internal\n */\nfunction getAccessorArray(accessorDef: GLTF.IAccessor, context: ReaderContext): TypedArray {\n\tconst jsonDoc = context.jsonDoc;\n\tconst bufferView = context.bufferViews[accessorDef.bufferView!];\n\tconst bufferViewDef = jsonDoc.json.bufferViews![accessorDef.bufferView!];\n\n\tconst TypedArray = ComponentTypeToTypedArray[accessorDef.componentType];\n\tconst elementSize = Accessor.getElementSize(accessorDef.type);\n\tconst componentSize = TypedArray.BYTES_PER_ELEMENT;\n\tconst elementStride = elementSize * componentSize;\n\n\t// Interleaved buffer view.\n\tif (bufferViewDef.byteStride !== undefined && bufferViewDef.byteStride !== elementStride) {\n\t\treturn getInterleavedArray(accessorDef, context);\n\t}\n\n\tconst byteOffset = bufferView.byteOffset + (accessorDef.byteOffset || 0);\n\tconst byteLength = accessorDef.count * elementSize * componentSize;\n\n\t// Might optimize this to avoid deep copy later, but it's useful for now and not a known\n\t// bottleneck. See https://github.com/donmccurdy/glTF-Transform/issues/256.\n\treturn new TypedArray(bufferView.buffer.slice(byteOffset, byteOffset + byteLength));\n}\n\n/**\n * Returns the contents of a sparse accessor, as a typed array.\n * @internal\n */\nfunction getSparseArray(accessorDef: GLTF.IAccessor, context: ReaderContext): TypedArray {\n\tconst TypedArray = ComponentTypeToTypedArray[accessorDef.componentType];\n\tconst elementSize = Accessor.getElementSize(accessorDef.type);\n\n\tlet array: TypedArray;\n\tif (accessorDef.bufferView !== undefined) {\n\t\tarray = getAccessorArray(accessorDef, context);\n\t} else {\n\t\tarray = new TypedArray(accessorDef.count * elementSize);\n\t}\n\n\tconst sparseDef = accessorDef.sparse!;\n\tconst count = sparseDef.count;\n\tconst indicesDef = { ...accessorDef, ...sparseDef.indices, count, type: 'SCALAR' };\n\tconst valuesDef = { ...accessorDef, ...sparseDef.values, count };\n\tconst indices = getAccessorArray(indicesDef as GLTF.IAccessor, context);\n\tconst values = getAccessorArray(valuesDef, context);\n\n\t// Override indices given in the sparse data.\n\tfor (let i = 0; i < indicesDef.count; i++) {\n\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\tarray[indices[i] * elementSize + j] = values[i * elementSize + j];\n\t\t}\n\t}\n\n\treturn array;\n}\n","import { BufferViewUsage, Format, PropertyType } from '../constants';\nimport type { Document } from '../document';\nimport type { JSONDocument } from '../json-document';\nimport type {\n\tAccessor,\n\tAnimation,\n\tBuffer,\n\tCamera,\n\tMaterial,\n\tMesh,\n\tNode,\n\tProperty,\n\tScene,\n\tSkin,\n\tTexture,\n\tTextureInfo,\n} from '../properties';\nimport type { GLTF } from '../types/gltf';\nimport { ImageUtils, Logger } from '../utils';\nimport type { WriterOptions } from './writer';\n\ntype PropertyDef = GLTF.IScene | GLTF.INode | GLTF.IMaterial | GLTF.ISkin | GLTF.ITexture;\n\nenum BufferViewTarget {\n\tARRAY_BUFFER = 34962,\n\tELEMENT_ARRAY_BUFFER = 34963,\n}\n\n/**\n * Model class providing writing state to a {@link Writer} and its {@link Extension}\n * implementations.\n *\n * @hidden\n */\nexport class WriterContext {\n\t/** Explicit buffer view targets defined by glTF specification. */\n\tpublic static readonly BufferViewTarget = BufferViewTarget;\n\t/**\n\t * Implicit buffer view usage, not required by glTF specification, but nonetheless useful for\n\t * proper grouping of accessors into buffer views. Additional usages are defined by extensions,\n\t * like `EXT_mesh_gpu_instancing`.\n\t */\n\tpublic static readonly BufferViewUsage = BufferViewUsage;\n\t/** Maps usage type to buffer view target. Usages not mapped have undefined targets. */\n\tpublic static readonly USAGE_TO_TARGET: { [key: string]: BufferViewTarget | undefined } = {\n\t\t[BufferViewUsage.ARRAY_BUFFER]: BufferViewTarget.ARRAY_BUFFER,\n\t\t[BufferViewUsage.ELEMENT_ARRAY_BUFFER]: BufferViewTarget.ELEMENT_ARRAY_BUFFER,\n\t};\n\n\tpublic readonly accessorIndexMap = new Map<Accessor, number>();\n\tpublic readonly animationIndexMap = new Map<Animation, number>();\n\tpublic readonly bufferIndexMap = new Map<Buffer, number>();\n\tpublic readonly cameraIndexMap = new Map<Camera, number>();\n\tpublic readonly skinIndexMap = new Map<Skin, number>();\n\tpublic readonly materialIndexMap = new Map<Material, number>();\n\tpublic readonly meshIndexMap = new Map<Mesh, number>();\n\tpublic readonly nodeIndexMap = new Map<Node, number>();\n\tpublic readonly imageIndexMap = new Map<Texture, number>();\n\tpublic readonly textureDefIndexMap = new Map<string, number>(); // textureDef JSON -> index\n\tpublic readonly textureInfoDefMap = new Map<TextureInfo, GLTF.ITextureInfo>();\n\tpublic readonly samplerDefIndexMap = new Map<string, number>(); // samplerDef JSON -> index\n\tpublic readonly sceneIndexMap = new Map<Scene, number>();\n\n\tpublic readonly imageBufferViews: Uint8Array[] = [];\n\tpublic readonly otherBufferViews = new Map<Buffer, Uint8Array[]>();\n\tpublic readonly otherBufferViewsIndexMap = new Map<Uint8Array, number>();\n\tpublic readonly extensionData: { [key: string]: unknown } = {};\n\n\tpublic bufferURIGenerator: UniqueURIGenerator;\n\tpublic imageURIGenerator: UniqueURIGenerator;\n\tpublic logger: Logger;\n\n\tprivate readonly _accessorUsageMap = new Map<Accessor, BufferViewUsage | string>();\n\tpublic readonly accessorUsageGroupedByParent = new Set<string>(['ARRAY_BUFFER']);\n\tpublic readonly accessorParents = new Map<Property, Set<Accessor>>();\n\n\tconstructor(\n\t\tprivate readonly _doc: Document,\n\t\tpublic readonly jsonDoc: JSONDocument,\n\t\tpublic readonly options: Required<WriterOptions>\n\t) {\n\t\tconst root = _doc.getRoot();\n\t\tconst numBuffers = root.listBuffers().length;\n\t\tconst numImages = root.listTextures().length;\n\t\tthis.bufferURIGenerator = new UniqueURIGenerator(numBuffers > 1, options.basename);\n\t\tthis.imageURIGenerator = new UniqueURIGenerator(numImages > 1, options.basename);\n\t\tthis.logger = _doc.getLogger();\n\t}\n\n\t/**\n\t * Creates a TextureInfo definition, and any Texture or Sampler definitions it requires. If\n\t * possible, Texture and Sampler definitions are shared.\n\t */\n\tpublic createTextureInfoDef(texture: Texture, textureInfo: TextureInfo): GLTF.ITextureInfo {\n\t\tconst samplerDef = {\n\t\t\tmagFilter: textureInfo.getMagFilter() || undefined,\n\t\t\tminFilter: textureInfo.getMinFilter() || undefined,\n\t\t\twrapS: textureInfo.getWrapS(),\n\t\t\twrapT: textureInfo.getWrapT(),\n\t\t} as GLTF.ISampler;\n\n\t\tconst samplerKey = JSON.stringify(samplerDef);\n\t\tif (!this.samplerDefIndexMap.has(samplerKey)) {\n\t\t\tthis.samplerDefIndexMap.set(samplerKey, this.jsonDoc.json.samplers!.length);\n\t\t\tthis.jsonDoc.json.samplers!.push(samplerDef);\n\t\t}\n\n\t\tconst textureDef = {\n\t\t\tsource: this.imageIndexMap.get(texture),\n\t\t\tsampler: this.samplerDefIndexMap.get(samplerKey),\n\t\t} as GLTF.ITexture;\n\n\t\tconst textureKey = JSON.stringify(textureDef);\n\t\tif (!this.textureDefIndexMap.has(textureKey)) {\n\t\t\tthis.textureDefIndexMap.set(textureKey, this.jsonDoc.json.textures!.length);\n\t\t\tthis.jsonDoc.json.textures!.push(textureDef);\n\t\t}\n\n\t\tconst textureInfoDef = {\n\t\t\tindex: this.textureDefIndexMap.get(textureKey),\n\t\t} as GLTF.ITextureInfo;\n\n\t\tif (textureInfo.getTexCoord() !== 0) {\n\t\t\ttextureInfoDef.texCoord = textureInfo.getTexCoord();\n\t\t}\n\n\t\tthis.textureInfoDefMap.set(textureInfo, textureInfoDef);\n\n\t\treturn textureInfoDef;\n\t}\n\n\tpublic createPropertyDef(property: Property): PropertyDef {\n\t\tconst def = {} as PropertyDef;\n\t\tif (property.getName()) {\n\t\t\tdef.name = property.getName();\n\t\t}\n\t\tif (Object.keys(property.getExtras()).length > 0) {\n\t\t\tdef.extras = property.getExtras();\n\t\t}\n\t\treturn def;\n\t}\n\n\tpublic createAccessorDef(accessor: Accessor): GLTF.IAccessor {\n\t\tconst accessorDef = this.createPropertyDef(accessor) as GLTF.IAccessor;\n\t\taccessorDef.type = accessor.getType();\n\t\taccessorDef.componentType = accessor.getComponentType();\n\t\taccessorDef.count = accessor.getCount();\n\n\t\tconst needsBounds = this._doc\n\t\t\t.getGraph()\n\t\t\t.listParentEdges(accessor)\n\t\t\t.some(\n\t\t\t\t(edge) =>\n\t\t\t\t\t(edge.getName() === 'attributes' && edge.getAttributes().key === 'POSITION') ||\n\t\t\t\t\tedge.getName() === 'input'\n\t\t\t);\n\t\tif (needsBounds) {\n\t\t\taccessorDef.max = accessor.getMax([]).map(Math.fround);\n\t\t\taccessorDef.min = accessor.getMin([]).map(Math.fround);\n\t\t}\n\n\t\tif (accessor.getNormalized()) {\n\t\t\taccessorDef.normalized = accessor.getNormalized();\n\t\t}\n\n\t\treturn accessorDef;\n\t}\n\n\tpublic createImageData(imageDef: GLTF.IImage, data: Uint8Array, texture: Texture): void {\n\t\tif (this.options.format === Format.GLB) {\n\t\t\tthis.imageBufferViews.push(data);\n\t\t\timageDef.bufferView = this.jsonDoc.json.bufferViews!.length;\n\t\t\tthis.jsonDoc.json.bufferViews!.push({\n\t\t\t\tbuffer: 0,\n\t\t\t\tbyteOffset: -1, // determined while iterating buffers, in Writer.ts.\n\t\t\t\tbyteLength: data.byteLength,\n\t\t\t});\n\t\t} else {\n\t\t\tconst extension = ImageUtils.mimeTypeToExtension(texture.getMimeType());\n\t\t\timageDef.uri = this.imageURIGenerator.createURI(texture, extension);\n\t\t\tthis.jsonDoc.resources[imageDef.uri] = data;\n\t\t}\n\t}\n\n\t/**\n\t * Returns implicit usage type of the given accessor, related to grouping accessors into\n\t * buffer views. Usage is a superset of buffer view target, including ARRAY_BUFFER and\n\t * ELEMENT_ARRAY_BUFFER, but also usages that do not match GPU buffer view targets such as\n\t * IBMs. Additional usages are defined by extensions, like `EXT_mesh_gpu_instancing`.\n\t */\n\tpublic getAccessorUsage(accessor: Accessor): BufferViewUsage | string {\n\t\tconst cachedUsage = this._accessorUsageMap.get(accessor);\n\t\tif (cachedUsage) return cachedUsage;\n\n\t\tfor (const edge of this._doc.getGraph().listParentEdges(accessor)) {\n\t\t\tconst { usage } = edge.getAttributes() as { usage: BufferViewUsage | undefined };\n\n\t\t\tif (usage) return usage;\n\n\t\t\tif (edge.getParent().propertyType !== PropertyType.ROOT) {\n\t\t\t\tthis._doc.getLogger().warn(`Missing attribute \".usage\" on edge, \"${edge.getName()}\".`);\n\t\t\t}\n\t\t}\n\n\t\t// Group accessors with no specified usage into a miscellaneous buffer view.\n\t\treturn WriterContext.BufferViewUsage.OTHER;\n\t}\n\n\t/**\n\t * Sets usage for the given accessor. Some accessor types must be grouped into\n\t * buffer views with like accessors. This includes the specified buffer view \"targets\", but\n\t * also implicit usage like IBMs or instanced mesh attributes. If unspecified, an accessor\n\t * will be grouped with other accessors of unspecified usage.\n\t */\n\tpublic addAccessorToUsageGroup(accessor: Accessor, usage: BufferViewUsage | string): this {\n\t\tconst prevUsage = this._accessorUsageMap.get(accessor);\n\t\tif (prevUsage && prevUsage !== usage) {\n\t\t\tthrow new Error(`Accessor with usage \"${prevUsage}\" cannot be reused as \"${usage}\".`);\n\t\t}\n\t\tthis._accessorUsageMap.set(accessor, usage);\n\t\treturn this;\n\t}\n\n\t/** Lists accessors grouped by usage. Accessors with unspecified usage are not included. */\n\tpublic listAccessorUsageGroups(): { [key: string]: Accessor[] } {\n\t\tconst result = {} as { [key: string]: Accessor[] };\n\t\tfor (const [accessor, usage] of Array.from(this._accessorUsageMap.entries())) {\n\t\t\tresult[usage] = result[usage] || [];\n\t\t\tresult[usage].push(accessor);\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class UniqueURIGenerator {\n\tprivate counter = 1;\n\n\tconstructor(private readonly multiple: boolean, private readonly basename: string) {}\n\n\tpublic createURI(object: Texture | Buffer, extension: string): string {\n\t\tif (object.getURI()) {\n\t\t\treturn object.getURI();\n\t\t} else if (!this.multiple) {\n\t\t\treturn `${this.basename}.${extension}`;\n\t\t} else {\n\t\t\treturn `${this.basename}_${this.counter++}.${extension}`;\n\t\t}\n\t}\n}\n","import { Format, GLB_BUFFER, PropertyType, VERSION, VertexLayout } from '../constants';\nimport type { Document } from '../document';\nimport type { Extension } from '../extension';\nimport type { GraphEdge } from 'property-graph';\nimport type { JSONDocument } from '../json-document';\nimport { Accessor, AnimationSampler, Camera, Material, Property } from '../properties';\nimport type { GLTF } from '../types/gltf';\nimport { BufferUtils, Logger, MathUtils } from '../utils';\nimport { WriterContext } from './writer-context';\n\nconst { BufferViewUsage } = WriterContext;\n\nexport interface WriterOptions {\n\tformat: Format;\n\tlogger?: Logger;\n\tbasename?: string;\n\tvertexLayout?: VertexLayout;\n\tdependencies?: { [key: string]: unknown };\n\textensions?: typeof Extension[];\n}\n\n/** @internal */\nexport class GLTFWriter {\n\tpublic static write(doc: Document, options: Required<WriterOptions>): JSONDocument {\n\t\tconst root = doc.getRoot();\n\t\tconst json = {\n\t\t\tasset: { generator: `glTF-Transform ${VERSION}`, ...root.getAsset() },\n\t\t\textras: { ...root.getExtras() },\n\t\t} as GLTF.IGLTF;\n\t\tconst jsonDoc = { json, resources: {} } as JSONDocument;\n\n\t\tconst context = new WriterContext(doc, jsonDoc, options);\n\t\tconst logger = options.logger || Logger.DEFAULT_INSTANCE;\n\n\t\t/* Extensions (1/2). */\n\n\t\t// Extensions present on the Document are not written unless they are also registered with\n\t\t// the I/O class. This ensures that setup in `extension.register()` is completed, and\n\t\t// allows a Document to be written with specific extensions disabled.\n\t\tconst extensionsRegistered = new Set(options.extensions.map((ext) => ext.EXTENSION_NAME));\n\t\tconst extensionsUsed = doc\n\t\t\t.getRoot()\n\t\t\t.listExtensionsUsed()\n\t\t\t.filter((ext) => extensionsRegistered.has(ext.extensionName));\n\t\tconst extensionsRequired = doc\n\t\t\t.getRoot()\n\t\t\t.listExtensionsRequired()\n\t\t\t.filter((ext) => extensionsRegistered.has(ext.extensionName));\n\n\t\tif (extensionsUsed.length < doc.getRoot().listExtensionsUsed().length) {\n\t\t\tlogger.debug('Some extensions were not registered for I/O, and will not be written.');\n\t\t}\n\n\t\tfor (const extension of extensionsUsed) {\n\t\t\tfor (const key of extension.writeDependencies) {\n\t\t\t\textension.install(key, options.dependencies[key]);\n\t\t\t}\n\t\t}\n\n\t\t/* Utilities. */\n\n\t\tinterface BufferViewResult {\n\t\t\tbyteLength: number;\n\t\t\tbuffers: Uint8Array[];\n\t\t}\n\n\t\t/**\n\t\t * Pack a group of accessors into a sequential buffer view. Appends accessor and buffer view\n\t\t * definitions to the root JSON lists.\n\t\t *\n\t\t * @param accessors Accessors to be included.\n\t\t * @param bufferIndex Buffer to write to.\n\t\t * @param bufferByteOffset Current offset into the buffer, accounting for other buffer views.\n\t\t * @param bufferViewTarget (Optional) target use of the buffer view.\n\t\t */\n\t\tfunction concatAccessors(\n\t\t\taccessors: Accessor[],\n\t\t\tbufferIndex: number,\n\t\t\tbufferByteOffset: number,\n\t\t\tbufferViewTarget?: number\n\t\t): BufferViewResult {\n\t\t\tconst buffers: Uint8Array[] = [];\n\t\t\tlet byteLength = 0;\n\n\t\t\t// Create accessor definitions, determining size of final buffer view.\n\t\t\tfor (const accessor of accessors) {\n\t\t\t\tconst accessorDef = context.createAccessorDef(accessor);\n\t\t\t\taccessorDef.bufferView = json.bufferViews!.length;\n\n\t\t\t\tconst accessorArray = accessor.getArray()!;\n\t\t\t\tconst data = BufferUtils.pad(BufferUtils.toView(accessorArray));\n\t\t\t\taccessorDef.byteOffset = byteLength;\n\t\t\t\tbyteLength += data.byteLength;\n\t\t\t\tbuffers.push(data);\n\n\t\t\t\tcontext.accessorIndexMap.set(accessor, json.accessors!.length);\n\t\t\t\tjson.accessors!.push(accessorDef);\n\t\t\t}\n\n\t\t\t// Create buffer view definition.\n\t\t\tconst bufferViewData = BufferUtils.concat(buffers);\n\t\t\tconst bufferViewDef: GLTF.IBufferView = {\n\t\t\t\tbuffer: bufferIndex,\n\t\t\t\tbyteOffset: bufferByteOffset,\n\t\t\t\tbyteLength: bufferViewData.byteLength,\n\t\t\t};\n\t\t\tif (bufferViewTarget) bufferViewDef.target = bufferViewTarget;\n\t\t\tjson.bufferViews!.push(bufferViewDef);\n\n\t\t\treturn { buffers, byteLength };\n\t\t}\n\n\t\t/**\n\t\t * Pack a group of accessors into an interleaved buffer view. Appends accessor and buffer\n\t\t * view definitions to the root JSON lists. Buffer view target is implicitly attribute data.\n\t\t *\n\t\t * References:\n\t\t * - [Apple  Best Practices for Working with Vertex Data](https://developer.apple.com/library/archive/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/TechniquesforWorkingwithVertexData/TechniquesforWorkingwithVertexData.html)\n\t\t * - [Khronos  Vertex Specification Best Practices](https://www.khronos.org/opengl/wiki/Vertex_Specification_Best_Practices)\n\t\t *\n\t\t * @param accessors Accessors to be included.\n\t\t * @param bufferIndex Buffer to write to.\n\t\t * @param bufferByteOffset Offset into the buffer, accounting for other buffer views.\n\t\t */\n\t\tfunction interleaveAccessors(\n\t\t\taccessors: Accessor[],\n\t\t\tbufferIndex: number,\n\t\t\tbufferByteOffset: number\n\t\t): BufferViewResult {\n\t\t\tconst vertexCount = accessors[0].getCount();\n\t\t\tlet byteStride = 0;\n\n\t\t\t// Create accessor definitions, determining size and stride of final buffer view.\n\t\t\tfor (const accessor of accessors) {\n\t\t\t\tconst accessorDef = context.createAccessorDef(accessor);\n\t\t\t\taccessorDef.bufferView = json.bufferViews!.length;\n\t\t\t\taccessorDef.byteOffset = byteStride;\n\n\t\t\t\tconst elementSize = accessor.getElementSize();\n\t\t\t\tconst componentSize = accessor.getComponentSize();\n\t\t\t\tbyteStride += BufferUtils.padNumber(elementSize * componentSize);\n\n\t\t\t\tcontext.accessorIndexMap.set(accessor, json.accessors!.length);\n\t\t\t\tjson.accessors!.push(accessorDef);\n\t\t\t}\n\n\t\t\t// Allocate interleaved buffer view.\n\t\t\tconst byteLength = vertexCount * byteStride;\n\t\t\tconst buffer = new ArrayBuffer(byteLength);\n\t\t\tconst view = new DataView(buffer);\n\n\t\t\t// Write interleaved accessor data to the buffer view.\n\t\t\tfor (let i = 0; i < vertexCount; i++) {\n\t\t\t\tlet vertexByteOffset = 0;\n\t\t\t\tfor (const accessor of accessors) {\n\t\t\t\t\tconst elementSize = accessor.getElementSize();\n\t\t\t\t\tconst componentSize = accessor.getComponentSize();\n\t\t\t\t\tconst componentType = accessor.getComponentType();\n\t\t\t\t\tconst array = accessor.getArray()!;\n\t\t\t\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\t\t\t\tconst viewByteOffset = i * byteStride + vertexByteOffset + j * componentSize;\n\t\t\t\t\t\tconst value = array[i * elementSize + j];\n\t\t\t\t\t\tswitch (componentType) {\n\t\t\t\t\t\t\tcase Accessor.ComponentType.FLOAT:\n\t\t\t\t\t\t\t\tview.setFloat32(viewByteOffset, value, true);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase Accessor.ComponentType.BYTE:\n\t\t\t\t\t\t\t\tview.setInt8(viewByteOffset, value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase Accessor.ComponentType.SHORT:\n\t\t\t\t\t\t\t\tview.setInt16(viewByteOffset, value, true);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase Accessor.ComponentType.UNSIGNED_BYTE:\n\t\t\t\t\t\t\t\tview.setUint8(viewByteOffset, value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase Accessor.ComponentType.UNSIGNED_SHORT:\n\t\t\t\t\t\t\t\tview.setUint16(viewByteOffset, value, true);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase Accessor.ComponentType.UNSIGNED_INT:\n\t\t\t\t\t\t\t\tview.setUint32(viewByteOffset, value, true);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthrow new Error('Unexpected component type: ' + componentType);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvertexByteOffset += BufferUtils.padNumber(elementSize * componentSize);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create buffer view definition.\n\t\t\tconst bufferViewDef: GLTF.IBufferView = {\n\t\t\t\tbuffer: bufferIndex,\n\t\t\t\tbyteOffset: bufferByteOffset,\n\t\t\t\tbyteLength: byteLength,\n\t\t\t\tbyteStride: byteStride,\n\t\t\t\ttarget: WriterContext.BufferViewTarget.ARRAY_BUFFER,\n\t\t\t};\n\t\t\tjson.bufferViews!.push(bufferViewDef);\n\n\t\t\treturn { byteLength, buffers: [new Uint8Array(buffer)] };\n\t\t}\n\n\t\t/* Data use pre-processing. */\n\n\t\tconst accessorRefs = new Map<Accessor, GraphEdge<Property, Accessor>[]>();\n\n\t\t// Gather all accessors, creating a map to look up their uses.\n\t\tfor (const ref of doc.getGraph().listEdges()) {\n\t\t\tif (ref.getParent() === root) continue;\n\n\t\t\tconst child = ref.getChild();\n\n\t\t\tif (child instanceof Accessor) {\n\t\t\t\tconst uses = accessorRefs.get(child) || [];\n\t\t\t\tuses.push(ref as GraphEdge<Property, Accessor>);\n\t\t\t\taccessorRefs.set(child, uses);\n\t\t\t}\n\t\t}\n\n\t\tjson.accessors = [];\n\t\tjson.bufferViews = [];\n\n\t\t/* Textures. */\n\n\t\t// glTF-Transform's \"Texture\" properties correspond 1:1 with glTF \"Image\" properties, and\n\t\t// with image files. The glTF file may contain more one texture per image, where images\n\t\t// are reused with different sampler properties.\n\t\tjson.samplers = [];\n\t\tjson.textures = [];\n\t\tjson.images = root.listTextures().map((texture, textureIndex) => {\n\t\t\tconst imageDef = context.createPropertyDef(texture) as GLTF.IImage;\n\n\t\t\tif (texture.getMimeType()) {\n\t\t\t\timageDef.mimeType = texture.getMimeType();\n\t\t\t}\n\n\t\t\tconst image = texture.getImage();\n\t\t\tif (image) {\n\t\t\t\tcontext.createImageData(imageDef, image, texture);\n\t\t\t}\n\n\t\t\tcontext.imageIndexMap.set(texture, textureIndex);\n\t\t\treturn imageDef;\n\t\t});\n\n\t\t/* Accessors. */\n\n\t\textensionsUsed\n\t\t\t.filter((extension) => extension.prewriteTypes.includes(PropertyType.ACCESSOR))\n\t\t\t.forEach((extension) => extension.prewrite(context, PropertyType.ACCESSOR));\n\t\troot.listAccessors().forEach((accessor) => {\n\t\t\t// Attributes are grouped and interleaved in one buffer view per mesh primitive.\n\t\t\t// Indices for all primitives are grouped into a single buffer view. IBMs are grouped\n\t\t\t// into a single buffer view. Other usage (if specified by extensions) also goes into\n\t\t\t// a dedicated buffer view. Everything else goes into a miscellaneous buffer view.\n\n\t\t\t// Certain accessor usage should group data into buffer views by the accessor parent.\n\t\t\t// The `accessorParents` map uses the first parent of each accessor for this purpose.\n\t\t\tconst groupByParent = context.accessorUsageGroupedByParent;\n\t\t\tconst accessorParents = context.accessorParents;\n\n\t\t\t// Skip if already written by an extension.\n\t\t\tif (context.accessorIndexMap.has(accessor)) return;\n\n\t\t\t// Assign usage for core accessor usage types (explicit targets and implicit usage).\n\t\t\tconst accessorEdges = accessorRefs.get(accessor) || [];\n\t\t\tconst usage = context.getAccessorUsage(accessor);\n\t\t\tcontext.addAccessorToUsageGroup(accessor, usage);\n\n\t\t\t// For accessor usage that requires grouping by parent (vertex and instance\n\t\t\t// attributes) organize buffer views accordingly.\n\t\t\tif (groupByParent.has(usage)) {\n\t\t\t\tconst parent = accessorEdges[0].getParent();\n\t\t\t\tconst parentAccessors = accessorParents.get(parent) || new Set<Accessor>();\n\t\t\t\tparentAccessors.add(accessor);\n\t\t\t\taccessorParents.set(parent, parentAccessors);\n\t\t\t}\n\t\t});\n\n\t\t/* Buffers, buffer views. */\n\n\t\textensionsUsed\n\t\t\t.filter((extension) => extension.prewriteTypes.includes(PropertyType.BUFFER))\n\t\t\t.forEach((extension) => extension.prewrite(context, PropertyType.BUFFER));\n\n\t\tconst hasBinaryResources =\n\t\t\troot.listAccessors().length > 0 || root.listTextures().length > 0 || context.otherBufferViews.size > 0;\n\t\tif (hasBinaryResources && root.listBuffers().length === 0) {\n\t\t\tthrow new Error('Buffer required for Document resources, but none was found.');\n\t\t}\n\n\t\tjson.buffers = [];\n\t\troot.listBuffers().forEach((buffer, index) => {\n\t\t\tconst bufferDef = context.createPropertyDef(buffer) as GLTF.IBuffer;\n\t\t\tconst groupByParent = context.accessorUsageGroupedByParent;\n\t\t\tconst accessorParents = context.accessorParents;\n\n\t\t\tconst bufferAccessors = buffer\n\t\t\t\t.listParents()\n\t\t\t\t.filter((property) => property instanceof Accessor) as Accessor[];\n\t\t\tconst bufferAccessorsSet = new Set(bufferAccessors);\n\n\t\t\t// Write accessor groups to buffer views.\n\n\t\t\tconst buffers: Uint8Array[] = [];\n\t\t\tconst bufferIndex = json.buffers!.length;\n\t\t\tlet bufferByteLength = 0;\n\n\t\t\tconst usageGroups = context.listAccessorUsageGroups();\n\n\t\t\tfor (const usage in usageGroups) {\n\t\t\t\tif (groupByParent.has(usage)) {\n\t\t\t\t\t// Accessors grouped by (first) parent, including vertex and instance\n\t\t\t\t\t// attributes.\n\t\t\t\t\tfor (const parentAccessors of Array.from(accessorParents.values())) {\n\t\t\t\t\t\tconst accessors = Array.from(parentAccessors)\n\t\t\t\t\t\t\t.filter((a) => bufferAccessorsSet.has(a))\n\t\t\t\t\t\t\t.filter((a) => context.getAccessorUsage(a) === usage);\n\t\t\t\t\t\tif (!accessors.length) continue;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tusage !== BufferViewUsage.ARRAY_BUFFER ||\n\t\t\t\t\t\t\toptions.vertexLayout === VertexLayout.INTERLEAVED\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Case 1: Non-vertex data OR interleaved vertex data.\n\n\t\t\t\t\t\t\t// Instanced data is not interleaved, see:\n\t\t\t\t\t\t\t// https://github.com/KhronosGroup/glTF/pull/1888\n\t\t\t\t\t\t\tconst result =\n\t\t\t\t\t\t\t\tusage === BufferViewUsage.ARRAY_BUFFER\n\t\t\t\t\t\t\t\t\t? interleaveAccessors(accessors, bufferIndex, bufferByteLength)\n\t\t\t\t\t\t\t\t\t: concatAccessors(accessors, bufferIndex, bufferByteLength);\n\t\t\t\t\t\t\tbufferByteLength += result.byteLength;\n\t\t\t\t\t\t\tbuffers.push(...result.buffers);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Case 2: Non-interleaved vertex data.\n\n\t\t\t\t\t\t\tfor (const accessor of accessors) {\n\t\t\t\t\t\t\t\t// We 'interleave' a single accessor because the method pads to\n\t\t\t\t\t\t\t\t// 4-byte boundaries, which concatAccessors() does not.\n\t\t\t\t\t\t\t\tconst result = interleaveAccessors([accessor], bufferIndex, bufferByteLength);\n\t\t\t\t\t\t\t\tbufferByteLength += result.byteLength;\n\t\t\t\t\t\t\t\tbuffers.push(...result.buffers);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Accessors concatenated end-to-end, including indices, IBMs, and other data.\n\t\t\t\t\tconst accessors = usageGroups[usage].filter((a) => bufferAccessorsSet.has(a));\n\t\t\t\t\tif (!accessors.length) continue;\n\n\t\t\t\t\tconst target =\n\t\t\t\t\t\tusage === BufferViewUsage.ELEMENT_ARRAY_BUFFER\n\t\t\t\t\t\t\t? WriterContext.BufferViewTarget.ELEMENT_ARRAY_BUFFER\n\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\tconst result = concatAccessors(accessors, bufferIndex, bufferByteLength, target);\n\t\t\t\t\tbufferByteLength += result.byteLength;\n\t\t\t\t\tbuffers.push(...result.buffers);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// We only support embedded images in GLB, where the embedded buffer must be the first.\n\t\t\t// Additional buffers are currently left empty (see EXT_meshopt_compression fallback).\n\t\t\tif (context.imageBufferViews.length && index === 0) {\n\t\t\t\tfor (let i = 0; i < context.imageBufferViews.length; i++) {\n\t\t\t\t\tjson.bufferViews![json.images![i].bufferView!].byteOffset = bufferByteLength;\n\t\t\t\t\tbufferByteLength += context.imageBufferViews[i].byteLength;\n\t\t\t\t\tbuffers.push(context.imageBufferViews[i]);\n\n\t\t\t\t\tif (bufferByteLength % 8) {\n\t\t\t\t\t\t// See: https://github.com/KhronosGroup/glTF/issues/1935\n\t\t\t\t\t\tconst imagePadding = 8 - (bufferByteLength % 8);\n\t\t\t\t\t\tbufferByteLength += imagePadding;\n\t\t\t\t\t\tbuffers.push(new Uint8Array(imagePadding));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context.otherBufferViews.has(buffer)) {\n\t\t\t\tfor (const data of context.otherBufferViews.get(buffer)!) {\n\t\t\t\t\tjson.bufferViews!.push({\n\t\t\t\t\t\tbuffer: bufferIndex,\n\t\t\t\t\t\tbyteOffset: bufferByteLength,\n\t\t\t\t\t\tbyteLength: data.byteLength,\n\t\t\t\t\t});\n\t\t\t\t\tcontext.otherBufferViewsIndexMap.set(data, json.bufferViews!.length - 1);\n\t\t\t\t\tbufferByteLength += data.byteLength;\n\t\t\t\t\tbuffers.push(data);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (bufferByteLength) {\n\t\t\t\t// Assign buffer URI.\n\t\t\t\tlet uri: string;\n\t\t\t\tif (options.format === Format.GLB) {\n\t\t\t\t\turi = GLB_BUFFER;\n\t\t\t\t} else {\n\t\t\t\t\turi = context.bufferURIGenerator.createURI(buffer, 'bin');\n\t\t\t\t\tbufferDef.uri = uri;\n\t\t\t\t}\n\n\t\t\t\t// Write buffer views to buffer.\n\t\t\t\tbufferDef.byteLength = bufferByteLength;\n\t\t\t\tjsonDoc.resources[uri] = BufferUtils.concat(buffers);\n\t\t\t}\n\n\t\t\tjson.buffers!.push(bufferDef);\n\t\t\tcontext.bufferIndexMap.set(buffer, index);\n\t\t});\n\n\t\tif (root.listAccessors().find((a) => !a.getBuffer())) {\n\t\t\tlogger.warn('Skipped writing one or more Accessors: no Buffer assigned.');\n\t\t}\n\n\t\t/* Materials. */\n\n\t\tjson.materials = root.listMaterials().map((material, index) => {\n\t\t\tconst materialDef = context.createPropertyDef(material) as GLTF.IMaterial;\n\n\t\t\t// Program state & blending.\n\n\t\t\tif (material.getAlphaMode() !== Material.AlphaMode.OPAQUE) {\n\t\t\t\tmaterialDef.alphaMode = material.getAlphaMode();\n\t\t\t}\n\t\t\tif (material.getAlphaMode() === Material.AlphaMode.MASK) {\n\t\t\t\tmaterialDef.alphaCutoff = material.getAlphaCutoff();\n\t\t\t}\n\t\t\tif (material.getDoubleSided()) materialDef.doubleSided = true;\n\n\t\t\t// Factors.\n\n\t\t\tmaterialDef.pbrMetallicRoughness = {};\n\t\t\tif (!MathUtils.eq(material.getBaseColorFactor(), [1, 1, 1, 1])) {\n\t\t\t\tmaterialDef.pbrMetallicRoughness.baseColorFactor = material.getBaseColorFactor();\n\t\t\t}\n\t\t\tif (!MathUtils.eq(material.getEmissiveFactor(), [0, 0, 0])) {\n\t\t\t\tmaterialDef.emissiveFactor = material.getEmissiveFactor();\n\t\t\t}\n\t\t\tif (material.getRoughnessFactor() !== 1) {\n\t\t\t\tmaterialDef.pbrMetallicRoughness.roughnessFactor = material.getRoughnessFactor();\n\t\t\t}\n\t\t\tif (material.getMetallicFactor() !== 1) {\n\t\t\t\tmaterialDef.pbrMetallicRoughness.metallicFactor = material.getMetallicFactor();\n\t\t\t}\n\n\t\t\t// Textures.\n\n\t\t\tif (material.getBaseColorTexture()) {\n\t\t\t\tconst texture = material.getBaseColorTexture()!;\n\t\t\t\tconst textureInfo = material.getBaseColorTextureInfo()!;\n\t\t\t\tmaterialDef.pbrMetallicRoughness.baseColorTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t}\n\n\t\t\tif (material.getEmissiveTexture()) {\n\t\t\t\tconst texture = material.getEmissiveTexture()!;\n\t\t\t\tconst textureInfo = material.getEmissiveTextureInfo()!;\n\t\t\t\tmaterialDef.emissiveTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t}\n\n\t\t\tif (material.getNormalTexture()) {\n\t\t\t\tconst texture = material.getNormalTexture()!;\n\t\t\t\tconst textureInfo = material.getNormalTextureInfo()!;\n\t\t\t\tconst textureInfoDef = context.createTextureInfoDef(\n\t\t\t\t\ttexture,\n\t\t\t\t\ttextureInfo\n\t\t\t\t) as GLTF.IMaterialNormalTextureInfo;\n\t\t\t\tif (material.getNormalScale() !== 1) {\n\t\t\t\t\ttextureInfoDef.scale = material.getNormalScale();\n\t\t\t\t}\n\t\t\t\tmaterialDef.normalTexture = textureInfoDef;\n\t\t\t}\n\n\t\t\tif (material.getOcclusionTexture()) {\n\t\t\t\tconst texture = material.getOcclusionTexture()!;\n\t\t\t\tconst textureInfo = material.getOcclusionTextureInfo()!;\n\t\t\t\tconst textureInfoDef = context.createTextureInfoDef(\n\t\t\t\t\ttexture,\n\t\t\t\t\ttextureInfo\n\t\t\t\t) as GLTF.IMaterialOcclusionTextureInfo;\n\t\t\t\tif (material.getOcclusionStrength() !== 1) {\n\t\t\t\t\ttextureInfoDef.strength = material.getOcclusionStrength();\n\t\t\t\t}\n\t\t\t\tmaterialDef.occlusionTexture = textureInfoDef;\n\t\t\t}\n\n\t\t\tif (material.getMetallicRoughnessTexture()) {\n\t\t\t\tconst texture = material.getMetallicRoughnessTexture()!;\n\t\t\t\tconst textureInfo = material.getMetallicRoughnessTextureInfo()!;\n\t\t\t\tmaterialDef.pbrMetallicRoughness.metallicRoughnessTexture = context.createTextureInfoDef(\n\t\t\t\t\ttexture,\n\t\t\t\t\ttextureInfo\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tcontext.materialIndexMap.set(material, index);\n\t\t\treturn materialDef;\n\t\t});\n\n\t\t/* Meshes. */\n\n\t\tjson.meshes = root.listMeshes().map((mesh, index) => {\n\t\t\tconst meshDef = context.createPropertyDef(mesh) as GLTF.IMesh;\n\n\t\t\tlet targetNames: string[] | null = null;\n\n\t\t\tmeshDef.primitives = mesh.listPrimitives().map((primitive) => {\n\t\t\t\tconst primitiveDef: GLTF.IMeshPrimitive = { attributes: {} };\n\n\t\t\t\tprimitiveDef.mode = primitive.getMode();\n\n\t\t\t\tconst material = primitive.getMaterial();\n\t\t\t\tif (material) {\n\t\t\t\t\tprimitiveDef.material = context.materialIndexMap.get(material);\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(primitive.getExtras()).length) {\n\t\t\t\t\tprimitiveDef.extras = primitive.getExtras();\n\t\t\t\t}\n\n\t\t\t\tconst indices = primitive.getIndices();\n\t\t\t\tif (indices) {\n\t\t\t\t\tprimitiveDef.indices = context.accessorIndexMap.get(indices);\n\t\t\t\t}\n\n\t\t\t\tfor (const semantic of primitive.listSemantics()) {\n\t\t\t\t\tprimitiveDef.attributes[semantic] = context.accessorIndexMap.get(\n\t\t\t\t\t\tprimitive.getAttribute(semantic)!\n\t\t\t\t\t)!;\n\t\t\t\t}\n\n\t\t\t\tfor (const target of primitive.listTargets()) {\n\t\t\t\t\tconst targetDef = {} as { [name: string]: number };\n\n\t\t\t\t\tfor (const semantic of target.listSemantics()) {\n\t\t\t\t\t\ttargetDef[semantic] = context.accessorIndexMap.get(target.getAttribute(semantic)!)!;\n\t\t\t\t\t}\n\n\t\t\t\t\tprimitiveDef.targets = primitiveDef.targets || [];\n\t\t\t\t\tprimitiveDef.targets.push(targetDef);\n\t\t\t\t}\n\n\t\t\t\tif (primitive.listTargets().length && !targetNames) {\n\t\t\t\t\ttargetNames = primitive.listTargets().map((target) => target.getName());\n\t\t\t\t}\n\n\t\t\t\treturn primitiveDef;\n\t\t\t});\n\n\t\t\tif (mesh.getWeights().length) {\n\t\t\t\tmeshDef.weights = mesh.getWeights();\n\t\t\t}\n\n\t\t\tif (targetNames) {\n\t\t\t\tmeshDef.extras = meshDef.extras || {};\n\t\t\t\tmeshDef.extras['targetNames'] = targetNames;\n\t\t\t}\n\n\t\t\tcontext.meshIndexMap.set(mesh, index);\n\t\t\treturn meshDef;\n\t\t});\n\n\t\t/** Cameras. */\n\n\t\tjson.cameras = root.listCameras().map((camera, index) => {\n\t\t\tconst cameraDef = context.createPropertyDef(camera) as GLTF.ICamera;\n\t\t\tcameraDef.type = camera.getType();\n\t\t\tif (cameraDef.type === Camera.Type.PERSPECTIVE) {\n\t\t\t\tcameraDef.perspective = {\n\t\t\t\t\tznear: camera.getZNear(),\n\t\t\t\t\tzfar: camera.getZFar(),\n\t\t\t\t\tyfov: camera.getYFov(),\n\t\t\t\t};\n\t\t\t\tconst aspectRatio = camera.getAspectRatio();\n\t\t\t\tif (aspectRatio !== null) {\n\t\t\t\t\tcameraDef.perspective.aspectRatio = aspectRatio;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcameraDef.orthographic = {\n\t\t\t\t\tznear: camera.getZNear(),\n\t\t\t\t\tzfar: camera.getZFar(),\n\t\t\t\t\txmag: camera.getXMag(),\n\t\t\t\t\tymag: camera.getYMag(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tcontext.cameraIndexMap.set(camera, index);\n\t\t\treturn cameraDef;\n\t\t});\n\n\t\t/* Nodes. */\n\n\t\tjson.nodes = root.listNodes().map((node, index) => {\n\t\t\tconst nodeDef = context.createPropertyDef(node) as GLTF.INode;\n\n\t\t\tif (!MathUtils.eq(node.getTranslation(), [0, 0, 0])) {\n\t\t\t\tnodeDef.translation = node.getTranslation();\n\t\t\t}\n\n\t\t\tif (!MathUtils.eq(node.getRotation(), [0, 0, 0, 1])) {\n\t\t\t\tnodeDef.rotation = node.getRotation();\n\t\t\t}\n\n\t\t\tif (!MathUtils.eq(node.getScale(), [1, 1, 1])) {\n\t\t\t\tnodeDef.scale = node.getScale();\n\t\t\t}\n\n\t\t\tif (node.getWeights().length) {\n\t\t\t\tnodeDef.weights = node.getWeights();\n\t\t\t}\n\n\t\t\t// Attachments (mesh, camera, skin) defined later in writing process.\n\n\t\t\tcontext.nodeIndexMap.set(node, index);\n\t\t\treturn nodeDef;\n\t\t});\n\n\t\t/** Skins. */\n\n\t\tjson.skins = root.listSkins().map((skin, index) => {\n\t\t\tconst skinDef = context.createPropertyDef(skin) as GLTF.ISkin;\n\n\t\t\tconst inverseBindMatrices = skin.getInverseBindMatrices();\n\t\t\tif (inverseBindMatrices) {\n\t\t\t\tskinDef.inverseBindMatrices = context.accessorIndexMap.get(inverseBindMatrices);\n\t\t\t}\n\n\t\t\tconst skeleton = skin.getSkeleton();\n\t\t\tif (skeleton) {\n\t\t\t\tskinDef.skeleton = context.nodeIndexMap.get(skeleton);\n\t\t\t}\n\n\t\t\tskinDef.joints = skin.listJoints().map((joint) => context.nodeIndexMap.get(joint)!);\n\n\t\t\tcontext.skinIndexMap.set(skin, index);\n\t\t\treturn skinDef;\n\t\t});\n\n\t\t/** Node attachments. */\n\n\t\troot.listNodes().forEach((node, index) => {\n\t\t\tconst nodeDef = json.nodes![index];\n\n\t\t\tconst mesh = node.getMesh();\n\t\t\tif (mesh) {\n\t\t\t\tnodeDef.mesh = context.meshIndexMap.get(mesh);\n\t\t\t}\n\n\t\t\tconst camera = node.getCamera();\n\t\t\tif (camera) {\n\t\t\t\tnodeDef.camera = context.cameraIndexMap.get(camera);\n\t\t\t}\n\n\t\t\tconst skin = node.getSkin();\n\t\t\tif (skin) {\n\t\t\t\tnodeDef.skin = context.skinIndexMap.get(skin);\n\t\t\t}\n\n\t\t\tif (node.listChildren().length > 0) {\n\t\t\t\tnodeDef.children = node.listChildren().map((node) => context.nodeIndexMap.get(node)!);\n\t\t\t}\n\t\t});\n\n\t\t/** Animations. */\n\n\t\tjson.animations = root.listAnimations().map((animation, index) => {\n\t\t\tconst animationDef = context.createPropertyDef(animation) as GLTF.IAnimation;\n\n\t\t\tconst samplerIndexMap: Map<AnimationSampler, number> = new Map();\n\n\t\t\tanimationDef.samplers = animation.listSamplers().map((sampler, samplerIndex) => {\n\t\t\t\tconst samplerDef = context.createPropertyDef(sampler) as GLTF.IAnimationSampler;\n\t\t\t\tsamplerDef.input = context.accessorIndexMap.get(sampler.getInput()!)!;\n\t\t\t\tsamplerDef.output = context.accessorIndexMap.get(sampler.getOutput()!)!;\n\t\t\t\tsamplerDef.interpolation = sampler.getInterpolation();\n\t\t\t\tsamplerIndexMap.set(sampler, samplerIndex);\n\t\t\t\treturn samplerDef;\n\t\t\t});\n\n\t\t\tanimationDef.channels = animation.listChannels().map((channel) => {\n\t\t\t\tconst channelDef = context.createPropertyDef(channel) as GLTF.IAnimationChannel;\n\t\t\t\tchannelDef.sampler = samplerIndexMap.get(channel.getSampler()!)!;\n\t\t\t\tchannelDef.target = {\n\t\t\t\t\tnode: context.nodeIndexMap.get(channel.getTargetNode()!)!,\n\t\t\t\t\tpath: channel.getTargetPath()!,\n\t\t\t\t};\n\t\t\t\treturn channelDef;\n\t\t\t});\n\n\t\t\tcontext.animationIndexMap.set(animation, index);\n\t\t\treturn animationDef;\n\t\t});\n\n\t\t/* Scenes. */\n\n\t\tjson.scenes = root.listScenes().map((scene, index) => {\n\t\t\tconst sceneDef = context.createPropertyDef(scene) as GLTF.IScene;\n\t\t\tsceneDef.nodes = scene.listChildren().map((node) => context.nodeIndexMap.get(node)!);\n\t\t\tcontext.sceneIndexMap.set(scene, index);\n\t\t\treturn sceneDef;\n\t\t});\n\n\t\tconst defaultScene = root.getDefaultScene();\n\t\tif (defaultScene) {\n\t\t\tjson.scene = root.listScenes().indexOf(defaultScene);\n\t\t}\n\n\t\t/* Extensions (2/2). */\n\n\t\tjson.extensionsUsed = extensionsUsed.map((ext) => ext.extensionName);\n\t\tjson.extensionsRequired = extensionsRequired.map((ext) => ext.extensionName);\n\t\textensionsUsed.forEach((extension) => extension.write(context));\n\n\t\t//\n\n\t\tclean(json as unknown as Record<string, unknown>);\n\n\t\treturn jsonDoc;\n\t}\n}\n\n/**\n * Removes empty and null values from an object.\n * @param object\n * @internal\n */\nfunction clean(object: Record<string, unknown>): void {\n\tconst unused: string[] = [];\n\n\tfor (const key in object) {\n\t\tconst value = object[key];\n\t\tif (Array.isArray(value) && value.length === 0) {\n\t\t\tunused.push(key);\n\t\t} else if (value === null || value === '') {\n\t\t\tunused.push(key);\n\t\t} else if (value && typeof value === 'object' && Object.keys(value).length === 0) {\n\t\t\tunused.push(key);\n\t\t}\n\t}\n\n\tfor (const key of unused) {\n\t\tdelete object[key];\n\t}\n}\n","import { Format, GLB_BUFFER, VertexLayout } from '../constants';\nimport type { Document } from '../document';\nimport type { Extension } from '../extension';\nimport type { JSONDocument } from '../json-document';\nimport type { GLTF } from '../types/gltf';\nimport { BufferUtils, FileUtils, HTTPUtils, Logger, uuid } from '../utils/';\nimport { GLTFReader } from './reader';\nimport { GLTFWriter, WriterOptions } from './writer';\n\nenum ChunkType {\n\tJSON = 0x4e4f534a,\n\tBIN = 0x004e4942,\n}\n\ntype PublicWriterOptions = Partial<Pick<WriterOptions, 'format' | 'basename'>>;\n\n/**\n * # PlatformIO\n *\n * *Abstract I/O service.*\n *\n * The most common use of the I/O service is to read/write a {@link Document} with a given path.\n * Methods are also available for converting in-memory representations of raw glTF files, both\n * binary (*Uint8Array*) and JSON ({@link JSONDocument}).\n *\n * For platform-specific implementations, see {@link NodeIO}, {@link WebIO}, and {@link DenoIO}.\n *\n * @category I/O\n */\nexport abstract class PlatformIO {\n\tprotected _logger = Logger.DEFAULT_INSTANCE;\n\tprivate _extensions = new Set<typeof Extension>();\n\tprivate _dependencies: { [key: string]: unknown } = {};\n\tprivate _vertexLayout = VertexLayout.INTERLEAVED;\n\n\t/** @hidden */\n\tpublic lastReadBytes = 0;\n\n\t/** @hidden */\n\tpublic lastWriteBytes = 0;\n\n\t/** Sets the {@link Logger} used by this I/O instance. Defaults to Logger.DEFAULT_INSTANCE. */\n\tpublic setLogger(logger: Logger): this {\n\t\tthis._logger = logger;\n\t\treturn this;\n\t}\n\n\t/** Registers extensions, enabling I/O class to read and write glTF assets requiring them. */\n\tpublic registerExtensions(extensions: typeof Extension[]): this {\n\t\tfor (const extension of extensions) {\n\t\t\tthis._extensions.add(extension);\n\t\t\textension.register();\n\t\t}\n\t\treturn this;\n\t}\n\n\t/** Registers dependencies used (e.g. by extensions) in the I/O process. */\n\tpublic registerDependencies(dependencies: { [key: string]: unknown }): this {\n\t\tObject.assign(this._dependencies, dependencies);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets the vertex layout method used by this I/O instance. Defaults to\n\t * VertexLayout.INTERLEAVED.\n\t */\n\tpublic setVertexLayout(layout: VertexLayout): this {\n\t\tthis._vertexLayout = layout;\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Abstract.\n\t */\n\n\tprotected abstract readURI(uri: string, type: 'view'): Promise<Uint8Array>;\n\tprotected abstract readURI(uri: string, type: 'text'): Promise<string>;\n\tprotected abstract readURI(uri: string, type: 'view' | 'text'): Promise<Uint8Array | string>;\n\n\tprotected abstract resolve(base: string, path: string): string;\n\tprotected abstract dirname(uri: string): string;\n\n\t/**********************************************************************************************\n\t * Public Read API.\n\t */\n\n\t/** Reads a {@link Document} from the given URI. */\n\tpublic async read(uri: string): Promise<Document> {\n\t\treturn await this.readJSON(await this.readAsJSON(uri));\n\t}\n\n\t/** Loads a URI and returns a {@link JSONDocument} struct, without parsing. */\n\tpublic async readAsJSON(uri: string): Promise<JSONDocument> {\n\t\tconst isGLB = uri.match(/^data:application\\/octet-stream;/) || this.detectFormat(uri) === Format.GLB;\n\t\treturn isGLB ? this._readGLB(uri) : this._readGLTF(uri);\n\t}\n\n\t/** Converts glTF-formatted JSON and a resource map to a {@link Document}. */\n\tpublic async readJSON(jsonDoc: JSONDocument): Promise<Document> {\n\t\tjsonDoc = this._copyJSON(jsonDoc);\n\t\tthis._readResourcesInternal(jsonDoc);\n\t\treturn GLTFReader.read(jsonDoc, {\n\t\t\textensions: Array.from(this._extensions),\n\t\t\tdependencies: this._dependencies,\n\t\t\tlogger: this._logger,\n\t\t});\n\t}\n\n\t/** Converts a GLB-formatted Uint8Array to a {@link JSONDocument}. */\n\tpublic async binaryToJSON(glb: Uint8Array): Promise<JSONDocument> {\n\t\tconst jsonDoc = this._binaryToJSON(BufferUtils.assertView(glb));\n\t\tthis._readResourcesInternal(jsonDoc);\n\t\tconst json = jsonDoc.json;\n\n\t\t// Check for external references, which can't be resolved by this method.\n\t\tif (json.buffers && json.buffers.some((bufferDef) => isExternalBuffer(jsonDoc, bufferDef))) {\n\t\t\tthrow new Error('Cannot resolve external buffers with binaryToJSON().');\n\t\t} else if (json.images && json.images.some((imageDef) => isExternalImage(jsonDoc, imageDef))) {\n\t\t\tthrow new Error('Cannot resolve external images with binaryToJSON().');\n\t\t}\n\n\t\treturn jsonDoc;\n\t}\n\n\t/** Converts a GLB-formatted Uint8Array to a {@link Document}. */\n\tpublic async readBinary(glb: Uint8Array): Promise<Document> {\n\t\treturn this.readJSON(await this.binaryToJSON(BufferUtils.assertView(glb)));\n\t}\n\n\t/**********************************************************************************************\n\t * Public Write API.\n\t */\n\n\t/** Converts a {@link Document} to glTF-formatted JSON and a resource map. */\n\tpublic async writeJSON(doc: Document, _options: PublicWriterOptions = {}): Promise<JSONDocument> {\n\t\tif (_options.format === Format.GLB && doc.getRoot().listBuffers().length > 1) {\n\t\t\tthrow new Error('GLB must have 01 buffers.');\n\t\t}\n\t\treturn GLTFWriter.write(doc, {\n\t\t\tformat: _options.format || Format.GLTF,\n\t\t\tbasename: _options.basename || '',\n\t\t\tlogger: this._logger,\n\t\t\tvertexLayout: this._vertexLayout,\n\t\t\tdependencies: { ...this._dependencies },\n\t\t\textensions: Array.from(this._extensions),\n\t\t} as Required<WriterOptions>);\n\t}\n\n\t/** Converts a {@link Document} to a GLB-formatted Uint8Array. */\n\tpublic async writeBinary(doc: Document): Promise<Uint8Array> {\n\t\tconst { json, resources } = await this.writeJSON(doc, { format: Format.GLB });\n\n\t\tconst header = new Uint32Array([0x46546c67, 2, 12]);\n\n\t\tconst jsonText = JSON.stringify(json);\n\t\tconst jsonChunkData = BufferUtils.pad(BufferUtils.encodeText(jsonText), 0x20);\n\t\tconst jsonChunkHeader = BufferUtils.toView(new Uint32Array([jsonChunkData.byteLength, 0x4e4f534a]));\n\t\tconst jsonChunk = BufferUtils.concat([jsonChunkHeader, jsonChunkData]);\n\t\theader[header.length - 1] += jsonChunk.byteLength;\n\n\t\tconst binBuffer = Object.values(resources)[0];\n\t\tif (!binBuffer || !binBuffer.byteLength) {\n\t\t\treturn BufferUtils.concat([BufferUtils.toView(header), jsonChunk]);\n\t\t}\n\n\t\tconst binChunkData = BufferUtils.pad(binBuffer, 0x00);\n\t\tconst binChunkHeader = BufferUtils.toView(new Uint32Array([binChunkData.byteLength, 0x004e4942]));\n\t\tconst binChunk = BufferUtils.concat([binChunkHeader, binChunkData]);\n\t\theader[header.length - 1] += binChunk.byteLength;\n\n\t\treturn BufferUtils.concat([BufferUtils.toView(header), jsonChunk, binChunk]);\n\t}\n\n\t/**********************************************************************************************\n\t * Internal.\n\t */\n\n\t/** @hidden */\n\tprotected detectFormat(uri: string): Format {\n\t\t// Overriden by WebIO, which only uses HTTPUtils.\n\t\tconst extension = HTTPUtils.isAbsoluteURL(uri) ? HTTPUtils.extension(uri) : FileUtils.extension(uri);\n\t\treturn extension === 'glb' ? Format.GLB : Format.GLTF;\n\t}\n\n\tprivate async _readGLTF(uri: string): Promise<JSONDocument> {\n\t\tthis.lastReadBytes = 0;\n\t\tconst jsonContent = await this.readURI(uri, 'text');\n\t\tthis.lastReadBytes += jsonContent.length;\n\t\tconst jsonDoc: JSONDocument = { json: JSON.parse(jsonContent), resources: {} };\n\t\t// Read external resources first, before Data URIs are replaced.\n\t\tawait this._readResourcesExternal(jsonDoc, this.dirname(uri));\n\t\tthis._readResourcesInternal(jsonDoc);\n\t\treturn jsonDoc;\n\t}\n\n\tprivate async _readGLB(uri: string): Promise<JSONDocument> {\n\t\tconst view = await this.readURI(uri, 'view');\n\t\tthis.lastReadBytes = view.byteLength;\n\t\tconst jsonDoc = this._binaryToJSON(view);\n\t\t// Read external resources first, before Data URIs are replaced.\n\t\tawait this._readResourcesExternal(jsonDoc, this.dirname(uri));\n\t\tthis._readResourcesInternal(jsonDoc);\n\t\treturn jsonDoc;\n\t}\n\n\tprivate async _readResourcesExternal(jsonDoc: JSONDocument, base: string): Promise<void> {\n\t\tconst images = jsonDoc.json.images || [];\n\t\tconst buffers = jsonDoc.json.buffers || [];\n\t\tconst pendingResources: Array<Promise<void>> = [...images, ...buffers].map(\n\t\t\tasync (resource: GLTF.IBuffer | GLTF.IImage): Promise<void> => {\n\t\t\t\tconst uri = resource.uri;\n\t\t\t\tif (!uri || uri.match(/data:/)) return Promise.resolve();\n\n\t\t\t\tjsonDoc.resources[uri] = await this.readURI(this.resolve(base, uri), 'view');\n\t\t\t\tthis.lastReadBytes += jsonDoc.resources[uri].byteLength;\n\t\t\t}\n\t\t);\n\t\tawait Promise.all(pendingResources);\n\t}\n\n\tprivate _readResourcesInternal(jsonDoc: JSONDocument): void {\n\t\t// NOTICE: This method may be called more than once during the loading\n\t\t// process (e.g. WebIO.read) and should handle that safely.\n\n\t\tfunction resolveResource(resource: GLTF.IBuffer | GLTF.IImage) {\n\t\t\tif (!resource.uri) return;\n\n\t\t\tif (resource.uri in jsonDoc.resources) {\n\t\t\t\tBufferUtils.assertView(jsonDoc.resources[resource.uri]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (resource.uri.match(/data:/)) {\n\t\t\t\t// Rewrite Data URIs to something short and unique.\n\t\t\t\tconst resourceUUID = `__${uuid()}.${FileUtils.extension(resource.uri)}`;\n\t\t\t\tjsonDoc.resources[resourceUUID] = BufferUtils.createBufferFromDataURI(resource.uri);\n\t\t\t\tresource.uri = resourceUUID;\n\t\t\t}\n\t\t}\n\n\t\t// Unpack images.\n\t\tconst images = jsonDoc.json.images || [];\n\t\timages.forEach((image: GLTF.IImage) => {\n\t\t\tif (image.bufferView === undefined && image.uri === undefined) {\n\t\t\t\tthrow new Error('Missing resource URI or buffer view.');\n\t\t\t}\n\n\t\t\tresolveResource(image);\n\t\t});\n\n\t\t// Unpack buffers.\n\t\tconst buffers = jsonDoc.json.buffers || [];\n\t\tbuffers.forEach(resolveResource);\n\t}\n\n\t/**\n\t * Creates a shallow copy of glTF-formatted {@link JSONDocument}.\n\t *\n\t * Images, Buffers, and Resources objects are deep copies so that PlatformIO can safely\n\t * modify them during the parsing process. Other properties are shallow copies, and buffers\n\t * are passed by reference.\n\t */\n\tprivate _copyJSON(jsonDoc: JSONDocument): JSONDocument {\n\t\tconst { images, buffers } = jsonDoc.json;\n\n\t\tjsonDoc = { json: { ...jsonDoc.json }, resources: { ...jsonDoc.resources } };\n\n\t\tif (images) {\n\t\t\tjsonDoc.json.images = images.map((image) => ({ ...image }));\n\t\t}\n\t\tif (buffers) {\n\t\t\tjsonDoc.json.buffers = buffers.map((buffer) => ({ ...buffer }));\n\t\t}\n\n\t\treturn jsonDoc;\n\t}\n\n\t/** Internal version of binaryToJSON; does not warn about external resources. */\n\tprivate _binaryToJSON(glb: Uint8Array): JSONDocument {\n\t\t// Decode and verify GLB header.\n\t\tconst header = new Uint32Array(glb.buffer, glb.byteOffset, 3);\n\t\tif (header[0] !== 0x46546c67) {\n\t\t\tthrow new Error('Invalid glTF asset.');\n\t\t} else if (header[1] !== 2) {\n\t\t\tthrow new Error(`Unsupported glTF binary version, \"${header[1]}\".`);\n\t\t}\n\n\t\t// Decode JSON chunk.\n\n\t\tconst jsonChunkHeader = new Uint32Array(glb.buffer, glb.byteOffset + 12, 2);\n\t\tif (jsonChunkHeader[1] !== ChunkType.JSON) {\n\t\t\tthrow new Error('Missing required GLB JSON chunk.');\n\t\t}\n\n\t\tconst jsonByteOffset = 20;\n\t\tconst jsonByteLength = jsonChunkHeader[0];\n\t\tconst jsonText = BufferUtils.decodeText(BufferUtils.toView(glb, jsonByteOffset, jsonByteLength));\n\t\tconst json = JSON.parse(jsonText) as GLTF.IGLTF;\n\n\t\t// Decode BIN chunk.\n\n\t\tconst binByteOffset = jsonByteOffset + jsonByteLength;\n\t\tif (glb.byteLength <= binByteOffset) {\n\t\t\treturn { json, resources: {} };\n\t\t}\n\n\t\tconst binChunkHeader = new Uint32Array(glb.buffer, glb.byteOffset + binByteOffset, 2);\n\t\tif (binChunkHeader[1] !== ChunkType.BIN) {\n\t\t\tthrow new Error('Expected GLB BIN in second chunk.');\n\t\t}\n\n\t\tconst binByteLength = binChunkHeader[0];\n\t\tconst binBuffer = BufferUtils.toView(glb, binByteOffset + 8, binByteLength);\n\n\t\treturn { json, resources: { [GLB_BUFFER]: binBuffer } };\n\t}\n}\n\nfunction isExternalBuffer(jsonDocument: JSONDocument, bufferDef: GLTF.IBuffer): boolean {\n\treturn bufferDef.uri !== undefined && !(bufferDef.uri in jsonDocument.resources);\n}\n\nfunction isExternalImage(jsonDocument: JSONDocument, imageDef: GLTF.IImage): boolean {\n\treturn imageDef.uri !== undefined && !(imageDef.uri in jsonDocument.resources) && imageDef.bufferView === undefined;\n}\n","import { PlatformIO } from './platform-io';\n\ninterface Path {\n\tresolve(base: string, path: string): string;\n\tdirname(uri: string): string;\n}\n\n/**\n * # DenoIO\n *\n * *I/O service for [Deno](https://deno.land/).*\n *\n * The most common use of the I/O service is to read/write a {@link Document} with a given path.\n * Methods are also available for converting in-memory representations of raw glTF files, both\n * binary (*Uint8Array*) and JSON ({@link JSONDocument}).\n *\n * _*NOTICE:* Support for the Deno environment is currently experimental. See\n * [glTF-Transform#457](https://github.com/donmccurdy/glTF-Transform/issues/457)._\n *\n * Usage:\n *\n * ```typescript\n * import { DenoIO } from 'https://esm.sh/@gltf-transform/core';\n * import * as path from 'https://deno.land/std/path/mod.ts';\n *\n * const io = new DenoIO(path);\n *\n * // Read.\n * let document;\n * document = io.read('model.glb');  //  Document\n * document = io.readBinary(glb);    // Uint8Array  Document\n *\n * // Write.\n * const glb = io.writeBinary(document);  // Document  Uint8Array\n * ```\n *\n * @category I/O\n */\nexport class DenoIO extends PlatformIO {\n\tprivate _path: Path;\n\n\tconstructor(path: unknown) {\n\t\tsuper();\n\t\tthis._path = path as Path;\n\t}\n\n\tprotected async readURI(uri: string, type: 'view'): Promise<Uint8Array>;\n\tprotected async readURI(uri: string, type: 'text'): Promise<string>;\n\tprotected async readURI(uri: string, type: 'view' | 'text'): Promise<Uint8Array | string> {\n\t\t// TODO(cleanup): The @ts-ignore rules below are necessary for typedoc, but not for normal\n\t\t// compilation with microbundle. Clean this up when possible.\n\t\tswitch (type) {\n\t\t\tcase 'view':\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t\t\t// @ts-ignore\n\t\t\t\treturn Deno.readFile(uri);\n\t\t\tcase 'text':\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t\t\t// @ts-ignore\n\t\t\t\treturn Deno.readTextFile(uri);\n\t\t}\n\t}\n\n\tprotected resolve(base: string, path: string): string {\n\t\treturn this._path.resolve(base, path);\n\t}\n\n\tprotected dirname(uri: string): string {\n\t\treturn this._path.dirname(uri);\n\t}\n}\n","import { PlatformIO } from './platform-io';\nimport { HTTPUtils } from '../utils';\nimport { Format } from '../constants';\n\n/**\n * # WebIO\n *\n * *I/O service for Web.*\n *\n * The most common use of the I/O service is to read/write a {@link Document} with a given path.\n * Methods are also available for converting in-memory representations of raw glTF files, both\n * binary (*Uint8Array*) and JSON ({@link JSONDocument}).\n *\n * Usage:\n *\n * ```typescript\n * import { WebIO } from '@gltf-transform/core';\n *\n * const io = new WebIO({credentials: 'include'});\n *\n * // Read.\n * let document;\n * document = await io.read('model.glb');  //  Document\n * document = await io.readBinary(glb);    // Uint8Array  Document\n *\n * // Write.\n * const glb = await io.writeBinary(document); // Document  Uint8Array\n * ```\n *\n * @category I/O\n */\nexport class WebIO extends PlatformIO {\n\tprivate readonly _fetchConfig: RequestInit;\n\n\t/**\n\t * Constructs a new WebIO service. Instances are reusable.\n\t * @param fetchConfig Configuration object for Fetch API.\n\t */\n\tconstructor(fetchConfig = HTTPUtils.DEFAULT_INIT) {\n\t\tsuper();\n\t\tthis._fetchConfig = fetchConfig;\n\t}\n\n\tprotected async readURI(uri: string, type: 'view'): Promise<Uint8Array>;\n\tprotected async readURI(uri: string, type: 'text'): Promise<string>;\n\tprotected async readURI(uri: string, type: 'view' | 'text'): Promise<Uint8Array | string> {\n\t\tconst response = await fetch(uri, this._fetchConfig);\n\t\tswitch (type) {\n\t\t\tcase 'view':\n\t\t\t\treturn new Uint8Array(await response.arrayBuffer());\n\t\t\tcase 'text':\n\t\t\t\treturn response.text();\n\t\t}\n\t}\n\n\tprotected resolve(base: string, path: string): string {\n\t\treturn HTTPUtils.resolve(base, path);\n\t}\n\n\tprotected dirname(uri: string): string {\n\t\treturn HTTPUtils.dirname(uri);\n\t}\n\n\t/** @hidden */\n\tprotected detectFormat(uri: string): Format {\n\t\treturn HTTPUtils.extension(uri) === 'glb' ? Format.GLB : Format.GLTF;\n\t}\n}\n","///////////////////////////////////////////////////\n// Common.\n///////////////////////////////////////////////////\n\n// Injected at compile time, from $npm_package_version.\ndeclare const PACKAGE_VERSION: string;\n\nexport const KTX_WRITER = `KTX-Parse v${PACKAGE_VERSION}`;\n\nexport const NUL = new Uint8Array([0x00]);\n\n\n///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\n\nexport const KTX2_ID = [\n\t// '', 'K', 'T', 'X', '2', '0', '', '\\r', '\\n', '\\x1A', '\\n'\n\t0xAB, 0x4B, 0x54, 0x58, 0x20, 0x32, 0x30, 0xBB, 0x0D, 0x0A, 0x1A, 0x0A\n];\n\nexport const HEADER_BYTE_LENGTH = 68; // 13 * 4 + 2 * 8\n\n\n///////////////////////////////////////////////////\n// Data Format Descriptor (DFD).\n///////////////////////////////////////////////////\n\nexport const KHR_DF_VENDORID_KHRONOS = 0;\nexport const KHR_DF_VERSION = 2;\nexport const KHR_DF_BLOCKSIZE = 40;\nexport const VK_FORMAT_UNDEFINED = 0;\n","/**\n * Enums.\n */\n\n///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\n\nexport enum KTX2SupercompressionScheme {\n\tNONE = 0,\n\tBASISLZ = 1,\n\tZSTD = 2,\n\tZLIB = 3,\n};\n\n\n///////////////////////////////////////////////////\n// Data Format Descriptor (DFD).\n///////////////////////////////////////////////////\n\nexport enum KTX2DescriptorType {\n\tBASICFORMAT = 0x00,\n};\n\nexport enum KTX2Model {\n\tUNSPECIFIED = 0,\n\tETC1S = 163,\n\tUASTC = 166,\n};\n\nexport enum KTX2Primaries {\n\tUNSPECIFIED = 0,\n\tSRGB = 1,\n};\n\nexport enum KTX2Transfer {\n\tUNSPECIFIED = 0,\n\tLINEAR = 1,\n\tSRGB = 2,\n\tITU = 3,\n\tNTSC = 4,\n\tSLOG = 5,\n\tSLOG2 = 6,\n};\n\nexport enum KTX2Flags {\n\tALPHA_STRAIGHT = 0,\n\tALPHA_PREMULTIPLIED = 1,\n};\n\nexport enum KTX2ChannelETC1S {\n\tRGB = 0,\n\tRRR = 3,\n\tGGG = 4,\n\tAAA = 15,\n};\n\nexport enum KTX2ChannelUASTC {\n\tRGB = 0,\n\tRGBA = 3,\n\tRRR = 4,\n\tRRRG = 5,\n};\n","import { KHR_DF_BLOCKSIZE, KHR_DF_VENDORID_KHRONOS, KHR_DF_VERSION, VK_FORMAT_UNDEFINED } from './constants';\nimport { KTX2DescriptorType, KTX2Flags, KTX2Model, KTX2Primaries, KTX2SupercompressionScheme } from './enums';\n\n/**\n * Represents an unpacked KTX 2.0 texture container. Data for individual mip levels are stored in\n * the `.levels` array, typically compressed in Basis Universal formats. Additional properties\n * provide metadata required to process, transcode, and upload these textures.\n */\nexport class KTX2Container {\n\t/**\n\t * Specifies the image format using Vulkan VkFormat enum values. When using Basis Universal\n\t * texture formats, `vkFormat` must be VK_FORMAT_UNDEFINED.\n\t */\n\tpublic vkFormat = VK_FORMAT_UNDEFINED;\n\n\t/**\n\t * Size of the data type in bytes used to upload the data to a graphics API. When `vkFormat` is\n\t * VK_FORMAT_UNDEFINED, `typeSize` must be 1.\n\t */\n\tpublic typeSize: number = 1;\n\n\t/** Width of the texture image for level 0, in pixels. */\n\tpublic pixelWidth: number = 0;\n\n\t/** Height of the texture image for level 0, in pixels. */\n\tpublic pixelHeight: number = 0;\n\n\t/** Depth of the texture image for level 0, in pixels (3D textures only). */\n\tpublic pixelDepth: number = 0;\n\n\t/** Number of array elements (array textures only). */\n\tpublic layerCount: number = 0;\n\n\t/**\n\t * Number of cubemap faces. For cubemaps and cubemap arrays, `faceCount` must be 6. For all\n\t * other textures, `faceCount` must be 1. Cubemap faces are stored in +X, -X, +Y, -Y, +Z, -Z\n\t * order.\n\t */\n\tpublic faceCount: number = 1;\n\n\t/** Indicates which supercompression scheme has been applied to mip level images, if any. */\n\tpublic supercompressionScheme = KTX2SupercompressionScheme.NONE;\n\n\t/** Mip levels, ordered largest (original) to smallest (~1px). */\n\tpublic levels: KTX2Level[] = [];\n\n\t/** Data Format Descriptor. */\n\tpublic dataFormatDescriptor: KTX2DataFormatDescriptorBasicFormat[] = [{\n\t\tvendorId: KHR_DF_VENDORID_KHRONOS,\n\t\tdescriptorType: KTX2DescriptorType.BASICFORMAT,\n\t\tversionNumber: KHR_DF_VERSION,\n\t\tdescriptorBlockSize: KHR_DF_BLOCKSIZE,\n\t\tcolorModel: KTX2Model.UNSPECIFIED,\n\t\tcolorPrimaries: KTX2Primaries.SRGB,\n\t\ttransferFunction: KTX2Primaries.SRGB,\n\t\tflags: KTX2Flags.ALPHA_STRAIGHT,\n\t\ttexelBlockDimension: {x: 4, y: 4, z: 1, w: 1},\n\t\tbytesPlane: [],\n\t\tsamples: [],\n\t}];\n\n\t/** Key/Value Data. */\n\tpublic keyValue: {[key: string]: string | Uint8Array} = {};\n\n\t/** Supercompression Global Data. */\n\tpublic globalData: KTX2GlobalDataBasisLZ | null = null;\n}\n\n\n///////////////////////////////////////////////////\n// Mip Levels.\n///////////////////////////////////////////////////\n\nexport interface KTX2Level {\n\t/** Compressed data of the mip level. */\n\tlevelData: Uint8Array;\n\n\t/**\n\t * Size of the mip level after reflation from supercompression, if applicable. When\n\t * `supercompressionType` is BASISLZ, `uncompressedByteLength` must be 0. When\n\t * `supercompressionType` is `NONE`, `uncompressedByteLength` must match the `levelData` byte\n\t * length.\n\t *\n\t * _**NOTICE:** this implies that for formats such as UASTC, `uncompressedByteLength` may\n\t * indicate size after ZSTD reflation (and of transcoded ASTC data), but does _not_ indicate\n\t * size of decoded RGBA32 pixels._\n\t */\n\tuncompressedByteLength: number;\n};\n\n\n///////////////////////////////////////////////////\n// Data Format Descriptor (DFD).\n///////////////////////////////////////////////////\n\nexport interface KTX2DataFormatDescriptorBasicFormat {\n\tvendorId: number;\n\tdescriptorType: number;\n\tversionNumber: number;\n\tdescriptorBlockSize: number;\n\tcolorModel: number;\n\tcolorPrimaries: number;\n\ttransferFunction: number;\n\tflags: number;\n\ttexelBlockDimension: KTX2BasicFormatTexelBlockDimensions;\n\tbytesPlane: number[];\n\tsamples: KTX2BasicFormatSample[],\n};\n\nexport interface KTX2BasicFormatTexelBlockDimensions {\n\tx: number;\n\ty: number;\n\tz: number;\n\tw: number;\n};\n\nexport interface KTX2BasicFormatSample {\n\tbitOffset: number;\n\tbitLength: number;\n\tchannelID: number;\n\tsamplePosition: number[];\n\tsampleLower: number;\n\tsampleUpper: number;\n};\n\n\n///////////////////////////////////////////////////\n// Supercompression Global Data.\n///////////////////////////////////////////////////\n\nexport interface KTX2GlobalDataBasisLZ {\n\tendpointCount: number;\n\tselectorCount: number;\n\timageDescs: KTX2GlobalDataBasisLZImageDesc[];\n\tendpointsData: Uint8Array;\n\tselectorsData: Uint8Array;\n\ttablesData: Uint8Array;\n\textendedData: Uint8Array;\n};\n\ninterface KTX2GlobalDataBasisLZImageDesc {\n\timageFlags: number;\n\trgbSliceByteOffset: number;\n\trgbSliceByteLength: number;\n\talphaSliceByteOffset: number;\n\talphaSliceByteLength: number;\n};\n","export class BufferReader {\n\tprivate _dataView: DataView;\n\tprivate _littleEndian: boolean;\n\tpublic _offset: number;\n\n\tconstructor(data: Uint8Array, byteOffset: number, byteLength: number, littleEndian: boolean) {\n\t\tthis._dataView = new DataView(data.buffer, data.byteOffset + byteOffset, byteLength);\n\t\tthis._littleEndian = littleEndian;\n\t\tthis._offset = 0;\n\t}\n\n\t_nextUint8() {\n\t\tconst value = this._dataView.getUint8(this._offset);\n\t\tthis._offset += 1;\n\t\treturn value;\n\t}\n\n\t_nextUint16() {\n\t\tconst value = this._dataView.getUint16(this._offset, this._littleEndian);\n\t\tthis._offset += 2;\n\t\treturn value;\n\t}\n\n\t_nextUint32() {\n\t\tconst value = this._dataView.getUint32(this._offset, this._littleEndian);\n\t\tthis._offset += 4;\n\t\treturn value;\n\t}\n\n\t_nextUint64() {\n\t\tconst left = this._dataView.getUint32(this._offset, this._littleEndian);\n\t\tconst right = this._dataView.getUint32(this._offset + 4, this._littleEndian);\n\t\t// TODO(cleanup): Just test this...\n\t\t// const value = this._littleEndian ? left + (2 ** 32 * right) : (2 ** 32 * left) + right;\n\t\tconst value = left + (2 ** 32 * right);\n\t\tthis._offset += 8;\n\t\treturn value;\n\t}\n\n\t_skip(bytes: number) {\n\t\tthis._offset += bytes;\n\t\treturn this;\n\t}\n\n\t_scan(maxByteLength: number, term: number = 0x00): Uint8Array {\n\t\tconst byteOffset = this._offset;\n\t\tlet byteLength = 0;\n\t\twhile (this._dataView.getUint8(this._offset) !== term && byteLength < maxByteLength) {\n\t\t\tbyteLength++;\n\t\t\tthis._offset++;\n\t\t}\n\n\t\tif (byteLength < maxByteLength) this._offset++;\n\n\t\treturn new Uint8Array(\n\t\t\tthis._dataView.buffer,\n\t\t\tthis._dataView.byteOffset + byteOffset,\n\t\t\tbyteLength\n\t\t);\n\t}\n}\n","\n/** Encodes text to an ArrayBuffer. */\nexport function encodeText(text: string): Uint8Array {\n\tif (typeof TextEncoder !== 'undefined') {\n\t\treturn new TextEncoder().encode(text);\n\t}\n\treturn Buffer.from(text);\n}\n\n/** Decodes an ArrayBuffer to text. */\nexport function decodeText(buffer: Uint8Array): string {\n\tif (typeof TextDecoder !== 'undefined') {\n\t\treturn new TextDecoder().decode(buffer);\n\t}\n\treturn Buffer.from(buffer).toString('utf8');\n}\n\n/** Concatenates N ArrayBuffers. */\nexport function concat (buffers: (ArrayBuffer | Uint8Array)[]): Uint8Array {\n\tlet totalByteLength = 0;\n\tfor (const buffer of buffers) {\n\t\ttotalByteLength += buffer.byteLength;\n\t}\n\n\tconst result = new Uint8Array(totalByteLength);\n\tlet byteOffset = 0;\n\n\tfor (const buffer of buffers) {\n\t\tresult.set(new Uint8Array(buffer), byteOffset);\n\t\tbyteOffset += buffer.byteLength;\n\t}\n\n\treturn result;\n}","import { BufferReader } from './buffer-reader';\nimport { KTX2_ID } from './constants';\nimport { KTX2Container, KTX2DataFormatDescriptorBasicFormat } from './container';\nimport { decodeText } from './util';\n\n/**\n * Parses a KTX 2.0 file, returning an unpacked {@link KTX2Container} instance with all associated\n * data. The container's mip levels and other binary data are pointers into the original file, not\n * copies, so the original file should not be overwritten after reading.\n *\n * @param data Bytes of KTX 2.0 file, as Uint8Array or Buffer.\n */\nexport function read(data: Uint8Array): KTX2Container {\n\n\t///////////////////////////////////////////////////\n\t// KTX 2.0 Identifier.\n\t///////////////////////////////////////////////////\n\n\tconst id = new Uint8Array(data.buffer, data.byteOffset, KTX2_ID.length);\n\tif (id[0] !== KTX2_ID[0] || // ''\n\t\tid[1] !== KTX2_ID[1] || // 'K'\n\t\tid[2] !== KTX2_ID[2] || // 'T'\n\t\tid[3] !== KTX2_ID[3] || // 'X'\n\t\tid[4] !== KTX2_ID[4] || // ' '\n\t\tid[5] !== KTX2_ID[5] || // '2'\n\t\tid[6] !== KTX2_ID[6] || // '0'\n\t\tid[7] !== KTX2_ID[7] || // ''\n\t\tid[8] !== KTX2_ID[8] || // '\\r'\n\t\tid[9] !== KTX2_ID[9] || // '\\n'\n\t\tid[10] !== KTX2_ID[10] || // '\\x1A'\n\t\tid[11] !== KTX2_ID[11] // '\\n'\n\t) {\n\t\tthrow new Error('Missing KTX 2.0 identifier.');\n\t}\n\n\tconst container = new KTX2Container();\n\n\t///////////////////////////////////////////////////\n\t// Header.\n\t///////////////////////////////////////////////////\n\n\tconst headerByteLength = 17 * Uint32Array.BYTES_PER_ELEMENT;\n\tconst headerReader = new BufferReader(data, KTX2_ID.length, headerByteLength, true);\n\n\tcontainer.vkFormat = headerReader._nextUint32();\n\tcontainer.typeSize = headerReader._nextUint32();\n\tcontainer.pixelWidth = headerReader._nextUint32();\n\tcontainer.pixelHeight = headerReader._nextUint32();\n\tcontainer.pixelDepth = headerReader._nextUint32();\n\tcontainer.layerCount = headerReader._nextUint32();\n\tcontainer.faceCount = headerReader._nextUint32();\n\n\tconst levelCount = headerReader._nextUint32();\n\n\tcontainer.supercompressionScheme = headerReader._nextUint32();\n\n\tconst dfdByteOffset = headerReader._nextUint32();\n\tconst dfdByteLength = headerReader._nextUint32();\n\tconst kvdByteOffset = headerReader._nextUint32();\n\tconst kvdByteLength = headerReader._nextUint32();\n\tconst sgdByteOffset = headerReader._nextUint64();\n\tconst sgdByteLength = headerReader._nextUint64();\n\n\t///////////////////////////////////////////////////\n\t// Level Index.\n\t///////////////////////////////////////////////////\n\n\tconst levelByteLength = levelCount * 3 * 8;\n\tconst levelReader = new BufferReader(data, KTX2_ID.length + headerByteLength, levelByteLength, true);\n\n\tfor (let i = 0; i < levelCount; i ++) {\n\t\tcontainer.levels.push({\n\t\t\tlevelData: new Uint8Array(data.buffer, data.byteOffset + levelReader._nextUint64(), levelReader._nextUint64()),\n\t\t\tuncompressedByteLength: levelReader._nextUint64(),\n\t\t});\n\t}\n\n\n\t///////////////////////////////////////////////////\n\t// Data Format Descriptor (DFD).\n\t///////////////////////////////////////////////////\n\n\tconst dfdReader = new BufferReader(data, dfdByteOffset, dfdByteLength, true);\n\n\tconst dfd: KTX2DataFormatDescriptorBasicFormat = {\n\t\tvendorId: dfdReader._skip(4 /* totalSize */)._nextUint16(),\n\t\tdescriptorType: dfdReader._nextUint16(),\n\t\tversionNumber: dfdReader._nextUint16(),\n\t\tdescriptorBlockSize: dfdReader._nextUint16(),\n\t\tcolorModel: dfdReader._nextUint8(),\n\t\tcolorPrimaries: dfdReader._nextUint8(),\n\t\ttransferFunction: dfdReader._nextUint8(),\n\t\tflags: dfdReader._nextUint8(),\n\t\ttexelBlockDimension: {\n\t\t\tx: dfdReader._nextUint8() + 1,\n\t\t\ty: dfdReader._nextUint8() + 1,\n\t\t\tz: dfdReader._nextUint8() + 1,\n\t\t\tw: dfdReader._nextUint8() + 1,\n\t\t},\n\t\tbytesPlane: [\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t\tdfdReader._nextUint8(),\n\t\t],\n\t\tsamples: [],\n\t};\n\n\tconst sampleStart = 6;\n\tconst sampleWords = 4;\n\tconst numSamples = (dfd.descriptorBlockSize / 4 - sampleStart) / sampleWords;\n\n\tfor (let i = 0; i < numSamples; i ++) {\n\t\tdfd.samples[ i ] = {\n\t\t\tbitOffset: dfdReader._nextUint16(),\n\t\t\tbitLength: dfdReader._nextUint8(),\n\t\t\tchannelID: dfdReader._nextUint8(),\n\t\t\tsamplePosition: [\n\t\t\t\tdfdReader._nextUint8(),\n\t\t\t\tdfdReader._nextUint8(),\n\t\t\t\tdfdReader._nextUint8(),\n\t\t\t\tdfdReader._nextUint8(),\n\t\t\t],\n\t\t\tsampleLower: dfdReader._nextUint32(),\n\t\t\tsampleUpper: dfdReader._nextUint32(),\n\t\t};\n\t}\n\n\tcontainer.dataFormatDescriptor.length = 0;\n\tcontainer.dataFormatDescriptor.push(dfd);\n\n\n\t///////////////////////////////////////////////////\n\t// Key/Value Data (KVD).\n\t///////////////////////////////////////////////////\n\n\tconst kvdReader = new BufferReader(data, kvdByteOffset, kvdByteLength, true);\n\n\twhile (kvdReader._offset < kvdByteLength) {\n\t\tconst keyValueByteLength = kvdReader._nextUint32();\n\t\tconst keyData = kvdReader._scan(keyValueByteLength);\n\t\tconst key = decodeText(keyData);\n\n\t\tconst valueData = kvdReader._scan(keyValueByteLength - keyData.byteLength);\n\t\tcontainer.keyValue[key] = key.match(/^ktx/i) ? decodeText(valueData) : valueData;\n\n\t\t// 4-byte alignment.\n\t\tif (kvdReader._offset % 4) kvdReader._skip(4 - (kvdReader._offset % 4));\n\t}\n\n\n\t///////////////////////////////////////////////////\n\t// Supercompression Global Data (SGD).\n\t///////////////////////////////////////////////////\n\n\tif (sgdByteLength <= 0) return container;\n\n\tconst sgdReader = new BufferReader(data, sgdByteOffset, sgdByteLength, true);\n\n\tconst endpointCount = sgdReader._nextUint16();\n\tconst selectorCount = sgdReader._nextUint16();\n\tconst endpointsByteLength = sgdReader._nextUint32();\n\tconst selectorsByteLength = sgdReader._nextUint32();\n\tconst tablesByteLength = sgdReader._nextUint32();\n\tconst extendedByteLength = sgdReader._nextUint32();\n\n\tconst imageDescs = [];\n\tfor (let i = 0; i < levelCount; i ++) {\n\t\timageDescs.push({\n\t\t\timageFlags: sgdReader._nextUint32(),\n\t\t\trgbSliceByteOffset: sgdReader._nextUint32(),\n\t\t\trgbSliceByteLength: sgdReader._nextUint32(),\n\t\t\talphaSliceByteOffset: sgdReader._nextUint32(),\n\t\t\talphaSliceByteLength: sgdReader._nextUint32(),\n\t\t});\n\t}\n\n\tconst endpointsByteOffset = sgdByteOffset + sgdReader._offset;\n\tconst selectorsByteOffset = endpointsByteOffset + endpointsByteLength;\n\tconst tablesByteOffset = selectorsByteOffset + selectorsByteLength;\n\tconst extendedByteOffset = tablesByteOffset + tablesByteLength;\n\n\tconst endpointsData = new Uint8Array(data.buffer, data.byteOffset + endpointsByteOffset, endpointsByteLength);\n\tconst selectorsData = new Uint8Array(data.buffer, data.byteOffset + selectorsByteOffset, selectorsByteLength);\n\tconst tablesData = new Uint8Array(data.buffer, data.byteOffset + tablesByteOffset, tablesByteLength);\n\tconst extendedData = new Uint8Array(data.buffer, data.byteOffset + extendedByteOffset, extendedByteLength);\n\n\tcontainer.globalData = {\n\t\tendpointCount,\n\t\tselectorCount,\n\t\timageDescs,\n\t\tendpointsData,\n\t\tselectorsData,\n\t\ttablesData,\n\t\textendedData,\n\t};\n\n\treturn container;\n}\n","import { Accessor, ExtensionProperty, IProperty, Nullable, PropertyType } from '@gltf-transform/core';\r\nimport { EXT_MESH_GPU_INSTANCING } from '../constants';\r\n\r\ninterface IInstancedMesh extends IProperty {\r\n\tattributes: { [key: string]: Accessor };\r\n}\r\n\r\n// See BufferViewUsage in `writer-context.ts`.\r\nexport const INSTANCE_ATTRIBUTE = 'INSTANCE_ATTRIBUTE';\r\n\r\n/**\r\n * # InstancedMesh\r\n *\r\n * Defines GPU instances of a {@link Mesh} under one {@link Node}. See {@link MeshGPUInstancing}.\r\n */\r\nexport class InstancedMesh extends ExtensionProperty<IInstancedMesh> {\r\n\tpublic static EXTENSION_NAME = EXT_MESH_GPU_INSTANCING;\r\n\tpublic declare extensionName: typeof EXT_MESH_GPU_INSTANCING;\r\n\tpublic declare propertyType: 'InstancedMesh';\r\n\tpublic declare parentTypes: [PropertyType.NODE];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = EXT_MESH_GPU_INSTANCING;\r\n\t\tthis.propertyType = 'InstancedMesh';\r\n\t\tthis.parentTypes = [PropertyType.NODE];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IInstancedMesh> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, { attributes: {} });\r\n\t}\r\n\r\n\t/** Returns an instance attribute as an {@link Accessor}. */\r\n\tpublic getAttribute(semantic: string): Accessor | null {\r\n\t\treturn this.getRefMap('attributes', semantic);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets an instance attribute to an {@link Accessor}. All attributes must have the same\r\n\t * instance count.\r\n\t */\r\n\tpublic setAttribute(semantic: string, accessor: Accessor | null): this {\r\n\t\treturn this.setRefMap('attributes', semantic, accessor, { usage: INSTANCE_ATTRIBUTE });\r\n\t}\r\n\r\n\t/**\r\n\t * Lists all instance attributes {@link Accessor}s associated with the InstancedMesh. Order\r\n\t * will be consistent with the order returned by {@link .listSemantics}().\r\n\t */\r\n\tpublic listAttributes(): Accessor[] {\r\n\t\treturn this.listRefMapValues('attributes');\r\n\t}\r\n\r\n\t/**\r\n\t * Lists all instance attribute semantics associated with the primitive. Order will be\r\n\t * consistent with the order returned by {@link .listAttributes}().\r\n\t */\r\n\tpublic listSemantics(): string[] {\r\n\t\treturn this.listRefMapKeys('attributes');\r\n\t}\r\n}\r\n","export const EXT_MESH_GPU_INSTANCING = 'EXT_mesh_gpu_instancing';\r\nexport const EXT_MESHOPT_COMPRESSION = 'EXT_meshopt_compression';\r\nexport const EXT_TEXTURE_WEBP = 'EXT_texture_webp';\r\nexport const KHR_DRACO_MESH_COMPRESSION = 'KHR_draco_mesh_compression';\r\nexport const KHR_LIGHTS_PUNCTUAL = 'KHR_lights_punctual';\r\nexport const KHR_MATERIALS_ANISOTROPY = 'KHR_materials_anisotropy';\r\nexport const KHR_MATERIALS_CLEARCOAT = 'KHR_materials_clearcoat';\r\nexport const KHR_MATERIALS_EMISSIVE_STRENGTH = 'KHR_materials_emissive_strength';\r\nexport const KHR_MATERIALS_IOR = 'KHR_materials_ior';\r\nexport const KHR_MATERIALS_IRIDESCENCE = 'KHR_materials_iridescence';\r\nexport const KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS = 'KHR_materials_pbrSpecularGlossiness';\r\nexport const KHR_MATERIALS_SHEEN = 'KHR_materials_sheen';\r\nexport const KHR_MATERIALS_SPECULAR = 'KHR_materials_specular';\r\nexport const KHR_MATERIALS_TRANSLUCENCY = 'KHR_materials_translucency';\r\nexport const KHR_MATERIALS_TRANSMISSION = 'KHR_materials_transmission';\r\nexport const KHR_MATERIALS_UNLIT = 'KHR_materials_unlit';\r\nexport const KHR_MATERIALS_VOLUME = 'KHR_materials_volume';\r\nexport const KHR_MATERIALS_VARIANTS = 'KHR_materials_variants';\r\nexport const KHR_MESH_QUANTIZATION = 'KHR_mesh_quantization';\r\nexport const KHR_TEXTURE_BASISU = 'KHR_texture_basisu';\r\nexport const KHR_TEXTURE_TRANSFORM = 'KHR_texture_transform';\r\nexport const KHR_XMP_JSON_LD = 'KHR_xmp_json_ld';\r\n","import { Extension, PropertyType, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { EXT_MESH_GPU_INSTANCING } from '../constants';\r\nimport { InstancedMesh, INSTANCE_ATTRIBUTE } from './instanced-mesh';\r\n\r\nconst NAME = EXT_MESH_GPU_INSTANCING;\r\n\r\ninterface InstancedMeshDef {\r\n\tattributes: {\r\n\t\t[name: string]: number;\r\n\t};\r\n}\r\n\r\n/**\r\n * # MeshGPUInstancing\r\n *\r\n * [`EXT_mesh_gpu_instancing`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing/)\r\n * prepares mesh data for efficient GPU instancing.\r\n *\r\n * [[include:VENDOR_EXTENSIONS_NOTE.md]]\r\n *\r\n * GPU instancing allows engines to render many copies of a single mesh at once using a small number\r\n * of draw calls. Instancing is particularly useful for things like trees, grass, road signs, etc.\r\n * Keep in mind that predefined batches, as used in this extension, may prevent frustum culling\r\n * within a batch. Dividing batches into collocated cells may be preferable to using a single large\r\n * batch.\r\n *\r\n * > _**NOTICE:** While this extension stores mesh data optimized for GPU instancing, it\r\n * > is important to note that (1) GPU instancing and other optimizations are possible  and\r\n * > encouraged  even without this extension, and (2) other common meanings of the term\r\n * > \"instancing\" exist, distinct from this extension. See\r\n * > [Appendix: Motivation and Purpose](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing#appendix-motivation-and-purpose)\r\n * > of the `EXT_mesh_gpu_instancing` specification._\r\n *\r\n * Properties:\r\n * - {@link InstancedMesh}\r\n *\r\n * ### Example\r\n *\r\n * The `MeshGPUInstancing` class provides a single {@link ExtensionProperty} type, `InstancedMesh`,\r\n * which may be attached to any {@link Node} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MeshGPUInstancing } from '@gltf-transform/extensions';\r\n *\r\n * // Create standard mesh, node, and scene hierarchy.\r\n * // ...\r\n *\r\n * // Assign positions for each instance.\r\n * const batchPositions = doc.createAccessor('instance_positions')\r\n * \t.setArray(new Float32Array([\r\n * \t\t0, 0, 0,\r\n * \t\t1, 0, 0,\r\n * \t\t2, 0, 0,\r\n * \t]))\r\n * \t.setType(Accessor.Type.VEC3)\r\n * \t.setBuffer(buffer);\r\n *\r\n * // Assign IDs for each instance.\r\n * const batchIDs = doc.createAccessor('instance_ids')\r\n * \t.setArray(new Uint8Array([0, 1, 2]))\r\n * \t.setType(Accessor.Type.SCALAR)\r\n * \t.setBuffer(buffer);\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const batchExtension = document.createExtension(MeshGPUInstancing)\r\n * \t.setRequired(true);\r\n * const batch = batchExtension.createInstancedMesh()\r\n * \t.setAttribute('TRANSLATION', batchPositions)\r\n * \t.setAttribute('_ID', batchIDs);\r\n *\r\n * node\r\n * \t.setMesh(mesh)\r\n * \t.setExtension('EXT_mesh_gpu_instancing', batch);\r\n * ```\r\n *\r\n * Standard instance attributes are `TRANSLATION`, `ROTATION`, and `SCALE`, and support the accessor\r\n * types allowed by the extension specification. Custom instance attributes are allowed, and should\r\n * be prefixed with an underscore (`_*`).\r\n */\r\nexport class MeshGPUInstancing extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\t/** @hidden */\r\n\tpublic readonly provideTypes = [PropertyType.NODE];\r\n\t/** @hidden */\r\n\tpublic readonly prewriteTypes = [PropertyType.ACCESSOR];\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new InstancedMesh property for use on a {@link Node}. */\r\n\tpublic createInstancedMesh(): InstancedMesh {\r\n\t\treturn new InstancedMesh(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tconst nodeDefs = jsonDoc.json.nodes || [];\r\n\t\tnodeDefs.forEach((nodeDef, nodeIndex) => {\r\n\t\t\tif (!nodeDef.extensions || !nodeDef.extensions[NAME]) return;\r\n\r\n\t\t\tconst instancedMeshDef = nodeDef.extensions[NAME] as InstancedMeshDef;\r\n\t\t\tconst instancedMesh = this.createInstancedMesh();\r\n\r\n\t\t\tfor (const semantic in instancedMeshDef.attributes) {\r\n\t\t\t\tinstancedMesh.setAttribute(semantic, context.accessors[instancedMeshDef.attributes[semantic]]);\r\n\t\t\t}\r\n\r\n\t\t\tcontext.nodes[nodeIndex].setExtension(NAME, instancedMesh);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic prewrite(context: WriterContext): this {\r\n\t\t// Set usage for instance attribute accessors, so they are stored in separate buffer\r\n\t\t// views grouped by parent reference.\r\n\t\tcontext.accessorUsageGroupedByParent.add(INSTANCE_ATTRIBUTE);\r\n\t\tfor (const prop of this.properties) {\r\n\t\t\tfor (const attribute of (prop as InstancedMesh).listAttributes()) {\r\n\t\t\t\tcontext.addAccessorToUsageGroup(attribute, INSTANCE_ATTRIBUTE);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listNodes()\r\n\t\t\t.forEach((node) => {\r\n\t\t\t\tconst instancedMesh = node.getExtension<InstancedMesh>(NAME);\r\n\t\t\t\tif (instancedMesh) {\r\n\t\t\t\t\tconst nodeIndex = context.nodeIndexMap.get(node)!;\r\n\t\t\t\t\tconst nodeDef = jsonDoc.json.nodes![nodeIndex];\r\n\r\n\t\t\t\t\tconst instancedMeshDef = { attributes: {} } as InstancedMeshDef;\r\n\r\n\t\t\t\t\tinstancedMesh.listSemantics().forEach((semantic) => {\r\n\t\t\t\t\t\tconst attribute = instancedMesh.getAttribute(semantic)!;\r\n\t\t\t\t\t\tinstancedMeshDef.attributes[semantic] = context.accessorIndexMap.get(attribute)!;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tnodeDef.extensions = nodeDef.extensions || {};\r\n\t\t\t\t\tnodeDef.extensions[NAME] = instancedMeshDef;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import type { GLTF, TypedArray } from '@gltf-transform/core';\r\n\r\nexport enum EncoderMethod {\r\n\tQUANTIZE = 'quantize',\r\n\tFILTER = 'filter',\r\n}\r\n\r\nexport interface MeshoptBufferExtension {\r\n\tfallback?: boolean;\r\n}\r\n\r\nexport enum MeshoptMode {\r\n\tATTRIBUTES = 'ATTRIBUTES',\r\n\tTRIANGLES = 'TRIANGLES',\r\n\tINDICES = 'INDICES',\r\n}\r\n\r\nexport enum MeshoptFilter {\r\n\tNONE = 'NONE',\r\n\tOCTAHEDRAL = 'OCTAHEDRAL',\r\n\tQUATERNION = 'QUATERNION',\r\n\tEXPONENTIAL = 'EXPONENTIAL',\r\n}\r\n\r\nexport interface MeshoptBufferViewExtension {\r\n\tbuffer: number;\r\n\tbyteOffset: number;\r\n\tbyteLength: number;\r\n\tbyteStride: number;\r\n\tcount: number;\r\n\tmode: MeshoptMode;\r\n\tfilter?: MeshoptFilter;\r\n}\r\n\r\n/**\r\n * When using filters, the accessor definition written to the file will not necessarily have the\r\n * same properties as the input accessor. For example, octahedral encoding requires int8 or int16\r\n * output, so float32 input must be ignored.\r\n */\r\nexport interface PreparedAccessor {\r\n\tarray: TypedArray;\r\n\tbyteStride: number;\r\n\tnormalized: boolean;\r\n\tcomponentType: GLTF.AccessorComponentType;\r\n\tmin?: number[];\r\n\tmax?: number[];\r\n}\r\n","import { PreparedAccessor, MeshoptFilter, MeshoptMode } from './constants';\r\nimport {\r\n\tAccessor,\r\n\tAnimationChannel,\r\n\tAnimationSampler,\r\n\tBufferUtils,\r\n\tDocument,\r\n\tGLTF,\r\n\tMathUtils,\r\n\tPrimitive,\r\n\tRoot,\r\n\tTypedArray,\r\n\tTypedArrayConstructor,\r\n\tWriterContext,\r\n} from '@gltf-transform/core';\r\nimport type { MeshoptEncoder } from 'meshoptimizer';\r\n\r\nconst { BYTE, SHORT, FLOAT } = Accessor.ComponentType;\r\nconst { normalize, denormalize } = MathUtils;\r\n\r\n/** Pre-processes array with required filters or padding. */\r\nexport function prepareAccessor(\r\n\taccessor: Accessor,\r\n\tencoder: typeof MeshoptEncoder,\r\n\tmode: MeshoptMode,\r\n\tfilterOptions: { filter: MeshoptFilter; bits?: number }\r\n): PreparedAccessor {\r\n\tconst { filter, bits } = filterOptions as { filter: MeshoptFilter; bits: number };\r\n\tconst result: PreparedAccessor = {\r\n\t\tarray: accessor.getArray()!,\r\n\t\tbyteStride: accessor.getElementSize() * accessor.getComponentSize(),\r\n\t\tcomponentType: accessor.getComponentType(),\r\n\t\tnormalized: accessor.getNormalized(),\r\n\t};\r\n\r\n\tif (mode !== MeshoptMode.ATTRIBUTES) return result;\r\n\r\n\tif (filter !== MeshoptFilter.NONE) {\r\n\t\tlet array = accessor.getNormalized() ? denormalizeArray(accessor) : new Float32Array(result.array);\r\n\r\n\t\tswitch (filter) {\r\n\t\t\tcase MeshoptFilter.EXPONENTIAL: //  K single-precision floating point values.\r\n\t\t\t\tresult.byteStride = accessor.getElementSize() * 4;\r\n\t\t\t\tresult.componentType = FLOAT;\r\n\t\t\t\tresult.normalized = false;\r\n\t\t\t\tresult.array = encoder.encodeFilterExp(array, accessor.getCount(), result.byteStride, bits);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase MeshoptFilter.OCTAHEDRAL: //  four 8- or 16-bit normalized values.\r\n\t\t\t\tresult.byteStride = bits > 8 ? 8 : 4;\r\n\t\t\t\tresult.componentType = bits > 8 ? SHORT : BYTE;\r\n\t\t\t\tresult.normalized = true;\r\n\t\t\t\tarray = accessor.getElementSize() === 3 ? padNormals(array) : array;\r\n\t\t\t\tresult.array = encoder.encodeFilterOct(array, accessor.getCount(), result.byteStride, bits);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase MeshoptFilter.QUATERNION: //  four 16-bit normalized values.\r\n\t\t\t\tresult.byteStride = 8;\r\n\t\t\t\tresult.componentType = SHORT;\r\n\t\t\t\tresult.normalized = true;\r\n\t\t\t\tresult.array = encoder.encodeFilterQuat(array, accessor.getCount(), result.byteStride, bits);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Invalid filter.');\r\n\t\t}\r\n\r\n\t\tresult.min = accessor.getMin([]);\r\n\t\tresult.max = accessor.getMax([]);\r\n\t\tif (accessor.getNormalized()) {\r\n\t\t\tresult.min = result.min.map((v) => denormalize(v, accessor.getComponentType()));\r\n\t\t\tresult.max = result.max.map((v) => denormalize(v, accessor.getComponentType()));\r\n\t\t}\r\n\t\tif (result.normalized) {\r\n\t\t\tresult.min = result.min.map((v) => normalize(v, result.componentType));\r\n\t\t\tresult.max = result.max.map((v) => normalize(v, result.componentType));\r\n\t\t}\r\n\t} else if (result.byteStride % 4) {\r\n\t\tresult.array = padArrayElements(result.array, accessor.getElementSize());\r\n\t\tresult.byteStride = result.array.byteLength / accessor.getCount();\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction denormalizeArray(attribute: Accessor): Float32Array {\r\n\tconst componentType = attribute.getComponentType();\r\n\tconst srcArray = attribute.getArray()!;\r\n\tconst dstArray = new Float32Array(srcArray.length);\r\n\tfor (let i = 0; i < srcArray.length; i++) {\r\n\t\tdstArray[i] = denormalize(srcArray[i], componentType);\r\n\t}\r\n\treturn dstArray;\r\n}\r\n\r\n/** Pads array to 4 byte alignment, required for Meshopt ATTRIBUTE buffer views. */\r\nexport function padArrayElements<T extends TypedArray>(srcArray: T, elementSize: number): T {\r\n\tconst byteStride = BufferUtils.padNumber(srcArray.BYTES_PER_ELEMENT * elementSize);\r\n\tconst elementStride = byteStride / srcArray.BYTES_PER_ELEMENT;\r\n\tconst elementCount = srcArray.length / elementSize;\r\n\r\n\tconst dstArray = new (srcArray.constructor as TypedArrayConstructor)(elementCount * elementStride) as T;\r\n\r\n\tfor (let i = 0; i * elementSize < srcArray.length; i++) {\r\n\t\tfor (let j = 0; j < elementSize; j++) {\r\n\t\t\tdstArray[i * elementStride + j] = srcArray[i * elementSize + j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn dstArray;\r\n}\r\n\r\n/** Pad normals with a .w component for octahedral encoding. */\r\nfunction padNormals(srcArray: Float32Array): Float32Array {\r\n\tconst dstArray = new Float32Array((srcArray.length * 4) / 3);\r\n\tfor (let i = 0, il = srcArray.length / 3; i < il; i++) {\r\n\t\tdstArray[i * 4] = srcArray[i * 3];\r\n\t\tdstArray[i * 4 + 1] = srcArray[i * 3 + 1];\r\n\t\tdstArray[i * 4 + 2] = srcArray[i * 3 + 2];\r\n\t}\r\n\treturn dstArray;\r\n}\r\n\r\nexport function getMeshoptMode(accessor: Accessor, usage: string): MeshoptMode {\r\n\tif (usage === WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER) {\r\n\t\tconst isTriangles = accessor.listParents().some((parent) => {\r\n\t\t\treturn parent instanceof Primitive && parent.getMode() === Primitive.Mode.TRIANGLES;\r\n\t\t});\r\n\t\treturn isTriangles ? MeshoptMode.TRIANGLES : MeshoptMode.INDICES;\r\n\t}\r\n\r\n\treturn MeshoptMode.ATTRIBUTES;\r\n}\r\n\r\nexport function getMeshoptFilter(accessor: Accessor, doc: Document): { filter: MeshoptFilter; bits?: number } {\r\n\tconst refs = doc\r\n\t\t.getGraph()\r\n\t\t.listParentEdges(accessor)\r\n\t\t.filter((edge) => !(edge.getParent() instanceof Root));\r\n\r\n\tfor (const ref of refs) {\r\n\t\tconst refName = ref.getName();\r\n\t\tconst refKey = (ref.getAttributes().key || '') as string;\r\n\r\n\t\t// Indices.\r\n\t\tif (refName === 'indices') return { filter: MeshoptFilter.NONE };\r\n\r\n\t\t// Attributes.\r\n\t\t//\r\n\t\t// NOTES:\r\n\t\t// - Vertex attributes should be filtered IFF they are _not_ quantized in\r\n\t\t//   'packages/cli/src/transforms/meshopt.ts'.\r\n\t\t// - POSITION and TEXCOORD_0 could use exponential filtering, but this produces broken\r\n\t\t//   output in some cases (e.g. Matilda.glb), for unknown reasons. gltfpack uses manual\r\n\t\t//   quantization for these attributes.\r\n\t\tif (refName === 'attributes') {\r\n\t\t\tif (refKey === 'POSITION') return { filter: MeshoptFilter.NONE };\r\n\t\t\tif (refKey === 'TEXCOORD_0') return { filter: MeshoptFilter.NONE };\r\n\t\t\tif (refKey === 'NORMAL') return { filter: MeshoptFilter.OCTAHEDRAL, bits: 8 };\r\n\t\t\tif (refKey === 'TANGENT') return { filter: MeshoptFilter.OCTAHEDRAL, bits: 8 };\r\n\t\t\tif (refKey.startsWith('JOINTS_')) return { filter: MeshoptFilter.NONE };\r\n\t\t\tif (refKey.startsWith('WEIGHTS_')) return { filter: MeshoptFilter.NONE };\r\n\t\t}\r\n\r\n\t\t// Animation.\r\n\t\tif (refName === 'output') {\r\n\t\t\tconst targetPath = getTargetPath(accessor);\r\n\t\t\tif (targetPath === 'rotation') return { filter: MeshoptFilter.QUATERNION, bits: 16 };\r\n\t\t\tif (targetPath === 'translation') return { filter: MeshoptFilter.EXPONENTIAL, bits: 12 };\r\n\t\t\tif (targetPath === 'scale') return { filter: MeshoptFilter.EXPONENTIAL, bits: 12 };\r\n\t\t\treturn { filter: MeshoptFilter.NONE };\r\n\t\t}\r\n\r\n\t\t// See: https://github.com/donmccurdy/glTF-Transform/issues/489\r\n\t\tif (refName === 'input') return { filter: MeshoptFilter.NONE };\r\n\r\n\t\tif (refName === 'inverseBindMatrices') return { filter: MeshoptFilter.NONE };\r\n\t}\r\n\r\n\treturn { filter: MeshoptFilter.NONE };\r\n}\r\n\r\nexport function getTargetPath(accessor: Accessor): GLTF.AnimationChannelTargetPath | null {\r\n\tfor (const sampler of accessor.listParents()) {\r\n\t\tif (!(sampler instanceof AnimationSampler)) continue;\r\n\t\tfor (const channel of sampler.listParents()) {\r\n\t\t\tif (!(channel instanceof AnimationChannel)) continue;\r\n\t\t\treturn channel.getTargetPath();\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n","import {\r\n\tAccessor,\r\n\tBuffer,\r\n\tBufferUtils,\r\n\tExtension,\r\n\tGLB_BUFFER,\r\n\tGLTF,\r\n\tPropertyType,\r\n\tReaderContext,\r\n\tWriterContext,\r\n} from '@gltf-transform/core';\r\nimport { EncoderMethod, MeshoptBufferViewExtension, MeshoptFilter } from './constants';\r\nimport { EXT_MESHOPT_COMPRESSION } from '../constants';\r\nimport { getMeshoptFilter, getMeshoptMode, getTargetPath, prepareAccessor } from './encoder';\r\nimport { isFallbackBuffer } from './decoder';\r\nimport type { MeshoptEncoder, MeshoptDecoder } from 'meshoptimizer';\r\n\r\nconst NAME = EXT_MESHOPT_COMPRESSION;\r\n\r\ninterface EncoderOptions {\r\n\tmethod?: EncoderMethod;\r\n}\r\n\r\nconst DEFAULT_ENCODER_OPTIONS: Required<EncoderOptions> = {\r\n\tmethod: EncoderMethod.QUANTIZE,\r\n};\r\n\r\ntype MeshoptBufferView = { extensions: { [NAME]: MeshoptBufferViewExtension } };\r\ntype EncodedBufferView = GLTF.IBufferView & MeshoptBufferView;\r\n\r\n/**\r\n * # MeshoptCompression\r\n *\r\n * [`EXT_meshopt_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Vendor/EXT_meshopt_compression/)\r\n * provides compression and fast decoding for geometry, morph targets, and animations.\r\n *\r\n * [[include:VENDOR_EXTENSIONS_NOTE.md]]\r\n *\r\n * Meshopt compression (based on the [meshoptimizer](https://github.com/zeux/meshoptimizer)\r\n * library) offers a lightweight decoder with very fast runtime decompression, and is\r\n * appropriate for models of any size. Meshopt can reduce the transmission sizes of geometry,\r\n * morph targets, animation, and other numeric data stored in buffer views. When textures are\r\n * large, other complementary compression methods should be used as well.\r\n *\r\n * For the full benefits of meshopt compression, **apply gzip, brotli, or another lossless\r\n * compression method** to the resulting .glb, .gltf, or .bin files. Meshopt specifically\r\n * pre-optimizes assets for this purpose  without this secondary compression, the size\r\n * reduction is considerably less.\r\n *\r\n * Be aware that decompression happens before uploading to the GPU. While Meshopt decoding is\r\n * considerably faster than Draco decoding, neither compression method will improve runtime\r\n * performance directly. To improve framerate, you'll need to simplify the geometry by reducing\r\n * vertex count or draw calls  not just compress it. Finally, be aware that Meshopt compression is\r\n * lossy: repeatedly compressing and decompressing a model in a pipeline will lose precision, so\r\n * compression should generally be the last stage of an art workflow, and uncompressed original\r\n * files should be kept.\r\n *\r\n * The meshoptimizer library ([github](https://github.com/zeux/meshoptimizer/tree/master/js),\r\n * [npm](https://www.npmjs.com/package/meshoptimizer)) is a required dependency for reading or\r\n * writing files, and must be provided by the application. Compression may alternatively be applied\r\n * with the [gltfpack](https://github.com/zeux/meshoptimizer/tree/master/gltf) tool.\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { NodeIO } from '@gltf-transform/core';\r\n * import { MeshoptCompression } from '@gltf-transform/extensions';\r\n * import { MeshoptDecoder, MeshoptEncoder } from 'meshoptimizer';\r\n *\r\n * await MeshoptDecoder.ready;\r\n * await MeshoptEncoder.ready;\r\n *\r\n * const io = new NodeIO()\r\n *\t.registerExtensions([MeshoptCompression])\r\n *\t.registerDependencies({\r\n *\t\t'meshopt.decoder': MeshoptDecoder,\r\n *\t\t'meshopt.encoder': MeshoptEncoder,\r\n *\t});\r\n *\r\n * // Read and decode.\r\n * const document = await io.read('compressed.glb');\r\n *\r\n * // Write and encode. (Medium, -c)\r\n * await document.transform(\r\n * \treorder({encoder: MeshoptEncoder}),\r\n * \tquantize()\r\n * );\r\n * document.createExtension(MeshoptCompression)\r\n * \t.setRequired(true)\r\n * \t.setEncoderOptions({ method: MeshoptCompression.EncoderMethod.QUANTIZE });\r\n * await io.write('compressed-medium.glb', document);\r\n *\r\n * // Write and encode. (High, -cc)\r\n * await document.transform(\r\n * \treorder({encoder: MeshoptEncoder}),\r\n * \tquantize({pattern: /^(POSITION|TEXCOORD|JOINTS|WEIGHTS)(_\\d+)?$/}),\r\n * );\r\n * document.createExtension(MeshoptCompression)\r\n * \t.setRequired(true)\r\n * \t.setEncoderOptions({ method: MeshoptCompression.EncoderMethod.FILTER });\r\n * await io.write('compressed-high.glb', document);\r\n * ```\r\n */\r\nexport class MeshoptCompression extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\t/** @hidden */\r\n\tpublic readonly prereadTypes = [PropertyType.BUFFER, PropertyType.PRIMITIVE];\r\n\t/** @hidden */\r\n\tpublic readonly prewriteTypes = [PropertyType.BUFFER, PropertyType.ACCESSOR];\r\n\t/** @hidden */\r\n\tpublic readonly readDependencies = ['meshopt.decoder'];\r\n\t/** @hidden */\r\n\tpublic readonly writeDependencies = ['meshopt.encoder'];\r\n\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\tpublic static readonly EncoderMethod = EncoderMethod;\r\n\r\n\tprivate _decoder: typeof MeshoptDecoder | null = null;\r\n\tprivate _decoderFallbackBufferMap = new Map<Buffer, Buffer>();\r\n\tprivate _encoder: typeof MeshoptEncoder | null = null;\r\n\tprivate _encoderOptions: Required<EncoderOptions> = DEFAULT_ENCODER_OPTIONS;\r\n\tprivate _encoderFallbackBuffer: Buffer | null = null;\r\n\tprivate _encoderBufferViews: { [key: string]: EncodedBufferView } = {};\r\n\tprivate _encoderBufferViewData: { [key: string]: Uint8Array[] } = {};\r\n\tprivate _encoderBufferViewAccessors: { [key: string]: GLTF.IAccessor[] } = {};\r\n\r\n\t/** @hidden */\r\n\tpublic install(key: string, dependency: unknown): this {\r\n\t\tif (key === 'meshopt.decoder') {\r\n\t\t\tthis._decoder = dependency as typeof MeshoptDecoder;\r\n\t\t}\r\n\t\tif (key === 'meshopt.encoder') {\r\n\t\t\tthis._encoder = dependency as typeof MeshoptEncoder;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Configures Meshopt options for quality/compression tuning. The two methods rely on different\r\n\t * pre-processing before compression, and should be compared on the basis of (a) quality/loss\r\n\t * and (b) final asset size after _also_ applying a lossless compression such as gzip or brotli.\r\n\t *\r\n\t * - QUANTIZE: Default. Pre-process with {@link quantize quantize()} (lossy to specified\r\n\t * \tprecision) before applying lossless Meshopt compression. Offers a considerable compression\r\n\t * \tratio with or without further supercompression. Equivalent to `gltfpack -c`.\r\n\t * - FILTER: Pre-process with lossy filters to improve compression, before applying lossless\r\n\t *\tMeshopt compression. While output may initially be larger than with the QUANTIZE method,\r\n\t *\tthis method will benefit more from supercompression (e.g. gzip or brotli). Equivalent to\r\n\t * \t`gltfpack -cc`.\r\n\t *\r\n\t * Output with the FILTER method will generally be smaller after supercompression (e.g. gzip or\r\n\t * brotli) is applied, but may be larger than QUANTIZE output without it. Decoding is very fast\r\n\t * with both methods.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```ts\r\n\t * doc.createExtension(MeshoptCompression)\r\n\t * \t.setRequired(true)\r\n\t * \t.setEncoderOptions({\r\n\t * \t\tmethod: MeshoptCompression.EncoderMethod.QUANTIZE\r\n\t * \t});\r\n\t * ```\r\n\t */\r\n\tpublic setEncoderOptions(options: EncoderOptions): this {\r\n\t\tthis._encoderOptions = { ...DEFAULT_ENCODER_OPTIONS, ...options };\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Decoding.\r\n\t */\r\n\r\n\t/** @internal Checks preconditions, decodes buffer views, and creates decoded primitives. */\r\n\tpublic preread(context: ReaderContext, propertyType: PropertyType): this {\r\n\t\tif (!this._decoder) {\r\n\t\t\tif (!this.isRequired()) return this;\r\n\t\t\tthrow new Error(`[${NAME}] Please install extension dependency, \"meshopt.decoder\".`);\r\n\t\t}\r\n\t\tif (!this._decoder.supported) {\r\n\t\t\tif (!this.isRequired()) return this;\r\n\t\t\tthrow new Error(`[${NAME}]: Missing WASM support.`);\r\n\t\t}\r\n\r\n\t\tif (propertyType === PropertyType.BUFFER) {\r\n\t\t\tthis._prereadBuffers(context);\r\n\t\t} else if (propertyType === PropertyType.PRIMITIVE) {\r\n\t\t\tthis._prereadPrimitives(context);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @internal Decode buffer views. */\r\n\tprivate _prereadBuffers(context: ReaderContext): void {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tconst viewDefs = jsonDoc.json.bufferViews || [];\r\n\t\tviewDefs.forEach((viewDef, index) => {\r\n\t\t\tif (!viewDef.extensions || !viewDef.extensions[NAME]) return;\r\n\r\n\t\t\tconst meshoptDef = viewDef.extensions[NAME] as MeshoptBufferViewExtension;\r\n\t\t\tconst byteOffset = meshoptDef.byteOffset || 0;\r\n\t\t\tconst byteLength = meshoptDef.byteLength || 0;\r\n\t\t\tconst count = meshoptDef.count;\r\n\t\t\tconst stride = meshoptDef.byteStride;\r\n\t\t\tconst result = new Uint8Array(count * stride);\r\n\r\n\t\t\tconst bufferDef = jsonDoc.json.buffers![viewDef.buffer];\r\n\t\t\t// TODO(cleanup): Should be encapsulated in writer-context.ts.\r\n\t\t\tconst resource = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\r\n\t\t\tconst source = BufferUtils.toView(resource, byteOffset, byteLength);\r\n\r\n\t\t\tthis._decoder!.decodeGltfBuffer(result, count, stride, source, meshoptDef.mode, meshoptDef.filter);\r\n\r\n\t\t\tcontext.bufferViews[index] = result;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Mark fallback buffers and replacements.\r\n\t *\r\n\t * Note: Alignment with primitives is arbitrary; this just needs to happen\r\n\t * after Buffers have been parsed.\r\n\t * @internal\r\n\t */\r\n\tprivate _prereadPrimitives(context: ReaderContext): void {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst viewDefs = jsonDoc.json.bufferViews || [];\r\n\r\n\t\t//\r\n\t\tviewDefs.forEach((viewDef) => {\r\n\t\t\tif (!viewDef.extensions || !viewDef.extensions[NAME]) return;\r\n\r\n\t\t\tconst meshoptDef = viewDef.extensions[NAME] as MeshoptBufferViewExtension;\r\n\r\n\t\t\tconst buffer = context.buffers[meshoptDef.buffer];\r\n\t\t\tconst fallbackBuffer = context.buffers[viewDef.buffer];\r\n\t\t\tconst fallbackBufferDef = jsonDoc.json.buffers![viewDef.buffer];\r\n\t\t\tif (isFallbackBuffer(fallbackBufferDef)) {\r\n\t\t\t\tthis._decoderFallbackBufferMap.set(fallbackBuffer, buffer);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/** @hidden Removes Fallback buffers, if extension is required. */\r\n\tpublic read(_context: ReaderContext): this {\r\n\t\tif (!this.isRequired()) return this;\r\n\r\n\t\t// Replace fallback buffers.\r\n\t\tfor (const [fallbackBuffer, buffer] of this._decoderFallbackBufferMap) {\r\n\t\t\tfor (const parent of fallbackBuffer.listParents()) {\r\n\t\t\t\tif (parent instanceof Accessor) {\r\n\t\t\t\t\tparent.swap(fallbackBuffer, buffer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfallbackBuffer.dispose();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Encoding.\r\n\t */\r\n\r\n\t/** @internal Claims accessors that can be compressed and writes compressed buffer views. */\r\n\tpublic prewrite(context: WriterContext, propertyType: PropertyType): this {\r\n\t\tif (propertyType === PropertyType.ACCESSOR) {\r\n\t\t\tthis._prewriteAccessors(context);\r\n\t\t} else if (propertyType === PropertyType.BUFFER) {\r\n\t\t\tthis._prewriteBuffers(context);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @internal Claims accessors that can be compressed. */\r\n\tprivate _prewriteAccessors(context: WriterContext): void {\r\n\t\tconst json = context.jsonDoc.json;\r\n\t\tconst encoder = this._encoder!;\r\n\t\tconst options = this._encoderOptions;\r\n\r\n\t\tconst fallbackBuffer = this.document.createBuffer(); // Disposed on write.\r\n\t\tconst fallbackBufferIndex = this.document.getRoot().listBuffers().indexOf(fallbackBuffer);\r\n\r\n\t\tthis._encoderFallbackBuffer = fallbackBuffer;\r\n\t\tthis._encoderBufferViews = {};\r\n\t\tthis._encoderBufferViewData = {};\r\n\t\tthis._encoderBufferViewAccessors = {};\r\n\r\n\t\tfor (const accessor of this.document.getRoot().listAccessors()) {\r\n\t\t\t// See: https://github.com/donmccurdy/glTF-Transform/pull/323#issuecomment-898791251\r\n\t\t\t// Example: https://skfb.ly/6qAD8\r\n\t\t\tif (getTargetPath(accessor) === 'weights') continue;\r\n\r\n\t\t\tconst usage = context.getAccessorUsage(accessor);\r\n\t\t\tconst mode = getMeshoptMode(accessor, usage);\r\n\t\t\tconst filter =\r\n\t\t\t\toptions.method === EncoderMethod.FILTER\r\n\t\t\t\t\t? getMeshoptFilter(accessor, this.document)\r\n\t\t\t\t\t: { filter: MeshoptFilter.NONE };\r\n\t\t\tconst preparedAccessor = prepareAccessor(accessor, encoder, mode, filter);\r\n\t\t\tconst { array, byteStride } = preparedAccessor;\r\n\r\n\t\t\tconst buffer = accessor.getBuffer();\r\n\t\t\tif (!buffer) throw new Error(`${NAME}: Missing buffer for accessor.`);\r\n\t\t\tconst bufferIndex = this.document.getRoot().listBuffers().indexOf(buffer);\r\n\r\n\t\t\t// Buffer view grouping key.\r\n\t\t\tconst key = [usage, mode, filter.filter, byteStride, bufferIndex].join(':');\r\n\r\n\t\t\tlet bufferView = this._encoderBufferViews[key];\r\n\t\t\tlet bufferViewData = this._encoderBufferViewData[key];\r\n\t\t\tlet bufferViewAccessors = this._encoderBufferViewAccessors[key];\r\n\r\n\t\t\t// Write new buffer view, if needed.\r\n\t\t\tif (!bufferView || !bufferViewData) {\r\n\t\t\t\tbufferViewAccessors = this._encoderBufferViewAccessors[key] = [];\r\n\t\t\t\tbufferViewData = this._encoderBufferViewData[key] = [];\r\n\t\t\t\tbufferView = this._encoderBufferViews[key] = {\r\n\t\t\t\t\tbuffer: fallbackBufferIndex,\r\n\t\t\t\t\ttarget: WriterContext.USAGE_TO_TARGET[usage],\r\n\t\t\t\t\tbyteOffset: 0,\r\n\t\t\t\t\tbyteLength: 0,\r\n\t\t\t\t\tbyteStride: usage === WriterContext.BufferViewUsage.ARRAY_BUFFER ? byteStride : undefined,\r\n\t\t\t\t\textensions: {\r\n\t\t\t\t\t\t[NAME]: {\r\n\t\t\t\t\t\t\tbuffer: bufferIndex,\r\n\t\t\t\t\t\t\tbyteOffset: 0,\r\n\t\t\t\t\t\t\tbyteLength: 0,\r\n\t\t\t\t\t\t\tmode: mode,\r\n\t\t\t\t\t\t\tfilter: filter.filter !== MeshoptFilter.NONE ? filter.filter : undefined,\r\n\t\t\t\t\t\t\tbyteStride: byteStride,\r\n\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Write accessor.\r\n\t\t\tconst accessorDef = context.createAccessorDef(accessor);\r\n\t\t\taccessorDef.componentType = preparedAccessor.componentType;\r\n\t\t\taccessorDef.normalized = preparedAccessor.normalized;\r\n\t\t\taccessorDef.byteOffset = bufferView.byteLength;\r\n\t\t\tif (accessorDef.min && preparedAccessor.min) accessorDef.min = preparedAccessor.min;\r\n\t\t\tif (accessorDef.max && preparedAccessor.max) accessorDef.max = preparedAccessor.max;\r\n\t\t\tcontext.accessorIndexMap.set(accessor, json.accessors!.length);\r\n\t\t\tjson.accessors!.push(accessorDef);\r\n\t\t\tbufferViewAccessors.push(accessorDef);\r\n\r\n\t\t\t// Update buffer view.\r\n\t\t\tbufferViewData.push(new Uint8Array(array.buffer, array.byteOffset, array.byteLength));\r\n\t\t\tbufferView.byteLength += array.byteLength;\r\n\t\t\tbufferView.extensions.EXT_meshopt_compression.count += accessor.getCount();\r\n\t\t}\r\n\t}\r\n\r\n\t/** @internal Writes compressed buffer views. */\r\n\tprivate _prewriteBuffers(context: WriterContext): void {\r\n\t\tconst encoder = this._encoder!;\r\n\r\n\t\tfor (const key in this._encoderBufferViews) {\r\n\t\t\tconst bufferView = this._encoderBufferViews[key];\r\n\t\t\tconst bufferViewData = this._encoderBufferViewData[key];\r\n\t\t\tconst buffer = this.document.getRoot().listBuffers()[bufferView.extensions[NAME].buffer];\r\n\t\t\tconst otherBufferViews = context.otherBufferViews.get(buffer) || [];\r\n\r\n\t\t\tconst { count, byteStride, mode } = bufferView.extensions[NAME];\r\n\t\t\tconst srcArray = BufferUtils.concat(bufferViewData);\r\n\t\t\tconst dstArray = encoder.encodeGltfBuffer(srcArray, count, byteStride, mode);\r\n\t\t\tconst compressedData = BufferUtils.pad(dstArray);\r\n\r\n\t\t\tbufferView.extensions[NAME].byteLength = dstArray.byteLength;\r\n\r\n\t\t\tbufferViewData.length = 0;\r\n\t\t\tbufferViewData.push(compressedData);\r\n\t\t\totherBufferViews.push(compressedData);\r\n\t\t\tcontext.otherBufferViews.set(buffer, otherBufferViews);\r\n\t\t}\r\n\t}\r\n\r\n\t/** @hidden Puts encoded data into glTF output. */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tlet fallbackBufferByteOffset = 0;\r\n\r\n\t\t// Write final encoded buffer view properties.\r\n\t\tfor (const key in this._encoderBufferViews) {\r\n\t\t\tconst bufferView = this._encoderBufferViews[key];\r\n\t\t\tconst bufferViewData = this._encoderBufferViewData[key][0];\r\n\t\t\tconst bufferViewIndex = context.otherBufferViewsIndexMap.get(bufferViewData)!;\r\n\r\n\t\t\tconst bufferViewAccessors = this._encoderBufferViewAccessors[key];\r\n\t\t\tfor (const accessorDef of bufferViewAccessors) {\r\n\t\t\t\taccessorDef.bufferView = bufferViewIndex;\r\n\t\t\t}\r\n\r\n\t\t\tconst finalBufferViewDef = context.jsonDoc.json.bufferViews![bufferViewIndex];\r\n\t\t\tconst compressedByteOffset = finalBufferViewDef.byteOffset || 0;\r\n\r\n\t\t\tObject.assign(finalBufferViewDef, bufferView);\r\n\t\t\tfinalBufferViewDef.byteOffset = fallbackBufferByteOffset;\r\n\t\t\tconst bufferViewExtensionDef = finalBufferViewDef.extensions![NAME] as MeshoptBufferViewExtension;\r\n\t\t\tbufferViewExtensionDef.byteOffset = compressedByteOffset;\r\n\r\n\t\t\tfallbackBufferByteOffset += BufferUtils.padNumber(bufferView.byteLength);\r\n\t\t}\r\n\r\n\t\t// Write final fallback buffer.\r\n\t\tconst fallbackBuffer = this._encoderFallbackBuffer!;\r\n\t\tconst fallbackBufferIndex = context.bufferIndexMap.get(fallbackBuffer)!;\r\n\t\tconst fallbackBufferDef = context.jsonDoc.json.buffers![fallbackBufferIndex];\r\n\t\tfallbackBufferDef.byteLength = fallbackBufferByteOffset;\r\n\t\tfallbackBufferDef.extensions = { [NAME]: { fallback: true } };\r\n\t\tfallbackBuffer.dispose();\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { EXT_MESHOPT_COMPRESSION } from '../constants';\r\nimport type { GLTF } from '@gltf-transform/core';\r\nimport type { MeshoptBufferExtension } from './constants';\r\n\r\n/**\r\n * Returns true for a fallback buffer, else false.\r\n *\r\n *   - All references to the fallback buffer must come from bufferViews that\r\n *     have a EXT_meshopt_compression extension specified.\r\n *   - No references to the fallback buffer may come from\r\n *     EXT_meshopt_compression extension JSON.\r\n */\r\nexport function isFallbackBuffer(bufferDef: GLTF.IBuffer): boolean {\r\n\tif (!bufferDef.extensions || !bufferDef.extensions[EXT_MESHOPT_COMPRESSION]) return false;\r\n\tconst fallbackDef = bufferDef.extensions[EXT_MESHOPT_COMPRESSION] as MeshoptBufferExtension;\r\n\treturn !!fallbackDef.fallback;\r\n}\r\n","import {\r\n\tBufferUtils,\r\n\tExtension,\r\n\tImageUtils,\r\n\tImageUtilsFormat,\r\n\tPropertyType,\r\n\tReaderContext,\r\n\tWriterContext,\r\n\tvec2,\r\n} from '@gltf-transform/core';\r\nimport { EXT_TEXTURE_WEBP } from '../constants';\r\n\r\nconst NAME = EXT_TEXTURE_WEBP;\r\n\r\nclass WEBPImageUtils implements ImageUtilsFormat {\r\n\tmatch(array: Uint8Array): boolean {\r\n\t\treturn array.length >= 12 && array[8] === 87 && array[9] === 69 && array[10] === 66 && array[11] === 80;\r\n\t}\r\n\tgetSize(array: Uint8Array): vec2 | null {\r\n\t\t// Reference: http://tools.ietf.org/html/rfc6386\r\n\t\tconst RIFF = BufferUtils.decodeText(array.slice(0, 4));\r\n\t\tconst WEBP = BufferUtils.decodeText(array.slice(8, 12));\r\n\t\tif (RIFF !== 'RIFF' || WEBP !== 'WEBP') return null;\r\n\r\n\t\tconst view = new DataView(array.buffer, array.byteOffset);\r\n\r\n\t\t// Reference: https://wiki.tcl-lang.org/page/Reading+WEBP+image+dimensions\r\n\t\tlet offset = 12;\r\n\t\twhile (offset < view.byteLength) {\r\n\t\t\tconst chunkId = BufferUtils.decodeText(\r\n\t\t\t\tnew Uint8Array([\r\n\t\t\t\t\tview.getUint8(offset),\r\n\t\t\t\t\tview.getUint8(offset + 1),\r\n\t\t\t\t\tview.getUint8(offset + 2),\r\n\t\t\t\t\tview.getUint8(offset + 3),\r\n\t\t\t\t])\r\n\t\t\t);\r\n\t\t\tconst chunkByteLength = view.getUint32(offset + 4, true);\r\n\t\t\tif (chunkId === 'VP8 ') {\r\n\t\t\t\tconst width = view.getInt16(offset + 14, true) & 0x3fff;\r\n\t\t\t\tconst height = view.getInt16(offset + 16, true) & 0x3fff;\r\n\t\t\t\treturn [width, height];\r\n\t\t\t} else if (chunkId === 'VP8L') {\r\n\t\t\t\tconst b0 = view.getUint8(offset + 9);\r\n\t\t\t\tconst b1 = view.getUint8(offset + 10);\r\n\t\t\t\tconst b2 = view.getUint8(offset + 11);\r\n\t\t\t\tconst b3 = view.getUint8(offset + 12);\r\n\t\t\t\tconst width = 1 + (((b1 & 0x3f) << 8) | b0);\r\n\t\t\t\tconst height = 1 + (((b3 & 0xf) << 10) | (b2 << 2) | ((b1 & 0xc0) >> 6));\r\n\t\t\t\treturn [width, height];\r\n\t\t\t}\r\n\t\t\toffset += 8 + chunkByteLength + (chunkByteLength % 2);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\tgetChannels(_buffer: Uint8Array): number {\r\n\t\treturn 4;\r\n\t}\r\n}\r\n\r\n/**\r\n * # TextureWebP\r\n *\r\n * [`EXT_texture_webp`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp/)\r\n * enables WebP images for any material texture.\r\n *\r\n * [[include:VENDOR_EXTENSIONS_NOTE.md]]\r\n *\r\n * WebP typically provides the minimal transmission\r\n * size, but [requires browser support](https://caniuse.com/webp). Like PNG and JPEG, a WebP image is\r\n * *fully decompressed* when uploaded to the GPU, which increases upload time and GPU memory cost.\r\n * For seamless uploads and minimal GPU memory cost, it is necessary to use a GPU texture format\r\n * like Basis Universal, with the `KHR_texture_basisu` extension.\r\n *\r\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\r\n * {@link Document}, and affects the entire Document by allowing use of the `image/webp` MIME type\r\n * and passing WebP image data to the {@link Texture.setImage} method. Without the Extension, the\r\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\r\n * specification.\r\n *\r\n * Properties:\r\n * - N/A\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { TextureWebP } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const webpExtension = document.createExtension(TextureWebP)\r\n * \t.setRequired(true);\r\n * document.createTexture('MyWebPTexture')\r\n * \t.setMimeType('image/webp')\r\n * \t.setImage(fs.readFileSync('my-texture.webp'));\r\n * ```\r\n *\r\n * WebP conversion is not done automatically when adding the extension as shown above  you must\r\n * convert the image data first, then pass the `.webp` payload to {@link Texture.setImage}.\r\n *\r\n * When the `EXT_texture_webp` extension is added to a file by glTF-Transform, the extension should\r\n * always be required. This tool does not support writing assets that \"fall back\" to optional PNG or\r\n * JPEG image data.\r\n */\r\nexport class TextureWebP extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\t/** @hidden */\r\n\tpublic readonly prereadTypes = [PropertyType.TEXTURE];\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** @hidden */\r\n\tpublic static register(): void {\r\n\t\tImageUtils.registerFormat('image/webp', new WEBPImageUtils());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic preread(context: ReaderContext): this {\r\n\t\tconst textureDefs = context.jsonDoc.json.textures || [];\r\n\t\ttextureDefs.forEach((textureDef) => {\r\n\t\t\tif (textureDef.extensions && textureDef.extensions[NAME]) {\r\n\t\t\t\ttextureDef.source = (textureDef.extensions[NAME] as { source: number }).source;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tpublic read(context: ReaderContext): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listTextures()\r\n\t\t\t.forEach((texture) => {\r\n\t\t\t\tif (texture.getMimeType() === 'image/webp') {\r\n\t\t\t\t\tconst imageIndex = context.imageIndexMap.get(texture);\r\n\t\t\t\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\t\t\t\ttextureDefs.forEach((textureDef) => {\r\n\t\t\t\t\t\tif (textureDef.source === imageIndex) {\r\n\t\t\t\t\t\t\ttextureDef.extensions = textureDef.extensions || {};\r\n\t\t\t\t\t\t\ttextureDef.extensions[NAME] = { source: textureDef.source };\r\n\t\t\t\t\t\t\tdelete textureDef.source;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Accessor, GLTF, TypedArray, TypedArrayConstructor } from '@gltf-transform/core';\r\nimport { KHR_DRACO_MESH_COMPRESSION } from '../constants';\r\nimport type { Attribute, DataType, Decoder, DecoderModule, Mesh } from 'draco3dgltf';\r\n\r\nconst NAME = KHR_DRACO_MESH_COMPRESSION;\r\n\r\nexport let decoderModule: DecoderModule;\r\n\r\n// Initialized when decoder module loads.\r\nlet COMPONENT_ARRAY: { [key: number]: TypedArrayConstructor };\r\nlet DATA_TYPE: { [key: number]: DataType };\r\n\r\nexport function decodeGeometry(decoder: Decoder, data: Uint8Array): Mesh {\r\n\tconst buffer = new decoderModule.DecoderBuffer();\r\n\ttry {\r\n\t\tbuffer.Init(data as unknown as Int8Array, data.length);\r\n\r\n\t\tconst geometryType = decoder.GetEncodedGeometryType(buffer);\r\n\t\tif (geometryType !== decoderModule.TRIANGULAR_MESH) {\r\n\t\t\tthrow new Error(`[${NAME}] Unknown geometry type.`);\r\n\t\t}\r\n\r\n\t\tconst dracoMesh = new decoderModule.Mesh();\r\n\t\tconst status = decoder.DecodeBufferToMesh(buffer, dracoMesh);\r\n\r\n\t\tif (!status.ok() || dracoMesh.ptr === 0) {\r\n\t\t\tthrow new Error(`[${NAME}] Decoding failure.`);\r\n\t\t}\r\n\r\n\t\treturn dracoMesh;\r\n\t} finally {\r\n\t\tdecoderModule.destroy(buffer);\r\n\t}\r\n}\r\n\r\nexport function decodeIndex(decoder: Decoder, mesh: Mesh): Uint16Array | Uint32Array {\r\n\tconst numFaces = mesh.num_faces();\r\n\tconst numIndices = numFaces * 3;\r\n\r\n\tlet ptr: number;\r\n\tlet indices: Uint16Array | Uint32Array;\r\n\r\n\tif (mesh.num_points() <= 65534) {\r\n\t\tconst byteLength = numIndices * Uint16Array.BYTES_PER_ELEMENT;\r\n\t\tptr = decoderModule._malloc(byteLength);\r\n\t\tdecoder.GetTrianglesUInt16Array(mesh, byteLength, ptr);\r\n\t\tindices = new Uint16Array(decoderModule.HEAPU16.buffer, ptr, numIndices).slice();\r\n\t} else {\r\n\t\tconst byteLength = numIndices * Uint32Array.BYTES_PER_ELEMENT;\r\n\t\tptr = decoderModule._malloc(byteLength);\r\n\t\tdecoder.GetTrianglesUInt32Array(mesh, byteLength, ptr);\r\n\t\tindices = new Uint32Array(decoderModule.HEAPU32.buffer, ptr, numIndices).slice();\r\n\t}\r\n\r\n\tdecoderModule._free(ptr);\r\n\r\n\treturn indices;\r\n}\r\n\r\nexport function decodeAttribute(\r\n\tdecoder: Decoder,\r\n\tmesh: Mesh,\r\n\tattribute: Attribute,\r\n\taccessorDef: GLTF.IAccessor\r\n): TypedArray {\r\n\tconst dataType = DATA_TYPE[accessorDef.componentType];\r\n\tconst ArrayCtor = COMPONENT_ARRAY[accessorDef.componentType];\r\n\tconst numComponents = attribute.num_components();\r\n\tconst numPoints = mesh.num_points();\r\n\tconst numValues = numPoints * numComponents;\r\n\tconst byteLength: number = numValues * ArrayCtor.BYTES_PER_ELEMENT;\r\n\r\n\tconst ptr = decoderModule._malloc(byteLength);\r\n\tdecoder.GetAttributeDataArrayForAllPoints(mesh, attribute, dataType, byteLength, ptr);\r\n\tconst array: TypedArray = new ArrayCtor(decoderModule.HEAPF32.buffer, ptr, numValues).slice();\r\n\tdecoderModule._free(ptr);\r\n\r\n\treturn array;\r\n}\r\n\r\nexport function initDecoderModule(_decoderModule: DecoderModule): void {\r\n\tdecoderModule = _decoderModule;\r\n\r\n\tCOMPONENT_ARRAY = {\r\n\t\t[Accessor.ComponentType.FLOAT]: Float32Array,\r\n\t\t[Accessor.ComponentType.UNSIGNED_INT]: Uint32Array,\r\n\t\t[Accessor.ComponentType.UNSIGNED_SHORT]: Uint16Array,\r\n\t\t[Accessor.ComponentType.UNSIGNED_BYTE]: Uint8Array,\r\n\t\t[Accessor.ComponentType.SHORT]: Int16Array,\r\n\t\t[Accessor.ComponentType.BYTE]: Int8Array,\r\n\t};\r\n\r\n\tDATA_TYPE = {\r\n\t\t[Accessor.ComponentType.FLOAT]: decoderModule.DT_FLOAT32,\r\n\t\t[Accessor.ComponentType.UNSIGNED_INT]: decoderModule.DT_UINT32,\r\n\t\t[Accessor.ComponentType.UNSIGNED_SHORT]: decoderModule.DT_UINT16,\r\n\t\t[Accessor.ComponentType.UNSIGNED_BYTE]: decoderModule.DT_UINT8,\r\n\t\t[Accessor.ComponentType.SHORT]: decoderModule.DT_INT16,\r\n\t\t[Accessor.ComponentType.BYTE]: decoderModule.DT_INT8,\r\n\t};\r\n}\r\n","import { Accessor, bbox, GLTF, Primitive, TypedArray } from '@gltf-transform/core';\r\nimport type { EncoderModule, Mesh, MeshBuilder } from 'draco3dgltf';\r\n\r\nexport let encoderModule: EncoderModule;\r\n\r\nexport enum EncoderMethod {\r\n\tEDGEBREAKER = 1,\r\n\tSEQUENTIAL = 0,\r\n}\r\n\r\nenum AttributeEnum {\r\n\tPOSITION = 'POSITION',\r\n\tNORMAL = 'NORMAL',\r\n\tCOLOR = 'COLOR',\r\n\tTEX_COORD = 'TEX_COORD',\r\n\tGENERIC = 'GENERIC',\r\n}\r\n\r\nconst DEFAULT_QUANTIZATION_BITS = {\r\n\t[AttributeEnum.POSITION]: 14,\r\n\t[AttributeEnum.NORMAL]: 10,\r\n\t[AttributeEnum.COLOR]: 8,\r\n\t[AttributeEnum.TEX_COORD]: 12,\r\n\t[AttributeEnum.GENERIC]: 12,\r\n};\r\n\r\nexport interface EncodedPrimitive {\r\n\tnumVertices: number;\r\n\tnumIndices: number;\r\n\tdata: Uint8Array;\r\n\tattributeIDs: { [key: string]: number };\r\n}\r\n\r\nexport interface EncoderOptions {\r\n\tdecodeSpeed?: number;\r\n\tencodeSpeed?: number;\r\n\tmethod?: EncoderMethod;\r\n\tquantizationBits?: { [key: string]: number };\r\n\tquantizationVolume?: 'mesh' | 'scene' | bbox;\r\n}\r\n\r\nconst DEFAULT_ENCODER_OPTIONS: EncoderOptions = {\r\n\tdecodeSpeed: 5,\r\n\tencodeSpeed: 5,\r\n\tmethod: EncoderMethod.EDGEBREAKER,\r\n\tquantizationBits: DEFAULT_QUANTIZATION_BITS,\r\n\tquantizationVolume: 'mesh',\r\n};\r\n\r\nexport function initEncoderModule(_encoderModule: EncoderModule): void {\r\n\tencoderModule = _encoderModule;\r\n}\r\n\r\n/**\r\n * References:\r\n * - https://github.com/mrdoob/three.js/blob/dev/examples/js/exporters/DRACOExporter.js\r\n * - https://github.com/CesiumGS/gltf-pipeline/blob/master/lib/compressDracoMeshes.js\r\n */\r\nexport function encodeGeometry(prim: Primitive, _options: EncoderOptions = DEFAULT_ENCODER_OPTIONS): EncodedPrimitive {\r\n\tconst options = { ...DEFAULT_ENCODER_OPTIONS, ..._options } as Required<EncoderOptions>;\r\n\toptions.quantizationBits = { ...DEFAULT_QUANTIZATION_BITS, ..._options.quantizationBits };\r\n\r\n\tconst encoder = new encoderModule.Encoder();\r\n\tconst builder = new encoderModule.MeshBuilder();\r\n\tconst mesh = new encoderModule.Mesh();\r\n\r\n\tconst attributeIDs: { [key: string]: number } = {};\r\n\tconst dracoBuffer = new encoderModule.DracoInt8Array();\r\n\r\n\tfor (const semantic of prim.listSemantics()) {\r\n\t\tconst attribute = prim.getAttribute(semantic)!;\r\n\t\tconst attributeEnum = getAttributeEnum(semantic);\r\n\t\tconst attributeID: number = addAttribute(\r\n\t\t\tbuilder,\r\n\t\t\tattribute.getComponentType(),\r\n\t\t\tmesh,\r\n\t\t\tencoderModule[attributeEnum],\r\n\t\t\tattribute.getCount(),\r\n\t\t\tattribute.getElementSize(),\r\n\t\t\tattribute.getArray()!\r\n\t\t);\r\n\r\n\t\tif (attributeID === -1) throw new Error(`Error compressing \"${semantic}\" attribute.`);\r\n\r\n\t\tattributeIDs[semantic] = attributeID;\r\n\t\tif (options.quantizationVolume === 'mesh' || semantic !== 'POSITION') {\r\n\t\t\tencoder.SetAttributeQuantization(encoderModule[attributeEnum], options.quantizationBits[attributeEnum]);\r\n\t\t} else if (typeof options.quantizationVolume === 'object') {\r\n\t\t\tconst { quantizationVolume } = options;\r\n\t\t\tconst range = Math.max(\r\n\t\t\t\tquantizationVolume.max[0] - quantizationVolume.min[0],\r\n\t\t\t\tquantizationVolume.max[1] - quantizationVolume.min[1],\r\n\t\t\t\tquantizationVolume.max[2] - quantizationVolume.min[2]\r\n\t\t\t);\r\n\t\t\tencoder.SetAttributeExplicitQuantization(\r\n\t\t\t\tencoderModule[attributeEnum],\r\n\t\t\t\toptions.quantizationBits[attributeEnum],\r\n\t\t\t\tattribute.getElementSize(),\r\n\t\t\t\tquantizationVolume.min,\r\n\t\t\t\trange\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthrow new Error('Invalid quantization volume state.');\r\n\t\t}\r\n\t}\r\n\r\n\tconst indices = prim.getIndices();\r\n\tif (!indices) throw new Error('Primitive must have indices.');\r\n\r\n\tbuilder.AddFacesToMesh(mesh, indices.getCount() / 3, indices.getArray() as unknown as Uint32Array);\r\n\r\n\tencoder.SetSpeedOptions(options.encodeSpeed, options.decodeSpeed);\r\n\tencoder.SetTrackEncodedProperties(true);\r\n\r\n\t// Preserve vertex order for primitives with morph targets.\r\n\tif (options.method === EncoderMethod.SEQUENTIAL || prim.listTargets().length > 0) {\r\n\t\tencoder.SetEncodingMethod(encoderModule.MESH_SEQUENTIAL_ENCODING);\r\n\t} else {\r\n\t\tencoder.SetEncodingMethod(encoderModule.MESH_EDGEBREAKER_ENCODING);\r\n\t}\r\n\r\n\tconst byteLength = encoder.EncodeMeshToDracoBuffer(mesh, dracoBuffer);\r\n\tif (byteLength <= 0) throw new Error('Error applying Draco compression.');\r\n\r\n\tconst data = new Uint8Array(byteLength);\r\n\tfor (let i = 0; i < byteLength; ++i) {\r\n\t\tdata[i] = dracoBuffer.GetValue(i);\r\n\t}\r\n\r\n\tconst prevNumVertices = prim.getAttribute('POSITION')!.getCount();\r\n\tconst numVertices = encoder.GetNumberOfEncodedPoints();\r\n\tconst numIndices = encoder.GetNumberOfEncodedFaces() * 3;\r\n\r\n\tif (prim.listTargets().length > 0 && numVertices !== prevNumVertices) {\r\n\t\tthrow new Error(\r\n\t\t\t'Compression reduced vertex count unexpectedly, corrupting morph targets.' +\r\n\t\t\t\t' Applying the \"weld\" function before compression may resolve the issue.'\r\n\t\t);\r\n\t}\r\n\r\n\tencoderModule.destroy(dracoBuffer);\r\n\tencoderModule.destroy(mesh);\r\n\tencoderModule.destroy(builder);\r\n\tencoderModule.destroy(encoder);\r\n\r\n\treturn { numVertices, numIndices, data, attributeIDs };\r\n}\r\n\r\nfunction getAttributeEnum(semantic: string): AttributeEnum {\r\n\tif (semantic === 'POSITION') {\r\n\t\treturn AttributeEnum.POSITION;\r\n\t} else if (semantic === 'NORMAL') {\r\n\t\treturn AttributeEnum.NORMAL;\r\n\t} else if (semantic.startsWith('COLOR_')) {\r\n\t\treturn AttributeEnum.COLOR;\r\n\t} else if (semantic.startsWith('TEXCOORD_')) {\r\n\t\treturn AttributeEnum.TEX_COORD;\r\n\t}\r\n\treturn AttributeEnum.GENERIC;\r\n}\r\n\r\nfunction addAttribute(\r\n\tbuilder: MeshBuilder,\r\n\tcomponentType: GLTF.AccessorComponentType,\r\n\tmesh: Mesh,\r\n\tattribute: number,\r\n\tcount: number,\r\n\titemSize: number,\r\n\tarray: TypedArray\r\n): number {\r\n\tswitch (componentType) {\r\n\t\tcase Accessor.ComponentType.UNSIGNED_BYTE:\r\n\t\t\treturn builder.AddUInt8Attribute(mesh, attribute, count, itemSize, array);\r\n\t\tcase Accessor.ComponentType.BYTE:\r\n\t\t\treturn builder.AddInt8Attribute(mesh, attribute, count, itemSize, array);\r\n\t\tcase Accessor.ComponentType.UNSIGNED_SHORT:\r\n\t\t\treturn builder.AddUInt16Attribute(mesh, attribute, count, itemSize, array);\r\n\t\tcase Accessor.ComponentType.SHORT:\r\n\t\t\treturn builder.AddInt16Attribute(mesh, attribute, count, itemSize, array);\r\n\t\tcase Accessor.ComponentType.UNSIGNED_INT:\r\n\t\t\treturn builder.AddUInt32Attribute(mesh, attribute, count, itemSize, array);\r\n\t\tcase Accessor.ComponentType.FLOAT:\r\n\t\t\treturn builder.AddFloatAttribute(mesh, attribute, count, itemSize, array);\r\n\t\tdefault:\r\n\t\t\tthrow new Error(`Unexpected component type, \"${componentType}\".`);\r\n\t}\r\n}\r\n","import {\r\n\tAccessor,\r\n\tbbox,\r\n\tbounds,\r\n\tBufferUtils,\r\n\tDocument,\r\n\tExtension,\r\n\tGLB_BUFFER,\r\n\tPrimitive,\r\n\tPropertyType,\r\n\tReaderContext,\r\n\tWriterContext,\r\n} from '@gltf-transform/core';\r\nimport { decodeAttribute, decodeGeometry, decodeIndex, initDecoderModule } from './decoder';\r\nimport { EncodedPrimitive, encodeGeometry, EncoderMethod, EncoderOptions, initEncoderModule } from './encoder';\r\nimport { KHR_DRACO_MESH_COMPRESSION } from '../constants';\r\nimport type { Decoder, DecoderModule, EncoderModule, Mesh } from 'draco3dgltf';\r\n\r\nconst NAME = KHR_DRACO_MESH_COMPRESSION;\r\n\r\ninterface DracoPrimitiveExtension {\r\n\tbufferView: number;\r\n\tattributes: {\r\n\t\t[name: string]: number;\r\n\t};\r\n}\r\n\r\ninterface DracoWriterContext {\r\n\tprimitiveHashMap: Map<Primitive, string>;\r\n\tprimitiveEncodingMap: Map<string, EncodedPrimitive>;\r\n}\r\n\r\n/**\r\n * # DracoMeshCompression\r\n *\r\n * [`KHR_draco_mesh_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/)\r\n * provides advanced compression for mesh geometry.\r\n *\r\n * For models where geometry is a significant factor (>1 MB), Draco can reduce filesize by ~95%\r\n * in many cases. When animation or textures are large, other complementary compression methods\r\n * should be used as well. For geometry <1MB, the size of the WASM decoder library may outweigh\r\n * size savings.\r\n *\r\n * Be aware that decompression happens before uploading to the GPU  this will add some latency to\r\n * the parsing process, and means that compressing geometry with  Draco does _not_ affect runtime\r\n * performance. To improve framerate, you'll need to simplify the geometry by reducing vertex count\r\n * or draw calls  not just compress it. Finally, be aware that Draco compression is lossy:\r\n * repeatedly compressing and decompressing a model in a pipeline will lose precision, so\r\n * compression should generally be the last stage of an art workflow, and uncompressed original\r\n * files should be kept.\r\n *\r\n * A decoder or encoder from the `draco3dgltf` npm module for Node.js (or\r\n * [elsewhere for web](https://stackoverflow.com/a/66978236/1314762)) is required for reading and writing,\r\n * and must be provided by the application.\r\n *\r\n * ### Encoding options\r\n *\r\n * Two compression methods are available: 'edgebreaker' and 'sequential'. The\r\n * edgebreaker method will give higher compression in general, but changes the\r\n * order of the model's vertices. To preserve index order, use sequential\r\n * compression. When a mesh uses morph targets, or a high decoding speed is\r\n * selected, sequential compression will automatically be chosen.\r\n *\r\n * Both speed options affect the encoder's choice of algorithms. For example, a\r\n * requirement for fast decoding may prevent the encoder from using the best\r\n * compression methods even if the encoding speed is set to 0. In general, the\r\n * faster of the two options limits the choice of features that can be used by the\r\n * encoder. Setting --decodeSpeed to be faster than the --encodeSpeed may allow\r\n * the encoder to choose the optimal method out of the available features for the\r\n * given --decodeSpeed.\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { NodeIO } from '@gltf-transform/core';\r\n * import { DracoMeshCompression } from '@gltf-transform/extensions';\r\n *\r\n * import draco3d from 'draco3dgltf';\r\n *\r\n * // ...\r\n *\r\n * const io = new NodeIO()\r\n *\t.registerExtensions([DracoMeshCompression])\r\n *\t.registerDependencies({\r\n *\t\t'draco3d.decoder': await draco3d.createDecoderModule(), // Optional.\r\n *\t\t'draco3d.encoder': await draco3d.createEncoderModule(), // Optional.\r\n *\t});\r\n *\r\n * // Read and decode.\r\n * const document = await io.read('compressed.glb');\r\n *\r\n * // Write and encode.\r\n * document.createExtension(DracoMeshCompression)\r\n * \t.setRequired(true)\r\n * \t.setEncoderOptions({\r\n * \t\tmethod: DracoMeshCompression.EncoderMethod.EDGEBREAKER,\r\n * \t\tencodeSpeed: 5,\r\n * \t\tdecodeSpeed: 5,\r\n * \t});\r\n * await io.write('compressed.glb', document);\r\n * ```\r\n */\r\nexport class DracoMeshCompression extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\t/** @hidden */\r\n\tpublic readonly prereadTypes = [PropertyType.PRIMITIVE];\r\n\t/** @hidden */\r\n\tpublic readonly prewriteTypes = [PropertyType.ACCESSOR];\r\n\t/** @hidden */\r\n\tpublic readonly readDependencies = ['draco3d.decoder'];\r\n\t/** @hidden */\r\n\tpublic readonly writeDependencies = ['draco3d.encoder'];\r\n\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/**\r\n\t * Compression method. `EncoderMethod.EDGEBREAKER` usually provides a higher compression ratio,\r\n\t * while `EncoderMethod.SEQUENTIAL` better preserves original verter order.\r\n\t */\r\n\tpublic static readonly EncoderMethod = EncoderMethod;\r\n\r\n\tprivate _decoderModule: DecoderModule | null = null;\r\n\tprivate _encoderModule: EncoderModule | null = null;\r\n\tprivate _encoderOptions: EncoderOptions = {};\r\n\r\n\t/** @hidden */\r\n\tpublic install(key: string, dependency: unknown): this {\r\n\t\tif (key === 'draco3d.decoder') {\r\n\t\t\tthis._decoderModule = dependency as DecoderModule;\r\n\t\t\tinitDecoderModule(this._decoderModule);\r\n\t\t}\r\n\t\tif (key === 'draco3d.encoder') {\r\n\t\t\tthis._encoderModule = dependency as EncoderModule;\r\n\t\t\tinitEncoderModule(this._encoderModule);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets Draco compression options. Compression does not take effect until the Document is\r\n\t * written with an I/O class.\r\n\t *\r\n\t * Defaults:\r\n\t * ```\r\n\t * decodeSpeed?: number = 5;\r\n\t * encodeSpeed?: number = 5;\r\n\t * method?: EncoderMethod = EncoderMethod.EDGEBREAKER;\r\n\t * quantizationBits?: {[ATTRIBUTE_NAME]: bits};\r\n\t * quantizationVolume?: 'mesh' | 'scene' | bbox = 'mesh';\r\n\t * ```\r\n\t */\r\n\tpublic setEncoderOptions(options: EncoderOptions): this {\r\n\t\tthis._encoderOptions = options;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic preread(context: ReaderContext): this {\r\n\t\tif (!this._decoderModule) {\r\n\t\t\tthrow new Error(`[${NAME}] Please install extension dependency, \"draco3d.decoder\".`);\r\n\t\t}\r\n\r\n\t\tconst logger = this.document.getLogger();\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst dracoMeshes: Map<number, [Decoder, Mesh]> = new Map();\r\n\r\n\t\ttry {\r\n\t\t\tconst meshDefs = jsonDoc.json.meshes || [];\r\n\t\t\tfor (const meshDef of meshDefs) {\r\n\t\t\t\tfor (const primDef of meshDef.primitives) {\r\n\t\t\t\t\tif (!primDef.extensions || !primDef.extensions[NAME]) continue;\r\n\r\n\t\t\t\t\tconst dracoDef = primDef.extensions[NAME] as DracoPrimitiveExtension;\r\n\t\t\t\t\tlet [decoder, dracoMesh] = dracoMeshes.get(dracoDef.bufferView) || [];\r\n\r\n\t\t\t\t\tif (!dracoMesh || !decoder) {\r\n\t\t\t\t\t\tconst bufferViewDef = jsonDoc.json.bufferViews![dracoDef.bufferView];\r\n\t\t\t\t\t\tconst bufferDef = jsonDoc.json.buffers![bufferViewDef.buffer];\r\n\t\t\t\t\t\t// TODO(cleanup): Should be encapsulated in writer-context.ts.\r\n\t\t\t\t\t\tconst resource = bufferDef.uri\r\n\t\t\t\t\t\t\t? jsonDoc.resources[bufferDef.uri]\r\n\t\t\t\t\t\t\t: jsonDoc.resources[GLB_BUFFER];\r\n\r\n\t\t\t\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\t\t\t\tconst byteLength = bufferViewDef.byteLength;\r\n\t\t\t\t\t\tconst compressedData = BufferUtils.toView(resource, byteOffset, byteLength);\r\n\r\n\t\t\t\t\t\tdecoder = new this._decoderModule.Decoder();\r\n\t\t\t\t\t\tdracoMesh = decodeGeometry(decoder, compressedData);\r\n\t\t\t\t\t\tdracoMeshes.set(dracoDef.bufferView, [decoder, dracoMesh]);\r\n\t\t\t\t\t\tlogger.debug(`[${NAME}] Decompressed ${compressedData.byteLength} bytes.`);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Attributes.\r\n\t\t\t\t\tfor (const semantic in primDef.attributes) {\r\n\t\t\t\t\t\tconst accessorDef = context.jsonDoc.json.accessors![primDef.attributes[semantic]];\r\n\t\t\t\t\t\tconst dracoAttribute = decoder.GetAttributeByUniqueId(dracoMesh, dracoDef.attributes[semantic]);\r\n\t\t\t\t\t\tconst attributeArray = decodeAttribute(decoder, dracoMesh, dracoAttribute, accessorDef);\r\n\t\t\t\t\t\tcontext.accessors[primDef.attributes[semantic]].setArray(attributeArray);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Indices. Optional, see https://github.com/google/draco/issues/720.\r\n\t\t\t\t\tif (primDef.indices !== undefined) {\r\n\t\t\t\t\t\tcontext.accessors[primDef.indices].setArray(decodeIndex(decoder, dracoMesh));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tfor (const [decoder, dracoMesh] of Array.from(dracoMeshes.values())) {\r\n\t\t\t\tthis._decoderModule.destroy(decoder);\r\n\t\t\t\tthis._decoderModule.destroy(dracoMesh);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(_context: ReaderContext): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic prewrite(context: WriterContext, _propertyType: PropertyType): this {\r\n\t\tif (!this._encoderModule) {\r\n\t\t\tthrow new Error(`[${NAME}] Please install extension dependency, \"draco3d.encoder\".`);\r\n\t\t}\r\n\r\n\t\tconst logger = this.document.getLogger();\r\n\t\tlogger.debug(`[${NAME}] Compression options: ${JSON.stringify(this._encoderOptions)}`);\r\n\r\n\t\tconst primitiveHashMap = listDracoPrimitives(this.document);\r\n\t\tconst primitiveEncodingMap = new Map<string, EncodedPrimitive>();\r\n\r\n\t\tlet quantizationVolume: bbox | 'mesh' = 'mesh';\r\n\t\tif (this._encoderOptions.quantizationVolume === 'scene') {\r\n\t\t\tif (this.document.getRoot().listScenes().length !== 1) {\r\n\t\t\t\tlogger.warn(`[${NAME}]: quantizationVolume=scene requires exactly 1 scene.`);\r\n\t\t\t} else {\r\n\t\t\t\tquantizationVolume = bounds(this.document.getRoot().listScenes().pop()!);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const prim of Array.from(primitiveHashMap.keys())) {\r\n\t\t\tconst primHash = primitiveHashMap.get(prim);\r\n\t\t\tif (!primHash) throw new Error('Unexpected primitive.');\r\n\r\n\t\t\t// Reuse an existing EncodedPrimitive, if possible.\r\n\t\t\tif (primitiveEncodingMap.has(primHash)) {\r\n\t\t\t\tprimitiveEncodingMap.set(primHash, primitiveEncodingMap.get(primHash)!);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst indices = prim.getIndices()!; // Condition for listDracoPrimitives().\r\n\t\t\tconst accessorDefs = context.jsonDoc.json.accessors!;\r\n\r\n\t\t\t// Create a new EncodedPrimitive.\r\n\t\t\tconst encodedPrim = encodeGeometry(prim, { ...this._encoderOptions, quantizationVolume });\r\n\t\t\tprimitiveEncodingMap.set(primHash, encodedPrim);\r\n\r\n\t\t\t// Create indices definition, update count.\r\n\t\t\tconst indicesDef = context.createAccessorDef(indices);\r\n\t\t\tindicesDef.count = encodedPrim.numIndices;\r\n\t\t\tcontext.accessorIndexMap.set(indices, accessorDefs.length);\r\n\t\t\taccessorDefs.push(indicesDef);\r\n\r\n\t\t\t// Create attribute definitions, update count.\r\n\t\t\tfor (const semantic of prim.listSemantics()) {\r\n\t\t\t\tconst attribute = prim.getAttribute(semantic)!;\r\n\t\t\t\tconst attributeDef = context.createAccessorDef(attribute);\r\n\t\t\t\tattributeDef.count = encodedPrim.numVertices;\r\n\t\t\t\tcontext.accessorIndexMap.set(attribute, accessorDefs.length);\r\n\t\t\t\taccessorDefs.push(attributeDef);\r\n\t\t\t}\r\n\r\n\t\t\t// Map compressed buffer view to a Buffer.\r\n\t\t\tconst buffer = prim.getAttribute('POSITION')!.getBuffer() || this.document.getRoot().listBuffers()[0];\r\n\t\t\tif (!context.otherBufferViews.has(buffer)) context.otherBufferViews.set(buffer, []);\r\n\t\t\tcontext.otherBufferViews.get(buffer)!.push(encodedPrim.data);\r\n\t\t}\r\n\r\n\t\tlogger.debug(`[${NAME}] Compressed ${primitiveHashMap.size} primitives.`);\r\n\r\n\t\tcontext.extensionData[NAME] = {\r\n\t\t\tprimitiveHashMap,\r\n\t\t\tprimitiveEncodingMap,\r\n\t\t} as DracoWriterContext;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst dracoContext: DracoWriterContext = context.extensionData[NAME] as DracoWriterContext;\r\n\r\n\t\tfor (const mesh of this.document.getRoot().listMeshes()) {\r\n\t\t\tconst meshDef = context.jsonDoc.json.meshes![context.meshIndexMap.get(mesh)!];\r\n\t\t\tfor (let i = 0; i < mesh.listPrimitives().length; i++) {\r\n\t\t\t\tconst prim = mesh.listPrimitives()[i];\r\n\t\t\t\tconst primDef = meshDef.primitives[i];\r\n\r\n\t\t\t\tconst primHash = dracoContext.primitiveHashMap.get(prim);\r\n\t\t\t\tif (!primHash) continue;\r\n\r\n\t\t\t\tconst encodedPrim = dracoContext.primitiveEncodingMap.get(primHash)!;\r\n\t\t\t\tprimDef.extensions = primDef.extensions || {};\r\n\t\t\t\tprimDef.extensions[NAME] = {\r\n\t\t\t\t\tbufferView: context.otherBufferViewsIndexMap.get(encodedPrim.data),\r\n\t\t\t\t\tattributes: encodedPrim.attributeIDs,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Omit the extension if nothing was compressed.\r\n\t\tif (!dracoContext.primitiveHashMap.size) {\r\n\t\t\tconst json = context.jsonDoc.json;\r\n\t\t\tjson.extensionsUsed = (json.extensionsUsed || []).filter((name) => name !== NAME);\r\n\t\t\tjson.extensionsRequired = (json.extensionsRequired || []).filter((name) => name !== NAME);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a list of Primitives compatible with Draco compression. If any required preconditions\r\n * fail, and would break assumptions required for compression, this function will throw an error.\r\n */\r\nfunction listDracoPrimitives(doc: Document): Map<Primitive, string> {\r\n\tconst logger = doc.getLogger();\r\n\tconst included = new Set<Primitive>();\r\n\tconst excluded = new Set<Primitive>();\r\n\r\n\t// Support compressing only indexed, mode=TRIANGLES primitives.\r\n\tfor (const mesh of doc.getRoot().listMeshes()) {\r\n\t\tfor (const prim of mesh.listPrimitives()) {\r\n\t\t\tif (!prim.getIndices()) {\r\n\t\t\t\texcluded.add(prim);\r\n\t\t\t\tlogger.warn(`[${NAME}] Skipping Draco compression on non-indexed primitive.`);\r\n\t\t\t} else if (prim.getMode() !== Primitive.Mode.TRIANGLES) {\r\n\t\t\t\texcluded.add(prim);\r\n\t\t\t\tlogger.warn(`[${NAME}] Skipping Draco compression on non-TRIANGLES primitive.`);\r\n\t\t\t} else {\r\n\t\t\t\tincluded.add(prim);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Create an Accessor->index mapping.\r\n\tconst accessors = doc.getRoot().listAccessors();\r\n\tconst accessorIndices = new Map<Accessor, number>();\r\n\tfor (let i = 0; i < accessors.length; i++) accessorIndices.set(accessors[i], i);\r\n\r\n\t// For each compressed Primitive, create a hash key identifying its accessors. Map each\r\n\t// compressed Primitive and Accessor to this hash key.\r\n\tconst includedAccessors = new Map<Accessor, string>();\r\n\tconst includedHashKeys = new Set<string>();\r\n\tconst primToHashKey = new Map<Primitive, string>();\r\n\tfor (const prim of Array.from(included)) {\r\n\t\tlet hashKey = createHashKey(prim, accessorIndices);\r\n\r\n\t\t// If accessors of an identical primitive have already been checked, we're done.\r\n\t\tif (includedHashKeys.has(hashKey)) {\r\n\t\t\tprimToHashKey.set(prim, hashKey);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\t// If any accessors are already in use, but the same hashKey hasn't been written, then we\r\n\t\t// need to create copies of these accessors for the current encoded primitive. We can't\r\n\t\t// reuse the same compressed accessor for two encoded primitives, because Draco might\r\n\t\t// change the vertex count, change the vertex order, or cause other conflicts.\r\n\t\tif (includedAccessors.has(prim.getIndices()!)) {\r\n\t\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\r\n\t\t\tconst dstIndices = indices.clone();\r\n\t\t\taccessorIndices.set(dstIndices, doc.getRoot().listAccessors().length - 1);\r\n\t\t\tprim.swap(indices, dstIndices); // TODO(cleanup): I/O should not modify Document.\r\n\t\t}\r\n\t\tfor (const attribute of prim.listAttributes()) {\r\n\t\t\tif (includedAccessors.has(attribute)) {\r\n\t\t\t\tconst dstAttribute = attribute.clone();\r\n\t\t\t\taccessorIndices.set(dstAttribute, doc.getRoot().listAccessors().length - 1);\r\n\t\t\t\tprim.swap(attribute, dstAttribute); // TODO(cleanup): I/O should not modify Document.\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// With conflicts resolved, compute the hash key again.\r\n\t\thashKey = createHashKey(prim, accessorIndices);\r\n\r\n\t\t// Commit the primitive and its accessors to the hash key.\r\n\t\tincludedHashKeys.add(hashKey);\r\n\t\tprimToHashKey.set(prim, hashKey);\r\n\t\tincludedAccessors.set(prim.getIndices()!, hashKey);\r\n\t\tfor (const attribute of prim.listAttributes()) {\r\n\t\t\tincludedAccessors.set(attribute, hashKey);\r\n\t\t}\r\n\t}\r\n\r\n\t// For each compressed Accessor, ensure that it isn't used except by a Primitive.\r\n\tfor (const accessor of Array.from(includedAccessors.keys())) {\r\n\t\tconst parentTypes = new Set(accessor.listParents().map((prop) => prop.propertyType));\r\n\t\tif (parentTypes.size !== 2 || !parentTypes.has(PropertyType.PRIMITIVE) || !parentTypes.has(PropertyType.ROOT)) {\r\n\t\t\tthrow new Error(`[${NAME}] Compressed accessors must only be used as indices or vertex attributes.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// For each compressed Primitive, ensure that Accessors are mapped only to the same hash key.\r\n\tfor (const prim of Array.from(included)) {\r\n\t\tconst hashKey = primToHashKey.get(prim);\r\n\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\r\n\t\tif (\r\n\t\t\tincludedAccessors.get(indices) !== hashKey ||\r\n\t\t\tprim.listAttributes().some((attr) => includedAccessors.get(attr) !== hashKey)\r\n\t\t) {\r\n\t\t\tthrow new Error(`[${NAME}] Draco primitives must share all, or no, accessors.`);\r\n\t\t}\r\n\t}\r\n\r\n\t// For each excluded Primitive, ensure that no Accessors are compressed.\r\n\tfor (const prim of Array.from(excluded)) {\r\n\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\r\n\t\tif (includedAccessors.has(indices) || prim.listAttributes().some((attr) => includedAccessors.has(attr))) {\r\n\t\t\tthrow new Error(`[${NAME}] Accessor cannot be shared by compressed and uncompressed primitives.`);\r\n\t\t}\r\n\t}\r\n\r\n\treturn primToHashKey;\r\n}\r\n\r\nfunction createHashKey(prim: Primitive, indexMap: Map<Accessor, number>): string {\r\n\tconst hashElements = [];\r\n\tconst indices = prim.getIndices()!; // Condition for 'included' list.\r\n\r\n\thashElements.push(indexMap.get(indices));\r\n\tfor (const attribute of prim.listAttributes()) {\r\n\t\thashElements.push(indexMap.get(attribute));\r\n\t}\r\n\r\n\treturn hashElements.sort().join('|');\r\n}\r\n","import { ExtensionProperty, IProperty, Nullable, PropertyType, vec3 } from '@gltf-transform/core';\r\nimport { ColorUtils } from '@gltf-transform/core';\r\nimport { KHR_LIGHTS_PUNCTUAL } from '../constants';\r\n\r\ninterface ILight extends IProperty {\r\n\tcolor: vec3;\r\n\tintensity: number;\r\n\ttype: PunctualLightType;\r\n\trange: number | null;\r\n\tinnerConeAngle: number;\r\n\touterConeAngle: number;\r\n}\r\n\r\ntype PunctualLightType = 'point' | 'spot' | 'directional';\r\n\r\n/**\r\n * # Light\r\n *\r\n * Defines a light attached to a {@link Node}. See {@link LightsPunctual}.\r\n */\r\nexport class Light extends ExtensionProperty<ILight> {\r\n\tpublic static EXTENSION_NAME = KHR_LIGHTS_PUNCTUAL;\r\n\tpublic declare extensionName: typeof KHR_LIGHTS_PUNCTUAL;\r\n\tpublic declare propertyType: 'Light';\r\n\tpublic declare parentTypes: [PropertyType.NODE];\r\n\r\n\t/**********************************************************************************************\r\n\t * CONSTANTS.\r\n\t */\r\n\r\n\tpublic static Type: Record<string, PunctualLightType> = {\r\n\t\tPOINT: 'point',\r\n\t\tSPOT: 'spot',\r\n\t\tDIRECTIONAL: 'directional',\r\n\t};\r\n\r\n\t/**********************************************************************************************\r\n\t * INSTANCE.\r\n\t */\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_LIGHTS_PUNCTUAL;\r\n\t\tthis.propertyType = 'Light';\r\n\t\tthis.parentTypes = [PropertyType.NODE];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ILight> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tcolor: [1, 1, 1] as vec3,\r\n\t\t\tintensity: 1,\r\n\t\t\ttype: Light.Type.POINT,\r\n\t\t\trange: null,\r\n\t\t\tinnerConeAngle: 0,\r\n\t\t\touterConeAngle: Math.PI / 4,\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * COLOR.\r\n\t */\r\n\r\n\t/** Light color; Linear-sRGB components. */\r\n\tpublic getColor(): vec3 {\r\n\t\treturn this.get('color');\r\n\t}\r\n\r\n\t/** Light color; Linear-sRGB components. */\r\n\tpublic setColor(color: vec3): this {\r\n\t\treturn this.set('color', color);\r\n\t}\r\n\r\n\t/** Light color; sRGB hexadecimal color. */\r\n\tpublic getColorHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getColor());\r\n\t}\r\n\r\n\t/** Light color; sRGB hexadecimal color. */\r\n\tpublic setColorHex(hex: number): this {\r\n\t\tconst color = this.getColor().slice() as vec3;\r\n\t\tColorUtils.hexToFactor(hex, color);\r\n\t\treturn this.setColor(color);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * INTENSITY.\r\n\t */\r\n\r\n\t/**\r\n\t * Brightness of light. Units depend on the type of light: point and spot lights use luminous\r\n\t * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\r\n\t */\r\n\tpublic getIntensity(): number {\r\n\t\treturn this.get('intensity');\r\n\t}\r\n\r\n\t/**\r\n\t * Brightness of light. Units depend on the type of light: point and spot lights use luminous\r\n\t * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\r\n\t */\r\n\tpublic setIntensity(intensity: number): this {\r\n\t\treturn this.set('intensity', intensity);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * TYPE.\r\n\t */\r\n\r\n\t/** Type. */\r\n\tpublic getType(): PunctualLightType {\r\n\t\treturn this.get('type');\r\n\t}\r\n\r\n\t/** Type. */\r\n\tpublic setType(type: PunctualLightType): this {\r\n\t\treturn this.set('type', type);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * RANGE.\r\n\t */\r\n\r\n\t/**\r\n\t * Hint defining a distance cutoff at which the light's intensity may be considered to have\r\n\t * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\r\n\t * is assumed to be infinite.\r\n\t */\r\n\tpublic getRange(): number | null {\r\n\t\treturn this.get('range');\r\n\t}\r\n\r\n\t/**\r\n\t * Hint defining a distance cutoff at which the light's intensity may be considered to have\r\n\t * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\r\n\t * is assumed to be infinite.\r\n\t */\r\n\tpublic setRange(range: number | null): this {\r\n\t\treturn this.set('range', range);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * SPOT LIGHT PROPERTIES\r\n\t */\r\n\r\n\t/**\r\n\t * Angle, in radians, from centre of spotlight where falloff begins. Must be  0 and\r\n\t * < outerConeAngle.\r\n\t */\r\n\tpublic getInnerConeAngle(): number {\r\n\t\treturn this.get('innerConeAngle');\r\n\t}\r\n\r\n\t/**\r\n\t * Angle, in radians, from centre of spotlight where falloff begins. Must be  0 and\r\n\t * < outerConeAngle.\r\n\t */\r\n\tpublic setInnerConeAngle(angle: number): this {\r\n\t\treturn this.set('innerConeAngle', angle);\r\n\t}\r\n\r\n\t/**\r\n\t * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\r\n\t *  PI / 2.0.\r\n\t */\r\n\tpublic getOuterConeAngle(): number {\r\n\t\treturn this.get('outerConeAngle');\r\n\t}\r\n\r\n\t/**\r\n\t * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\r\n\t *  PI / 2.0.\r\n\t */\r\n\tpublic setOuterConeAngle(angle: number): this {\r\n\t\treturn this.set('outerConeAngle', angle);\r\n\t}\r\n}\r\n","import { Extension, MathUtils, ReaderContext, WriterContext, vec3 } from '@gltf-transform/core';\r\nimport { KHR_LIGHTS_PUNCTUAL } from '../constants';\r\nimport { Light } from './light';\r\n\r\nconst NAME = KHR_LIGHTS_PUNCTUAL;\r\n\r\ninterface LightsPunctualRootDef {\r\n\tlights?: LightDef[];\r\n}\r\n\r\ninterface LightsPunctualNodeDef {\r\n\tlight: number;\r\n}\r\n\r\ninterface LightDef {\r\n\tname?: string;\r\n\tcolor?: vec3;\r\n\tintensity?: number;\r\n\trange?: number;\r\n\ttype: 'spot' | 'point' | 'directional';\r\n\tspot?: {\r\n\t\tinnerConeAngle?: number;\r\n\t\touterConeAngle?: number;\r\n\t};\r\n}\r\n\r\n/**\r\n * # LightsPunctual\r\n *\r\n * [`KHR_lights_punctual`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_lights_punctual/) defines three \"punctual\" light types: directional, point and\r\n * spot.\r\n *\r\n * Punctual lights are parameterized, infinitely small points that emit light in\r\n * well-defined directions and intensities. Lights are referenced by nodes and inherit the transform\r\n * of that node.\r\n *\r\n * Properties:\r\n * - {@link Light}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { LightsPunctual, Light, LightType } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const lightsExtension = document.createExtension(LightsPunctual);\r\n *\r\n * // Create a Light property.\r\n * const light = lightsExtension.createLight()\r\n *\t.setType(LightType.POINT)\r\n *\t.setIntensity(2.0)\r\n *\t.setColor([1.0, 0.0, 0.0]);\r\n *\r\n * // Attach the property to a Material.\r\n * node.setExtension('KHR_lights_punctual', light);\r\n * ```\r\n */\r\nexport class LightsPunctual extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new punctual Light property for use on a {@link Node}. */\r\n\tpublic createLight(name = ''): Light {\r\n\t\treturn new Light(this.document.getGraph(), name);\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tif (!jsonDoc.json.extensions || !jsonDoc.json.extensions[NAME]) return this;\r\n\r\n\t\tconst rootDef = jsonDoc.json.extensions[NAME] as LightsPunctualRootDef;\r\n\t\tconst lightDefs = rootDef.lights || ([] as LightDef[]);\r\n\t\tconst lights = lightDefs.map((lightDef) => {\r\n\t\t\tconst light = this.createLight()\r\n\t\t\t\t.setName(lightDef.name || '')\r\n\t\t\t\t.setType(lightDef.type);\r\n\r\n\t\t\tif (lightDef.color !== undefined) light.setColor(lightDef.color);\r\n\t\t\tif (lightDef.intensity !== undefined) light.setIntensity(lightDef.intensity);\r\n\t\t\tif (lightDef.range !== undefined) light.setRange(lightDef.range);\r\n\r\n\t\t\tif (lightDef.spot?.innerConeAngle !== undefined) {\r\n\t\t\t\tlight.setInnerConeAngle(lightDef.spot.innerConeAngle);\r\n\t\t\t}\r\n\t\t\tif (lightDef.spot?.outerConeAngle !== undefined) {\r\n\t\t\t\tlight.setOuterConeAngle(lightDef.spot.outerConeAngle);\r\n\t\t\t}\r\n\r\n\t\t\treturn light;\r\n\t\t});\r\n\r\n\t\tjsonDoc.json.nodes!.forEach((nodeDef, nodeIndex) => {\r\n\t\t\tif (!nodeDef.extensions || !nodeDef.extensions[NAME]) return;\r\n\t\t\tconst lightNodeDef = nodeDef.extensions[NAME] as LightsPunctualNodeDef;\r\n\t\t\tcontext.nodes[nodeIndex].setExtension(NAME, lights[lightNodeDef.light]);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tif (this.properties.size === 0) return this;\r\n\r\n\t\tconst lightDefs = [];\r\n\t\tconst lightIndexMap = new Map<Light, number>();\r\n\r\n\t\tfor (const property of this.properties) {\r\n\t\t\tconst light = property as Light;\r\n\t\t\tconst lightDef = { type: light.getType() } as LightDef;\r\n\r\n\t\t\tif (!MathUtils.eq(light.getColor(), [1, 1, 1])) lightDef.color = light.getColor();\r\n\t\t\tif (light.getIntensity() !== 1) lightDef.intensity = light.getIntensity();\r\n\t\t\tif (light.getRange() != null) lightDef.range = light.getRange()!;\r\n\r\n\t\t\tif (light.getName()) lightDef.name = light.getName();\r\n\r\n\t\t\tif (light.getType() === Light.Type.SPOT) {\r\n\t\t\t\tlightDef.spot = {\r\n\t\t\t\t\tinnerConeAngle: light.getInnerConeAngle(),\r\n\t\t\t\t\touterConeAngle: light.getOuterConeAngle(),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tlightDefs.push(lightDef);\r\n\t\t\tlightIndexMap.set(light, lightDefs.length - 1);\r\n\t\t}\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listNodes()\r\n\t\t\t.forEach((node) => {\r\n\t\t\t\tconst light = node.getExtension<Light>(NAME);\r\n\t\t\t\tif (light) {\r\n\t\t\t\t\tconst nodeIndex = context.nodeIndexMap.get(node)!;\r\n\t\t\t\t\tconst nodeDef = jsonDoc.json.nodes![nodeIndex];\r\n\t\t\t\t\tnodeDef.extensions = nodeDef.extensions || {};\r\n\t\t\t\t\tnodeDef.extensions[NAME] = { light: lightIndexMap.get(light) };\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tjsonDoc.json.extensions = jsonDoc.json.extensions || {};\r\n\t\tjsonDoc.json.extensions[NAME] = { lights: lightDefs };\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n  vec3\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_ANISOTROPY } from '../constants';\r\n\r\n\r\ninterface IAnisotropy extends IProperty {\r\n\tanisotropy: number;\r\n\tanisotropyTexture: Texture;\r\n\tanisotropyTextureInfo: TextureInfo;\r\n\r\n\tanisotropyDirection: vec3;\r\n\tanisotropyDirectionTexture: Texture;\r\n\tanisotropyDirectionTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B } = TextureChannel;\r\n\r\n/**\r\n * # Anisotropy\r\n *\r\n * Defines anisotropy for a PBR material. See {@link MaterialsAnisotropy}.\r\n */\r\nexport class Anisotropy extends ExtensionProperty<IAnisotropy> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_ANISOTROPY;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_ANISOTROPY;\r\n\tpublic declare propertyType: 'Anisotropy';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n  protected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_ANISOTROPY;\r\n\t\tthis.propertyType = 'Anisotropy';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n  protected getDefaults(): Nullable<IAnisotropy> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tanisotropy: 0,\r\n\t\t\tanisotropyTexture: null,\r\n\t\t\tanisotropyTextureInfo: new TextureInfo(this.graph, 'anisotropyTextureInfo'),\r\n\r\n\t\t\tanisotropyDirection: [1.0, 0.0, 0.0] as vec3,\r\n\t\t\tanisotropyDirectionTexture: null,\r\n\t\t\tanisotropyDirectionTextureInfo: new TextureInfo(this.graph, 'anisotropyDirectionTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Anisotropy.\r\n\t */\r\n\r\n\t/** Anisotropy; See {@link getAnisotropyTexture. */\r\n\tpublic getAnisotropy(): number {\r\n    return this.get('anisotropy');\r\n  }\r\n\r\n\t/** Anisotropy; See {@link setAnisotropyTexture.}. */\r\n\tpublic setAnisotropy(val: number): this {\r\n    return this.set('anisotropy', val);\r\n\t}\r\n\r\n\t/**\r\n\t * Anisotropy texture.\r\n\t */\r\n\tpublic getAnisotropyTexture(): Texture | null {\r\n\t\treturn this.getRef('anisotropyTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its anisotropy texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getAnisotropyTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('anisotropyTexture') ? this.getRef('anisotropyTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets anisotropy texture. See {@link getAnisotropyTexture}. */\r\n\tpublic setAnisotropyTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('anisotropyTexture', texture, { channels: R });\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Anisotropy direction.\r\n\t */\r\n\r\n\t/** Anisotropy direction; See {@link getAnisotropyDirectionTexture}. */\r\n\tpublic getAnisotropyDirection(): vec3 {\r\n\t\treturn this.get('anisotropyDirection');\r\n  }\r\n\r\n\t/** Anisotropy direction; See {@link setAnisotropyDirectionTexture}. */\r\n\tpublic setAnisotropyDirection(direction: vec3): this {\r\n\t\treturn this.set('anisotropyDirection', direction);\r\n\t}\r\n\r\n\t/**\r\n\t * Anisotropy direction texture.\r\n\t */\r\n\tpublic getAnisotropyDirectionTexture(): Texture | null {\r\n\t\treturn this.getRef('anisotropyDirectionTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its anisotropy direction texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getAnisotropyDirectionTextureInfo(): TextureInfo | null {\r\n    return this.getRef('anisotropyDirectionTexture') ? this.getRef('anisotropyDirectionTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets anisotropy direction texture. See {@link getAnisotropyDirectionTexture}. */\r\n\tpublic setAnisotropyDirectionTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('anisotropyDirectionTexture', texture, { channels: G });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3 } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_ANISOTROPY} from '../constants';\r\nimport { Anisotropy } from './anisotropy';\r\n\r\nconst NAME = KHR_MATERIALS_ANISOTROPY;\r\n\r\ninterface AnisotropyDef {\r\n\tanisotropy?: number;\r\n\tanisotropyDirection?: vec3;\r\n\tanisotropyTexture?: GLTF.ITextureInfo;\r\n\tanisotropyDirectionTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsAnisotropy\r\n */\r\nexport class MaterialsAnisotropy extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\tpublic createAnisotropy(): Anisotropy {\r\n\t\treturn new Anisotropy(this.document.getGraph());\r\n\t}\r\n\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst anisotropy = this.createAnisotropy();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, anisotropy);\r\n\r\n\t\t\t\tconst anisotropyDef = materialDef.extensions[NAME] as AnisotropyDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (anisotropyDef.anisotropy !== undefined) {\r\n\t\t\t\t\tanisotropy.setAnisotropy(anisotropyDef.anisotropy);\r\n\t\t\t\t}\r\n\t\t\t\tif (anisotropyDef.anisotropyDirection !== undefined) {\r\n\t\t\t\t\tanisotropy.setAnisotropyDirection(\r\n\t\t\t\t\t\tanisotropyDef.anisotropyDirection\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (anisotropyDef.anisotropyTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = anisotropyDef.anisotropyTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tanisotropy.setAnisotropyTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(anisotropy.getAnisotropyTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (anisotropyDef.anisotropyDirectionTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = anisotropyDef.anisotropyDirectionTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tanisotropy.setAnisotropyDirectionTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(\r\n\t\t\t\t\t\tanisotropy.getAnisotropyDirectionTextureInfo()!,\r\n\t\t\t\t\t\ttextureInfoDef\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst anisotropy = material.getExtension<Anisotropy>(NAME);\r\n\t\t\t\tif (anisotropy) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst anisotropyDef = materialDef.extensions[NAME] = {\r\n\t\t\t\t\t\tanisotropy: anisotropy.getAnisotropy(),\r\n\t\t\t\t\t\tanisotropyDirection: anisotropy.getAnisotropyDirection(),\r\n\t\t\t\t\t} as AnisotropyDef;\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (anisotropy.getAnisotropyTexture()) {\r\n\t\t\t\t\t\tconst texture = anisotropy.getAnisotropyTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = anisotropy.getAnisotropyTextureInfo()!;\r\n\t\t\t\t\t\tanisotropyDef.anisotropyTexture\r\n\t\t\t\t\t\t\t= context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (anisotropy.getAnisotropyDirectionTexture()) {\r\n\t\t\t\t\t\tconst texture = anisotropy.getAnisotropyDirectionTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = anisotropy.getAnisotropyDirectionTextureInfo()!;\r\n\t\t\t\t\t\tanisotropyDef.anisotropyDirectionTexture\r\n\t\t\t\t\t\t\t= context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_CLEARCOAT } from '../constants';\r\n\r\ninterface IClearcoat extends IProperty {\r\n\tclearcoatFactor: number;\r\n\tclearcoatTexture: Texture;\r\n\tclearcoatTextureInfo: TextureInfo;\r\n\r\n\tclearcoatRoughnessFactor: number;\r\n\tclearcoatRoughnessTexture: Texture;\r\n\tclearcoatRoughnessTextureInfo: TextureInfo;\r\n\r\n\tclearcoatNormalScale: number;\r\n\tclearcoatNormalTexture: Texture;\r\n\tclearcoatNormalTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B } = TextureChannel;\r\n\r\n/**\r\n * # Clearcoat\r\n *\r\n * Defines clear coat for a PBR material. See {@link MaterialsClearcoat}.\r\n */\r\nexport class Clearcoat extends ExtensionProperty<IClearcoat> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_CLEARCOAT;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_CLEARCOAT;\r\n\tpublic declare propertyType: 'Clearcoat';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_CLEARCOAT;\r\n\t\tthis.propertyType = 'Clearcoat';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IClearcoat> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tclearcoatFactor: 0,\r\n\t\t\tclearcoatTexture: null,\r\n\t\t\tclearcoatTextureInfo: new TextureInfo(this.graph, 'clearcoatTextureInfo'),\r\n\r\n\t\t\tclearcoatRoughnessFactor: 0,\r\n\t\t\tclearcoatRoughnessTexture: null,\r\n\t\t\tclearcoatRoughnessTextureInfo: new TextureInfo(this.graph, 'clearcoatRoughnessTextureInfo'),\r\n\r\n\t\t\tclearcoatNormalScale: 1,\r\n\t\t\tclearcoatNormalTexture: null,\r\n\t\t\tclearcoatNormalTextureInfo: new TextureInfo(this.graph, 'clearcoatNormalTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Clearcoat.\r\n\t */\r\n\r\n\t/** Clearcoat; linear multiplier. See {@link getClearcoatTexture}. */\r\n\tpublic getClearcoatFactor(): number {\r\n\t\treturn this.get('clearcoatFactor');\r\n\t}\r\n\r\n\t/** Clearcoat; linear multiplier. See {@link getClearcoatTexture}. */\r\n\tpublic setClearcoatFactor(factor: number): this {\r\n\t\treturn this.set('clearcoatFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Clearcoat texture; linear multiplier. The `r` channel of this texture specifies an amount\r\n\t * [0-1] of coating over the surface of the material, which may have its own roughness and\r\n\t * normal map properties.\r\n\t */\r\n\tpublic getClearcoatTexture(): Texture | null {\r\n\t\treturn this.getRef('clearcoatTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its clearcoat texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getClearcoatTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('clearcoatTexture') ? this.getRef('clearcoatTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets clearcoat texture. See {@link getClearcoatTexture}. */\r\n\tpublic setClearcoatTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('clearcoatTexture', texture, { channels: R });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Clearcoat roughness.\r\n\t */\r\n\r\n\t/** Clearcoat roughness; linear multiplier. See {@link getClearcoatRoughnessTexture}. */\r\n\tpublic getClearcoatRoughnessFactor(): number {\r\n\t\treturn this.get('clearcoatRoughnessFactor');\r\n\t}\r\n\r\n\t/** Clearcoat roughness; linear multiplier. See {@link getClearcoatRoughnessTexture}. */\r\n\tpublic setClearcoatRoughnessFactor(factor: number): this {\r\n\t\treturn this.set('clearcoatRoughnessFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Clearcoat roughness texture; linear multiplier. The `g` channel of this texture specifies\r\n\t * roughness, independent of the base layer's roughness.\r\n\t */\r\n\tpublic getClearcoatRoughnessTexture(): Texture | null {\r\n\t\treturn this.getRef('clearcoatRoughnessTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its clearcoat roughness texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getClearcoatRoughnessTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('clearcoatRoughnessTexture') ? this.getRef('clearcoatRoughnessTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets clearcoat roughness texture. See {@link getClearcoatRoughnessTexture}. */\r\n\tpublic setClearcoatRoughnessTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('clearcoatRoughnessTexture', texture, { channels: G });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Clearcoat normals.\r\n\t */\r\n\r\n\t/** Clearcoat normal scale. See {@link getClearcoatNormalTexture}. */\r\n\tpublic getClearcoatNormalScale(): number {\r\n\t\treturn this.get('clearcoatNormalScale');\r\n\t}\r\n\r\n\t/** Clearcoat normal scale. See {@link getClearcoatNormalTexture}. */\r\n\tpublic setClearcoatNormalScale(scale: number): this {\r\n\t\treturn this.set('clearcoatNormalScale', scale);\r\n\t}\r\n\r\n\t/**\r\n\t * Clearcoat normal map. Independent of the material base layer normal map.\r\n\t */\r\n\tpublic getClearcoatNormalTexture(): Texture | null {\r\n\t\treturn this.getRef('clearcoatNormalTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its clearcoat normal texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getClearcoatNormalTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('clearcoatNormalTexture') ? this.getRef('clearcoatNormalTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets clearcoat normal texture. See {@link getClearcoatNormalTexture}. */\r\n\tpublic setClearcoatNormalTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('clearcoatNormalTexture', texture, { channels: R | G | B });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_CLEARCOAT } from '../constants';\r\nimport { Clearcoat } from './clearcoat';\r\n\r\nconst NAME = KHR_MATERIALS_CLEARCOAT;\r\n\r\ninterface ClearcoatDef {\r\n\tclearcoatFactor?: number;\r\n\tclearcoatRoughnessFactor?: number;\r\n\tclearcoatTexture?: GLTF.ITextureInfo;\r\n\tclearcoatRoughnessTexture?: GLTF.ITextureInfo;\r\n\tclearcoatNormalTexture?: GLTF.IMaterialNormalTextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsClearcoat\r\n *\r\n * [KHR_materials_clearcoat](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_clearcoat/)\r\n * defines a clear coating on a glTF PBR material.\r\n *\r\n * ![Illustration](/media/extensions/khr-materials-clearcoat.png)\r\n *\r\n * > _**Figure:** Comparison of a carbon-fiber material without clearcoat (left) and with clearcoat\r\n * > (right). Source: [Filament](https://google.github.io/filament/Materials.html)._\r\n *\r\n * A clear coat is a common technique used in Physically-Based\r\n * Rendering for a protective layer applied to a base material.\r\n * Commonly used to represent car paint, carbon fiber, or thin lacquers.\r\n *\r\n * Properties:\r\n * - {@link Clearcoat}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MaterialsClearcoat, Clearcoat } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const clearcoatExtension = document.createExtension(MaterialsClearcoat);\r\n *\r\n * // Create Clearcoat property.\r\n * const clearcoat = clearcoatExtension.createClearcoat()\r\n *\t.setClearcoatFactor(1.0);\r\n *\r\n * // Assign to a Material.\r\n * material.setExtension('KHR_materials_clearcoat', clearcoat);\r\n * ```\r\n */\r\nexport class MaterialsClearcoat extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Clearcoat property for use on a {@link Material}. */\r\n\tpublic createClearcoat(): Clearcoat {\r\n\t\treturn new Clearcoat(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst clearcoat = this.createClearcoat();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, clearcoat);\r\n\r\n\t\t\t\tconst clearcoatDef = materialDef.extensions[NAME] as ClearcoatDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (clearcoatDef.clearcoatFactor !== undefined) {\r\n\t\t\t\t\tclearcoat.setClearcoatFactor(clearcoatDef.clearcoatFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (clearcoatDef.clearcoatRoughnessFactor !== undefined) {\r\n\t\t\t\t\tclearcoat.setClearcoatRoughnessFactor(clearcoatDef.clearcoatRoughnessFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (clearcoatDef.clearcoatTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tclearcoat.setClearcoatTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (clearcoatDef.clearcoatRoughnessTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatRoughnessTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tclearcoat.setClearcoatRoughnessTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatRoughnessTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (clearcoatDef.clearcoatNormalTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatNormalTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tclearcoat.setClearcoatNormalTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatNormalTextureInfo()!, textureInfoDef);\r\n\t\t\t\t\tif (textureInfoDef.scale !== undefined) {\r\n\t\t\t\t\t\tclearcoat.setClearcoatNormalScale(textureInfoDef.scale);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst clearcoat = material.getExtension<Clearcoat>(NAME);\r\n\t\t\t\tif (clearcoat) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst clearcoatDef = (materialDef.extensions[NAME] = {\r\n\t\t\t\t\t\tclearcoatFactor: clearcoat.getClearcoatFactor(),\r\n\t\t\t\t\t\tclearcoatRoughnessFactor: clearcoat.getClearcoatRoughnessFactor(),\r\n\t\t\t\t\t} as ClearcoatDef);\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (clearcoat.getClearcoatTexture()) {\r\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatTextureInfo()!;\r\n\t\t\t\t\t\tclearcoatDef.clearcoatTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (clearcoat.getClearcoatRoughnessTexture()) {\r\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatRoughnessTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatRoughnessTextureInfo()!;\r\n\t\t\t\t\t\tclearcoatDef.clearcoatRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (clearcoat.getClearcoatNormalTexture()) {\r\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatNormalTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatNormalTextureInfo()!;\r\n\t\t\t\t\t\tclearcoatDef.clearcoatNormalTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t\tif (clearcoat.getClearcoatNormalScale() !== 1) {\r\n\t\t\t\t\t\t\tclearcoatDef.clearcoatNormalTexture.scale = clearcoat.getClearcoatNormalScale();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { ExtensionProperty, IProperty, Nullable, PropertyType } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_EMISSIVE_STRENGTH } from '../constants';\r\n\r\ninterface IEmissiveStrength extends IProperty {\r\n\temissiveStrength: number;\r\n}\r\n\r\n/**\r\n * # EmissiveStrength\r\n *\r\n * Defines emissive strength for a PBR {@link Material}, allowing high-dynamic-range\r\n * (HDR) emissive materials. See {@link MaterialsEmissiveStrength}.\r\n */\r\nexport class EmissiveStrength extends ExtensionProperty<IEmissiveStrength> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_EMISSIVE_STRENGTH;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_EMISSIVE_STRENGTH;\r\n\tpublic declare propertyType: 'EmissiveStrength';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_EMISSIVE_STRENGTH;\r\n\t\tthis.propertyType = 'EmissiveStrength';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IEmissiveStrength> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, { emissiveStrength: 1.0 });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * EmissiveStrength.\r\n\t */\r\n\r\n\t/** EmissiveStrength. */\r\n\tpublic getEmissiveStrength(): number {\r\n\t\treturn this.get('emissiveStrength');\r\n\t}\r\n\r\n\t/** EmissiveStrength. */\r\n\tpublic setEmissiveStrength(strength: number): this {\r\n\t\treturn this.set('emissiveStrength', strength);\r\n\t}\r\n}\r\n","import { Extension, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_EMISSIVE_STRENGTH } from '../constants';\r\nimport { EmissiveStrength } from './emissive-strength';\r\n\r\nconst NAME = KHR_MATERIALS_EMISSIVE_STRENGTH;\r\n\r\ninterface EmissiveStrengthDef {\r\n\temissiveStrength?: number;\r\n}\r\n\r\n/**\r\n * # MaterialsEmissiveStrength\r\n *\r\n * [KHR_materials_emissive_strength](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_emissive_strength/)\r\n * defines emissive strength and enables high-dynamic-range (HDR) emissive materials.\r\n *\r\n * [[include:UNRATIFIED_EXTENSIONS_NOTE.md]]\r\n *\r\n * The core glTF 2.0 material model includes {@link Material.setEmissiveFactor `emissiveFactor`}\r\n * and {@link Material.setEmissiveTexture `emissiveTexture`} to control the color and intensity\r\n * of the light being emitted by the material, clamped to the range [0.0, 1.0]. However, in\r\n * PBR environments with HDR reflections and lighting, stronger emission effects may be desirable.\r\n *\r\n * In this extension, a new {@link EmissiveStrength.setEmissiveStrength `emissiveStrength`} scalar\r\n * factor is supplied, which governs the upper limit of emissive strength per material and may be\r\n * given arbitrarily high values.\r\n *\r\n * For implementations where a physical light unit is needed, the units for the multiplicative\r\n * product of the emissive texture and factor are candela per square meter (cd / m2), sometimes\r\n * called _nits_. Many realtime rendering engines simplify this calculation by assuming that an\r\n * emissive factor of 1.0 results in a fully exposed pixel.\r\n *\r\n * Properties:\r\n * - {@link EmissiveStrength}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MaterialsEmissiveStrength, EmissiveStrength } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const emissiveStrengthExtension = document.createExtension(MaterialsEmissiveStrength);\r\n *\r\n * // Create EmissiveStrength property.\r\n * const emissiveStrength = emissiveStrengthExtension\r\n * \t.createEmissiveStrength().setEmissiveStrength(5.0);\r\n *\r\n * // Assign to a Material.\r\n * material.setExtension('KHR_materials_emissive_strength', emissiveStrength);\r\n * ```\r\n */\r\nexport class MaterialsEmissiveStrength extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new EmissiveStrength property for use on a {@link Material}. */\r\n\tpublic createEmissiveStrength(): EmissiveStrength {\r\n\t\treturn new EmissiveStrength(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst emissiveStrength = this.createEmissiveStrength();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, emissiveStrength);\r\n\r\n\t\t\t\tconst emissiveStrengthDef = materialDef.extensions[NAME] as EmissiveStrengthDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (emissiveStrengthDef.emissiveStrength !== undefined) {\r\n\t\t\t\t\temissiveStrength.setEmissiveStrength(emissiveStrengthDef.emissiveStrength);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst emissiveStrength = material.getExtension<EmissiveStrength>(NAME);\r\n\t\t\t\tif (emissiveStrength) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tmaterialDef.extensions[NAME] = {\r\n\t\t\t\t\t\temissiveStrength: emissiveStrength.getEmissiveStrength(),\r\n\t\t\t\t\t} as EmissiveStrengthDef;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { ExtensionProperty, IProperty, Nullable, PropertyType } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_IOR } from '../constants';\r\n\r\ninterface IIOR extends IProperty {\r\n\tior: number;\r\n}\r\n\r\n/**\r\n * # IOR\r\n *\r\n * Defines index of refraction for a PBR {@link Material}. See {@link MaterialsIOR}.\r\n */\r\nexport class IOR extends ExtensionProperty<IIOR> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_IOR;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_IOR;\r\n\tpublic declare propertyType: 'IOR';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_IOR;\r\n\t\tthis.propertyType = 'IOR';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IIOR> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, { ior: 0 });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * IOR.\r\n\t */\r\n\r\n\t/** IOR. */\r\n\tpublic getIOR(): number {\r\n\t\treturn this.get('ior');\r\n\t}\r\n\r\n\t/** IOR. */\r\n\tpublic setIOR(ior: number): this {\r\n\t\treturn this.set('ior', ior);\r\n\t}\r\n}\r\n","import { Extension, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_IOR } from '../constants';\r\nimport { IOR } from './ior';\r\n\r\nconst NAME = KHR_MATERIALS_IOR;\r\n\r\ninterface IORDef {\r\n\tior?: number;\r\n}\r\n\r\n/**\r\n * # MaterialsIOR\r\n *\r\n * [KHR_materials_ior](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_ior/)\r\n * defines index of refraction on a glTF PBR material.\r\n *\r\n * The dielectric BRDF of the metallic-roughness material in glTF uses a fixed value of 1.5 for the\r\n * index of refraction. This is a good fit for many plastics and glass, but not for other materials\r\n * like water or asphalt, sapphire or diamond. `KHR_materials_ior` allows users to set the index of\r\n * refraction to a certain value.\r\n *\r\n * Properties:\r\n * - {@link IOR}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MaterialsIOR, IOR } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const iorExtension = document.createExtension(MaterialsIOR);\r\n *\r\n * // Create IOR property.\r\n * const ior = iorExtension.createIOR().setIOR(1.0);\r\n *\r\n * // Assign to a Material.\r\n * material.setExtension('KHR_materials_ior', ior);\r\n * ```\r\n */\r\nexport class MaterialsIOR extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new IOR property for use on a {@link Material}. */\r\n\tpublic createIOR(): IOR {\r\n\t\treturn new IOR(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst ior = this.createIOR();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, ior);\r\n\r\n\t\t\t\tconst iorDef = materialDef.extensions[NAME] as IORDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (iorDef.ior !== undefined) {\r\n\t\t\t\t\tior.setIOR(iorDef.ior);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst ior = material.getExtension<IOR>(NAME);\r\n\t\t\t\tif (ior) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tmaterialDef.extensions[NAME] = {\r\n\t\t\t\t\t\tior: ior.getIOR(),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_IRIDESCENCE } from '../constants';\r\n\r\ninterface IIridescence extends IProperty {\r\n\tiridescenceFactor: number;\r\n\tiridescenceTexture: Texture;\r\n\tiridescenceTextureInfo: TextureInfo;\r\n\tiridescenceIOR: number;\r\n\tiridescenceThicknessMinimum: number;\r\n\tiridescenceThicknessMaximum: number;\r\n\tiridescenceThicknessTexture: Texture;\r\n\tiridescenceThicknessTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G } = TextureChannel;\r\n\r\n/**\r\n * # Iridescence\r\n *\r\n * Defines iridescence (thin film interference) on a PBR {@link Material}. See {@link MaterialsIridescence}.\r\n */\r\nexport class Iridescence extends ExtensionProperty<IIridescence> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_IRIDESCENCE;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_IRIDESCENCE;\r\n\tpublic declare propertyType: 'Iridescence';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_IRIDESCENCE;\r\n\t\tthis.propertyType = 'Iridescence';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IIridescence> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tiridescenceFactor: 0.0,\r\n\t\t\tiridescenceTexture: null,\r\n\t\t\tiridescenceTextureInfo: new TextureInfo(this.graph, 'iridescenceTextureInfo'),\r\n\t\t\tiridescenceIOR: 1.3,\r\n\t\t\tiridescenceThicknessMinimum: 100,\r\n\t\t\tiridescenceThicknessMaximum: 400,\r\n\t\t\tiridescenceThicknessTexture: null,\r\n\t\t\tiridescenceThicknessTextureInfo: new TextureInfo(this.graph, 'iridescenceThicknessTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Iridescence.\r\n\t */\r\n\r\n\t/** Iridescence; linear multiplier. See {@link getIridescenceTexture}. */\r\n\tpublic getIridescenceFactor(): number {\r\n\t\treturn this.get('iridescenceFactor');\r\n\t}\r\n\r\n\t/** Iridescence; linear multiplier. See {@link getIridescenceTexture}. */\r\n\tpublic setIridescenceFactor(factor: number): this {\r\n\t\treturn this.set('iridescenceFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Iridescence intensity.\r\n\t *\r\n\t * Only the red (R) channel is used for iridescence intensity, but this texture may optionally\r\n\t * be packed with additional data in the other channels.\r\n\t */\r\n\tpublic getIridescenceTexture(): Texture | null {\r\n\t\treturn this.getRef('iridescenceTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its iridescence texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getIridescenceTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('iridescenceTexture') ? this.getRef('iridescenceTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Iridescence intensity. See {@link getIridescenceTexture}. */\r\n\tpublic setIridescenceTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('iridescenceTexture', texture, { channels: R });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Iridescence IOR.\r\n\t */\r\n\r\n\t/** Index of refraction of the dielectric thin-film layer. */\r\n\tpublic getIridescenceIOR(): number {\r\n\t\treturn this.get('iridescenceIOR');\r\n\t}\r\n\r\n\t/** Index of refraction of the dielectric thin-film layer. */\r\n\tpublic setIridescenceIOR(ior: number): this {\r\n\t\treturn this.set('iridescenceIOR', ior);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Iridescence thickness.\r\n\t */\r\n\r\n\t/** Minimum thickness of the thin-film layer, in nanometers (nm). */\r\n\tpublic getIridescenceThicknessMinimum(): number {\r\n\t\treturn this.get('iridescenceThicknessMinimum');\r\n\t}\r\n\r\n\t/** Minimum thickness of the thin-film layer, in nanometers (nm). */\r\n\tpublic setIridescenceThicknessMinimum(thickness: number): this {\r\n\t\treturn this.set('iridescenceThicknessMinimum', thickness);\r\n\t}\r\n\r\n\t/** Maximum thickness of the thin-film layer, in nanometers (nm). */\r\n\tpublic getIridescenceThicknessMaximum(): number {\r\n\t\treturn this.get('iridescenceThicknessMaximum');\r\n\t}\r\n\r\n\t/** Maximum thickness of the thin-film layer, in nanometers (nm). */\r\n\tpublic setIridescenceThicknessMaximum(thickness: number): this {\r\n\t\treturn this.set('iridescenceThicknessMaximum', thickness);\r\n\t}\r\n\r\n\t/**\r\n\t * The green channel of this texture defines the thickness of the\r\n\t * thin-film layer by blending between the minimum and maximum thickness.\r\n\t */\r\n\tpublic getIridescenceThicknessTexture(): Texture | null {\r\n\t\treturn this.getRef('iridescenceThicknessTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its iridescence thickness texture.\r\n\t * If no texture is attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getIridescenceThicknessTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('iridescenceThicknessTexture') ? this.getRef('iridescenceThicknessTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets iridescence thickness texture. See {@link getIridescenceThicknessTexture}. */\r\n\tpublic setIridescenceThicknessTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('iridescenceThicknessTexture', texture, { channels: G });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_IRIDESCENCE } from '../constants';\r\nimport { Iridescence } from './iridescence';\r\n\r\nconst NAME = KHR_MATERIALS_IRIDESCENCE;\r\n\r\ninterface IridescenceDef {\r\n\tiridescenceFactor: number;\r\n\tiridescenceTexture: GLTF.ITextureInfo;\r\n\tiridescenceIor: number;\r\n\tiridescenceThicknessMinimum: number;\r\n\tiridescenceThicknessMaximum: number;\r\n\tiridescenceThicknessTexture: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsIridescence\r\n *\r\n * [`KHR_materials_iridescence`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_iridescence/)\r\n * defines iridescence (thin film interference) on a PBR material.\r\n *\r\n * Iridescence describes an effect where hue varies depending on the viewing\r\n * angle and illumination angle: A thin-film of a semi-transparent layer\r\n * results in inter-reflections and due to thin-film interference, certain\r\n * wavelengths get absorbed or amplified. Iridescence can be seen on soap\r\n * bubbles, oil films, or on the wings of many insects. With this extension,\r\n * thickness and index of refraction (IOR) of the thin-film can be specified,\r\n * enabling iridescent materials.\r\n *\r\n * Properties:\r\n * - {@link Iridescence}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsIridescence` class provides a single {@link ExtensionProperty} type, `Iridescence`,\r\n * which may be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsIridescence, Iridescence } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const iridescenceExtension = document.createExtension(MaterialsIridescence);\r\n *\r\n * // Create an Iridescence property.\r\n * const iridescence = iridescenceExtension.createIridescence()\r\n * \t.setIridescenceFactor(1.0)\r\n * \t.setIridescenceIOR(1.8);\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_iridescence', iridescence);\r\n * ```\r\n */\r\nexport class MaterialsIridescence extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Iridescence property for use on a {@link Material}. */\r\n\tpublic createIridescence(): Iridescence {\r\n\t\treturn new Iridescence(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst iridescence = this.createIridescence();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, iridescence);\r\n\r\n\t\t\t\tconst iridescenceDef = materialDef.extensions[NAME] as IridescenceDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (iridescenceDef.iridescenceFactor !== undefined) {\r\n\t\t\t\t\tiridescence.setIridescenceFactor(iridescenceDef.iridescenceFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (iridescenceDef.iridescenceIor !== undefined) {\r\n\t\t\t\t\tiridescence.setIridescenceIOR(iridescenceDef.iridescenceIor);\r\n\t\t\t\t}\r\n\t\t\t\tif (iridescenceDef.iridescenceThicknessMinimum !== undefined) {\r\n\t\t\t\t\tiridescence.setIridescenceThicknessMinimum(iridescenceDef.iridescenceThicknessMinimum);\r\n\t\t\t\t}\r\n\t\t\t\tif (iridescenceDef.iridescenceThicknessMaximum !== undefined) {\r\n\t\t\t\t\tiridescence.setIridescenceThicknessMaximum(iridescenceDef.iridescenceThicknessMaximum);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (iridescenceDef.iridescenceTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = iridescenceDef.iridescenceTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tiridescence.setIridescenceTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(iridescence.getIridescenceTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (iridescenceDef.iridescenceThicknessTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = iridescenceDef.iridescenceThicknessTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tiridescence.setIridescenceThicknessTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(iridescence.getIridescenceThicknessTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst iridescence = material.getExtension<Iridescence>(NAME);\r\n\t\t\t\tif (iridescence) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst iridescenceDef = (materialDef.extensions[NAME] = {} as IridescenceDef);\r\n\r\n\t\t\t\t\tif (iridescence.getIridescenceFactor() > 0) {\r\n\t\t\t\t\t\tiridescenceDef.iridescenceFactor = iridescence.getIridescenceFactor();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iridescence.getIridescenceIOR() !== 1.3) {\r\n\t\t\t\t\t\tiridescenceDef.iridescenceIor = iridescence.getIridescenceIOR();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iridescence.getIridescenceThicknessMinimum() !== 100) {\r\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessMinimum = iridescence.getIridescenceThicknessMinimum();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iridescence.getIridescenceThicknessMaximum() !== 400) {\r\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessMaximum = iridescence.getIridescenceThicknessMaximum();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (iridescence.getIridescenceTexture()) {\r\n\t\t\t\t\t\tconst texture = iridescence.getIridescenceTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = iridescence.getIridescenceTextureInfo()!;\r\n\t\t\t\t\t\tiridescenceDef.iridescenceTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iridescence.getIridescenceThicknessTexture()) {\r\n\t\t\t\t\t\tconst texture = iridescence.getIridescenceThicknessTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = iridescence.getIridescenceThicknessTextureInfo()!;\r\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tColorUtils,\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n\tvec3,\r\n\tvec4,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS } from '../constants';\r\n\r\ninterface IPBRSpecularGlossiness extends IProperty {\r\n\tdiffuseFactor: vec4;\r\n\tdiffuseTexture: Texture;\r\n\tdiffuseTextureInfo: TextureInfo;\r\n\tspecularFactor: vec3;\r\n\tglossinessFactor: number;\r\n\tspecularGlossinessTexture: Texture;\r\n\tspecularGlossinessTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B, A } = TextureChannel;\r\n\r\n/**\r\n * # PBRSpecularGlossiness\r\n *\r\n * Converts a {@link Material} to a spec/gloss workflow. See {@link MaterialsPBRSpecularGlossiness}.\r\n */\r\nexport class PBRSpecularGlossiness extends ExtensionProperty<IPBRSpecularGlossiness> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\tpublic declare propertyType: 'PBRSpecularGlossiness';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\t\tthis.propertyType = 'PBRSpecularGlossiness';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IPBRSpecularGlossiness> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tdiffuseFactor: [1.0, 1.0, 1.0, 1.0] as vec4,\r\n\t\t\tdiffuseTexture: null,\r\n\t\t\tdiffuseTextureInfo: new TextureInfo(this.graph, 'diffuseTextureInfo'),\r\n\t\t\tspecularFactor: [1.0, 1.0, 1.0] as vec3,\r\n\t\t\tglossinessFactor: 1.0,\r\n\t\t\tspecularGlossinessTexture: null,\r\n\t\t\tspecularGlossinessTextureInfo: new TextureInfo(this.graph, 'specularGlossinessTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Diffuse.\r\n\t */\r\n\r\n\t/** Diffuse; Linear-sRGB components. See {@link getDiffuseTexture}. */\r\n\tpublic getDiffuseFactor(): vec4 {\r\n\t\treturn this.get('diffuseFactor');\r\n\t}\r\n\r\n\t/** Diffuse; Linear-sRGB components. See {@link getDiffuseTexture}. */\r\n\tpublic setDiffuseFactor(factor: vec4): this {\r\n\t\treturn this.set('diffuseFactor', factor);\r\n\t}\r\n\r\n\t/** Diffuse; sRGB hexadecimal color. */\r\n\tpublic getDiffuseHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getDiffuseFactor());\r\n\t}\r\n\r\n\t/** Diffuse; sRGB hexadecimal color. */\r\n\tpublic setDiffuseHex(hex: number): this {\r\n\t\tconst factor = this.getDiffuseFactor().slice() as vec4;\r\n\t\treturn this.setDiffuseFactor(ColorUtils.hexToFactor(hex, factor));\r\n\t}\r\n\r\n\t/**\r\n\t * Diffuse texture; sRGB. Alternative to baseColorTexture, used within the\r\n\t * spec/gloss PBR workflow.\r\n\t */\r\n\tpublic getDiffuseTexture(): Texture | null {\r\n\t\treturn this.getRef('diffuseTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its diffuse texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getDiffuseTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('diffuseTexture') ? this.getRef('diffuseTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets diffuse texture. See {@link getDiffuseTexture}. */\r\n\tpublic setDiffuseTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('diffuseTexture', texture, { channels: R | G | B | A });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Specular.\r\n\t */\r\n\r\n\t/** Specular; linear multiplier. */\r\n\tpublic getSpecularFactor(): vec3 {\r\n\t\treturn this.get('specularFactor');\r\n\t}\r\n\r\n\t/** Specular; linear multiplier. */\r\n\tpublic setSpecularFactor(factor: vec3): this {\r\n\t\treturn this.set('specularFactor', factor);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Glossiness.\r\n\t */\r\n\r\n\t/** Glossiness; linear multiplier. */\r\n\tpublic getGlossinessFactor(): number {\r\n\t\treturn this.get('glossinessFactor');\r\n\t}\r\n\r\n\t/** Glossiness; linear multiplier. */\r\n\tpublic setGlossinessFactor(factor: number): this {\r\n\t\treturn this.set('glossinessFactor', factor);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Specular/Glossiness.\r\n\t */\r\n\r\n\t/** Spec/gloss texture; linear multiplier. */\r\n\tpublic getSpecularGlossinessTexture(): Texture | null {\r\n\t\treturn this.getRef('specularGlossinessTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its spec/gloss texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getSpecularGlossinessTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('specularGlossinessTexture') ? this.getRef('specularGlossinessTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Spec/gloss texture; linear multiplier. */\r\n\tpublic setSpecularGlossinessTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('specularGlossinessTexture', texture, { channels: R | G | B | A });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3, vec4 } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS } from '../constants';\r\nimport { PBRSpecularGlossiness } from './pbr-specular-glossiness';\r\n\r\nconst NAME = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\r\n\r\ninterface SpecularGlossinessDef {\r\n\tdiffuseFactor?: vec4;\r\n\tspecularFactor: vec3;\r\n\tglossinessFactor: number;\r\n\tdiffuseTexture?: GLTF.ITextureInfo;\r\n\tspecularGlossinessTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsPBRSpecularGlossiness\r\n *\r\n * [`KHR_materials_pbrSpecularGlossiness`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/)\r\n * converts a PBR material from the default metal/rough workflow to a spec/gloss workflow.\r\n *\r\n * > _**NOTICE:** The spec/gloss workflow does _not_ support other PBR extensions such as clearcoat,\r\n * > transmission, IOR, etc. For the complete PBR feature set and specular data, use the\r\n * > {@link MaterialsSpecular} extension instead, which provides specular data within a metal/rough\r\n * > workflow._\r\n *\r\n * ![Illustration](/media/extensions/khr-material-pbr-specular-glossiness.png)\r\n *\r\n * > _**Figure:** Components of a PBR spec/gloss material. Source: Khronos Group._\r\n *\r\n * Properties:\r\n * - {@link PBRSpecularGlossiness}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MaterialsPBRSpecularGlossiness } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const specGlossExtension = document.createExtension(MaterialsPBRSpecularGlossiness);\r\n *\r\n * // Create a PBRSpecularGlossiness property.\r\n * const specGloss = specGlossExtension.createPBRSpecularGlossiness()\r\n * \t.setSpecularFactor(1.0);\r\n *\r\n * // // Assign to a Material.\r\n * material.setExtension('KHR_materials_pbrSpecularGlossiness', specGloss);\r\n * ```\r\n */\r\nexport class MaterialsPBRSpecularGlossiness extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new PBRSpecularGlossiness property for use on a {@link Material}. */\r\n\tpublic createPBRSpecularGlossiness(): PBRSpecularGlossiness {\r\n\t\treturn new PBRSpecularGlossiness(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst specGloss = this.createPBRSpecularGlossiness();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, specGloss);\r\n\r\n\t\t\t\tconst specGlossDef = materialDef.extensions[NAME] as SpecularGlossinessDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (specGlossDef.diffuseFactor !== undefined) {\r\n\t\t\t\t\tspecGloss.setDiffuseFactor(specGlossDef.diffuseFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (specGlossDef.specularFactor !== undefined) {\r\n\t\t\t\t\tspecGloss.setSpecularFactor(specGlossDef.specularFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (specGlossDef.glossinessFactor !== undefined) {\r\n\t\t\t\t\tspecGloss.setGlossinessFactor(specGlossDef.glossinessFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (specGlossDef.diffuseTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = specGlossDef.diffuseTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tspecGloss.setDiffuseTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(specGloss.getDiffuseTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (specGlossDef.specularGlossinessTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = specGlossDef.specularGlossinessTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tspecGloss.setSpecularGlossinessTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(specGloss.getSpecularGlossinessTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst specGloss = material.getExtension<PBRSpecularGlossiness>(NAME);\r\n\t\t\t\tif (specGloss) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst specGlossDef = (materialDef.extensions[NAME] = {\r\n\t\t\t\t\t\tdiffuseFactor: specGloss.getDiffuseFactor(),\r\n\t\t\t\t\t\tspecularFactor: specGloss.getSpecularFactor(),\r\n\t\t\t\t\t\tglossinessFactor: specGloss.getGlossinessFactor(),\r\n\t\t\t\t\t} as SpecularGlossinessDef);\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (specGloss.getDiffuseTexture()) {\r\n\t\t\t\t\t\tconst texture = specGloss.getDiffuseTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = specGloss.getDiffuseTextureInfo()!;\r\n\t\t\t\t\t\tspecGlossDef.diffuseTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (specGloss.getSpecularGlossinessTexture()) {\r\n\t\t\t\t\t\tconst texture = specGloss.getSpecularGlossinessTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = specGloss.getSpecularGlossinessTextureInfo()!;\r\n\t\t\t\t\t\tspecGlossDef.specularGlossinessTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tColorUtils,\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n\tvec3,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_SHEEN } from '../constants';\r\n\r\ninterface ISheen extends IProperty {\r\n\tsheenColorFactor: vec3;\r\n\tsheenColorTexture: Texture;\r\n\tsheenColorTextureInfo: TextureInfo;\r\n\tsheenRoughnessFactor: number;\r\n\tsheenRoughnessTexture: Texture;\r\n\tsheenRoughnessTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B, A } = TextureChannel;\r\n\r\n/**\r\n * # Sheen\r\n *\r\n * Defines sheen on a PBR {@link Material}. See {@link MaterialsSheen}.\r\n */\r\nexport class Sheen extends ExtensionProperty<ISheen> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_SHEEN;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_SHEEN;\r\n\tpublic declare propertyType: 'Sheen';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_SHEEN;\r\n\t\tthis.propertyType = 'Sheen';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ISheen> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tsheenColorFactor: [0.0, 0.0, 0.0] as vec3,\r\n\t\t\tsheenColorTexture: null,\r\n\t\t\tsheenColorTextureInfo: new TextureInfo(this.graph, 'sheenColorTextureInfo'),\r\n\t\t\tsheenRoughnessFactor: 0.0,\r\n\t\t\tsheenRoughnessTexture: null,\r\n\t\t\tsheenRoughnessTextureInfo: new TextureInfo(this.graph, 'sheenRoughnessTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Sheen color.\r\n\t */\r\n\r\n\t/** Sheen; linear multiplier. */\r\n\tpublic getSheenColorFactor(): vec3 {\r\n\t\treturn this.get('sheenColorFactor');\r\n\t}\r\n\r\n\t/** Sheen; hex color in sRGB colorspace. */\r\n\tpublic getSheenColorHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getSheenColorFactor());\r\n\t}\r\n\r\n\t/** Sheen; linear multiplier. */\r\n\tpublic setSheenColorFactor(factor: vec3): this {\r\n\t\treturn this.set('sheenColorFactor', factor);\r\n\t}\r\n\r\n\t/** Sheen; hex color in sRGB colorspace. */\r\n\tpublic setSheenColorHex(hex: number): this {\r\n\t\tconst factor = this.getSheenColorFactor().slice() as vec3;\r\n\t\treturn this.set('sheenColorFactor', ColorUtils.hexToFactor(hex, factor));\r\n\t}\r\n\r\n\t/**\r\n\t * Sheen color texture, in sRGB colorspace.\r\n\t */\r\n\tpublic getSheenColorTexture(): Texture | null {\r\n\t\treturn this.getRef('sheenColorTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its sheen color texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getSheenColorTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('sheenColorTexture') ? this.getRef('sheenColorTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets sheen color texture. See {@link getSheenColorTexture}. */\r\n\tpublic setSheenColorTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('sheenColorTexture', texture, { channels: R | G | B });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Sheen roughness.\r\n\t */\r\n\r\n\t/** Sheen roughness; linear multiplier. See {@link getSheenRoughnessTexture}. */\r\n\tpublic getSheenRoughnessFactor(): number {\r\n\t\treturn this.get('sheenRoughnessFactor');\r\n\t}\r\n\r\n\t/** Sheen roughness; linear multiplier. See {@link getSheenRoughnessTexture}. */\r\n\tpublic setSheenRoughnessFactor(factor: number): this {\r\n\t\treturn this.set('sheenRoughnessFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Sheen roughness texture; linear multiplier. The `a` channel of this texture specifies\r\n\t * roughness, independent of the base layer's roughness.\r\n\t */\r\n\tpublic getSheenRoughnessTexture(): Texture | null {\r\n\t\treturn this.getRef('sheenRoughnessTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its sheen roughness texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getSheenRoughnessTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('sheenRoughnessTexture') ? this.getRef('sheenRoughnessTextureInfo') : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets sheen roughness texture.  The `a` channel of this texture specifies\r\n\t * roughness, independent of the base layer's roughness.\r\n\t */\r\n\tpublic setSheenRoughnessTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('sheenRoughnessTexture', texture, { channels: A });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3 } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_SHEEN } from '../constants';\r\nimport { Sheen } from './sheen';\r\n\r\nconst NAME = KHR_MATERIALS_SHEEN;\r\n\r\ninterface SheenDef {\r\n\tsheenColorFactor?: vec3;\r\n\tsheenRoughnessFactor?: number;\r\n\tsheenColorTexture?: GLTF.ITextureInfo;\r\n\tsheenRoughnessTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsSheen\r\n *\r\n * [`KHR_materials_sheen`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_sheen/)\r\n * defines a velvet-like sheen layered on a glTF PBR material.\r\n *\r\n * ![Illustration](/media/extensions/khr-materials-sheen.png)\r\n *\r\n * > _**Figure:** A cushion, showing high material roughness and low sheen roughness. Soft\r\n * > highlights at edges of the material show backscattering from microfibers. Source: Khronos\r\n * > Group._\r\n *\r\n * A sheen layer is a common technique used in Physically-Based Rendering to represent\r\n * cloth and fabric materials.\r\n *\r\n * Properties:\r\n * - {@link Sheen}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsSheen` class provides a single {@link ExtensionProperty} type, `Sheen`,\r\n * which may be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsSheen, Sheen } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const sheenExtension = document.createExtension(MaterialsSheen);\r\n *\r\n * // Create a Sheen property.\r\n * const sheen = sheenExtension.createSheen()\r\n * \t.setSheenColorFactor([1.0, 1.0, 1.0]);\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_sheen', sheen);\r\n * ```\r\n */\r\nexport class MaterialsSheen extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Sheen property for use on a {@link Material}. */\r\n\tpublic createSheen(): Sheen {\r\n\t\treturn new Sheen(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst sheen = this.createSheen();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, sheen);\r\n\r\n\t\t\t\tconst sheenDef = materialDef.extensions[NAME] as SheenDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (sheenDef.sheenColorFactor !== undefined) {\r\n\t\t\t\t\tsheen.setSheenColorFactor(sheenDef.sheenColorFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (sheenDef.sheenRoughnessFactor !== undefined) {\r\n\t\t\t\t\tsheen.setSheenRoughnessFactor(sheenDef.sheenRoughnessFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (sheenDef.sheenColorTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = sheenDef.sheenColorTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tsheen.setSheenColorTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(sheen.getSheenColorTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (sheenDef.sheenRoughnessTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = sheenDef.sheenRoughnessTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tsheen.setSheenRoughnessTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(sheen.getSheenRoughnessTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst sheen = material.getExtension<Sheen>(NAME);\r\n\t\t\t\tif (sheen) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst sheenDef = (materialDef.extensions[NAME] = {\r\n\t\t\t\t\t\tsheenColorFactor: sheen.getSheenColorFactor(),\r\n\t\t\t\t\t\tsheenRoughnessFactor: sheen.getSheenRoughnessFactor(),\r\n\t\t\t\t\t} as SheenDef);\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (sheen.getSheenColorTexture()) {\r\n\t\t\t\t\t\tconst texture = sheen.getSheenColorTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = sheen.getSheenColorTextureInfo()!;\r\n\t\t\t\t\t\tsheenDef.sheenColorTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (sheen.getSheenRoughnessTexture()) {\r\n\t\t\t\t\t\tconst texture = sheen.getSheenRoughnessTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = sheen.getSheenRoughnessTextureInfo()!;\r\n\t\t\t\t\t\tsheenDef.sheenRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tColorUtils,\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n\tvec3,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_SPECULAR } from '../constants';\r\n\r\ninterface ISpecular extends IProperty {\r\n\tspecularFactor: number;\r\n\tspecularTexture: Texture;\r\n\tspecularTextureInfo: TextureInfo;\r\n\tspecularColorFactor: vec3;\r\n\tspecularColorTexture: Texture;\r\n\tspecularColorTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B, A } = TextureChannel;\r\n\r\n/**\r\n * # Specular\r\n *\r\n * Defines specular reflectivity on a PBR {@link Material}. See {@link MaterialsSpecular}.\r\n */\r\nexport class Specular extends ExtensionProperty<ISpecular> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_SPECULAR;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_SPECULAR;\r\n\tpublic declare propertyType: 'Specular';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_SPECULAR;\r\n\t\tthis.propertyType = 'Specular';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ISpecular> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tspecularFactor: 1.0,\r\n\t\t\tspecularTexture: null,\r\n\t\t\tspecularTextureInfo: new TextureInfo(this.graph, 'specularTextureInfo'),\r\n\t\t\tspecularColorFactor: [1.0, 1.0, 1.0] as vec3,\r\n\t\t\tspecularColorTexture: null,\r\n\t\t\tspecularColorTextureInfo: new TextureInfo(this.graph, 'specularColorTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Specular.\r\n\t */\r\n\r\n\t/** Specular; linear multiplier. See {@link getSpecularTexture}. */\r\n\tpublic getSpecularFactor(): number {\r\n\t\treturn this.get('specularFactor');\r\n\t}\r\n\r\n\t/** Specular; linear multiplier. See {@link getSpecularTexture}. */\r\n\tpublic setSpecularFactor(factor: number): this {\r\n\t\treturn this.set('specularFactor', factor);\r\n\t}\r\n\r\n\t/** Specular color; Linear-sRGB components. See {@link getSpecularTexture}. */\r\n\tpublic getSpecularColorFactor(): vec3 {\r\n\t\treturn this.get('specularColorFactor');\r\n\t}\r\n\r\n\t/** Specular color; Linear-sRGB components. See {@link getSpecularTexture}. */\r\n\tpublic setSpecularColorFactor(factor: vec3): this {\r\n\t\treturn this.set('specularColorFactor', factor);\r\n\t}\r\n\r\n\t/** Specular color; sRGB hexadecimal color. See {@link getSpecularTexture} */\r\n\tpublic getSpecularColorHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getSpecularColorFactor());\r\n\t}\r\n\r\n\t/** Specular color; sRGB hexadecimal color. See {@link getSpecularTexture} */\r\n\tpublic setSpecularColorHex(hex: number): this {\r\n\t\tconst factor = this.getSpecularColorFactor().slice() as vec3;\r\n\t\treturn this.set('specularColorFactor', ColorUtils.hexToFactor(hex, factor));\r\n\t}\r\n\r\n\t/**\r\n\t * Specular texture; linear multiplier. Configures the strength of the specular reflection in\r\n\t * the dielectric BRDF. A value of zero disables the specular reflection, resulting in a pure\r\n\t * diffuse material.\r\n\t *\r\n\t * Only the alpha (A) channel is used for specular strength, but this texture may optionally\r\n\t * be packed with specular color (RGB) into a single texture.\r\n\t */\r\n\tpublic getSpecularTexture(): Texture | null {\r\n\t\treturn this.getRef('specularTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its specular texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getSpecularTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('specularTexture') ? this.getRef('specularTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets specular texture. See {@link getSpecularTexture}. */\r\n\tpublic setSpecularTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('specularTexture', texture, { channels: A });\r\n\t}\r\n\r\n\t/**\r\n\t * Specular color texture; linear multiplier. Defines the F0 color of the specular reflection\r\n\t * (RGB channels, encoded in sRGB) in the the dielectric BRDF.\r\n\t *\r\n\t * Only RGB channels are used here, but this texture may optionally be packed with a specular\r\n\t * factor (A) into a single texture.\r\n\t */\r\n\tpublic getSpecularColorTexture(): Texture | null {\r\n\t\treturn this.getRef('specularColorTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its specular color texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getSpecularColorTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('specularColorTexture') ? this.getRef('specularColorTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets specular color texture. See {@link getSpecularColorTexture}. */\r\n\tpublic setSpecularColorTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('specularColorTexture', texture, { channels: R | G | B });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3, MathUtils } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_SPECULAR } from '../constants';\r\nimport { Specular } from './specular';\r\n\r\nconst NAME = KHR_MATERIALS_SPECULAR;\r\n\r\ninterface SpecularDef {\r\n\tspecularFactor?: number;\r\n\tspecularColorFactor?: vec3;\r\n\tspecularTexture?: GLTF.ITextureInfo;\r\n\tspecularColorTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsSpecular\r\n *\r\n * [`KHR_materials_specular`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_specular/)\r\n * adjusts the strength of the specular reflection in the dielectric BRDF.\r\n *\r\n * MaterialsSpecular is a better alternative to the older\r\n * {@link MaterialsPBRSpecularGlossiness KHR_materials_pbrSpecularGlossiness} extension, and\r\n * provides specular information while remaining within a metal/rough PBR workflow. A\r\n * value of zero disables the specular reflection, resulting in a pure diffuse material.\r\n *\r\n * Properties:\r\n * - {@link Specular}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsSpecular` class provides a single {@link ExtensionProperty} type, `Specular`,\r\n * which may be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsSpecular, Specular } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const specularExtension = document.createExtension(MaterialsSpecular);\r\n *\r\n * // Create a Specular property.\r\n * const specular = specularExtension.createSpecular()\r\n * \t.setSpecularFactor(1.0);\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_specular', specular);\r\n * ```\r\n */\r\nexport class MaterialsSpecular extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Specular property for use on a {@link Material}. */\r\n\tpublic createSpecular(): Specular {\r\n\t\treturn new Specular(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst specular = this.createSpecular();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, specular);\r\n\r\n\t\t\t\tconst specularDef = materialDef.extensions[NAME] as SpecularDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (specularDef.specularFactor !== undefined) {\r\n\t\t\t\t\tspecular.setSpecularFactor(specularDef.specularFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (specularDef.specularColorFactor !== undefined) {\r\n\t\t\t\t\tspecular.setSpecularColorFactor(specularDef.specularColorFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (specularDef.specularTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = specularDef.specularTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tspecular.setSpecularTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(specular.getSpecularTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (specularDef.specularColorTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = specularDef.specularColorTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tspecular.setSpecularColorTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(specular.getSpecularColorTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst specular = material.getExtension<Specular>(NAME);\r\n\t\t\t\tif (specular) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst specularDef = (materialDef.extensions[NAME] = {} as SpecularDef);\r\n\r\n\t\t\t\t\tif (specular.getSpecularFactor() !== 1) {\r\n\t\t\t\t\t\tspecularDef.specularFactor = specular.getSpecularFactor();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!MathUtils.eq(specular.getSpecularColorFactor(), [1, 1, 1])) {\r\n\t\t\t\t\t\tspecularDef.specularColorFactor = specular.getSpecularColorFactor();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (specular.getSpecularTexture()) {\r\n\t\t\t\t\t\tconst texture = specular.getSpecularTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = specular.getSpecularTextureInfo()!;\r\n\t\t\t\t\t\tspecularDef.specularTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (specular.getSpecularColorTexture()) {\r\n\t\t\t\t\t\tconst texture = specular.getSpecularColorTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = specular.getSpecularColorTextureInfo()!;\r\n\t\t\t\t\t\tspecularDef.specularColorTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tColorUtils,\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n\tvec3,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_TRANSLUCENCY } from '../constants';\r\n\r\ninterface ITranslucency extends IProperty {\r\n\ttranslucencyFactor: number;\r\n\ttranslucencyTexture: Texture;\r\n\ttranslucencyTextureInfo: TextureInfo;\r\n\ttranslucencyColorFactor: vec3;\r\n\ttranslucencyColorTexture: Texture;\r\n\ttranslucencyColorTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R, G, B, A } = TextureChannel;\r\n\r\n/**\r\n * # translucency\r\n *\r\n * Defines translucency reflectivity on a PBR {@link Material}. See {@link Materialstranslucency}.\r\n */\r\nexport class Translucency extends ExtensionProperty<ITranslucency> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_TRANSLUCENCY;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_TRANSLUCENCY;\r\n\tpublic declare propertyType: 'Translucency';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_TRANSLUCENCY;\r\n\t\tthis.propertyType = 'Translucency';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ITranslucency> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\ttranslucencyFactor: 1.0,\r\n\t\t\ttranslucencyTexture: null,\r\n\t\t\ttranslucencyTextureInfo: new TextureInfo(this.graph, 'translucencyTextureInfo'),\r\n\t\t\ttranslucencyColorFactor: [1.0, 1.0, 1.0] as vec3,\r\n\t\t\ttranslucencyColorTexture: null,\r\n\t\t\ttranslucencyColorTextureInfo: new TextureInfo(this.graph, 'translucencyColorTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * translucency.\r\n\t */\r\n\r\n\t/** translucency; linear multiplier. See {@link getTranslucencyTexture}. */\r\n\tpublic getTranslucencyFactor(): number {\r\n\t\treturn this.get('translucencyFactor');\r\n\t}\r\n\r\n\t/** translucency; linear multiplier. See {@link getTranslucencyTexture}. */\r\n\tpublic setTranslucencyFactor(factor: number): this {\r\n\t\treturn this.set('translucencyFactor', factor);\r\n\t}\r\n\r\n\t/** translucency color; Linear-sRGB components. See {@link getTranslucencyTexture}. */\r\n\tpublic getTranslucencyColorFactor(): vec3 {\r\n\t\treturn this.get('translucencyColorFactor');\r\n\t}\r\n\r\n\t/** translucency color; Linear-sRGB components. See {@link getTranslucencyTexture}. */\r\n\tpublic setTranslucencyColorFactor(factor: vec3): this {\r\n\t\treturn this.set('translucencyColorFactor', factor);\r\n\t}\r\n\r\n\t/** translucency color; sRGB hexadecimal color. See {@link getTranslucencyTexture} */\r\n\tpublic getTranslucencyColorHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getTranslucencyColorFactor());\r\n\t}\r\n\r\n\t/** translucency color; sRGB hexadecimal color. See {@link getTranslucencyTexture} */\r\n\tpublic setTranslucencyColorHex(hex: number): this {\r\n\t\tconst factor = this.getTranslucencyColorFactor().slice() as vec3;\r\n\t\treturn this.set('translucencyColorFactor', ColorUtils.hexToFactor(hex, factor));\r\n\t}\r\n\r\n\t/**\r\n\t * translucency texture; linear multiplier. Configures the strength of the translucency reflection in\r\n\t * the dielectric BRDF. A value of zero disables the translucency reflection, resulting in a pure\r\n\t * diffuse material.\r\n\t *\r\n\t * Only the alpha (A) channel is used for translucency strength, but this texture may optionally\r\n\t * be packed with translucency color (RGB) into a single texture.\r\n\t */\r\n\tpublic getTranslucencyTexture(): Texture | null {\r\n\t\treturn this.getRef('translucencyTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its translucency texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getTranslucencyTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('translucencyTexture') ? this.getRef('translucencyTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets translucency texture. See {@link getTranslucencyTexture}. */\r\n\tpublic setTranslucencyTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('translucencyTexture', texture, { channels: A });\r\n\t}\r\n\r\n\t/**\r\n\t * translucency color texture; linear multiplier. Defines the F0 color of the translucency reflection\r\n\t * (RGB channels, encoded in sRGB) in the the dielectric BRDF.\r\n\t *\r\n\t * Only RGB channels are used here, but this texture may optionally be packed with a translucency\r\n\t * factor (A) into a single texture.\r\n\t */\r\n\tpublic getTranslucencyColorTexture(): Texture | null {\r\n\t\treturn this.getRef('translucencyColorTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its translucency color texture. If no texture is\r\n\t * attached, {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getTranslucencyColorTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('translucencyColorTexture') ? this.getRef('translucencyColorTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets translucency color texture. See {@link getTranslucencyColorTexture}. */\r\n\tpublic setTranslucencyColorTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('translucencyColorTexture', texture, { channels: R | G | B });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3, MathUtils } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_TRANSLUCENCY } from '../constants';\r\nimport { Translucency } from './translucency';\r\n\r\nconst NAME = KHR_MATERIALS_TRANSLUCENCY;\r\n\r\ninterface TranslucencyDef {\r\n\ttranslucencyFactor?: number;\r\n\ttranslucencyColorFactor?: vec3;\r\n\ttranslucencyTexture?: GLTF.ITextureInfo;\r\n\ttranslucencyColorTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsTranslucency\r\n */\r\nexport class MaterialsTranslucency extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Translucency property for use on a {@link Material}. */\r\n\tpublic createTranslucency(): Translucency {\r\n\t\treturn new Translucency(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst translucency = this.createTranslucency();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, translucency);\r\n\r\n\t\t\t\tconst translucencyDef = materialDef.extensions[NAME] as TranslucencyDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (translucencyDef.translucencyFactor !== undefined) {\r\n\t\t\t\t\ttranslucency.setTranslucencyFactor(translucencyDef.translucencyFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (translucencyDef.translucencyColorFactor !== undefined) {\r\n\t\t\t\t\ttranslucency.setTranslucencyColorFactor(translucencyDef.translucencyColorFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (translucencyDef.translucencyTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = translucencyDef.translucencyTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\ttranslucency.setTranslucencyTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(translucency.getTranslucencyTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t\tif (translucencyDef.translucencyColorTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = translucencyDef.translucencyColorTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\ttranslucency.setTranslucencyColorTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(translucency.getTranslucencyColorTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst translucency = material.getExtension<Translucency>(NAME);\r\n\t\t\t\tif (translucency) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst translucencyDef = (materialDef.extensions[NAME] = {} as TranslucencyDef);\r\n\r\n\t\t\t\t\tif (translucency.getTranslucencyFactor() !== 1) {\r\n\t\t\t\t\t\ttranslucencyDef.translucencyFactor = translucency.getTranslucencyFactor();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!MathUtils.eq(translucency.getTranslucencyColorFactor(), [1, 1, 1])) {\r\n\t\t\t\t\t\ttranslucencyDef.translucencyColorFactor = translucency.getTranslucencyColorFactor();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (translucency.getTranslucencyTexture()) {\r\n\t\t\t\t\t\tconst texture = translucency.getTranslucencyTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = translucency.getTranslucencyTextureInfo()!;\r\n\t\t\t\t\t\ttranslucencyDef.translucencyTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (translucency.getTranslucencyColorTexture()) {\r\n\t\t\t\t\t\tconst texture = translucency.getTranslucencyColorTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = translucency.getTranslucencyColorTextureInfo()!;\r\n\t\t\t\t\t\ttranslucencyDef.translucencyColorTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_TRANSMISSION } from '../constants';\r\n\r\ninterface ITransmission extends IProperty {\r\n\ttransmissionFactor: number;\r\n\ttransmissionTexture: Texture;\r\n\ttransmissionTextureInfo: TextureInfo;\r\n}\r\n\r\nconst { R } = TextureChannel;\r\n\r\n/**\r\n * # Transmission\r\n *\r\n * Defines optical transmission on a PBR {@link Material}. See {@link MaterialsTransmission}.\r\n */\r\nexport class Transmission extends ExtensionProperty<ITransmission> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_TRANSMISSION;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_TRANSMISSION;\r\n\tpublic declare propertyType: 'Transmission';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_TRANSMISSION;\r\n\t\tthis.propertyType = 'Transmission';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ITransmission> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\ttransmissionFactor: 0.0,\r\n\t\t\ttransmissionTexture: null,\r\n\t\t\ttransmissionTextureInfo: new TextureInfo(this.graph, 'transmissionTextureInfo'),\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Transmission.\r\n\t */\r\n\r\n\t/** Transmission; linear multiplier. See {@link getTransmissionTexture}. */\r\n\tpublic getTransmissionFactor(): number {\r\n\t\treturn this.get('transmissionFactor');\r\n\t}\r\n\r\n\t/** Transmission; linear multiplier. See {@link getTransmissionTexture}. */\r\n\tpublic setTransmissionFactor(factor: number): this {\r\n\t\treturn this.set('transmissionFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Transmission texture; linear multiplier. The `r` channel of this texture specifies\r\n\t * transmission [0-1] of the material's surface. By default this is a thin transparency\r\n\t * effect, but volume effects (refraction, subsurface scattering) may be introduced with the\r\n\t * addition of the `KHR_materials_volume` extension.\r\n\t */\r\n\tpublic getTransmissionTexture(): Texture | null {\r\n\t\treturn this.getRef('transmissionTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its transmission texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getTransmissionTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('transmissionTexture') ? this.getRef('transmissionTextureInfo') : null;\r\n\t}\r\n\r\n\t/** Sets transmission texture. See {@link getTransmissionTexture}. */\r\n\tpublic setTransmissionTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('transmissionTexture', texture, { channels: R });\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_TRANSMISSION } from '../constants';\r\nimport { Transmission } from './transmission';\r\n\r\nconst NAME = KHR_MATERIALS_TRANSMISSION;\r\n\r\ninterface TransmissionDef {\r\n\ttransmissionFactor?: number;\r\n\ttransmissionTexture?: GLTF.ITextureInfo;\r\n}\r\n\r\n/**\r\n * # MaterialsTransmission\r\n *\r\n * [`KHR_materials_transmission`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_transmission/)\r\n * provides a common type of optical transparency: infinitely-thin materials with no refraction,\r\n * scattering, or dispersion.\r\n *\r\n * While default PBR materials using alpha blending become invisible as their opacity approaches\r\n * zero, a transmissive material continues to reflect light in a glass-like manner, even at low\r\n * transmission values. When combined with {@link MaterialsVolume}, transmission may be used for\r\n * thicker materials and refractive effects.\r\n *\r\n * Properties:\r\n * - {@link Transmission}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsTransmission` class provides a single {@link ExtensionProperty} type,\r\n * `Transmission`, which may be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsTransmission, Transmission } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const transmissionExtension = document.createExtension(MaterialsTransmission);\r\n *\r\n * // Create a Transmission property.\r\n * const transmission = transmissionExtension.createTransmission()\r\n * \t.setTransmissionFactor(1.0);\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_transmission', transmission);\r\n * ```\r\n */\r\nexport class MaterialsTransmission extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Transmission property for use on a {@link Material}. */\r\n\tpublic createTransmission(): Transmission {\r\n\t\treturn new Transmission(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst transmission = this.createTransmission();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, transmission);\r\n\r\n\t\t\t\tconst transmissionDef = materialDef.extensions[NAME] as TransmissionDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (transmissionDef.transmissionFactor !== undefined) {\r\n\t\t\t\t\ttransmission.setTransmissionFactor(transmissionDef.transmissionFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (transmissionDef.transmissionTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = transmissionDef.transmissionTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\ttransmission.setTransmissionTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(transmission.getTransmissionTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst transmission = material.getExtension<Transmission>(NAME);\r\n\t\t\t\tif (transmission) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst transmissionDef = (materialDef.extensions[NAME] = {\r\n\t\t\t\t\t\ttransmissionFactor: transmission.getTransmissionFactor(),\r\n\t\t\t\t\t} as TransmissionDef);\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (transmission.getTransmissionTexture()) {\r\n\t\t\t\t\t\tconst texture = transmission.getTransmissionTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = transmission.getTransmissionTextureInfo()!;\r\n\t\t\t\t\t\ttransmissionDef.transmissionTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { ExtensionProperty } from '@gltf-transform/core';\r\nimport { PropertyType } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_UNLIT } from '../constants';\r\n\r\n/**\r\n * # Unlit\r\n *\r\n * Converts a PBR {@link Material} to an unlit shading model. See {@link MaterialsUnlit}.\r\n */\r\nexport class Unlit extends ExtensionProperty {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_UNLIT;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_UNLIT;\r\n\tpublic declare propertyType: 'Unlit';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_UNLIT;\r\n\t\tthis.propertyType = 'Unlit';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n}\r\n","import { Extension, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_UNLIT } from '../constants';\r\nimport { Unlit } from './unlit';\r\n\r\nconst NAME = KHR_MATERIALS_UNLIT;\r\n\r\n/**\r\n * # MaterialsUnlit\r\n *\r\n * [`KHR_materials_unlit`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_unlit/)\r\n * defines an unlit shading model for use in glTF 2.0 materials.\r\n *\r\n * ![Illustration](/media/extensions/khr-materials-unlit.png)\r\n *\r\n * > _**Figure:** Unlit materials are useful for flat shading, stylized effects, and for improving\r\n * > performance on mobile devices. Source: [Model by Hayden VanEarden](https://sketchfab.com/3d-models/summertime-kirby-c5711316103a4d67a62c34cfe8710938)._\r\n *\r\n * Unlit (also \"Shadeless\" or \"Constant\") materials provide a simple alternative to the Physically\r\n * Based Rendering (PBR) shading models provided by the core specification. Unlit materials are\r\n * often useful for cheaper rendering on performance-contrained devices, e.g. mobile phones.\r\n * Additionally, unlit materials can be very useful in achieving stylized, non-photo-realistic\r\n * effects like hand painted illustrative styles or baked toon shaders.\r\n *\r\n * Properties:\r\n * - {@link Unlit}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsUnlit` class provides a single {@link ExtensionProperty} type, `Unlit`, which may\r\n * be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsUnlit, Unlit } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const unlitExtension = document.createExtension(MaterialsUnlit);\r\n *\r\n * // Create an Unlit property.\r\n * const unlit = unlitExtension.createUnlit();\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_unlit', unlit);\r\n * ```\r\n */\r\nexport class MaterialsUnlit extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Unlit property for use on a {@link Material}. */\r\n\tpublic createUnlit(): Unlit {\r\n\t\treturn new Unlit(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst materialDefs = context.jsonDoc.json.materials || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, this.createUnlit());\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tif (material.getExtension<Unlit>(NAME)) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\t\t\t\t\tmaterialDef.extensions[NAME] = {};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { ExtensionProperty, IProperty, Material, Nullable } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VARIANTS } from '../constants';\r\nimport type { Variant } from './variant';\r\n\r\ninterface IMapping extends IProperty {\r\n\tmaterial: Material;\r\n\tvariants: Variant[];\r\n}\r\n\r\n/**\r\n * # Mapping\r\n *\r\n * Maps {@link Variant}s to {@link Material}s. See {@link MaterialsVariants}.\r\n */\r\nexport class Mapping extends ExtensionProperty<IMapping> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\r\n\tpublic declare propertyType: 'Mapping';\r\n\tpublic declare parentTypes: ['MappingList'];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\r\n\t\tthis.propertyType = 'Mapping';\r\n\t\tthis.parentTypes = ['MappingList'];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IMapping> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, { material: null, variants: [] });\r\n\t}\r\n\r\n\t/** The {@link Material} designated for this {@link Primitive}, under the given variants. */\r\n\tpublic getMaterial(): Material | null {\r\n\t\treturn this.getRef('material');\r\n\t}\r\n\r\n\t/** The {@link Material} designated for this {@link Primitive}, under the given variants. */\r\n\tpublic setMaterial(material: Material | null): this {\r\n\t\treturn this.setRef('material', material);\r\n\t}\r\n\r\n\t/** Adds a {@link Variant} to this mapping. */\r\n\tpublic addVariant(variant: Variant): this {\r\n\t\treturn this.addRef('variants', variant);\r\n\t}\r\n\r\n\t/** Removes a {@link Variant} from this mapping. */\r\n\tpublic removeVariant(variant: Variant): this {\r\n\t\treturn this.removeRef('variants', variant);\r\n\t}\r\n\r\n\t/** Lists {@link Variant}s in this mapping. */\r\n\tpublic listVariants(): Variant[] {\r\n\t\treturn this.listRefs('variants');\r\n\t}\r\n}\r\n","import { ExtensionProperty, IProperty, Nullable, PropertyType } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VARIANTS } from '../constants';\r\nimport type { Mapping } from './mapping';\r\n\r\ninterface IMappingList extends IProperty {\r\n\tmappings: Mapping[];\r\n}\r\n\r\n/**\r\n * # MappingList\r\n *\r\n * List of material variant {@link Mapping}s. See {@link MaterialsVariants}.\r\n */\r\nexport class MappingList extends ExtensionProperty<IMappingList> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\r\n\tpublic declare propertyType: 'MappingList';\r\n\tpublic declare parentTypes: [PropertyType.PRIMITIVE];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\r\n\t\tthis.propertyType = 'MappingList';\r\n\t\tthis.parentTypes = [PropertyType.PRIMITIVE];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IMappingList> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, { mappings: [] });\r\n\t}\r\n\r\n\t/** Adds a {@link Mapping} to this mapping. */\r\n\tpublic addMapping(mapping: Mapping): this {\r\n\t\treturn this.addRef('mappings', mapping);\r\n\t}\r\n\r\n\t/** Removes a {@link Mapping} from the list for this {@link Primitive}. */\r\n\tpublic removeMapping(mapping: Mapping): this {\r\n\t\treturn this.removeRef('mappings', mapping);\r\n\t}\r\n\r\n\t/** Lists {@link Mapping}s in this {@link Primitive}. */\r\n\tpublic listMappings(): Mapping[] {\r\n\t\treturn this.listRefs('mappings');\r\n\t}\r\n}\r\n","import { ExtensionProperty } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VARIANTS } from '../constants';\r\n\r\n/**\r\n * # Variant\r\n *\r\n * Defines a variant of a {@link Material}. See {@link MaterialsVariants}.\r\n */\r\nexport class Variant extends ExtensionProperty {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_VARIANTS;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\r\n\tpublic declare propertyType: 'Variant';\r\n\tpublic declare parentTypes: ['MappingList'];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\r\n\t\tthis.propertyType = 'Variant';\r\n\t\tthis.parentTypes = ['MappingList'];\r\n\t}\r\n}\r\n","import { Extension, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VARIANTS } from '../constants';\r\nimport { Mapping } from './mapping';\r\nimport { MappingList } from './mapping-list';\r\nimport { Variant } from './variant';\r\n\r\nconst NAME = KHR_MATERIALS_VARIANTS;\r\n\r\ninterface VariantsRootDef {\r\n\tvariants: VariantDef[];\r\n}\r\n\r\ninterface VariantDef {\r\n\tname?: string;\r\n}\r\n\r\ninterface VariantPrimDef {\r\n\tmappings: VariantMappingDef[];\r\n}\r\n\r\ninterface VariantMappingDef {\r\n\tmaterial: number;\r\n\tvariants: number[];\r\n}\r\n\r\n/**\r\n * # MaterialsVariants\r\n *\r\n * [`KHR_materials_variants`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants/)\r\n * defines alternate {@link Material} states for any {@link Primitive} in the scene.\r\n *\r\n * ![Illustration](/media/extensions/khr-materials-variants.png)\r\n *\r\n * > _**Figure:** A sneaker, in three material variants. Source: Khronos Group._\r\n *\r\n * Uses include product configurators, night/day states, healthy/damaged states, etc. The\r\n * `MaterialsVariants` class provides three {@link ExtensionProperty} types: `Variant`, `Mapping`,\r\n * and `MappingList`. When attached to {@link Primitive} properties, these offer flexible ways of\r\n * defining the variants available to an application. Triggering a variant is out of scope of this\r\n * extension, but could be handled in the application with a UI dropdown, particular game states,\r\n * and so on.\r\n *\r\n * Mesh geometry cannot be changed by this extension, although another extension\r\n * (tentative: `KHR_mesh_variants`) is under consideration by the Khronos Group, for that purpose.\r\n *\r\n * Properties:\r\n * - {@link Variant}\r\n * - {@link Mapping}\r\n * - {@link MappingList}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MaterialsVariants } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const variantExtension = document.createExtension(MaterialsVariants);\r\n *\r\n * // Create some Variant states.\r\n * const healthyVariant = variantExtension.createVariant('Healthy');\r\n * const damagedVariant = variantExtension.createVariant('Damaged');\r\n *\r\n * // Create mappings from a Variant state to a Material.\r\n * const healthyMapping = variantExtension.createMapping()\r\n * \t.addVariant(healthyVariant)\r\n * \t.setMaterial(healthyMat);\r\n * const damagedMapping = variantExtension.createMapping()\r\n * \t.addVariant(damagedVariant)\r\n * \t.setMaterial(damagedMat);\r\n *\r\n * // Attach the mappings to a Primitive.\r\n * primitive.setExtension(\r\n * \t'KHR_materials_variants',\r\n * \tvariantExtension.createMappingList()\r\n * \t\t.addMapping(healthyMapping)\r\n * \t\t.addMapping(damagedMapping)\r\n * );\r\n * ```\r\n *\r\n * A few notes about this extension:\r\n *\r\n * 1. Viewers that don't recognized this extension will show the default material for each primitive\r\n * \t instead, so assign that material accordingly. This material can be  but doesn't have to be \r\n * \t associated with one of the available variants.\r\n * 2. Mappings can list multiple Variants. In that case, the first Mapping containing an active\r\n * \t Variant will be chosen by the viewer.\r\n * 3. Variant names are how these states are identified, so choose informative names.\r\n * 4. When writing the file to an unpacked `.gltf`, instead of an embedded `.glb`, viewers will have\r\n * \t the option of downloading only textures associated with the default state, and lazy-loading\r\n * \t any textures for inactive Variants only when they are needed.\r\n */\r\nexport class MaterialsVariants extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new MappingList property. */\r\n\tpublic createMappingList(): MappingList {\r\n\t\treturn new MappingList(this.document.getGraph());\r\n\t}\r\n\r\n\t/** Creates a new Variant property. */\r\n\tpublic createVariant(name = ''): Variant {\r\n\t\treturn new Variant(this.document.getGraph(), name);\r\n\t}\r\n\r\n\t/** Creates a new Mapping property. */\r\n\tpublic createMapping(): Mapping {\r\n\t\treturn new Mapping(this.document.getGraph());\r\n\t}\r\n\r\n\t/** Lists all Variants on the current Document. */\r\n\tpublic listVariants(): Variant[] {\r\n\t\treturn Array.from(this.properties).filter((prop) => prop instanceof Variant) as Variant[];\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tif (!jsonDoc.json.extensions || !jsonDoc.json.extensions[NAME]) return this;\r\n\r\n\t\t// Read all top-level variant names.\r\n\t\tconst variantsRootDef = jsonDoc.json.extensions[NAME] as VariantsRootDef;\r\n\t\tconst variantDefs = variantsRootDef.variants || [];\r\n\t\tconst variants = variantDefs.map((variantDef) => this.createVariant().setName(variantDef.name || ''));\r\n\r\n\t\t// For each mesh primitive, read its material/variant mappings.\r\n\t\tconst meshDefs = jsonDoc.json.meshes || [];\r\n\t\tmeshDefs.forEach((meshDef, meshIndex) => {\r\n\t\t\tconst mesh = context.meshes[meshIndex];\r\n\t\t\tconst primDefs = meshDef.primitives || [];\r\n\r\n\t\t\tprimDefs.forEach((primDef, primIndex) => {\r\n\t\t\t\tif (!primDef.extensions || !primDef.extensions[NAME]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst mappingList = this.createMappingList();\r\n\r\n\t\t\t\tconst variantPrimDef = primDef.extensions[NAME] as VariantPrimDef;\r\n\t\t\t\tfor (const mappingDef of variantPrimDef.mappings) {\r\n\t\t\t\t\tconst mapping = this.createMapping();\r\n\r\n\t\t\t\t\tif (mappingDef.material !== undefined) {\r\n\t\t\t\t\t\tmapping.setMaterial(context.materials[mappingDef.material]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const variantIndex of mappingDef.variants || []) {\r\n\t\t\t\t\t\tmapping.addVariant(variants[variantIndex]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmappingList.addMapping(mapping);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.listPrimitives()[primIndex].setExtension(NAME, mappingList);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tconst variants = this.listVariants();\r\n\t\tif (!variants.length) return this;\r\n\r\n\t\t// Write all top-level variant names.\r\n\t\tconst variantDefs = [];\r\n\t\tconst variantIndexMap = new Map<Variant, number>();\r\n\t\tfor (const variant of variants) {\r\n\t\t\tvariantIndexMap.set(variant, variantDefs.length);\r\n\t\t\tvariantDefs.push(context.createPropertyDef(variant));\r\n\t\t}\r\n\r\n\t\t// For each mesh primitive, write its material/variant mappings.\r\n\t\tfor (const mesh of this.document.getRoot().listMeshes()) {\r\n\t\t\tconst meshIndex = context.meshIndexMap.get(mesh)!;\r\n\r\n\t\t\tmesh.listPrimitives().forEach((prim, primIndex) => {\r\n\t\t\t\tconst mappingList = prim.getExtension<MappingList>(NAME);\r\n\t\t\t\tif (!mappingList) return;\r\n\r\n\t\t\t\tconst primDef = context.jsonDoc.json.meshes![meshIndex].primitives[primIndex];\r\n\r\n\t\t\t\tconst mappingDefs = mappingList.listMappings().map((mapping) => {\r\n\t\t\t\t\tconst mappingDef = context.createPropertyDef(mapping) as VariantMappingDef;\r\n\r\n\t\t\t\t\tconst material = mapping.getMaterial();\r\n\t\t\t\t\tif (material) {\r\n\t\t\t\t\t\tmappingDef.material = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmappingDef.variants = mapping.listVariants().map((variant) => variantIndexMap.get(variant)!);\r\n\r\n\t\t\t\t\treturn mappingDef;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tprimDef.extensions = primDef.extensions || {};\r\n\t\t\t\tprimDef.extensions[NAME] = { mappings: mappingDefs };\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tjsonDoc.json.extensions = jsonDoc.json.extensions || {};\r\n\t\tjsonDoc.json.extensions[NAME] = { variants: variantDefs };\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import {\r\n\tColorUtils,\r\n\tExtensionProperty,\r\n\tIProperty,\r\n\tNullable,\r\n\tPropertyType,\r\n\tTexture,\r\n\tTextureChannel,\r\n\tTextureInfo,\r\n\tvec3,\r\n} from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VOLUME } from '../constants';\r\n\r\ninterface IVolume extends IProperty {\r\n\tthicknessFactor: number;\r\n\tthicknessTexture: Texture;\r\n\tthicknessTextureInfo: TextureInfo;\r\n\tattenuationDistance: number;\r\n\tattenuationColor: vec3;\r\n}\r\n\r\nconst { G } = TextureChannel;\r\n\r\n/**\r\n * # Volume\r\n *\r\n * Defines volume on a PBR {@link Material}. See {@link MaterialsVolume}.\r\n */\r\nexport class Volume extends ExtensionProperty<IVolume> {\r\n\tpublic static EXTENSION_NAME = KHR_MATERIALS_VOLUME;\r\n\tpublic declare extensionName: typeof KHR_MATERIALS_VOLUME;\r\n\tpublic declare propertyType: 'Volume';\r\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_MATERIALS_VOLUME;\r\n\t\tthis.propertyType = 'Volume';\r\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IVolume> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\tthicknessFactor: 0.0,\r\n\t\t\tthicknessTexture: null,\r\n\t\t\tthicknessTextureInfo: new TextureInfo(this.graph, 'thicknessTexture'),\r\n\t\t\tattenuationDistance: Infinity,\r\n\t\t\tattenuationColor: [1.0, 1.0, 1.0] as vec3,\r\n\t\t});\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Thickness.\r\n\t */\r\n\r\n\t/**\r\n\t * Thickness of the volume beneath the surface in meters in the local coordinate system of the\r\n\t * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\r\n\t * boundary. The doubleSided property has no effect on volume boundaries.\r\n\t */\r\n\tpublic getThicknessFactor(): number {\r\n\t\treturn this.get('thicknessFactor');\r\n\t}\r\n\r\n\t/**\r\n\t * Thickness of the volume beneath the surface in meters in the local coordinate system of the\r\n\t * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\r\n\t * boundary. The doubleSided property has no effect on volume boundaries.\r\n\t */\r\n\tpublic setThicknessFactor(factor: number): this {\r\n\t\treturn this.set('thicknessFactor', factor);\r\n\t}\r\n\r\n\t/**\r\n\t * Texture that defines the thickness, stored in the G channel. This will be multiplied by\r\n\t * thicknessFactor.\r\n\t */\r\n\tpublic getThicknessTexture(): Texture | null {\r\n\t\treturn this.getRef('thicknessTexture');\r\n\t}\r\n\r\n\t/**\r\n\t * Settings affecting the material's use of its thickness texture. If no texture is attached,\r\n\t * {@link TextureInfo} is `null`.\r\n\t */\r\n\tpublic getThicknessTextureInfo(): TextureInfo | null {\r\n\t\treturn this.getRef('thicknessTexture') ? this.getRef('thicknessTextureInfo') : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Texture that defines the thickness, stored in the G channel. This will be multiplied by\r\n\t * thicknessFactor.\r\n\t */\r\n\tpublic setThicknessTexture(texture: Texture | null): this {\r\n\t\treturn this.setRef('thicknessTexture', texture, { channels: G });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Attenuation.\r\n\t */\r\n\r\n\t/**\r\n\t * Density of the medium given as the average distance in meters that light travels in the\r\n\t * medium before interacting with a particle.\r\n\t */\r\n\tpublic getAttenuationDistance(): number {\r\n\t\treturn this.get('attenuationDistance');\r\n\t}\r\n\r\n\t/**\r\n\t * Density of the medium given as the average distance in meters that light travels in the\r\n\t * medium before interacting with a particle.\r\n\t */\r\n\tpublic setAttenuationDistance(distance: number): this {\r\n\t\treturn this.set('attenuationDistance', distance);\r\n\t}\r\n\r\n\t/**\r\n\t * Color (linear) that white light turns into due to absorption when reaching the attenuation\r\n\t * distance.\r\n\t */\r\n\tpublic getAttenuationColor(): vec3 {\r\n\t\treturn this.get('attenuationColor');\r\n\t}\r\n\r\n\t/**\r\n\t * Color (linear) that white light turns into due to absorption when reaching the attenuation\r\n\t * distance.\r\n\t */\r\n\tpublic setAttenuationColor(color: vec3): this {\r\n\t\treturn this.set('attenuationColor', color);\r\n\t}\r\n\r\n\t/**\r\n\t * Color (sRGB) that white light turns into due to absorption when reaching the attenuation\r\n\t * distance.\r\n\t */\r\n\tpublic getAttenuationColorHex(): number {\r\n\t\treturn ColorUtils.factorToHex(this.getAttenuationColor());\r\n\t}\r\n\r\n\t/**\r\n\t * Color (sRGB) that white light turns into due to absorption when reaching the attenuation\r\n\t * distance.\r\n\t */\r\n\tpublic setAttenuationColorHex(hex: number): this {\r\n\t\tconst factor = this.getAttenuationColor().slice() as vec3;\r\n\t\treturn this.set('attenuationColor', ColorUtils.hexToFactor(hex, factor));\r\n\t}\r\n}\r\n","import { Extension, GLTF, ReaderContext, WriterContext, vec3, MathUtils } from '@gltf-transform/core';\r\nimport { KHR_MATERIALS_VOLUME } from '../constants';\r\nimport { Volume } from './volume';\r\n\r\nconst NAME = KHR_MATERIALS_VOLUME;\r\n\r\ninterface VolumeDef {\r\n\tthicknessFactor?: number;\r\n\tthicknessTexture?: GLTF.ITextureInfo;\r\n\tattenuationDistance?: number;\r\n\tattenuationColor?: vec3;\r\n}\r\n\r\n/**\r\n * # MaterialsVolume\r\n *\r\n * [KHR_materials_volume](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_volume/)\r\n * adds refraction, absorption, or scattering to a glTF PBR material already using transmission or\r\n * translucency.\r\n *\r\n * ![Illustration](/media/extensions/khr-materials-volume.png)\r\n *\r\n * > _**Figure:** Base color changes the amount of light passing through the volume boundary\r\n * > (left). The overall color of the object is the same everywhere, as if the object is covered\r\n * > with a colored, transparent foil. Absorption changes the amount of light traveling through the\r\n * > volume (right). The overall color depends on the distance the light traveled through it; at\r\n * > small distances (tail of the dragon) less light is absorbed and the color is brighter than at\r\n * > large distances. Source: Khronos Group._\r\n *\r\n * By default, a glTF 2.0 material describes the scattering properties of a surface enclosing an\r\n * infinitely thin volume. The surface defined by the mesh represents a thin wall. The volume\r\n * extension makes it possible to turn the surface into an interface between volumes. The mesh to\r\n * which the material is attached defines the boundaries of an homogeneous medium and therefore must\r\n * be manifold. Volumes provide effects like refraction, absorption and scattering. Scattering\r\n * effects will require future (TBD) extensions.\r\n *\r\n * The volume extension must be combined with {@link MaterialsTransmission} or\r\n * `KHR_materials_translucency` in order to define entry of light into the volume.\r\n *\r\n * Properties:\r\n * - {@link Volume}\r\n *\r\n * ### Example\r\n *\r\n * The `MaterialsVolume` class provides a single {@link ExtensionProperty} type, `Volume`, which\r\n * may be attached to any {@link Material} instance. For example:\r\n *\r\n * ```typescript\r\n * import { MaterialsVolume, Volume } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const volumeExtension = document.createExtension(MaterialsVolume);\r\n *\r\n * // Create a Volume property.\r\n * const volume = volumeExtension.createVolume()\r\n * \t.setThicknessFactor(1.0)\r\n * \t.setThicknessTexture(texture)\r\n * \t.setAttenuationDistance(1.0)\r\n * \t.setAttenuationColorHex(0xFFEEEE);\r\n *\r\n * // Attach the property to a Material.\r\n * material.setExtension('KHR_materials_volume', volume);\r\n * ```\r\n *\r\n * A thickness texture is required in most realtime renderers, and can be baked in software such as\r\n * Blender or Substance Painter. When `thicknessFactor = 0`, all volumetric effects are disabled.\r\n */\r\nexport class MaterialsVolume extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Volume property for use on a {@link Material}. */\r\n\tpublic createVolume(): Volume {\r\n\t\treturn new Volume(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\t\tconst materialDefs = jsonDoc.json.materials || [];\r\n\t\tconst textureDefs = jsonDoc.json.textures || [];\r\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\r\n\t\t\tif (materialDef.extensions && materialDef.extensions[NAME]) {\r\n\t\t\t\tconst volume = this.createVolume();\r\n\t\t\t\tcontext.materials[materialIndex].setExtension(NAME, volume);\r\n\r\n\t\t\t\tconst volumeDef = materialDef.extensions[NAME] as VolumeDef;\r\n\r\n\t\t\t\t// Factors.\r\n\r\n\t\t\t\tif (volumeDef.thicknessFactor !== undefined) {\r\n\t\t\t\t\tvolume.setThicknessFactor(volumeDef.thicknessFactor);\r\n\t\t\t\t}\r\n\t\t\t\tif (volumeDef.attenuationDistance !== undefined) {\r\n\t\t\t\t\tvolume.setAttenuationDistance(volumeDef.attenuationDistance);\r\n\t\t\t\t}\r\n\t\t\t\tif (volumeDef.attenuationColor !== undefined) {\r\n\t\t\t\t\tvolume.setAttenuationColor(volumeDef.attenuationColor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Textures.\r\n\r\n\t\t\t\tif (volumeDef.thicknessTexture !== undefined) {\r\n\t\t\t\t\tconst textureInfoDef = volumeDef.thicknessTexture;\r\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\r\n\t\t\t\t\tvolume.setThicknessTexture(texture);\r\n\t\t\t\t\tcontext.setTextureInfo(volume.getThicknessTextureInfo()!, textureInfoDef);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listMaterials()\r\n\t\t\t.forEach((material) => {\r\n\t\t\t\tconst volume = material.getExtension<Volume>(NAME);\r\n\t\t\t\tif (volume) {\r\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\r\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\r\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\r\n\r\n\t\t\t\t\t// Factors.\r\n\r\n\t\t\t\t\tconst volumeDef = (materialDef.extensions[NAME] = {} as VolumeDef);\r\n\r\n\t\t\t\t\tif (volume.getThicknessFactor() > 0) {\r\n\t\t\t\t\t\tvolumeDef.thicknessFactor = volume.getThicknessFactor();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (Number.isFinite(volume.getAttenuationDistance())) {\r\n\t\t\t\t\t\tvolumeDef.attenuationDistance = volume.getAttenuationDistance();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!MathUtils.eq(volume.getAttenuationColor(), [1, 1, 1])) {\r\n\t\t\t\t\t\tvolumeDef.attenuationColor = volume.getAttenuationColor();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Textures.\r\n\r\n\t\t\t\t\tif (volume.getThicknessTexture()) {\r\n\t\t\t\t\t\tconst texture = volume.getThicknessTexture()!;\r\n\t\t\t\t\t\tconst textureInfo = volume.getThicknessTextureInfo()!;\r\n\t\t\t\t\t\tvolumeDef.thicknessTexture = context.createTextureInfoDef(texture, textureInfo);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Extension, ReaderContext, WriterContext } from '@gltf-transform/core';\r\nimport { KHR_MESH_QUANTIZATION } from '../constants';\r\n\r\nconst NAME = KHR_MESH_QUANTIZATION;\r\n\r\n/**\r\n * # MeshQuantization\r\n *\r\n * [`KHR_mesh_quantization`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_mesh_quantization/)\r\n * expands allowed component types for vertex attributes to include 16- and 8-bit storage.\r\n *\r\n * Quantization provides a memory/precision tradeoff  depending on the application needs, 16-bit or\r\n * 8-bit storage can be sufficient for mesh geometry, at 1/2 or 1/4 the size. For example, a 10x10\r\n * mesh might be written to a uint16 {@link Accessor}, with values `065536`, normalized to be\r\n * interpreted as `01`. With an additional 10x scale on any node {@link Node} instantiating the\r\n * quantized {@link Mesh}, the model retains its original scale with a minimal quality loss and\r\n * up to 50% file size reduction.\r\n *\r\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\r\n * {@link Document}, and affects the entire Document by allowing more flexible use of\r\n * {@link Accessor} types for vertex attributes. Without the Extension, the same use of these data\r\n * types would yield an invalid glTF document, under the stricter core glTF specification.\r\n *\r\n * Properties:\r\n * - N/A\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { MeshQuantization } from '@gltf-transform/extensions';\r\n * import { quantize } from '@gltf-transform/functions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const quantizationExtension = document.createExtension(MeshQuantization).setRequired(true);\r\n *\r\n * // Use Uint16Array, Uint8Array, Int16Array, and Int8Array in vertex accessors manually,\r\n * // or apply the provided quantize() function to compute quantized accessors automatically:\r\n * await document.transform(quantize({\r\n * \tquantizePosition: 16,\r\n * \tquantizeNormal: 12,\r\n * \tquantizeTexcoord: 14\r\n * }));\r\n * ```\r\n *\r\n * For more documentation about automatic quantization, see the {@link quantize} function.\r\n */\r\nexport class MeshQuantization extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** @hidden */\r\n\tread(_: ReaderContext): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\twrite(_: WriterContext): this {\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { KTX2Model, read as readKTX } from 'ktx-parse';\r\nimport {\r\n\tExtension,\r\n\tImageUtils,\r\n\tImageUtilsFormat,\r\n\tPropertyType,\r\n\tReaderContext,\r\n\tWriterContext,\r\n\tvec2,\r\n} from '@gltf-transform/core';\r\nimport { KHR_TEXTURE_BASISU } from '../constants';\r\n\r\nconst NAME = KHR_TEXTURE_BASISU;\r\n\r\ninterface BasisuDef {\r\n\tsource: number;\r\n}\r\n\r\nclass KTX2ImageUtils implements ImageUtilsFormat {\r\n\tmatch(array: Uint8Array): boolean {\r\n\t\treturn (\r\n\t\t\tarray[0] === 0xab &&\r\n\t\t\tarray[1] === 0x4b &&\r\n\t\t\tarray[2] === 0x54 &&\r\n\t\t\tarray[3] === 0x58 &&\r\n\t\t\tarray[4] === 0x20 &&\r\n\t\t\tarray[5] === 0x32 &&\r\n\t\t\tarray[6] === 0x30 &&\r\n\t\t\tarray[7] === 0xbb &&\r\n\t\t\tarray[8] === 0x0d &&\r\n\t\t\tarray[9] === 0x0a &&\r\n\t\t\tarray[10] === 0x1a &&\r\n\t\t\tarray[11] === 0x0a\r\n\t\t);\r\n\t}\r\n\tgetSize(array: Uint8Array): vec2 {\r\n\t\tconst container = readKTX(array);\r\n\t\treturn [container.pixelWidth, container.pixelHeight];\r\n\t}\r\n\tgetChannels(array: Uint8Array): number {\r\n\t\tconst container = readKTX(array);\r\n\t\tconst dfd = container.dataFormatDescriptor[0];\r\n\t\tif (dfd.colorModel === KTX2Model.ETC1S) {\r\n\t\t\treturn dfd.samples.length === 2 && (dfd.samples[1].channelID & 0xf) === 15 ? 4 : 3;\r\n\t\t} else if (dfd.colorModel === KTX2Model.UASTC) {\r\n\t\t\treturn (dfd.samples[0].channelID & 0xf) === 3 ? 4 : 3;\r\n\t\t}\r\n\t\tthrow new Error(`Unexpected KTX2 colorModel, \"${dfd.colorModel}\".`);\r\n\t}\r\n\tgetGPUByteLength(array: Uint8Array): number {\r\n\t\tconst container = readKTX(array);\r\n\t\tconst hasAlpha = this.getChannels(array) > 3;\r\n\r\n\t\tlet uncompressedBytes = 0;\r\n\t\tfor (let i = 0; i < container.levels.length; i++) {\r\n\t\t\tconst level = container.levels[i];\r\n\r\n\t\t\t// Use level.uncompressedByteLength for UASTC; for ETC1S it's 0.\r\n\t\t\tif (level.uncompressedByteLength) {\r\n\t\t\t\tuncompressedBytes += level.uncompressedByteLength;\r\n\t\t\t} else {\r\n\t\t\t\tconst levelWidth = Math.max(1, Math.floor(container.pixelWidth / Math.pow(2, i)));\r\n\t\t\t\tconst levelHeight = Math.max(1, Math.floor(container.pixelHeight / Math.pow(2, i)));\r\n\t\t\t\tconst blockSize = hasAlpha ? 16 : 8;\r\n\t\t\t\tuncompressedBytes += (levelWidth / 4) * (levelHeight / 4) * blockSize;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn uncompressedBytes;\r\n\t}\r\n}\r\n\r\n/**\r\n * # TextureBasisu\r\n *\r\n * [`KHR_texture_basisu`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu)\r\n * enables KTX2 GPU textures with Basis Universal supercompression for any material texture.\r\n *\r\n * GPU texture formats, unlike traditional image formats, remain compressed in GPU memory. As a\r\n * result, they (1) upload to the GPU much more quickly, and (2) require much less GPU memory. In\r\n * certain cases they may also have smaller filesizes than PNG or JPEG textures, but this is not\r\n * guaranteed. GPU textures often require more careful tuning during compression to maintain image\r\n * quality, but this extra effort is worthwhile for applications that need to maintain a smooth\r\n * framerate while uploading images, or where GPU memory is limited.\r\n *\r\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\r\n * {@link Document}, and affects the entire Document by allowing use of the `image/ktx2` MIME type\r\n * and passing KTX2 image data to the {@link Texture.setImage} method. Without the Extension, the\r\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\r\n * specification.\r\n *\r\n * Properties:\r\n * - N/A\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { TextureBasisu } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const basisuExtension = document.createExtension(TextureBasisu)\r\n * \t.setRequired(true);\r\n * document.createTexture('MyCompressedTexture')\r\n * \t.setMimeType('image/ktx2')\r\n * \t.setImage(fs.readFileSync('my-texture.ktx2'));\r\n * ```\r\n *\r\n * Compression is not done automatically when adding the extension as shown above  you must\r\n * compress the image data first, then pass the `.ktx2` payload to {@link Texture.setImage}. The\r\n * [glTF-Transform CLI](/cli.html) has functions to help with this, or any similar KTX2-capable\r\n * utility will work.\r\n *\r\n * When the `KHR_texture_basisu` extension is added to a file by glTF-Transform, the extension\r\n * should always be required. This tool does not support writing assets that \"fall back\" to optional\r\n * PNG or JPEG image data.\r\n *\r\n * > _**NOTICE:** Compressing some textures  particularly 3-component (RGB) normal maps, and\r\n * > occlusion/roughness/metalness maps, may give poor results with the ETC1S compression option.\r\n * > These issues can often be avoided with the larger UASTC compression option, or by upscaling the\r\n * > texture before compressing it.\r\n * >\r\n * > For best results when authoring new textures, use\r\n * > [texture dilation](https://docs.substance3d.com/spdoc/padding-134643719.html) and minimize\r\n * > prominent UV seams._\r\n */\r\nexport class TextureBasisu extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\t/** @hidden */\r\n\tpublic readonly prereadTypes = [PropertyType.TEXTURE];\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** @hidden */\r\n\tpublic static register(): void {\r\n\t\tImageUtils.registerFormat('image/ktx2', new KTX2ImageUtils());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic preread(context: ReaderContext): this {\r\n\t\tcontext.jsonDoc.json.textures!.forEach((textureDef) => {\r\n\t\t\tif (textureDef.extensions && textureDef.extensions[NAME]) {\r\n\t\t\t\tconst basisuDef = textureDef.extensions[NAME] as BasisuDef;\r\n\t\t\t\ttextureDef.source = basisuDef.source;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tpublic read(context: ReaderContext): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst jsonDoc = context.jsonDoc;\r\n\r\n\t\tthis.document\r\n\t\t\t.getRoot()\r\n\t\t\t.listTextures()\r\n\t\t\t.forEach((texture) => {\r\n\t\t\t\tif (texture.getMimeType() === 'image/ktx2') {\r\n\t\t\t\t\tconst imageIndex = context.imageIndexMap.get(texture);\r\n\t\t\t\t\tjsonDoc.json.textures!.forEach((textureDef) => {\r\n\t\t\t\t\t\tif (textureDef.source === imageIndex) {\r\n\t\t\t\t\t\t\ttextureDef.extensions = textureDef.extensions || {};\r\n\t\t\t\t\t\t\ttextureDef.extensions[NAME] = { source: textureDef.source };\r\n\t\t\t\t\t\t\tdelete textureDef.source;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { ExtensionProperty, IProperty, Nullable, vec2 } from '@gltf-transform/core';\r\nimport { PropertyType } from '@gltf-transform/core';\r\nimport { KHR_TEXTURE_TRANSFORM } from '../constants';\r\n\r\ninterface ITransform extends IProperty {\r\n\toffset: vec2;\r\n\trotation: number;\r\n\tscale: vec2;\r\n\ttexCoord: number | null; // null  do not override TextureInfo.\r\n}\r\n\r\n/**\r\n * # Transform\r\n *\r\n * Defines UV transform for a {@link TextureInfo}. See {@link TextureTransform}.\r\n */\r\nexport class Transform extends ExtensionProperty<ITransform> {\r\n\tpublic static EXTENSION_NAME = KHR_TEXTURE_TRANSFORM;\r\n\tpublic declare extensionName: typeof KHR_TEXTURE_TRANSFORM;\r\n\tpublic declare propertyType: 'Transform';\r\n\tpublic declare parentTypes: [PropertyType.TEXTURE_INFO];\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_TEXTURE_TRANSFORM;\r\n\t\tthis.propertyType = 'Transform';\r\n\t\tthis.parentTypes = [PropertyType.TEXTURE_INFO];\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<ITransform> {\r\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\r\n\t\t\toffset: [0.0, 0.0] as vec2,\r\n\t\t\trotation: 0,\r\n\t\t\tscale: [1.0, 1.0] as vec2,\r\n\t\t\ttexCoord: null,\r\n\t\t});\r\n\t}\r\n\r\n\tpublic getOffset(): vec2 {\r\n\t\treturn this.get('offset');\r\n\t}\r\n\tpublic setOffset(offset: vec2): this {\r\n\t\treturn this.set('offset', offset);\r\n\t}\r\n\r\n\tpublic getRotation(): number {\r\n\t\treturn this.get('rotation');\r\n\t}\r\n\tpublic setRotation(rotation: number): this {\r\n\t\treturn this.set('rotation', rotation);\r\n\t}\r\n\r\n\tpublic getScale(): vec2 {\r\n\t\treturn this.get('scale');\r\n\t}\r\n\tpublic setScale(scale: vec2): this {\r\n\t\treturn this.set('scale', scale);\r\n\t}\r\n\r\n\tpublic getTexCoord(): number | null {\r\n\t\treturn this.get('texCoord');\r\n\t}\r\n\tpublic setTexCoord(texCoord: number | null): this {\r\n\t\treturn this.set('texCoord', texCoord);\r\n\t}\r\n}\r\n","import { Extension, MathUtils, ReaderContext, WriterContext, vec2 } from '@gltf-transform/core';\r\nimport { KHR_TEXTURE_TRANSFORM } from '../constants';\r\nimport { Transform } from './transform';\r\n\r\nconst NAME = KHR_TEXTURE_TRANSFORM;\r\n\r\ninterface TransformDef {\r\n\toffset?: vec2;\r\n\trotation?: number;\r\n\tscale?: vec2;\r\n\ttexCoord?: number;\r\n}\r\n\r\n/**\r\n * # TextureTransform\r\n *\r\n * [`KHR_texture_transform`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_texture_transform/)\r\n * adds offset, rotation, and scale to {@link TextureInfo} properties.\r\n *\r\n * Affine UV transforms are useful for reducing the number of textures the GPU must load, improving\r\n * performance when used in techniques like texture atlases. UV transforms cannot be animated at\r\n * this time.\r\n *\r\n * Properties:\r\n * - {@link Transform}\r\n *\r\n * ### Example\r\n *\r\n * The `TextureTransform` class provides a single {@link ExtensionProperty} type, `Transform`, which\r\n * may be attached to any {@link TextureInfo} instance. For example:\r\n *\r\n * ```typescript\r\n * import { TextureTransform } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const transformExtension = document.createExtension(TextureTransform)\r\n * \t.setRequired(true);\r\n *\r\n * // Create a reusable Transform.\r\n * const transform = transformExtension.createTransform()\r\n * \t.setScale([100, 100]);\r\n *\r\n * // Apply the Transform to a Material's baseColorTexture.\r\n * document.createMaterial()\r\n * \t.setBaseColorTexture(myTexture)\r\n * \t.getBaseColorTextureInfo()\r\n * \t.setExtension('KHR_texture_transform', transform);\r\n * ```\r\n */\r\nexport class TextureTransform extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new Transform property for use on a {@link TextureInfo}. */\r\n\tpublic createTransform(): Transform {\r\n\t\treturn new Transform(this.document.getGraph());\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tfor (const [textureInfo, textureInfoDef] of Array.from(context.textureInfos.entries())) {\r\n\t\t\tif (!textureInfoDef.extensions || !textureInfoDef.extensions[NAME]) continue;\r\n\r\n\t\t\tconst transform = this.createTransform();\r\n\t\t\tconst transformDef = textureInfoDef.extensions[NAME] as TransformDef;\r\n\r\n\t\t\tif (transformDef.offset !== undefined) transform.setOffset(transformDef.offset);\r\n\t\t\tif (transformDef.rotation !== undefined) transform.setRotation(transformDef.rotation);\r\n\t\t\tif (transformDef.scale !== undefined) transform.setScale(transformDef.scale);\r\n\t\t\tif (transformDef.texCoord !== undefined) transform.setTexCoord(transformDef.texCoord);\r\n\r\n\t\t\ttextureInfo.setExtension(NAME, transform);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst textureInfoEntries = Array.from(context.textureInfoDefMap.entries());\r\n\t\tfor (const [textureInfo, textureInfoDef] of textureInfoEntries) {\r\n\t\t\tconst transform = textureInfo.getExtension<Transform>(NAME);\r\n\t\t\tif (!transform) continue;\r\n\r\n\t\t\ttextureInfoDef.extensions = textureInfoDef.extensions || {};\r\n\t\t\tconst transformDef = {} as TransformDef;\r\n\r\n\t\t\tconst eq = MathUtils.eq;\r\n\t\t\tif (!eq(transform.getOffset(), [0, 0])) transformDef.offset = transform.getOffset();\r\n\t\t\tif (transform.getRotation() !== 0) transformDef.rotation = transform.getRotation();\r\n\t\t\tif (!eq(transform.getScale(), [1, 1])) transformDef.scale = transform.getScale();\r\n\t\t\tif (transform.getTexCoord() != null) transformDef.texCoord = transform.getTexCoord()!;\r\n\r\n\t\t\ttextureInfoDef.extensions[NAME] = transformDef;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n","import { Nullable, PropertyType, ExtensionProperty, IProperty } from '@gltf-transform/core';\r\nimport { KHR_XMP_JSON_LD } from '../constants';\r\n\r\ntype Term = string;\r\ntype TermDefinition = string | Record<string, string>;\r\n\r\ntype Value = string | number | boolean;\r\n\r\nconst PARENT_TYPES = [\r\n\tPropertyType.ROOT,\r\n\tPropertyType.SCENE,\r\n\tPropertyType.NODE,\r\n\tPropertyType.MESH,\r\n\tPropertyType.MATERIAL,\r\n\tPropertyType.TEXTURE,\r\n\tPropertyType.ANIMATION,\r\n];\r\n\r\ninterface IPacket extends IProperty {\r\n\t// https://json-ld.org/spec/latest/json-ld/#the-context\r\n\tcontext: Record<Term, TermDefinition>;\r\n\tproperties: Record<string, Value | Record<string, unknown>>;\r\n}\r\n\r\n/**\r\n * # Packet\r\n *\r\n * Defines an XMP packet associated with a Document or Property. See {@link XMP}.\r\n */\r\nexport class Packet extends ExtensionProperty<IPacket> {\r\n\tpublic declare propertyType: 'Packet';\r\n\tpublic declare parentTypes: typeof PARENT_TYPES;\r\n\tpublic declare extensionName: typeof KHR_XMP_JSON_LD;\r\n\tpublic static EXTENSION_NAME = KHR_XMP_JSON_LD;\r\n\r\n\tprotected init(): void {\r\n\t\tthis.extensionName = KHR_XMP_JSON_LD;\r\n\t\tthis.propertyType = 'Packet';\r\n\t\tthis.parentTypes = PARENT_TYPES;\r\n\t}\r\n\r\n\tprotected getDefaults(): Nullable<IPacket> {\r\n\t\treturn Object.assign(super.getDefaults(), { context: {}, properties: {} });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Context.\r\n\t */\r\n\r\n\t/**\r\n\t * Returns the XMP context definition URL for the given term.\r\n\t * See: https://json-ld.org/spec/latest/json-ld/#the-context\r\n\t * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\r\n\t */\r\n\tpublic getContext(): Record<Term, TermDefinition> {\r\n\t\treturn this.get('context');\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the XMP context definition URL for the given term.\r\n\t * See: https://json-ld.org/spec/latest/json-ld/#the-context\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```typescript\r\n\t * packet.setContext({\r\n\t *   dc: 'http://purl.org/dc/elements/1.1/',\r\n\t *   model3d: 'https://schema.khronos.org/model3d/xsd/1.0/',\r\n\t * });\r\n\t * ```\r\n\t *\r\n\t * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\r\n\t * @param definition URI for XMP namespace.\r\n\t */\r\n\tpublic setContext(context: Record<Term, TermDefinition>): this {\r\n\t\treturn this.set('context', { ...context });\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Properties.\r\n\t */\r\n\r\n\t/**\r\n\t * Lists properties defined in this packet.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```typescript\r\n\t * packet.listProperties(); //  ['dc:Language', 'dc:Creator', 'xmp:CreateDate']\r\n\t * ```\r\n\t */\r\n\tpublic listProperties(): string[] {\r\n\t\treturn Object.keys(this.get('properties'));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the value of a property, as a literal or JSONLD object.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```typescript\r\n\t * packet.getProperty('dc:Creator'); //  {\"@list\": [\"Acme, Inc.\"]}\r\n\t * packet.getProperty('dc:Title'); //  {\"@type\": \"rdf:Alt\", \"rdf:_1\": {\"@language\": \"en-US\", \"@value\": \"Lamp\"}}\r\n\t * packet.getProperty('xmp:CreateDate'); //  \"2022-01-01\"\r\n\t * ```\r\n\t */\r\n\tpublic getProperty(name: string): Value | Record<string, unknown> | null {\r\n\t\tconst properties = this.get('properties');\r\n\t\treturn name in properties ? properties[name] : null;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the value of a property, as a literal or JSONLD object.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```typescript\r\n\t * packet.setProperty('dc:Creator', {'@list': ['Acme, Inc.']});\r\n\t * packet.setProperty('dc:Title', {\r\n\t * \t'@type': 'rdf:Alt',\r\n\t * \t'rdf:_1': {'@language': 'en-US', '@value': 'Lamp'}\r\n\t * });\r\n\t * packet.setProperty('model3d:preferredSurfaces', {'@list': ['vertical']});\r\n\t * ```\r\n\t */\r\n\tpublic setProperty(name: string, value: Value | Record<string, unknown>): this {\r\n\t\tthis._assertContext(name);\r\n\r\n\t\tconst properties = { ...this.get('properties') };\r\n\t\tif (value) {\r\n\t\t\tproperties[name] = value;\r\n\t\t} else {\r\n\t\t\tdelete properties[name];\r\n\t\t}\r\n\t\treturn this.set('properties', properties);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Serialize / Deserialize.\r\n\t */\r\n\r\n\t/**\r\n\t * Serializes the packet context and properties to a JSONLD object.\r\n\t */\r\n\tpublic toJSONLD(): Record<string, unknown> {\r\n\t\tconst context = copyJSON(this.get('context'));\r\n\t\tconst properties = copyJSON(this.get('properties'));\r\n\t\treturn { '@context': context, ...properties };\r\n\t}\r\n\r\n\t/**\r\n\t * Deserializes a JSONLD packet, then overwrites existing context and properties with\r\n\t * the new values.\r\n\t */\r\n\tpublic fromJSONLD(jsonld: Record<string, unknown>): this {\r\n\t\tjsonld = copyJSON(jsonld);\r\n\r\n\t\t// Context.\r\n\t\tconst context = jsonld['@context'] as Record<Term, TermDefinition>;\r\n\t\tif (context) this.set('context', context);\r\n\t\tdelete jsonld['@context'];\r\n\r\n\t\t// Properties.\r\n\t\treturn this.set('properties', jsonld as Record<string, string | Record<string, unknown>>);\r\n\t}\r\n\r\n\t/**********************************************************************************************\r\n\t * Validation.\r\n\t */\r\n\r\n\t/** @hidden */\r\n\tprivate _assertContext(name: string) {\r\n\t\tconst prefix = name.split(':')[0];\r\n\t\tif (!(prefix in this.get('context'))) {\r\n\t\t\tthrow new Error(`${KHR_XMP_JSON_LD}: Missing context for term, \"${name}\".`);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction copyJSON<T>(object: T): T {\r\n\treturn JSON.parse(JSON.stringify(object));\r\n}\r\n","import {\r\n\tAnimation,\r\n\tExtension,\r\n\tGLTF,\r\n\tMaterial,\r\n\tMesh,\r\n\tNode,\r\n\tPropertyType,\r\n\tReaderContext,\r\n\tScene,\r\n\tTexture,\r\n\tWriterContext,\r\n} from '@gltf-transform/core';\r\nimport { KHR_XMP_JSON_LD } from '../constants';\r\nimport { Packet } from './packet';\r\n\r\nconst NAME = KHR_XMP_JSON_LD;\r\n\r\ntype XMPPacketDef = Record<string, unknown>;\r\n\r\ntype XMPParentDef =\r\n\t| GLTF.IAsset\r\n\t| GLTF.IScene\r\n\t| GLTF.INode\r\n\t| GLTF.IMesh\r\n\t| GLTF.IMaterial\r\n\t| GLTF.ITexture\r\n\t| GLTF.IAnimation;\r\n\r\ninterface XMPPropertyDef {\r\n\tpacket: number;\r\n}\r\n\r\ninterface XMPRootDef {\r\n\tpackets?: XMPPacketDef[];\r\n}\r\n\r\n/**\r\n * # XMP\r\n *\r\n * [KHR_xmp_json_ld](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_xmp_json_ld/)\r\n * defines XMP metadata associated with a glTF asset.\r\n *\r\n * XMP metadata provides standardized fields describing the content, provenance, usage\r\n * restrictions, or other attributes of a 3D model. XMP metadata does not generally affect the\r\n * parsing or runtime behavior of the content  for that, use custom extensions, custom vertex\r\n * attributes, or extras. Similarly, storage mechanisms other than XMP should be preferred\r\n * for binary content like mesh data, animations, or textures.\r\n *\r\n * Generally XMP metadata is associated with the entire glTF asset by attaching an XMP {@link Packet}\r\n * to the document {@link Root}. In less common cases where metadata must be associated with\r\n * specific subsets of a document, XMP Packets may be attached to {@link Scene}, {@link Node},\r\n * {@link Mesh}, {@link Material}, {@link Texture}, or {@link Animation} properties.\r\n *\r\n * Within each packet, XMP properties become available when an\r\n * [XMP namespace](https://www.adobe.io/xmp/docs/XMPNamespaces/) is registered\r\n * with {@link Packet.setContext}. Packets cannot use properties whose namespaces are not\r\n * registered as context. While not all XMP namespaces are relevant to 3D assets, some common\r\n * namespaces provide useful metadata about authorship and provenance. Additionally, the `model3d`\r\n * namespace provides certain properties specific to 3D content, such as Augmented Reality (AR)\r\n * orientation data.\r\n *\r\n * Common XMP contexts for 3D models include:\r\n *\r\n * | Prefix      | URI                                         | Name                           |\r\n * |:------------|:--------------------------------------------|:-------------------------------|\r\n * | `dc`        | http://purl.org/dc/elements/1.1/            | Dublin Core                    |\r\n * | `model3d`   | https://schema.khronos.org/model3d/xsd/1.0/ | Model 3D                       |\r\n * | `rdf`       | http://www.w3.org/1999/02/22-rdf-syntax-ns# | Resource Description Framework |\r\n * | `xmp`       | http://ns.adobe.com/xap/1.0/                | XMP                            |\r\n * | `xmpRights` | http://ns.adobe.com/xap/1.0/rights/         | XMP Rights Management          |\r\n *\r\n * Only the XMP contexts required for a packet should be assigned, and different packets\r\n * in the same asset may use different contexts.\r\n *\r\n * Properties:\r\n * - {@link Packet}\r\n *\r\n * ### Example\r\n *\r\n * ```typescript\r\n * import { XMP, Packet } from '@gltf-transform/extensions';\r\n *\r\n * // Create an Extension attached to the Document.\r\n * const xmpExtension = document.createExtension(XMP);\r\n *\r\n * // Create Packet property.\r\n * const packet = xmpExtension.createPacket()\r\n * \t.setContext({\r\n * \t\tdc: 'http://purl.org/dc/elements/1.1/',\r\n * \t})\r\n *\t.setProperty('dc:Creator', {\"@list\": [\"Acme, Inc.\"]});\r\n *\r\n * // Option 1: Assign to Document Root.\r\n * document.getRoot().setExtension('KHR_xmp_json_ld', packet);\r\n *\r\n * // Option 2: Assign to a specific Property.\r\n * texture.setExtension('KHR_xmp_json_ld', packet);\r\n * ```\r\n */\r\nexport class XMP extends Extension {\r\n\tpublic readonly extensionName = NAME;\r\n\tpublic static readonly EXTENSION_NAME = NAME;\r\n\r\n\t/** Creates a new XMP packet, to be linked with a {@link Document} or {@link Property Properties}. */\r\n\tpublic createPacket(): Packet {\r\n\t\treturn new Packet(this.document.getGraph());\r\n\t}\r\n\r\n\t/** Lists XMP packets currently defined in a {@link Document}. */\r\n\tpublic listPackets(): Packet[] {\r\n\t\treturn Array.from(this.properties) as Packet[];\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic read(context: ReaderContext): this {\r\n\t\tconst extensionDef = context.jsonDoc.json.extensions?.[NAME] as XMPRootDef | undefined;\r\n\t\tif (!extensionDef || !extensionDef.packets) return this;\r\n\r\n\t\t// Deserialize packets.\r\n\t\tconst json = context.jsonDoc.json;\r\n\t\tconst root = this.document.getRoot();\r\n\t\tconst packets = extensionDef.packets.map((packetDef) => this.createPacket().fromJSONLD(packetDef));\r\n\r\n\t\tconst defLists = [\r\n\t\t\t[json.asset],\r\n\t\t\tjson.scenes,\r\n\t\t\tjson.nodes,\r\n\t\t\tjson.meshes,\r\n\t\t\tjson.materials,\r\n\t\t\tjson.images,\r\n\t\t\tjson.animations,\r\n\t\t];\r\n\r\n\t\tconst propertyLists = [\r\n\t\t\t[root],\r\n\t\t\troot.listScenes(),\r\n\t\t\troot.listNodes(),\r\n\t\t\troot.listMeshes(),\r\n\t\t\troot.listMaterials(),\r\n\t\t\troot.listTextures(),\r\n\t\t\troot.listAnimations(),\r\n\t\t];\r\n\r\n\t\t// Assign packets.\r\n\t\tfor (let i = 0; i < defLists.length; i++) {\r\n\t\t\tconst defs = defLists[i] || [];\r\n\t\t\tfor (let j = 0; j < defs.length; j++) {\r\n\t\t\t\tconst def = defs[j];\r\n\t\t\t\tif (def.extensions && def.extensions[NAME]) {\r\n\t\t\t\t\tconst xmpDef = def.extensions[NAME] as XMPPropertyDef;\r\n\t\t\t\t\tpropertyLists[i][j].setExtension(NAME, packets[xmpDef.packet]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/** @hidden */\r\n\tpublic write(context: WriterContext): this {\r\n\t\tconst { json } = context.jsonDoc;\r\n\r\n\t\tconst packetDefs = [];\r\n\r\n\t\tfor (const packet of this.properties as Set<Packet>) {\r\n\t\t\t// Serialize packets.\r\n\t\t\tpacketDefs.push(packet.toJSONLD());\r\n\r\n\t\t\t// Assign packets.\r\n\r\n\t\t\tfor (const parent of packet.listParents()) {\r\n\t\t\t\tlet parentDef: XMPParentDef | null;\r\n\r\n\t\t\t\tswitch (parent.propertyType) {\r\n\t\t\t\t\tcase PropertyType.ROOT:\r\n\t\t\t\t\t\tparentDef = json.asset;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.SCENE:\r\n\t\t\t\t\t\tparentDef = json.scenes![context.sceneIndexMap.get(parent as Scene)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.NODE:\r\n\t\t\t\t\t\tparentDef = json.nodes![context.nodeIndexMap.get(parent as Node)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.MESH:\r\n\t\t\t\t\t\tparentDef = json.meshes![context.meshIndexMap.get(parent as Mesh)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.MATERIAL:\r\n\t\t\t\t\t\tparentDef = json.materials![context.materialIndexMap.get(parent as Material)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.TEXTURE:\r\n\t\t\t\t\t\tparentDef = json.images![context.imageIndexMap.get(parent as Texture)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase PropertyType.ANIMATION:\r\n\t\t\t\t\t\tparentDef = json.animations![context.animationIndexMap.get(parent as Animation)!];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tparentDef = null;\r\n\t\t\t\t\t\tthis.document\r\n\t\t\t\t\t\t\t.getLogger()\r\n\t\t\t\t\t\t\t.warn(`[${NAME}]: Unsupported parent property, \"${parent.propertyType}\"`);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!parentDef) continue;\r\n\r\n\t\t\t\tparentDef.extensions = parentDef.extensions || {};\r\n\t\t\t\tparentDef.extensions[NAME] = { packet: packetDefs.length - 1 };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (packetDefs.length > 0) {\r\n\t\t\tjson.extensions = json.extensions || {};\r\n\t\t\tjson.extensions[NAME] = { packets: packetDefs };\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/** @module extensions */\r\n\r\nimport { MeshGPUInstancing } from './ext-mesh-gpu-instancing';\r\nimport { MeshoptCompression } from './ext-meshopt-compression';\r\nimport { TextureWebP } from './ext-texture-webp';\r\nimport { DracoMeshCompression } from './khr-draco-mesh-compression';\r\nimport { LightsPunctual } from './khr-lights-punctual';\r\nimport { MaterialsAnisotropy } from './khr-materials-anisotropy';\r\nimport { MaterialsClearcoat } from './khr-materials-clearcoat';\r\nimport { MaterialsEmissiveStrength } from './khr-materials-emissive-strength';\r\nimport { MaterialsIOR } from './khr-materials-ior';\r\nimport { MaterialsIridescence } from './khr-materials-iridescence';\r\nimport { MaterialsPBRSpecularGlossiness } from './khr-materials-pbr-specular-glossiness';\r\nimport { MaterialsSheen } from './khr-materials-sheen';\r\nimport { MaterialsSpecular } from './khr-materials-specular';\r\nimport { MaterialsTranslucency } from './khr-materials-translucency';\r\nimport { MaterialsTransmission } from './khr-materials-transmission';\r\nimport { MaterialsUnlit } from './khr-materials-unlit';\r\nimport { MaterialsVariants } from './khr-materials-variants';\r\nimport { MaterialsVolume } from './khr-materials-volume';\r\nimport { MeshQuantization } from './khr-mesh-quantization';\r\nimport { TextureBasisu } from './khr-texture-basisu';\r\nimport { TextureTransform } from './khr-texture-transform';\r\nimport { XMP } from './khr-xmp-json-ld';\r\n\r\nexport const KHRONOS_EXTENSIONS = [\r\n\tDracoMeshCompression,\r\n\tLightsPunctual,\r\n  MaterialsAnisotropy,\r\n\tMaterialsClearcoat,\r\n\tMaterialsEmissiveStrength,\r\n\tMaterialsIOR,\r\n\tMaterialsIridescence,\r\n\tMaterialsPBRSpecularGlossiness,\r\n\tMaterialsSpecular,\r\n\tMaterialsSheen,\r\n  MaterialsTranslucency,\r\n\tMaterialsTransmission,\r\n\tMaterialsUnlit,\r\n\tMaterialsVariants,\r\n\tMaterialsVolume,\r\n\tMeshQuantization,\r\n\tTextureBasisu,\r\n\tTextureTransform,\r\n\tXMP,\r\n];\r\n\r\nexport const ALL_EXTENSIONS = [MeshGPUInstancing, MeshoptCompression, TextureWebP, ...KHRONOS_EXTENSIONS];\r\n\r\nexport * from './ext-mesh-gpu-instancing';\r\nexport * from './ext-meshopt-compression';\r\nexport * from './ext-texture-webp';\r\nexport * from './khr-draco-mesh-compression';\r\nexport * from './khr-lights-punctual';\r\nexport * from './khr-materials-anisotropy';\r\nexport * from './khr-materials-clearcoat';\r\nexport * from './khr-materials-emissive-strength';\r\nexport * from './khr-materials-ior';\r\nexport * from './khr-materials-iridescence';\r\nexport * from './khr-materials-sheen';\r\nexport * from './khr-materials-specular';\r\nexport * from './khr-materials-pbr-specular-glossiness';\r\nexport * from './khr-materials-translucency';\r\nexport * from './khr-materials-transmission';\r\nexport * from './khr-materials-unlit';\r\nexport * from './khr-materials-variants';\r\nexport * from './khr-materials-volume';\r\nexport * from './khr-mesh-quantization';\r\nexport * from './khr-texture-basisu';\r\nexport * from './khr-texture-transform';\r\nexport * from './khr-xmp-json-ld';\r\n","\"use strict\"\n\nfunction iota(n) {\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[i] = i\n  }\n  return result\n}\n\nmodule.exports = iota","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\n// The _isBuffer check is for Safari 5-7 support, because it's missing\n// Object.prototype.constructor. Remove this eventually\nmodule.exports = function (obj) {\n  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)\n}\n\nfunction isBuffer (obj) {\n  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n\n// For Node v0.10 support. Remove this eventually.\nfunction isSlowBuffer (obj) {\n  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))\n}\n","var iota = require(\"iota-array\")\nvar isBuffer = require(\"is-buffer\")\n\nvar hasTypedArrays  = ((typeof Float64Array) !== \"undefined\")\n\nfunction compare1st(a, b) {\n  return a[0] - b[0]\n}\n\nfunction order() {\n  var stride = this.stride\n  var terms = new Array(stride.length)\n  var i\n  for(i=0; i<terms.length; ++i) {\n    terms[i] = [Math.abs(stride[i]), i]\n  }\n  terms.sort(compare1st)\n  var result = new Array(terms.length)\n  for(i=0; i<result.length; ++i) {\n    result[i] = terms[i][1]\n  }\n  return result\n}\n\nfunction compileConstructor(dtype, dimension) {\n  var className = [\"View\", dimension, \"d\", dtype].join(\"\")\n  if(dimension < 0) {\n    className = \"View_Nil\" + dtype\n  }\n  var useGetters = (dtype === \"generic\")\n\n  if(dimension === -1) {\n    //Special case for trivial arrays\n    var code =\n      \"function \"+className+\"(a){this.data=a;};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return -1};\\\nproto.size=0;\\\nproto.dimension=-1;\\\nproto.shape=proto.stride=proto.order=[];\\\nproto.lo=proto.hi=proto.transpose=proto.step=\\\nfunction(){return new \"+className+\"(this.data);};\\\nproto.get=proto.set=function(){};\\\nproto.pick=function(){return null};\\\nreturn function construct_\"+className+\"(a){return new \"+className+\"(a);}\"\n    var procedure = new Function(code)\n    return procedure()\n  } else if(dimension === 0) {\n    //Special case for 0d arrays\n    var code =\n      \"function \"+className+\"(a,d) {\\\nthis.data = a;\\\nthis.offset = d\\\n};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return this.offset};\\\nproto.dimension=0;\\\nproto.size=1;\\\nproto.shape=\\\nproto.stride=\\\nproto.order=[];\\\nproto.lo=\\\nproto.hi=\\\nproto.transpose=\\\nproto.step=function \"+className+\"_copy() {\\\nreturn new \"+className+\"(this.data,this.offset)\\\n};\\\nproto.pick=function \"+className+\"_pick(){\\\nreturn TrivialArray(this.data);\\\n};\\\nproto.valueOf=proto.get=function \"+className+\"_get(){\\\nreturn \"+(useGetters ? \"this.data.get(this.offset)\" : \"this.data[this.offset]\")+\n\"};\\\nproto.set=function \"+className+\"_set(v){\\\nreturn \"+(useGetters ? \"this.data.set(this.offset,v)\" : \"this.data[this.offset]=v\")+\"\\\n};\\\nreturn function construct_\"+className+\"(a,b,c,d){return new \"+className+\"(a,d)}\"\n    var procedure = new Function(\"TrivialArray\", code)\n    return procedure(CACHED_CONSTRUCTORS[dtype][0])\n  }\n\n  var code = [\"'use strict'\"]\n\n  //Create constructor for view\n  var indices = iota(dimension)\n  var args = indices.map(function(i) { return \"i\"+i })\n  var index_str = \"this.offset+\" + indices.map(function(i) {\n        return \"this.stride[\" + i + \"]*i\" + i\n      }).join(\"+\")\n  var shapeArg = indices.map(function(i) {\n      return \"b\"+i\n    }).join(\",\")\n  var strideArg = indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")\n  code.push(\n    \"function \"+className+\"(a,\" + shapeArg + \",\" + strideArg + \",d){this.data=a\",\n      \"this.shape=[\" + shapeArg + \"]\",\n      \"this.stride=[\" + strideArg + \"]\",\n      \"this.offset=d|0}\",\n    \"var proto=\"+className+\".prototype\",\n    \"proto.dtype='\"+dtype+\"'\",\n    \"proto.dimension=\"+dimension)\n\n  //view.size:\n  code.push(\"Object.defineProperty(proto,'size',{get:function \"+className+\"_size(){\\\nreturn \"+indices.map(function(i) { return \"this.shape[\"+i+\"]\" }).join(\"*\"),\n\"}})\")\n\n  //view.order:\n  if(dimension === 1) {\n    code.push(\"proto.order=[0]\")\n  } else {\n    code.push(\"Object.defineProperty(proto,'order',{get:\")\n    if(dimension < 4) {\n      code.push(\"function \"+className+\"_order(){\")\n      if(dimension === 2) {\n        code.push(\"return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})\")\n      } else if(dimension === 3) {\n        code.push(\n\"var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\\\nif(s0>s1){\\\nif(s1>s2){\\\nreturn [2,1,0];\\\n}else if(s0>s2){\\\nreturn [1,2,0];\\\n}else{\\\nreturn [1,0,2];\\\n}\\\n}else if(s0>s2){\\\nreturn [2,0,1];\\\n}else if(s2>s1){\\\nreturn [0,1,2];\\\n}else{\\\nreturn [0,2,1];\\\n}}})\")\n      }\n    } else {\n      code.push(\"ORDER})\")\n    }\n  }\n\n  //view.set(i0, ..., v):\n  code.push(\n\"proto.set=function \"+className+\"_set(\"+args.join(\",\")+\",v){\")\n  if(useGetters) {\n    code.push(\"return this.data.set(\"+index_str+\",v)}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]=v}\")\n  }\n\n  //view.get(i0, ...):\n  code.push(\"proto.get=function \"+className+\"_get(\"+args.join(\",\")+\"){\")\n  if(useGetters) {\n    code.push(\"return this.data.get(\"+index_str+\")}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]}\")\n  }\n\n  //view.index:\n  code.push(\n    \"proto.index=function \"+className+\"_index(\", args.join(), \"){return \"+index_str+\"}\")\n\n  //view.hi():\n  code.push(\"proto.hi=function \"+className+\"_hi(\"+args.join(\",\")+\"){return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return [\"(typeof i\",i,\"!=='number'||i\",i,\"<0)?this.shape[\", i, \"]:i\", i,\"|0\"].join(\"\")\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"this.stride[\"+i + \"]\"\n    }).join(\",\")+\",this.offset)}\")\n\n  //view.lo():\n  var a_vars = indices.map(function(i) { return \"a\"+i+\"=this.shape[\"+i+\"]\" })\n  var c_vars = indices.map(function(i) { return \"c\"+i+\"=this.stride[\"+i+\"]\" })\n  code.push(\"proto.lo=function \"+className+\"_lo(\"+args.join(\",\")+\"){var b=this.offset,d=0,\"+a_vars.join(\",\")+\",\"+c_vars.join(\",\"))\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){\\\nd=i\"+i+\"|0;\\\nb+=c\"+i+\"*d;\\\na\"+i+\"-=d}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\"+i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")+\",b)}\")\n\n  //view.step():\n  code.push(\"proto.step=function \"+className+\"_step(\"+args.join(\",\")+\"){var \"+\n    indices.map(function(i) {\n      return \"a\"+i+\"=this.shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\"+i+\"=this.stride[\"+i+\"]\"\n    }).join(\",\")+\",c=this.offset,d=0,ceil=Math.ceil\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'){\\\nd=i\"+i+\"|0;\\\nif(d<0){\\\nc+=b\"+i+\"*(a\"+i+\"-1);\\\na\"+i+\"=ceil(-a\"+i+\"/d)\\\n}else{\\\na\"+i+\"=ceil(a\"+i+\"/d)\\\n}\\\nb\"+i+\"*=d\\\n}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\" + i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\" + i\n    }).join(\",\")+\",c)}\")\n\n  //view.transpose():\n  var tShape = new Array(dimension)\n  var tStride = new Array(dimension)\n  for(var i=0; i<dimension; ++i) {\n    tShape[i] = \"a[i\"+i+\"]\"\n    tStride[i] = \"b[i\"+i+\"]\"\n  }\n  code.push(\"proto.transpose=function \"+className+\"_transpose(\"+args+\"){\"+\n    args.map(function(n,idx) { return n + \"=(\" + n + \"===undefined?\" + idx + \":\" + n + \"|0)\"}).join(\";\"),\n    \"var a=this.shape,b=this.stride;return new \"+className+\"(this.data,\"+tShape.join(\",\")+\",\"+tStride.join(\",\")+\",this.offset)}\")\n\n  //view.pick():\n  code.push(\"proto.pick=function \"+className+\"_pick(\"+args+\"){var a=[],b=[],c=this.offset\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){c=(c+this.stride[\"+i+\"]*i\"+i+\")|0}else{a.push(this.shape[\"+i+\"]);b.push(this.stride[\"+i+\"])}\")\n  }\n  code.push(\"var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}\")\n\n  //Add return statement\n  code.push(\"return function construct_\"+className+\"(data,shape,stride,offset){return new \"+className+\"(data,\"+\n    indices.map(function(i) {\n      return \"shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"stride[\"+i+\"]\"\n    }).join(\",\")+\",offset)}\")\n\n  //Compile procedure\n  var procedure = new Function(\"CTOR_LIST\", \"ORDER\", code.join(\"\\n\"))\n  return procedure(CACHED_CONSTRUCTORS[dtype], order)\n}\n\nfunction arrayDType(data) {\n  if(isBuffer(data)) {\n    return \"buffer\"\n  }\n  if(hasTypedArrays) {\n    switch(Object.prototype.toString.call(data)) {\n      case \"[object Float64Array]\":\n        return \"float64\"\n      case \"[object Float32Array]\":\n        return \"float32\"\n      case \"[object Int8Array]\":\n        return \"int8\"\n      case \"[object Int16Array]\":\n        return \"int16\"\n      case \"[object Int32Array]\":\n        return \"int32\"\n      case \"[object Uint8Array]\":\n        return \"uint8\"\n      case \"[object Uint16Array]\":\n        return \"uint16\"\n      case \"[object Uint32Array]\":\n        return \"uint32\"\n      case \"[object Uint8ClampedArray]\":\n        return \"uint8_clamped\"\n      case \"[object BigInt64Array]\":\n        return \"bigint64\"\n      case \"[object BigUint64Array]\":\n        return \"biguint64\"\n    }\n  }\n  if(Array.isArray(data)) {\n    return \"array\"\n  }\n  return \"generic\"\n}\n\nvar CACHED_CONSTRUCTORS = {\n  \"float32\":[],\n  \"float64\":[],\n  \"int8\":[],\n  \"int16\":[],\n  \"int32\":[],\n  \"uint8\":[],\n  \"uint16\":[],\n  \"uint32\":[],\n  \"array\":[],\n  \"uint8_clamped\":[],\n  \"bigint64\": [],\n  \"biguint64\": [],\n  \"buffer\":[],\n  \"generic\":[]\n}\n\n;(function() {\n  for(var id in CACHED_CONSTRUCTORS) {\n    CACHED_CONSTRUCTORS[id].push(compileConstructor(id, -1))\n  }\n});\n\nfunction wrappedNDArrayCtor(data, shape, stride, offset) {\n  if(data === undefined) {\n    var ctor = CACHED_CONSTRUCTORS.array[0]\n    return ctor([])\n  } else if(typeof data === \"number\") {\n    data = [data]\n  }\n  if(shape === undefined) {\n    shape = [ data.length ]\n  }\n  var d = shape.length\n  if(stride === undefined) {\n    stride = new Array(d)\n    for(var i=d-1, sz=1; i>=0; --i) {\n      stride[i] = sz\n      sz *= shape[i]\n    }\n  }\n  if(offset === undefined) {\n    offset = 0\n    for(var i=0; i<d; ++i) {\n      if(stride[i] < 0) {\n        offset -= (shape[i]-1)*stride[i]\n      }\n    }\n  }\n  var dtype = arrayDType(data)\n  var ctor_list = CACHED_CONSTRUCTORS[dtype]\n  while(ctor_list.length <= d+1) {\n    ctor_list.push(compileConstructor(dtype, ctor_list.length-1))\n  }\n  var ctor = ctor_list[d+1]\n  return ctor(data, shape, stride, offset)\n}\n\nmodule.exports = wrappedNDArrayCtor\n","\"use strict\"\n\nvar uniq = require(\"uniq\")\n\n// This function generates very simple loops analogous to how you typically traverse arrays (the outermost loop corresponds to the slowest changing index, the innermost loop to the fastest changing index)\n// TODO: If two arrays have the same strides (and offsets) there is potential for decreasing the number of \"pointers\" and related variables. The drawback is that the type signature would become more specific and that there would thus be less potential for caching, but it might still be worth it, especially when dealing with large numbers of arguments.\nfunction innerFill(order, proc, body) {\n  var dimension = order.length\n    , nargs = proc.arrayArgs.length\n    , has_index = proc.indexArgs.length>0\n    , code = []\n    , vars = []\n    , idx=0, pidx=0, i, j\n  for(i=0; i<dimension; ++i) { // Iteration variables\n    vars.push([\"i\",i,\"=0\"].join(\"\"))\n  }\n  //Compute scan deltas\n  for(j=0; j<nargs; ++j) {\n    for(i=0; i<dimension; ++i) {\n      pidx = idx\n      idx = order[i]\n      if(i === 0) { // The innermost/fastest dimension's delta is simply its stride\n        vars.push([\"d\",j,\"s\",i,\"=t\",j,\"p\",idx].join(\"\"))\n      } else { // For other dimensions the delta is basically the stride minus something which essentially \"rewinds\" the previous (more inner) dimension\n        vars.push([\"d\",j,\"s\",i,\"=(t\",j,\"p\",idx,\"-s\",pidx,\"*t\",j,\"p\",pidx,\")\"].join(\"\"))\n      }\n    }\n  }\n  if (vars.length > 0) {\n    code.push(\"var \" + vars.join(\",\"))\n  }  \n  //Scan loop\n  for(i=dimension-1; i>=0; --i) { // Start at largest stride and work your way inwards\n    idx = order[i]\n    code.push([\"for(i\",i,\"=0;i\",i,\"<s\",idx,\";++i\",i,\"){\"].join(\"\"))\n  }\n  //Push body of inner loop\n  code.push(body)\n  //Advance scan pointers\n  for(i=0; i<dimension; ++i) {\n    pidx = idx\n    idx = order[i]\n    for(j=0; j<nargs; ++j) {\n      code.push([\"p\",j,\"+=d\",j,\"s\",i].join(\"\"))\n    }\n    if(has_index) {\n      if(i > 0) {\n        code.push([\"index[\",pidx,\"]-=s\",pidx].join(\"\"))\n      }\n      code.push([\"++index[\",idx,\"]\"].join(\"\"))\n    }\n    code.push(\"}\")\n  }\n  return code.join(\"\\n\")\n}\n\n// Generate \"outer\" loops that loop over blocks of data, applying \"inner\" loops to the blocks by manipulating the local variables in such a way that the inner loop only \"sees\" the current block.\n// TODO: If this is used, then the previous declaration (done by generateCwiseOp) of s* is essentially unnecessary.\n//       I believe the s* are not used elsewhere (in particular, I don't think they're used in the pre/post parts and \"shape\" is defined independently), so it would be possible to make defining the s* dependent on what loop method is being used.\nfunction outerFill(matched, order, proc, body) {\n  var dimension = order.length\n    , nargs = proc.arrayArgs.length\n    , blockSize = proc.blockSize\n    , has_index = proc.indexArgs.length > 0\n    , code = []\n  for(var i=0; i<nargs; ++i) {\n    code.push([\"var offset\",i,\"=p\",i].join(\"\"))\n  }\n  //Generate loops for unmatched dimensions\n  // The order in which these dimensions are traversed is fairly arbitrary (from small stride to large stride, for the first argument)\n  // TODO: It would be nice if the order in which these loops are placed would also be somehow \"optimal\" (at the very least we should check that it really doesn't hurt us if they're not).\n  for(var i=matched; i<dimension; ++i) {\n    code.push([\"for(var j\"+i+\"=SS[\", order[i], \"]|0;j\", i, \">0;){\"].join(\"\")) // Iterate back to front\n    code.push([\"if(j\",i,\"<\",blockSize,\"){\"].join(\"\")) // Either decrease j by blockSize (s = blockSize), or set it to zero (after setting s = j).\n    code.push([\"s\",order[i],\"=j\",i].join(\"\"))\n    code.push([\"j\",i,\"=0\"].join(\"\"))\n    code.push([\"}else{s\",order[i],\"=\",blockSize].join(\"\"))\n    code.push([\"j\",i,\"-=\",blockSize,\"}\"].join(\"\"))\n    if(has_index) {\n      code.push([\"index[\",order[i],\"]=j\",i].join(\"\"))\n    }\n  }\n  for(var i=0; i<nargs; ++i) {\n    var indexStr = [\"offset\"+i]\n    for(var j=matched; j<dimension; ++j) {\n      indexStr.push([\"j\",j,\"*t\",i,\"p\",order[j]].join(\"\"))\n    }\n    code.push([\"p\",i,\"=(\",indexStr.join(\"+\"),\")\"].join(\"\"))\n  }\n  code.push(innerFill(order, proc, body))\n  for(var i=matched; i<dimension; ++i) {\n    code.push(\"}\")\n  }\n  return code.join(\"\\n\")\n}\n\n//Count the number of compatible inner orders\n// This is the length of the longest common prefix of the arrays in orders.\n// Each array in orders lists the dimensions of the correspond ndarray in order of increasing stride.\n// This is thus the maximum number of dimensions that can be efficiently traversed by simple nested loops for all arrays.\nfunction countMatches(orders) {\n  var matched = 0, dimension = orders[0].length\n  while(matched < dimension) {\n    for(var j=1; j<orders.length; ++j) {\n      if(orders[j][matched] !== orders[0][matched]) {\n        return matched\n      }\n    }\n    ++matched\n  }\n  return matched\n}\n\n//Processes a block according to the given data types\n// Replaces variable names by different ones, either \"local\" ones (that are then ferried in and out of the given array) or ones matching the arguments that the function performing the ultimate loop will accept.\nfunction processBlock(block, proc, dtypes) {\n  var code = block.body\n  var pre = []\n  var post = []\n  for(var i=0; i<block.args.length; ++i) {\n    var carg = block.args[i]\n    if(carg.count <= 0) {\n      continue\n    }\n    var re = new RegExp(carg.name, \"g\")\n    var ptrStr = \"\"\n    var arrNum = proc.arrayArgs.indexOf(i)\n    switch(proc.argTypes[i]) {\n      case \"offset\":\n        var offArgIndex = proc.offsetArgIndex.indexOf(i)\n        var offArg = proc.offsetArgs[offArgIndex]\n        arrNum = offArg.array\n        ptrStr = \"+q\" + offArgIndex // Adds offset to the \"pointer\" in the array\n      case \"array\":\n        ptrStr = \"p\" + arrNum + ptrStr\n        var localStr = \"l\" + i\n        var arrStr = \"a\" + arrNum\n        if (proc.arrayBlockIndices[arrNum] === 0) { // Argument to body is just a single value from this array\n          if(carg.count === 1) { // Argument/array used only once(?)\n            if(dtypes[arrNum] === \"generic\") {\n              if(carg.lvalue) {\n                pre.push([\"var \", localStr, \"=\", arrStr, \".get(\", ptrStr, \")\"].join(\"\")) // Is this necessary if the argument is ONLY used as an lvalue? (keep in mind that we can have a += something, so we would actually need to check carg.rvalue)\n                code = code.replace(re, localStr)\n                post.push([arrStr, \".set(\", ptrStr, \",\", localStr,\")\"].join(\"\"))\n              } else {\n                code = code.replace(re, [arrStr, \".get(\", ptrStr, \")\"].join(\"\"))\n              }\n            } else {\n              code = code.replace(re, [arrStr, \"[\", ptrStr, \"]\"].join(\"\"))\n            }\n          } else if(dtypes[arrNum] === \"generic\") {\n            pre.push([\"var \", localStr, \"=\", arrStr, \".get(\", ptrStr, \")\"].join(\"\")) // TODO: Could we optimize by checking for carg.rvalue?\n            code = code.replace(re, localStr)\n            if(carg.lvalue) {\n              post.push([arrStr, \".set(\", ptrStr, \",\", localStr,\")\"].join(\"\"))\n            }\n          } else {\n            pre.push([\"var \", localStr, \"=\", arrStr, \"[\", ptrStr, \"]\"].join(\"\")) // TODO: Could we optimize by checking for carg.rvalue?\n            code = code.replace(re, localStr)\n            if(carg.lvalue) {\n              post.push([arrStr, \"[\", ptrStr, \"]=\", localStr].join(\"\"))\n            }\n          }\n        } else { // Argument to body is a \"block\"\n          var reStrArr = [carg.name], ptrStrArr = [ptrStr]\n          for(var j=0; j<Math.abs(proc.arrayBlockIndices[arrNum]); j++) {\n            reStrArr.push(\"\\\\s*\\\\[([^\\\\]]+)\\\\]\")\n            ptrStrArr.push(\"$\" + (j+1) + \"*t\" + arrNum + \"b\" + j) // Matched index times stride\n          }\n          re = new RegExp(reStrArr.join(\"\"), \"g\")\n          ptrStr = ptrStrArr.join(\"+\")\n          if(dtypes[arrNum] === \"generic\") {\n            /*if(carg.lvalue) {\n              pre.push([\"var \", localStr, \"=\", arrStr, \".get(\", ptrStr, \")\"].join(\"\")) // Is this necessary if the argument is ONLY used as an lvalue? (keep in mind that we can have a += something, so we would actually need to check carg.rvalue)\n              code = code.replace(re, localStr)\n              post.push([arrStr, \".set(\", ptrStr, \",\", localStr,\")\"].join(\"\"))\n            } else {\n              code = code.replace(re, [arrStr, \".get(\", ptrStr, \")\"].join(\"\"))\n            }*/\n            throw new Error(\"cwise: Generic arrays not supported in combination with blocks!\")\n          } else {\n            // This does not produce any local variables, even if variables are used multiple times. It would be possible to do so, but it would complicate things quite a bit.\n            code = code.replace(re, [arrStr, \"[\", ptrStr, \"]\"].join(\"\"))\n          }\n        }\n      break\n      case \"scalar\":\n        code = code.replace(re, \"Y\" + proc.scalarArgs.indexOf(i))\n      break\n      case \"index\":\n        code = code.replace(re, \"index\")\n      break\n      case \"shape\":\n        code = code.replace(re, \"shape\")\n      break\n    }\n  }\n  return [pre.join(\"\\n\"), code, post.join(\"\\n\")].join(\"\\n\").trim()\n}\n\nfunction typeSummary(dtypes) {\n  var summary = new Array(dtypes.length)\n  var allEqual = true\n  for(var i=0; i<dtypes.length; ++i) {\n    var t = dtypes[i]\n    var digits = t.match(/\\d+/)\n    if(!digits) {\n      digits = \"\"\n    } else {\n      digits = digits[0]\n    }\n    if(t.charAt(0) === 0) {\n      summary[i] = \"u\" + t.charAt(1) + digits\n    } else {\n      summary[i] = t.charAt(0) + digits\n    }\n    if(i > 0) {\n      allEqual = allEqual && summary[i] === summary[i-1]\n    }\n  }\n  if(allEqual) {\n    return summary[0]\n  }\n  return summary.join(\"\")\n}\n\n//Generates a cwise operator\nfunction generateCWiseOp(proc, typesig) {\n\n  //Compute dimension\n  // Arrays get put first in typesig, and there are two entries per array (dtype and order), so this gets the number of dimensions in the first array arg.\n  var dimension = (typesig[1].length - Math.abs(proc.arrayBlockIndices[0]))|0\n  var orders = new Array(proc.arrayArgs.length)\n  var dtypes = new Array(proc.arrayArgs.length)\n  for(var i=0; i<proc.arrayArgs.length; ++i) {\n    dtypes[i] = typesig[2*i]\n    orders[i] = typesig[2*i+1]\n  }\n  \n  //Determine where block and loop indices start and end\n  var blockBegin = [], blockEnd = [] // These indices are exposed as blocks\n  var loopBegin = [], loopEnd = [] // These indices are iterated over\n  var loopOrders = [] // orders restricted to the loop indices\n  for(var i=0; i<proc.arrayArgs.length; ++i) {\n    if (proc.arrayBlockIndices[i]<0) {\n      loopBegin.push(0)\n      loopEnd.push(dimension)\n      blockBegin.push(dimension)\n      blockEnd.push(dimension+proc.arrayBlockIndices[i])\n    } else {\n      loopBegin.push(proc.arrayBlockIndices[i]) // Non-negative\n      loopEnd.push(proc.arrayBlockIndices[i]+dimension)\n      blockBegin.push(0)\n      blockEnd.push(proc.arrayBlockIndices[i])\n    }\n    var newOrder = []\n    for(var j=0; j<orders[i].length; j++) {\n      if (loopBegin[i]<=orders[i][j] && orders[i][j]<loopEnd[i]) {\n        newOrder.push(orders[i][j]-loopBegin[i]) // If this is a loop index, put it in newOrder, subtracting loopBegin, to make sure that all loopOrders are using a common set of indices.\n      }\n    }\n    loopOrders.push(newOrder)\n  }\n\n  //First create arguments for procedure\n  var arglist = [\"SS\"] // SS is the overall shape over which we iterate\n  var code = [\"'use strict'\"]\n  var vars = []\n  \n  for(var j=0; j<dimension; ++j) {\n    vars.push([\"s\", j, \"=SS[\", j, \"]\"].join(\"\")) // The limits for each dimension.\n  }\n  for(var i=0; i<proc.arrayArgs.length; ++i) {\n    arglist.push(\"a\"+i) // Actual data array\n    arglist.push(\"t\"+i) // Strides\n    arglist.push(\"p\"+i) // Offset in the array at which the data starts (also used for iterating over the data)\n    \n    for(var j=0; j<dimension; ++j) { // Unpack the strides into vars for looping\n      vars.push([\"t\",i,\"p\",j,\"=t\",i,\"[\",loopBegin[i]+j,\"]\"].join(\"\"))\n    }\n    \n    for(var j=0; j<Math.abs(proc.arrayBlockIndices[i]); ++j) { // Unpack the strides into vars for block iteration\n      vars.push([\"t\",i,\"b\",j,\"=t\",i,\"[\",blockBegin[i]+j,\"]\"].join(\"\"))\n    }\n  }\n  for(var i=0; i<proc.scalarArgs.length; ++i) {\n    arglist.push(\"Y\" + i)\n  }\n  if(proc.shapeArgs.length > 0) {\n    vars.push(\"shape=SS.slice(0)\") // Makes the shape over which we iterate available to the user defined functions (so you can use width/height for example)\n  }\n  if(proc.indexArgs.length > 0) {\n    // Prepare an array to keep track of the (logical) indices, initialized to dimension zeroes.\n    var zeros = new Array(dimension)\n    for(var i=0; i<dimension; ++i) {\n      zeros[i] = \"0\"\n    }\n    vars.push([\"index=[\", zeros.join(\",\"), \"]\"].join(\"\"))\n  }\n  for(var i=0; i<proc.offsetArgs.length; ++i) { // Offset arguments used for stencil operations\n    var off_arg = proc.offsetArgs[i]\n    var init_string = []\n    for(var j=0; j<off_arg.offset.length; ++j) {\n      if(off_arg.offset[j] === 0) {\n        continue\n      } else if(off_arg.offset[j] === 1) {\n        init_string.push([\"t\", off_arg.array, \"p\", j].join(\"\"))      \n      } else {\n        init_string.push([off_arg.offset[j], \"*t\", off_arg.array, \"p\", j].join(\"\"))\n      }\n    }\n    if(init_string.length === 0) {\n      vars.push(\"q\" + i + \"=0\")\n    } else {\n      vars.push([\"q\", i, \"=\", init_string.join(\"+\")].join(\"\"))\n    }\n  }\n\n  //Prepare this variables\n  var thisVars = uniq([].concat(proc.pre.thisVars)\n                      .concat(proc.body.thisVars)\n                      .concat(proc.post.thisVars))\n  vars = vars.concat(thisVars)\n  if (vars.length > 0) {\n    code.push(\"var \" + vars.join(\",\"))\n  }\n  for(var i=0; i<proc.arrayArgs.length; ++i) {\n    code.push(\"p\"+i+\"|=0\")\n  }\n  \n  //Inline prelude\n  if(proc.pre.body.length > 3) {\n    code.push(processBlock(proc.pre, proc, dtypes))\n  }\n\n  //Process body\n  var body = processBlock(proc.body, proc, dtypes)\n  var matched = countMatches(loopOrders)\n  if(matched < dimension) {\n    code.push(outerFill(matched, loopOrders[0], proc, body)) // TODO: Rather than passing loopOrders[0], it might be interesting to look at passing an order that represents the majority of the arguments for example.\n  } else {\n    code.push(innerFill(loopOrders[0], proc, body))\n  }\n\n  //Inline epilog\n  if(proc.post.body.length > 3) {\n    code.push(processBlock(proc.post, proc, dtypes))\n  }\n  \n  if(proc.debug) {\n    console.log(\"-----Generated cwise routine for \", typesig, \":\\n\" + code.join(\"\\n\") + \"\\n----------\")\n  }\n  \n  var loopName = [(proc.funcName||\"unnamed\"), \"_cwise_loop_\", orders[0].join(\"s\"),\"m\",matched,typeSummary(dtypes)].join(\"\")\n  var f = new Function([\"function \",loopName,\"(\", arglist.join(\",\"),\"){\", code.join(\"\\n\"),\"} return \", loopName].join(\"\"))\n  return f()\n}\nmodule.exports = generateCWiseOp\n","\"use strict\"\n\nvar createThunk = require(\"./lib/thunk.js\")\n\nfunction Procedure() {\n  this.argTypes = []\n  this.shimArgs = []\n  this.arrayArgs = []\n  this.arrayBlockIndices = []\n  this.scalarArgs = []\n  this.offsetArgs = []\n  this.offsetArgIndex = []\n  this.indexArgs = []\n  this.shapeArgs = []\n  this.funcName = \"\"\n  this.pre = null\n  this.body = null\n  this.post = null\n  this.debug = false\n}\n\nfunction compileCwise(user_args) {\n  //Create procedure\n  var proc = new Procedure()\n  \n  //Parse blocks\n  proc.pre    = user_args.pre\n  proc.body   = user_args.body\n  proc.post   = user_args.post\n\n  //Parse arguments\n  var proc_args = user_args.args.slice(0)\n  proc.argTypes = proc_args\n  for(var i=0; i<proc_args.length; ++i) {\n    var arg_type = proc_args[i]\n    if(arg_type === \"array\" || (typeof arg_type === \"object\" && arg_type.blockIndices)) {\n      proc.argTypes[i] = \"array\"\n      proc.arrayArgs.push(i)\n      proc.arrayBlockIndices.push(arg_type.blockIndices ? arg_type.blockIndices : 0)\n      proc.shimArgs.push(\"array\" + i)\n      if(i < proc.pre.args.length && proc.pre.args[i].count>0) {\n        throw new Error(\"cwise: pre() block may not reference array args\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].count>0) {\n        throw new Error(\"cwise: post() block may not reference array args\")\n      }\n    } else if(arg_type === \"scalar\") {\n      proc.scalarArgs.push(i)\n      proc.shimArgs.push(\"scalar\" + i)\n    } else if(arg_type === \"index\") {\n      proc.indexArgs.push(i)\n      if(i < proc.pre.args.length && proc.pre.args[i].count > 0) {\n        throw new Error(\"cwise: pre() block may not reference array index\")\n      }\n      if(i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array index\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].count > 0) {\n        throw new Error(\"cwise: post() block may not reference array index\")\n      }\n    } else if(arg_type === \"shape\") {\n      proc.shapeArgs.push(i)\n      if(i < proc.pre.args.length && proc.pre.args[i].lvalue) {\n        throw new Error(\"cwise: pre() block may not write to array shape\")\n      }\n      if(i < proc.body.args.length && proc.body.args[i].lvalue) {\n        throw new Error(\"cwise: body() block may not write to array shape\")\n      }\n      if(i < proc.post.args.length && proc.post.args[i].lvalue) {\n        throw new Error(\"cwise: post() block may not write to array shape\")\n      }\n    } else if(typeof arg_type === \"object\" && arg_type.offset) {\n      proc.argTypes[i] = \"offset\"\n      proc.offsetArgs.push({ array: arg_type.array, offset:arg_type.offset })\n      proc.offsetArgIndex.push(i)\n    } else {\n      throw new Error(\"cwise: Unknown argument type \" + proc_args[i])\n    }\n  }\n  \n  //Make sure at least one array argument was specified\n  if(proc.arrayArgs.length <= 0) {\n    throw new Error(\"cwise: No array arguments specified\")\n  }\n  \n  //Make sure arguments are correct\n  if(proc.pre.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in pre() block\")\n  }\n  if(proc.body.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in body() block\")\n  }\n  if(proc.post.args.length > proc_args.length) {\n    throw new Error(\"cwise: Too many arguments in post() block\")\n  }\n\n  //Check debug flag\n  proc.debug = !!user_args.printCode || !!user_args.debug\n  \n  //Retrieve name\n  proc.funcName = user_args.funcName || \"cwise\"\n  \n  //Read in block size\n  proc.blockSize = user_args.blockSize || 64\n\n  return createThunk(proc)\n}\n\nmodule.exports = compileCwise\n","\"use strict\"\n\nfunction unique_pred(list, compare) {\n  var ptr = 1\n    , len = list.length\n    , a=list[0], b=list[0]\n  for(var i=1; i<len; ++i) {\n    b = a\n    a = list[i]\n    if(compare(a, b)) {\n      if(i === ptr) {\n        ptr++\n        continue\n      }\n      list[ptr++] = a\n    }\n  }\n  list.length = ptr\n  return list\n}\n\nfunction unique_eq(list) {\n  var ptr = 1\n    , len = list.length\n    , a=list[0], b = list[0]\n  for(var i=1; i<len; ++i, b=a) {\n    b = a\n    a = list[i]\n    if(a !== b) {\n      if(i === ptr) {\n        ptr++\n        continue\n      }\n      list[ptr++] = a\n    }\n  }\n  list.length = ptr\n  return list\n}\n\nfunction unique(list, compare, sorted) {\n  if(list.length === 0) {\n    return list\n  }\n  if(compare) {\n    if(!sorted) {\n      list.sort(compare)\n    }\n    return unique_pred(list, compare)\n  }\n  if(!sorted) {\n    list.sort()\n  }\n  return unique_eq(list)\n}\n\nmodule.exports = unique\n","\"use strict\"\n\n// The function below is called when constructing a cwise function object, and does the following:\n// A function object is constructed which accepts as argument a compilation function and returns another function.\n// It is this other function that is eventually returned by createThunk, and this function is the one that actually\n// checks whether a certain pattern of arguments has already been used before and compiles new loops as needed.\n// The compilation passed to the first function object is used for compiling new functions.\n// Once this function object is created, it is called with compile as argument, where the first argument of compile\n// is bound to \"proc\" (essentially containing a preprocessed version of the user arguments to cwise).\n// So createThunk roughly works like this:\n// function createThunk(proc) {\n//   var thunk = function(compileBound) {\n//     var CACHED = {}\n//     return function(arrays and scalars) {\n//       if (dtype and order of arrays in CACHED) {\n//         var func = CACHED[dtype and order of arrays]\n//       } else {\n//         var func = CACHED[dtype and order of arrays] = compileBound(dtype and order of arrays)\n//       }\n//       return func(arrays and scalars)\n//     }\n//   }\n//   return thunk(compile.bind1(proc))\n// }\n\nvar compile = require(\"./compile.js\")\n\nfunction createThunk(proc) {\n  var code = [\"'use strict'\", \"var CACHED={}\"]\n  var vars = []\n  var thunkName = proc.funcName + \"_cwise_thunk\"\n  \n  //Build thunk\n  code.push([\"return function \", thunkName, \"(\", proc.shimArgs.join(\",\"), \"){\"].join(\"\"))\n  var typesig = []\n  var string_typesig = []\n  var proc_args = [[\"array\",proc.arrayArgs[0],\".shape.slice(\", // Slice shape so that we only retain the shape over which we iterate (which gets passed to the cwise operator as SS).\n                    Math.max(0,proc.arrayBlockIndices[0]),proc.arrayBlockIndices[0]<0?(\",\"+proc.arrayBlockIndices[0]+\")\"):\")\"].join(\"\")]\n  var shapeLengthConditions = [], shapeConditions = []\n  // Process array arguments\n  for(var i=0; i<proc.arrayArgs.length; ++i) {\n    var j = proc.arrayArgs[i]\n    vars.push([\"t\", j, \"=array\", j, \".dtype,\",\n               \"r\", j, \"=array\", j, \".order\"].join(\"\"))\n    typesig.push(\"t\" + j)\n    typesig.push(\"r\" + j)\n    string_typesig.push(\"t\"+j)\n    string_typesig.push(\"r\"+j+\".join()\")\n    proc_args.push(\"array\" + j + \".data\")\n    proc_args.push(\"array\" + j + \".stride\")\n    proc_args.push(\"array\" + j + \".offset|0\")\n    if (i>0) { // Gather conditions to check for shape equality (ignoring block indices)\n      shapeLengthConditions.push(\"array\" + proc.arrayArgs[0] + \".shape.length===array\" + j + \".shape.length+\" + (Math.abs(proc.arrayBlockIndices[0])-Math.abs(proc.arrayBlockIndices[i])))\n      shapeConditions.push(\"array\" + proc.arrayArgs[0] + \".shape[shapeIndex+\" + Math.max(0,proc.arrayBlockIndices[0]) + \"]===array\" + j + \".shape[shapeIndex+\" + Math.max(0,proc.arrayBlockIndices[i]) + \"]\")\n    }\n  }\n  // Check for shape equality\n  if (proc.arrayArgs.length > 1) {\n    code.push(\"if (!(\" + shapeLengthConditions.join(\" && \") + \")) throw new Error('cwise: Arrays do not all have the same dimensionality!')\")\n    code.push(\"for(var shapeIndex=array\" + proc.arrayArgs[0] + \".shape.length-\" + Math.abs(proc.arrayBlockIndices[0]) + \"; shapeIndex-->0;) {\")\n    code.push(\"if (!(\" + shapeConditions.join(\" && \") + \")) throw new Error('cwise: Arrays do not all have the same shape!')\")\n    code.push(\"}\")\n  }\n  // Process scalar arguments\n  for(var i=0; i<proc.scalarArgs.length; ++i) {\n    proc_args.push(\"scalar\" + proc.scalarArgs[i])\n  }\n  // Check for cached function (and if not present, generate it)\n  vars.push([\"type=[\", string_typesig.join(\",\"), \"].join()\"].join(\"\"))\n  vars.push(\"proc=CACHED[type]\")\n  code.push(\"var \" + vars.join(\",\"))\n  \n  code.push([\"if(!proc){\",\n             \"CACHED[type]=proc=compile([\", typesig.join(\",\"), \"])}\",\n             \"return proc(\", proc_args.join(\",\"), \")}\"].join(\"\"))\n\n  if(proc.debug) {\n    console.log(\"-----Generated thunk:\\n\" + code.join(\"\\n\") + \"\\n----------\")\n  }\n  \n  //Compile thunk\n  var thunk = new Function(\"compile\", code.join(\"\\n\"))\n  return thunk(compile.bind(undefined, proc))\n}\n\nmodule.exports = createThunk\n","\"use strict\"\n\nvar compile = require(\"cwise-compiler\")\n\nvar EmptyProc = {\n  body: \"\",\n  args: [],\n  thisVars: [],\n  localVars: []\n}\n\nfunction fixup(x) {\n  if(!x) {\n    return EmptyProc\n  }\n  for(var i=0; i<x.args.length; ++i) {\n    var a = x.args[i]\n    if(i === 0) {\n      x.args[i] = {name: a, lvalue:true, rvalue: !!x.rvalue, count:x.count||1 }\n    } else {\n      x.args[i] = {name: a, lvalue:false, rvalue:true, count: 1}\n    }\n  }\n  if(!x.thisVars) {\n    x.thisVars = []\n  }\n  if(!x.localVars) {\n    x.localVars = []\n  }\n  return x\n}\n\nfunction pcompile(user_args) {\n  return compile({\n    args:     user_args.args,\n    pre:      fixup(user_args.pre),\n    body:     fixup(user_args.body),\n    post:     fixup(user_args.proc),\n    funcName: user_args.funcName\n  })\n}\n\nfunction makeOp(user_args) {\n  var args = []\n  for(var i=0; i<user_args.args.length; ++i) {\n    args.push(\"a\"+i)\n  }\n  var wrapper = new Function(\"P\", [\n    \"return function \", user_args.funcName, \"_ndarrayops(\", args.join(\",\"), \") {P(\", args.join(\",\"), \");return a0}\"\n  ].join(\"\"))\n  return wrapper(pcompile(user_args))\n}\n\nvar assign_ops = {\n  add:  \"+\",\n  sub:  \"-\",\n  mul:  \"*\",\n  div:  \"/\",\n  mod:  \"%\",\n  band: \"&\",\n  bor:  \"|\",\n  bxor: \"^\",\n  lshift: \"<<\",\n  rshift: \">>\",\n  rrshift: \">>>\"\n}\n;(function(){\n  for(var id in assign_ops) {\n    var op = assign_ops[id]\n    exports[id] = makeOp({\n      args: [\"array\",\"array\",\"array\"],\n      body: {args:[\"a\",\"b\",\"c\"],\n             body: \"a=b\"+op+\"c\"},\n      funcName: id\n    })\n    exports[id+\"eq\"] = makeOp({\n      args: [\"array\",\"array\"],\n      body: {args:[\"a\",\"b\"],\n             body:\"a\"+op+\"=b\"},\n      rvalue: true,\n      funcName: id+\"eq\"\n    })\n    exports[id+\"s\"] = makeOp({\n      args: [\"array\", \"array\", \"scalar\"],\n      body: {args:[\"a\",\"b\",\"s\"],\n             body:\"a=b\"+op+\"s\"},\n      funcName: id+\"s\"\n    })\n    exports[id+\"seq\"] = makeOp({\n      args: [\"array\",\"scalar\"],\n      body: {args:[\"a\",\"s\"],\n             body:\"a\"+op+\"=s\"},\n      rvalue: true,\n      funcName: id+\"seq\"\n    })\n  }\n})();\n\nvar unary_ops = {\n  not: \"!\",\n  bnot: \"~\",\n  neg: \"-\",\n  recip: \"1.0/\"\n}\n;(function(){\n  for(var id in unary_ops) {\n    var op = unary_ops[id]\n    exports[id] = makeOp({\n      args: [\"array\", \"array\"],\n      body: {args:[\"a\",\"b\"],\n             body:\"a=\"+op+\"b\"},\n      funcName: id\n    })\n    exports[id+\"eq\"] = makeOp({\n      args: [\"array\"],\n      body: {args:[\"a\"],\n             body:\"a=\"+op+\"a\"},\n      rvalue: true,\n      count: 2,\n      funcName: id+\"eq\"\n    })\n  }\n})();\n\nvar binary_ops = {\n  and: \"&&\",\n  or: \"||\",\n  eq: \"===\",\n  neq: \"!==\",\n  lt: \"<\",\n  gt: \">\",\n  leq: \"<=\",\n  geq: \">=\"\n}\n;(function() {\n  for(var id in binary_ops) {\n    var op = binary_ops[id]\n    exports[id] = makeOp({\n      args: [\"array\",\"array\",\"array\"],\n      body: {args:[\"a\", \"b\", \"c\"],\n             body:\"a=b\"+op+\"c\"},\n      funcName: id\n    })\n    exports[id+\"s\"] = makeOp({\n      args: [\"array\",\"array\",\"scalar\"],\n      body: {args:[\"a\", \"b\", \"s\"],\n             body:\"a=b\"+op+\"s\"},\n      funcName: id+\"s\"\n    })\n    exports[id+\"eq\"] = makeOp({\n      args: [\"array\", \"array\"],\n      body: {args:[\"a\", \"b\"],\n             body:\"a=a\"+op+\"b\"},\n      rvalue:true,\n      count:2,\n      funcName: id+\"eq\"\n    })\n    exports[id+\"seq\"] = makeOp({\n      args: [\"array\", \"scalar\"],\n      body: {args:[\"a\",\"s\"],\n             body:\"a=a\"+op+\"s\"},\n      rvalue:true,\n      count:2,\n      funcName: id+\"seq\"\n    })\n  }\n})();\n\nvar math_unary = [\n  \"abs\",\n  \"acos\",\n  \"asin\",\n  \"atan\",\n  \"ceil\",\n  \"cos\",\n  \"exp\",\n  \"floor\",\n  \"log\",\n  \"round\",\n  \"sin\",\n  \"sqrt\",\n  \"tan\"\n]\n;(function() {\n  for(var i=0; i<math_unary.length; ++i) {\n    var f = math_unary[i]\n    exports[f] = makeOp({\n                    args: [\"array\", \"array\"],\n                    pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                    body: {args:[\"a\",\"b\"], body:\"a=this_f(b)\", thisVars:[\"this_f\"]},\n                    funcName: f\n                  })\n    exports[f+\"eq\"] = makeOp({\n                      args: [\"array\"],\n                      pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                      body: {args: [\"a\"], body:\"a=this_f(a)\", thisVars:[\"this_f\"]},\n                      rvalue: true,\n                      count: 2,\n                      funcName: f+\"eq\"\n                    })\n  }\n})();\n\nvar math_comm = [\n  \"max\",\n  \"min\",\n  \"atan2\",\n  \"pow\"\n]\n;(function(){\n  for(var i=0; i<math_comm.length; ++i) {\n    var f= math_comm[i]\n    exports[f] = makeOp({\n                  args:[\"array\", \"array\", \"array\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\",\"c\"], body:\"a=this_f(b,c)\", thisVars:[\"this_f\"]},\n                  funcName: f\n                })\n    exports[f+\"s\"] = makeOp({\n                  args:[\"array\", \"array\", \"scalar\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\",\"c\"], body:\"a=this_f(b,c)\", thisVars:[\"this_f\"]},\n                  funcName: f+\"s\"\n                  })\n    exports[f+\"eq\"] = makeOp({ args:[\"array\", \"array\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\"], body:\"a=this_f(a,b)\", thisVars:[\"this_f\"]},\n                  rvalue: true,\n                  count: 2,\n                  funcName: f+\"eq\"\n                  })\n    exports[f+\"seq\"] = makeOp({ args:[\"array\", \"scalar\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\"], body:\"a=this_f(a,b)\", thisVars:[\"this_f\"]},\n                  rvalue:true,\n                  count:2,\n                  funcName: f+\"seq\"\n                  })\n  }\n})();\n\nvar math_noncomm = [\n  \"atan2\",\n  \"pow\"\n]\n;(function(){\n  for(var i=0; i<math_noncomm.length; ++i) {\n    var f= math_noncomm[i]\n    exports[f+\"op\"] = makeOp({\n                  args:[\"array\", \"array\", \"array\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\",\"c\"], body:\"a=this_f(c,b)\", thisVars:[\"this_f\"]},\n                  funcName: f+\"op\"\n                })\n    exports[f+\"ops\"] = makeOp({\n                  args:[\"array\", \"array\", \"scalar\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\",\"c\"], body:\"a=this_f(c,b)\", thisVars:[\"this_f\"]},\n                  funcName: f+\"ops\"\n                  })\n    exports[f+\"opeq\"] = makeOp({ args:[\"array\", \"array\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\"], body:\"a=this_f(b,a)\", thisVars:[\"this_f\"]},\n                  rvalue: true,\n                  count: 2,\n                  funcName: f+\"opeq\"\n                  })\n    exports[f+\"opseq\"] = makeOp({ args:[\"array\", \"scalar\"],\n                  pre: {args:[], body:\"this_f=Math.\"+f, thisVars:[\"this_f\"]},\n                  body: {args:[\"a\",\"b\"], body:\"a=this_f(b,a)\", thisVars:[\"this_f\"]},\n                  rvalue:true,\n                  count:2,\n                  funcName: f+\"opseq\"\n                  })\n  }\n})();\n\nexports.any = compile({\n  args:[\"array\"],\n  pre: EmptyProc,\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:1}], body: \"if(a){return true}\", localVars: [], thisVars: []},\n  post: {args:[], localVars:[], thisVars:[], body:\"return false\"},\n  funcName: \"any\"\n})\n\nexports.all = compile({\n  args:[\"array\"],\n  pre: EmptyProc,\n  body: {args:[{name:\"x\", lvalue:false, rvalue:true, count:1}], body: \"if(!x){return false}\", localVars: [], thisVars: []},\n  post: {args:[], localVars:[], thisVars:[], body:\"return true\"},\n  funcName: \"all\"\n})\n\nexports.sum = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=0\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:1}], body: \"this_s+=a\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return this_s\"},\n  funcName: \"sum\"\n})\n\nexports.prod = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=1\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:1}], body: \"this_s*=a\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return this_s\"},\n  funcName: \"prod\"\n})\n\nexports.norm2squared = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=0\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:2}], body: \"this_s+=a*a\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return this_s\"},\n  funcName: \"norm2squared\"\n})\n  \nexports.norm2 = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=0\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:2}], body: \"this_s+=a*a\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return Math.sqrt(this_s)\"},\n  funcName: \"norm2\"\n})\n  \n\nexports.norminf = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=0\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:4}], body:\"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return this_s\"},\n  funcName: \"norminf\"\n})\n\nexports.norm1 = compile({\n  args:[\"array\"],\n  pre: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"this_s=0\"},\n  body: {args:[{name:\"a\", lvalue:false, rvalue:true, count:3}], body: \"this_s+=a<0?-a:a\", localVars: [], thisVars: [\"this_s\"]},\n  post: {args:[], localVars:[], thisVars:[\"this_s\"], body:\"return this_s\"},\n  funcName: \"norm1\"\n})\n\nexports.sup = compile({\n  args: [ \"array\" ],\n  pre:\n   { body: \"this_h=-Infinity\",\n     args: [],\n     thisVars: [ \"this_h\" ],\n     localVars: [] },\n  body:\n   { body: \"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_\",\n     args: [{\"name\":\"_inline_1_arg0_\",\"lvalue\":false,\"rvalue\":true,\"count\":2} ],\n     thisVars: [ \"this_h\" ],\n     localVars: [] },\n  post:\n   { body: \"return this_h\",\n     args: [],\n     thisVars: [ \"this_h\" ],\n     localVars: [] }\n })\n\nexports.inf = compile({\n  args: [ \"array\" ],\n  pre:\n   { body: \"this_h=Infinity\",\n     args: [],\n     thisVars: [ \"this_h\" ],\n     localVars: [] },\n  body:\n   { body: \"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_\",\n     args: [{\"name\":\"_inline_1_arg0_\",\"lvalue\":false,\"rvalue\":true,\"count\":2} ],\n     thisVars: [ \"this_h\" ],\n     localVars: [] },\n  post:\n   { body: \"return this_h\",\n     args: [],\n     thisVars: [ \"this_h\" ],\n     localVars: [] }\n })\n\nexports.argmin = compile({\n  args:[\"index\",\"array\",\"shape\"],\n  pre:{\n    body:\"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}\",\n    args:[\n      {name:\"_inline_0_arg0_\",lvalue:false,rvalue:false,count:0},\n      {name:\"_inline_0_arg1_\",lvalue:false,rvalue:false,count:0},\n      {name:\"_inline_0_arg2_\",lvalue:false,rvalue:true,count:1}\n      ],\n    thisVars:[\"this_i\",\"this_v\"],\n    localVars:[]},\n  body:{\n    body:\"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}\",\n    args:[\n      {name:\"_inline_1_arg0_\",lvalue:false,rvalue:true,count:2},\n      {name:\"_inline_1_arg1_\",lvalue:false,rvalue:true,count:2}],\n    thisVars:[\"this_i\",\"this_v\"],\n    localVars:[\"_inline_1_k\"]},\n  post:{\n    body:\"{return this_i}\",\n    args:[],\n    thisVars:[\"this_i\"],\n    localVars:[]}\n})\n\nexports.argmax = compile({\n  args:[\"index\",\"array\",\"shape\"],\n  pre:{\n    body:\"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}\",\n    args:[\n      {name:\"_inline_0_arg0_\",lvalue:false,rvalue:false,count:0},\n      {name:\"_inline_0_arg1_\",lvalue:false,rvalue:false,count:0},\n      {name:\"_inline_0_arg2_\",lvalue:false,rvalue:true,count:1}\n      ],\n    thisVars:[\"this_i\",\"this_v\"],\n    localVars:[]},\n  body:{\n    body:\"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}\",\n    args:[\n      {name:\"_inline_1_arg0_\",lvalue:false,rvalue:true,count:2},\n      {name:\"_inline_1_arg1_\",lvalue:false,rvalue:true,count:2}],\n    thisVars:[\"this_i\",\"this_v\"],\n    localVars:[\"_inline_1_k\"]},\n  post:{\n    body:\"{return this_i}\",\n    args:[],\n    thisVars:[\"this_i\"],\n    localVars:[]}\n})  \n\nexports.random = makeOp({\n  args: [\"array\"],\n  pre: {args:[], body:\"this_f=Math.random\", thisVars:[\"this_f\"]},\n  body: {args: [\"a\"], body:\"a=this_f()\", thisVars:[\"this_f\"]},\n  funcName: \"random\"\n})\n\nexports.assign = makeOp({\n  args:[\"array\", \"array\"],\n  body: {args:[\"a\", \"b\"], body:\"a=b\"},\n  funcName: \"assign\" })\n\nexports.assigns = makeOp({\n  args:[\"array\", \"scalar\"],\n  body: {args:[\"a\", \"b\"], body:\"a=b\"},\n  funcName: \"assigns\" })\n\n\nexports.equals = compile({\n  args:[\"array\", \"array\"],\n  pre: EmptyProc,\n  body: {args:[{name:\"x\", lvalue:false, rvalue:true, count:1},\n               {name:\"y\", lvalue:false, rvalue:true, count:1}], \n        body: \"if(x!==y){return false}\", \n        localVars: [], \n        thisVars: []},\n  post: {args:[], localVars:[], thisVars:[], body:\"return true\"},\n  funcName: \"equals\"\n})\n\n\n","import ndarray, { NdArray } from 'ndarray';\nimport { filters } from '../vendor/filters';\nimport { convolve } from './convolve';\n\nenum Method {\n\tLANCZOS_3 = 3,\n\tLANCZOS_2 = 2,\n}\n\nfunction resize(src: NdArray, dst: NdArray, method: Method): void {\n\tconst [srcWidth, srcHeight] = src.shape;\n\tconst [dstWidth, dstHeight] = dst.shape;\n\n\tconst ratioX = dstWidth / srcWidth;\n\tconst ratioY = dstHeight / srcHeight;\n\n\tconst filtersX = filters(srcWidth, dstWidth, ratioX, 0, method === Method.LANCZOS_2);\n\tconst filtersY = filters(srcHeight, dstHeight, ratioY, 0, method === Method.LANCZOS_2);\n\n\tconst tmp = ndarray(new Uint8Array(dstWidth * srcHeight * 4), [srcHeight, dstWidth, 4]);\n\tconst tmpTranspose = tmp.transpose(1, 0);\n\tconst dstTranspose = dst.transpose(1, 0);\n\n\tconvolve(src, tmpTranspose, filtersX);\n\tconvolve(tmp, dstTranspose, filtersY);\n}\n\nexport function lanczos3(src: NdArray, dst: NdArray): void {\n\tresize(src, dst, Method.LANCZOS_3);\n}\n\nexport function lanczos2(src: NdArray, dst: NdArray): void {\n\tresize(src, dst, Method.LANCZOS_2);\n}\n","import type { NdArray } from 'ndarray';\nimport { getPixels, savePixels } from 'ndarray-pixels';\nimport { Primitive, Texture, Transform, TransformContext } from '@gltf-transform/core';\n\n/**\n * Prepares a function used in an {@link Document.transform} pipeline. Use of this wrapper is\n * optional, and plain functions may be used in transform pipelines just as well. The wrapper is\n * used internally so earlier pipeline stages can detect and optimize based on later stages.\n */\nexport function createTransform(name: string, fn: Transform): Transform {\n\tObject.defineProperty(fn, 'name', { value: name });\n\treturn fn;\n}\n\nexport function isTransformPending(context: TransformContext | undefined, initial: string, pending: string): boolean {\n\tif (!context) return false;\n\tconst initialIndex = context.stack.lastIndexOf(initial);\n\tconst pendingIndex = context.stack.lastIndexOf(pending);\n\treturn initialIndex < pendingIndex;\n}\n\n/** Maps pixels from source to target textures, with a per-pixel callback. */\nexport async function rewriteTexture(\n\tsource: Texture,\n\ttarget: Texture,\n\tfn: (pixels: NdArray, i: number, j: number) => void\n): Promise<Texture | null> {\n\tif (!source) return null;\n\n\tconst srcImage = source.getImage();\n\tif (!srcImage) return null;\n\n\tconst pixels = await getPixels(srcImage, source.getMimeType());\n\n\tfor (let i = 0; i < pixels.shape[0]; ++i) {\n\t\tfor (let j = 0; j < pixels.shape[1]; ++j) {\n\t\t\tfn(pixels, i, j);\n\t\t}\n\t}\n\n\tconst dstImage = await savePixels(pixels, 'image/png');\n\treturn target.setImage(dstImage).setMimeType('image/png');\n}\n\nexport function getGLPrimitiveCount(prim: Primitive): number {\n\tconst indices = prim.getIndices();\n\tconst position = prim.getAttribute('POSITION')!;\n\n\t// Reference: https://www.khronos.org/opengl/wiki/Primitive\n\tswitch (prim.getMode()) {\n\t\tcase Primitive.Mode.POINTS:\n\t\t\treturn position.getCount();\n\t\tcase Primitive.Mode.LINES:\n\t\t\treturn indices ? indices.getCount() / 2 : position.getCount() / 2;\n\t\tcase Primitive.Mode.LINE_LOOP:\n\t\t\treturn position.getCount();\n\t\tcase Primitive.Mode.LINE_STRIP:\n\t\t\treturn position.getCount() - 1;\n\t\tcase Primitive.Mode.TRIANGLES:\n\t\t\treturn indices ? indices.getCount() / 3 : position.getCount() / 3;\n\t\tcase Primitive.Mode.TRIANGLE_STRIP:\n\t\tcase Primitive.Mode.TRIANGLE_FAN:\n\t\t\treturn position.getCount() - 2;\n\t\tdefault:\n\t\t\tthrow new Error('Unexpected mode: ' + prim.getMode());\n\t}\n}\n\nexport class SetMap<K, V> {\n\tprivate _map = new Map<K, Set<V>>();\n\tpublic get size(): number {\n\t\treturn this._map.size;\n\t}\n\tpublic has(k: K): boolean {\n\t\treturn this._map.has(k);\n\t}\n\tpublic add(k: K, v: V): this {\n\t\tlet entry = this._map.get(k);\n\t\tif (!entry) {\n\t\t\tentry = new Set();\n\t\t\tthis._map.set(k, entry);\n\t\t}\n\t\tentry.add(v);\n\t\treturn this;\n\t}\n\tpublic get(k: K): Set<V> {\n\t\treturn this._map.get(k) || new Set();\n\t}\n\tpublic keys(): Iterable<K> {\n\t\treturn this._map.keys();\n\t}\n}\n\nexport function formatBytes(bytes: number, decimals = 2): string {\n\tif (bytes === 0) return '0 Bytes';\n\n\tconst k = 1000;\n\tconst dm = decimals < 0 ? 0 : decimals;\n\tconst sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\n\treturn parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n","const fixedFracBits = 14\n\nconst filterValue = ( x: number, a: 2 | 3 ) => {\n\tif ( x <= -a || x >= a ) return 0\n\n\t// appears to do nothing?\n\t// if ( x > -1.19209290e-07 && x < 1.19209290e-07 ) return 1\n\n\tconst xPi = x * Math.PI\n\n\treturn ( Math.sin( xPi ) / xPi ) * Math.sin( xPi / a ) / ( xPi / a )\n}\n\nconst toFixedPoint = ( value: number ) =>\nMath.round( value * ( ( 1 << fixedFracBits ) - 1 ) )\n\nexport const filters = ( srcSize: number, destSize: number, scale: number, offset: number, use2: boolean ) => {\n\tconst a = use2 ? 2 : 3\n\tconst scaleInverted = 1 / scale\n\tconst scaleClamped = Math.min( 1, scale ) // For upscale\n\n\t// Filter window (averaging interval), scaled to src image\n\tconst srcWindow = a / scaleClamped\n\n\tconst maxFilterElementSize = Math.floor( ( srcWindow + 1 ) * 2 )\n\tconst packedFilter = new Int16Array( ( maxFilterElementSize + 2 ) * destSize )\n\tlet packedFilterPtr = 0\n\n\t// For each destination pixel calculate source range and built filter values\n\tfor ( let destPixel = 0; destPixel < destSize; destPixel++ ) {\n\n\t\t// Scaling should be done relative to central pixel point\n\t\tconst sourcePixel = ( destPixel + 0.5 ) * scaleInverted + offset\n\t\tconst sourceFirst = Math.max( 0, Math.floor( sourcePixel - srcWindow ) )\n\t\tconst sourceLast = Math.min( srcSize - 1, Math.ceil( sourcePixel + srcWindow ) )\n\n\t\tconst filterElementSize = sourceLast - sourceFirst + 1\n\t\tconst floatFilter = new Float32Array( filterElementSize )\n\t\tconst fxpFilter = new Int16Array( filterElementSize )\n\n\t\tlet total = 0\n\n\t\t// Fill filter values for calculated range\n\t\tlet index = 0\n\t\tfor ( let pixel = sourceFirst; pixel <= sourceLast; pixel++ ) {\n\t\t\tconst floatValue = filterValue( ( ( pixel + 0.5 ) - sourcePixel ) * scaleClamped, a )\n\n\t\t\ttotal += floatValue\n\t\t\tfloatFilter[ index ] = floatValue\n\n\t\t\tindex++\n\t\t}\n\n\t\t// Normalize filter, convert to fixed point and accumulate conversion error\n\t\tlet filterTotal = 0\n\n\t\tfor ( let index = 0; index < floatFilter.length; index++ ) {\n\t\t\tconst filterValue = floatFilter[ index ] / total\n\n\t\t\tfilterTotal += filterValue\n\t\t\tfxpFilter[ index ] = toFixedPoint( filterValue )\n\t\t}\n\n\t\t// Compensate normalization error, to minimize brightness drift\n\t\tfxpFilter[ destSize >> 1 ] += toFixedPoint( 1 - filterTotal )\n\n\t\t//\n\t\t// Now pack filter to useable form\n\t\t//\n\t\t// 1. Trim heading and tailing zero values, and compensate shitf/length\n\t\t// 2. Put all to single array in this format:\n\t\t//\n\t\t//    [ pos shift, data length, value1, value2, value3, ... ]\n\t\t//\n\t\tlet leftNotEmpty = 0\n\t\twhile ( leftNotEmpty < fxpFilter.length && fxpFilter[ leftNotEmpty ] === 0 ) {\n\t\t\tleftNotEmpty++\n\t\t}\n\n\t\tlet rightNotEmpty = fxpFilter.length - 1\n\t\twhile ( rightNotEmpty > 0 && fxpFilter[ rightNotEmpty ] === 0 ) {\n\t\t\trightNotEmpty--\n\t\t}\n\n\t\tconst filterShift = sourceFirst + leftNotEmpty\n\t\tconst filterSize = rightNotEmpty - leftNotEmpty + 1\n\n\t\tpackedFilter[ packedFilterPtr++ ] = filterShift // shift\n\t\tpackedFilter[ packedFilterPtr++ ] = filterSize // size\n\n\t\tpackedFilter.set( fxpFilter.subarray( leftNotEmpty, rightNotEmpty + 1 ), packedFilterPtr )\n\t\tpackedFilterPtr += filterSize\n\t}\n\n\treturn packedFilter\n}\n","import { Accessor, BufferUtils, Document, Logger, Material, Mesh, Primitive, PrimitiveTarget, PropertyType, Root, Texture, Transform } from '@gltf-transform/core';\nimport { createTransform } from './utils';\n\nconst NAME = 'dedup';\n\nexport interface DedupOptions {\n\t/** List of {@link PropertyType} identifiers to be de-duplicated.*/\n\tpropertyTypes: string[];\n}\n\nconst DEDUP_DEFAULTS: Required<DedupOptions> = {\n\tpropertyTypes: [\n\t\tPropertyType.ACCESSOR,\n\t\tPropertyType.MESH,\n\t\tPropertyType.TEXTURE,\n\t\tPropertyType.MATERIAL,\n\t],\n};\n\n/**\n * Removes duplicate {@link Accessor}, {@link Mesh}, {@link Texture}, and {@link Material}\n * properties. Partially based on a\n * [gist by mattdesl](https://gist.github.com/mattdesl/aea40285e2d73916b6b9101b36d84da8). Only\n * accessors in mesh primitives, morph targets, and animation samplers are processed.\n *\n * Example:\n *\n * ```ts\n * document.getRoot().listMeshes(); //  [Mesh, Mesh, Mesh]\n *\n * await document.transform(dedup({propertyTypes: [PropertyType.MESH]}));\n *\n * document.getRoot().listMeshes(); //  [Mesh]\n * ```\n */\nexport const dedup = function (_options: DedupOptions = DEDUP_DEFAULTS): Transform {\n\tconst options = {...DEDUP_DEFAULTS, ..._options} as Required<DedupOptions>;\n\n\tconst propertyTypes = new Set(options.propertyTypes);\n\tfor (const propertyType of options.propertyTypes) {\n\t\tif (!DEDUP_DEFAULTS.propertyTypes.includes(propertyType)) {\n\t\t\tthrow new Error(`${NAME}: Unsupported deduplication on type \"${propertyType}\".`);\n\t\t}\n\t}\n\n\treturn createTransform(NAME, (doc: Document): void =>  {\n\t\tconst logger = doc.getLogger();\n\n\t\tif (propertyTypes.has(PropertyType.ACCESSOR)) dedupAccessors(logger, doc);\n\t\tif (propertyTypes.has(PropertyType.MESH)) dedupMeshes(logger, doc);\n\t\tif (propertyTypes.has(PropertyType.TEXTURE)) dedupImages(logger, doc);\n\t\tif (propertyTypes.has(PropertyType.MATERIAL)) dedupMaterials(logger, doc);\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t});\n\n};\n\nfunction dedupAccessors(logger: Logger, doc: Document): void {\n\t// Find all accessors used for mesh data.\n\tconst indicesAccessors: Set<Accessor> = new Set();\n\tconst attributeAccessors: Set<Accessor> = new Set();\n\tconst inputAccessors: Set<Accessor> = new Set();\n\tconst outputAccessors: Set<Accessor> = new Set();\n\n\tconst meshes = doc.getRoot().listMeshes();\n\tmeshes.forEach((mesh) => {\n\t\tmesh.listPrimitives().forEach((primitive) => {\n\t\t\tprimitive.listAttributes().forEach((accessor) => (attributeAccessors.add(accessor)));\n\t\t\tconst indices = primitive.getIndices();\n\t\t\tif (indices) indicesAccessors.add(indices);\n\t\t});\n\t});\n\n\tfor (const animation of doc.getRoot().listAnimations()) {\n\t\tfor (const sampler of animation.listSamplers()) {\n\t\t\tconst input = sampler.getInput();\n\t\t\tconst output = sampler.getOutput();\n\t\t\tif (input) inputAccessors.add(input);\n\t\t\tif (output) outputAccessors.add(output);\n\t\t}\n\t}\n\n\t// Find duplicate accessors of a given type.\n\tfunction detectDuplicates(accessors: Accessor[]): Map<Accessor, Accessor> {\n\t\tconst duplicateAccessors: Map<Accessor, Accessor> = new Map();\n\n\t\tfor (let i = 0; i < accessors.length; i++) {\n\t\t\tconst a = accessors[i];\n\t\t\tconst aData = BufferUtils.toView(a.getArray()!);\n\n\t\t\tif (duplicateAccessors.has(a)) continue;\n\n\t\t\tfor (let j = 0; j < accessors.length; j++) {\n\t\t\t\tconst b = accessors[j];\n\n\t\t\t\tif (a === b) continue;\n\t\t\t\tif (duplicateAccessors.has(b)) continue;\n\n\t\t\t\tif (a.getType() !== b.getType()) continue;\n\t\t\t\tif (a.getComponentType() !== b.getComponentType()) continue;\n\t\t\t\tif (a.getCount() !== b.getCount()) continue;\n\t\t\t\tif (a.getNormalized() !== b.getNormalized()) continue;\n\t\t\t\tif (BufferUtils.equals(aData, BufferUtils.toView(b.getArray()!))) {\n\t\t\t\t\tduplicateAccessors.set(b, a);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn duplicateAccessors;\n\t}\n\n\tconst duplicateIndices = detectDuplicates(Array.from(indicesAccessors));\n\tlogger.debug(\n\t\t`${NAME}: Found ${duplicateIndices.size} duplicates among ${indicesAccessors.size} indices.`\n\t);\n\n\tconst duplicateAttributes = detectDuplicates(Array.from(attributeAccessors));\n\tlogger.debug(\n\t\t`${NAME}: Found ${duplicateAttributes.size} duplicates among ${attributeAccessors.size}`\n\t\t+ ' attributes.'\n\t);\n\n\tconst duplicateInputs = detectDuplicates(Array.from(inputAccessors));\n\tconst duplicateOutputs = detectDuplicates(Array.from(outputAccessors));\n\tlogger.debug(\n\t\t`${NAME}: Found ${duplicateInputs.size + duplicateOutputs.size} duplicates among`\n\t\t+ ` ${inputAccessors.size + outputAccessors.size} animation accessors.`\n\t);\n\n\t// Dissolve duplicate vertex attributes and indices.\n\tmeshes.forEach((mesh) => {\n\t\tmesh.listPrimitives().forEach((primitive) => {\n\t\t\tprimitive.listAttributes().forEach((accessor) => {\n\t\t\t\tif (duplicateAttributes.has(accessor)) {\n\t\t\t\t\tprimitive.swap(accessor, duplicateAttributes.get(accessor) as Accessor);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst indices = primitive.getIndices();\n\t\t\tif (indices && duplicateIndices.has(indices)) {\n\t\t\t\tprimitive.swap(indices, duplicateIndices.get(indices) as Accessor);\n\t\t\t}\n\t\t});\n\t});\n\tArray.from(duplicateIndices.keys()).forEach((indices) => indices.dispose());\n\tArray.from(duplicateAttributes.keys()).forEach((attribute) => attribute.dispose());\n\n\t// Dissolve duplicate animation sampler inputs and outputs.\n\tfor (const animation of doc.getRoot().listAnimations()) {\n\t\tfor (const sampler of animation.listSamplers()) {\n\t\t\tconst input = sampler.getInput();\n\t\t\tconst output = sampler.getOutput();\n\t\t\tif (input && duplicateInputs.has(input)) {\n\t\t\t\tsampler.swap(input, duplicateInputs.get(input) as Accessor);\n\t\t\t}\n\t\t\tif (output && duplicateOutputs.has(output)) {\n\t\t\t\tsampler.swap(output, duplicateOutputs.get(output) as Accessor);\n\t\t\t}\n\t\t}\n\t}\n\tArray.from(duplicateInputs.keys()).forEach((input) => input.dispose());\n\tArray.from(duplicateOutputs.keys()).forEach((output) => output.dispose());\n}\n\nfunction dedupMeshes(logger: Logger, doc: Document): void {\n\tconst root = doc.getRoot();\n\n\t// Create Reference -> ID lookup table.\n\tconst refs = new Map<Accessor|Material, number>();\n\troot.listAccessors().forEach((accessor, index) => refs.set(accessor, index));\n\troot.listMaterials().forEach((material, index) => refs.set(material, index));\n\n\t// For each mesh, create a hashkey.\n\tconst numMeshes = root.listMeshes().length;\n\tconst uniqueMeshes = new Map<string, Mesh>();\n\tfor (const src of root.listMeshes()) {\n\t\t// For each mesh, create a hashkey.\n\t\tconst srcKeyItems = [];\n\t\tfor (const prim of src.listPrimitives()) {\n\t\t\tsrcKeyItems.push(createPrimitiveKey(prim, refs));\n\t\t}\n\n\t\t// If another mesh exists with the same key, replace all instances with that, and dispose\n\t\t// of the duplicate. If not, just cache it.\n\t\tconst meshKey = srcKeyItems.join(';');\n\t\tif (uniqueMeshes.has(meshKey)) {\n\t\t\tconst targetMesh = uniqueMeshes.get(meshKey)!;\n\t\t\tsrc.listParents().forEach((parent) => {\n\t\t\t\tif (parent.propertyType !== PropertyType.ROOT) {\n\t\t\t\t\tparent.swap(src, targetMesh);\n\t\t\t\t}\n\t\t\t});\n\t\t\tsrc.dispose();\n\t\t} else {\n\t\t\tuniqueMeshes.set(meshKey, src);\n\t\t}\n\t}\n\n\tlogger.debug(\n\t\t`${NAME}: Found ${numMeshes - uniqueMeshes.size} duplicates among ${numMeshes} meshes.`\n\t);\n}\n\nfunction dedupImages(logger: Logger, doc: Document): void {\n\tconst root = doc.getRoot();\n\tconst textures = root.listTextures();\n\tconst duplicates: Map<Texture, Texture> = new Map();\n\n\t// Compare each texture to every other texture  O(n)  and mark duplicates for replacement.\n\tfor (let i = 0; i < textures.length; i++) {\n\t\tconst a = textures[i];\n\t\tconst aData = a.getImage();\n\n\t\tif (duplicates.has(a)) continue;\n\n\t\tfor (let j = 0; j < textures.length; j++) {\n\t\t\tconst b = textures[j];\n\t\t\tconst bData = b.getImage();\n\n\t\t\tif (a === b) continue;\n\t\t\tif (duplicates.has(b)) continue;\n\n\t\t\t// URIs are intentionally not compared.\n\t\t\tif (a.getMimeType() !== b.getMimeType()) continue;\n\n\t\t\tconst aSize = a.getSize();\n\t\t\tconst bSize = b.getSize();\n\t\t\tif (!aSize || !bSize) continue;\n\t\t\tif (aSize[0] !== bSize[0]) continue;\n\t\t\tif (aSize[1] !== bSize[1]) continue;\n\t\t\tif (!aData || !bData) continue;\n\t\t\tif (BufferUtils.equals(aData, bData)) {\n\t\t\t\tduplicates.set(b, a);\n\t\t\t}\n\t\t}\n\t}\n\n\tlogger.debug(\n\t\t`${NAME}: Found ${duplicates.size} duplicates among ${root.listTextures().length} textures.`\n\t);\n\n\tArray.from(duplicates.entries()).forEach(([src, dst]) => {\n\t\tsrc.listParents().forEach((property) => {\n\t\t\tif (!(property instanceof Root)) property.swap(src, dst);\n\t\t});\n\t\tsrc.dispose();\n\t});\n}\n\nfunction dedupMaterials(logger: Logger, doc: Document): void {\n\tconst root = doc.getRoot();\n\tconst materials = root.listMaterials();\n\tconst duplicates: Map<Material, Material> = new Map();\n\n\t// Compare each material to every other material  O(n)  and mark duplicates for replacement.\n\tfor (let i = 0; i < materials.length; i++){\n\t\tconst a = materials[i];\n\n\t\tif (duplicates.has(a)) continue;\n\n\t\tfor (let j = 0; j < materials.length; j++){\n\t\t\tconst b = materials[j];\n\n\t\t\tif (a === b) continue;\n\t\t\tif (duplicates.has(b)) continue;\n\n\t\t\tif (a.equals(b)) {\n\t\t\t\tduplicates.set(b, a);\n\t\t\t}\n\t\t}\n\t}\n\n\tlogger.debug(\n\t\t// eslint-disable-next-line max-len\n\t\t`${NAME}: Found ${duplicates.size} duplicates among ${root.listMaterials().length} materials.`\n\t);\n\n\tArray.from(duplicates.entries()).forEach(([src, dst]) => {\n\t\tsrc.listParents().forEach((property) => {\n\t\t\tif (!(property instanceof Root)) property.swap(src, dst);\n\t\t});\n\t\tsrc.dispose();\n\t});\n}\n\n/** Generates a key unique to the content of a primitive or target. */\nfunction createPrimitiveKey(\n\tprim: Primitive | PrimitiveTarget,\n\trefs: Map<Accessor|Material, number>\n): string {\n\tconst primKeyItems = [];\n\tfor (const semantic of prim.listSemantics()) {\n\t\tconst attribute = prim.getAttribute(semantic)!;\n\t\tprimKeyItems.push(semantic + ':' + refs.get(attribute));\n\t}\n\tif (prim instanceof Primitive) {\n\t\tconst indices = prim.getIndices();\n\t\tif (indices) {\n\t\t\tprimKeyItems.push('indices:' + refs.get(indices));\n\t\t}\n\t\tconst material = prim.getMaterial();\n\t\tif (material) {\n\t\t\tprimKeyItems.push('material:' + refs.get(material));\n\t\t}\n\t\tprimKeyItems.push('mode:' + prim.getMode());\n\t\tfor (const target of prim.listTargets()) {\n\t\t\tprimKeyItems.push('target:' + createPrimitiveKey(target, refs));\n\t\t}\n\t}\n\treturn primKeyItems.join(',');\n}\n","import type { Accessor, Document, Primitive, Transform } from '@gltf-transform/core';\nimport { MeshQuantization } from '@gltf-transform/extensions';\nimport { createTransform } from './utils';\n\nconst NAME = 'dequantize';\n\n/** Options for the {@link dequantize} function. */\nexport interface DequantizeOptions {\n\t/**\n\t * Pattern (regex) used to filter vertex attribute semantics for quantization.\n\t * Default: `/^((?!JOINTS_).)*$/`.\n\t */\n\tpattern?: RegExp;\n}\n\nconst DEQUANTIZE_DEFAULTS: DequantizeOptions = {\n\tpattern: /^((?!JOINTS_).)*$/,\n};\n\n/**\n * Dequantize {@link Primitive Primitives}, removing {@link MeshQuantization `KHR_mesh_quantization`}\n * if present. Dequantization will increase the size of the mesh on disk and in memory, but may be\n * necessary for compatibility with applications that don't support quantization.\n */\nexport function dequantize(_options: DequantizeOptions = DEQUANTIZE_DEFAULTS): Transform {\n\tconst options = { ...DEQUANTIZE_DEFAULTS, ..._options } as Required<DequantizeOptions>;\n\n\treturn createTransform(NAME, (doc: Document): void => {\n\t\tconst logger = doc.getLogger();\n\t\tfor (const mesh of doc.getRoot().listMeshes()) {\n\t\t\tfor (const prim of mesh.listPrimitives()) {\n\t\t\t\tdequantizePrimitive(prim, options);\n\t\t\t}\n\t\t}\n\t\tdoc.createExtension(MeshQuantization).dispose();\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t});\n}\n\nfunction dequantizePrimitive(prim: Primitive, options: Required<DequantizeOptions>): void {\n\tfor (const semantic of prim.listSemantics()) {\n\t\tdequantizeAttribute(semantic, prim.getAttribute(semantic)!, options);\n\t}\n\tfor (const target of prim.listTargets()) {\n\t\tfor (const semantic of target.listSemantics()) {\n\t\t\tdequantizeAttribute(semantic, target.getAttribute(semantic)!, options);\n\t\t}\n\t}\n}\n\nfunction dequantizeAttribute(semantic: string, attribute: Accessor, options: Required<DequantizeOptions>): void {\n\tif (!attribute.getArray()) return;\n\tif (!options.pattern.test(semantic)) return;\n\tif (attribute.getComponentSize() >= 4) return;\n\n\tconst srcArray = attribute.getArray()!;\n\tconst dstArray = new Float32Array(srcArray.length);\n\n\tfor (let i = 0, il = attribute.getCount(), el = [] as number[]; i < il; i++) {\n\t\tel = attribute.getElement(i, el);\n\t\tattribute.setArray(dstArray).setElement(i, el).setArray(srcArray);\n\t}\n\n\tattribute.setArray(dstArray).setNormalized(false);\n}\n","import { AnimationChannel, Document, Graph, Property, PropertyType, Root, Transform } from '@gltf-transform/core';\nimport { createTransform } from './utils';\n\nconst NAME = 'prune';\n\nexport interface PruneOptions {\n\t/** List of {@link PropertyType} identifiers to be de-duplicated.*/\n\tpropertyTypes?: string[];\n}\nconst PRUNE_DEFAULTS: Required<PruneOptions> = {\n\tpropertyTypes: [\n\t\tPropertyType.NODE,\n\t\tPropertyType.SKIN,\n\t\tPropertyType.MESH,\n\t\tPropertyType.CAMERA,\n\t\tPropertyType.PRIMITIVE,\n\t\tPropertyType.PRIMITIVE_TARGET,\n\t\tPropertyType.ANIMATION,\n\t\tPropertyType.MATERIAL,\n\t\tPropertyType.TEXTURE,\n\t\tPropertyType.ACCESSOR,\n\t\tPropertyType.BUFFER,\n\t]\n};\n\n/**\n * Removes properties from the file if they are not referenced by a {@link Scene}. Commonly helpful\n * for cleaning up after other operations, e.g. allowing a node to be detached and any unused\n * meshes, materials, or other resources to be removed automatically.\n *\n * Example:\n *\n * ```\n * document.getRoot().listMaterials(); //  [Material, Material]\n *\n * await document.transform(prune());\n *\n * document.getRoot().listMaterials(); //  [Material]\n * ```\n *\n * No options are currently implemented for this function.\n */\nexport const prune = function (_options: PruneOptions = PRUNE_DEFAULTS): Transform {\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tconst options = {...PRUNE_DEFAULTS, ..._options} as Required<PruneOptions>;\n\tconst propertyTypes = options.propertyTypes;\n\n\treturn createTransform(NAME, (doc: Document): void =>  {\n\t\tconst logger = doc.getLogger();\n\t\tconst root = doc.getRoot();\n\t\tconst graph = doc.getGraph();\n\n\t\tconst disposed: Record<string, number> = {};\n\n\t\t// Prune top-down, so that low-level properties like accessors can be removed if the\n\t\t// properties referencing them are removed.\n\n\t\tif (propertyTypes.includes(PropertyType.NODE)) root.listNodes().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.SKIN)) root.listSkins().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.MESH)) root.listMeshes().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.CAMERA)) root.listCameras().forEach(treeShake);\n\n\t\tif (propertyTypes.includes(PropertyType.PRIMITIVE)) {\n\t\t\tindirectTreeShake(graph, PropertyType.PRIMITIVE);\n\t\t}\n\t\tif (propertyTypes.includes(PropertyType.PRIMITIVE_TARGET)) {\n\t\t\tindirectTreeShake(graph, PropertyType.PRIMITIVE_TARGET);\n\t\t}\n\n\t\t// Pruning animations is a bit more complicated:\n\t\t// (1) Remove channels without target nodes.\n\t\t// (2) Remove animations without channels.\n\t\t// (3) Remove samplers orphaned in the process.\n\t\tif (propertyTypes.includes(PropertyType.ANIMATION)) {\n\t\t\tfor (const anim of root.listAnimations()) {\n\t\t\t\tfor (const channel of anim.listChannels()) {\n\t\t\t\t\tif (!channel.getTargetNode()) {\n\t\t\t\t\t\tchannel.dispose();\n\t\t\t\t\t\tmarkDisposed(channel);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!anim.listChannels().length) {\n\t\t\t\t\tconst samplers = anim.listSamplers();\n\t\t\t\t\ttreeShake(anim);\n\t\t\t\t\tsamplers.forEach(treeShake);\n\t\t\t\t} else {\n\t\t\t\t\tanim.listSamplers().forEach(treeShake);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (propertyTypes.includes(PropertyType.MATERIAL)) root.listMaterials().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.TEXTURE)) root.listTextures().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.ACCESSOR)) root.listAccessors().forEach(treeShake);\n\t\tif (propertyTypes.includes(PropertyType.BUFFER)) root.listBuffers().forEach(treeShake);\n\n\t\t// TODO(bug): This process does not identify unused ExtensionProperty instances. That could\n\t\t// be a future enhancement, either tracking unlinked properties as if they were connected\n\t\t// to the Graph, or iterating over a property list provided by the Extension. Properties in\n\t\t// use by an Extension are correctly preserved, in the meantime.\n\n\t\tif (Object.keys(disposed).length) {\n\t\t\tconst str = Object.keys(disposed).map((t) => `${t} (${disposed[t]})`).join(', ');\n\t\t\tlogger.info(`${NAME}: Removed types... ${str}`);\n\t\t} else {\n\t\t\tlogger.info(`${NAME}: No unused properties found.`);\n\t\t}\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\n\t\t//\n\n\t\t/** Disposes of the given property if it is unused. */\n\t\tfunction treeShake(prop: Property): void {\n\t\t\t// Consider a property unused if it has no references from another property, excluding\n\t\t\t// types Root and AnimationChannel.\n\t\t\tconst parents = prop.listParents()\n\t\t\t\t.filter((p) => !(p instanceof Root || p instanceof AnimationChannel));\n\t\t\tif (!parents.length) {\n\t\t\t\tprop.dispose();\n\t\t\t\tmarkDisposed(prop);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * For property types the Root does not maintain references to, we'll need to search the\n\t\t * graph. It's possible that objects may have been constructed without any outbound links,\n\t\t * but since they're not on the graph they don't need to be tree-shaken.\n\t\t */\n\t\tfunction indirectTreeShake(graph: Graph<Property>, propertyType: string): void {\n\t\t\tgraph.listEdges()\n\t\t\t\t.map((edge) => edge.getParent())\n\t\t\t\t.filter((parent) => parent.propertyType === propertyType)\n\t\t\t\t.forEach(treeShake);\n\t\t}\n\n\t\t/** Records properties disposed by type. */\n\t\tfunction markDisposed(prop: Property): void {\n\t\t\tdisposed[prop.propertyType] = disposed[prop.propertyType] || 0;\n\t\t\tdisposed[prop.propertyType]++;\n\t\t}\n\n\t});\n\n};\n","import {\n\tAccessor,\n\tAnimationChannel,\n\tbbox,\n\tDocument,\n\tLogger,\n\tmat4,\n\tMesh,\n\tNode,\n\tPrimitive,\n\tPrimitiveTarget,\n\tPropertyType,\n\tSkin,\n\tTransform,\n\tvec2,\n\tvec3,\n\tvec4,\n} from '@gltf-transform/core';\nimport { dedup } from './dedup';\nimport { fromRotationTranslationScale, fromScaling, invert, multiply as multiplyMat4 } from 'gl-matrix/mat4';\nimport { max, min, scale, transformMat4 } from 'gl-matrix/vec3';\nimport { MeshQuantization } from '@gltf-transform/extensions';\nimport type { Volume } from '@gltf-transform/extensions';\nimport { prune } from './prune';\nimport { createTransform } from './utils';\n\nconst NAME = 'quantize';\n\ntype TypedArrayConstructor =\n\t| Int8ArrayConstructor\n\t| Int16ArrayConstructor\n\t| Uint8ArrayConstructor\n\t| Uint16ArrayConstructor;\nconst SIGNED_INT = [Int8Array, Int16Array, Int32Array] as TypedArrayConstructor[];\n\nconst { TRANSLATION, ROTATION, SCALE, WEIGHTS } = AnimationChannel.TargetPath;\nconst TRS_CHANNELS = [TRANSLATION, ROTATION, SCALE];\n\n/** Options for the {@link quantize} function. */\nexport interface QuantizeOptions {\n\t/** Pattern (regex) used to filter vertex attribute semantics for quantization. Default: all. */\n\tpattern?: RegExp;\n\t/** Bounds for quantization grid. */\n\tquantizationVolume?: 'mesh' | 'scene';\n\t/** Quantization bits for `POSITION` attributes. */\n\tquantizePosition?: number;\n\t/** Quantization bits for `NORMAL` attributes. */\n\tquantizeNormal?: number;\n\t/** Quantization bits for `TEXCOORD_*` attributes. */\n\tquantizeTexcoord?: number;\n\t/** Quantization bits for `COLOR_*` attributes. */\n\tquantizeColor?: number;\n\t/** Quantization bits for `WEIGHT_*` attributes. */\n\tquantizeWeight?: number;\n\t/** Quantization bits for application-specific (`_*`) attributes. */\n\tquantizeGeneric?: number;\n}\n\nexport const QUANTIZE_DEFAULTS: Required<QuantizeOptions> = {\n\tpattern: /.*/,\n\tquantizationVolume: 'mesh',\n\tquantizePosition: 14,\n\tquantizeNormal: 10,\n\tquantizeTexcoord: 12,\n\tquantizeColor: 8,\n\tquantizeWeight: 8,\n\tquantizeGeneric: 12,\n};\n\n/**\n * References:\n * - https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n * - http://www.aclockworkberry.com/normal-unpacking-quantization-errors/\n * - https://www.mathworks.com/help/dsp/ref/uniformencoder.html\n * - https://oroboro.com/compressed-unit-vectors/\n */\n\n/**\n * Quantizes vertex attributes with `KHR_mesh_quantization`, reducing the size and memory footprint\n * of the file.\n */\nconst quantize = (_options: QuantizeOptions = QUANTIZE_DEFAULTS): Transform => {\n\tconst options = { ...QUANTIZE_DEFAULTS, ..._options } as Required<QuantizeOptions>;\n\n\treturn createTransform(NAME, async (doc: Document): Promise<void> => {\n\t\tconst logger = doc.getLogger();\n\t\tconst root = doc.getRoot();\n\n\t\tdoc.createExtension(MeshQuantization).setRequired(true);\n\n\t\t// Compute vertex position quantization volume.\n\t\tlet nodeTransform: VectorTransform<vec3> | undefined = undefined;\n\t\tif (options.quantizationVolume === 'scene') {\n\t\t\tnodeTransform = getNodeTransform(expandBounds(root.listMeshes().map(getPositionQuantizationVolume)));\n\t\t}\n\n\t\t// Quantize mesh primitives.\n\t\tfor (const mesh of doc.getRoot().listMeshes()) {\n\t\t\tif (options.quantizationVolume === 'mesh') {\n\t\t\t\tnodeTransform = getNodeTransform(getPositionQuantizationVolume(mesh));\n\t\t\t}\n\n\t\t\tif (nodeTransform && options.pattern.test('POSITION')) {\n\t\t\t\ttransformMeshParents(doc, mesh, nodeTransform);\n\t\t\t\ttransformMeshMaterials(mesh, 1 / nodeTransform.scale);\n\t\t\t}\n\n\t\t\tfor (const prim of mesh.listPrimitives()) {\n\t\t\t\tquantizePrimitive(doc, prim, nodeTransform!, options);\n\t\t\t\tfor (const target of prim.listTargets()) {\n\t\t\t\t\tquantizePrimitive(doc, target, nodeTransform!, options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait doc.transform(\n\t\t\tprune({ propertyTypes: [PropertyType.ACCESSOR, PropertyType.SKIN, PropertyType.MATERIAL] }),\n\t\t\tdedup({ propertyTypes: [PropertyType.ACCESSOR, PropertyType.MATERIAL] })\n\t\t);\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t});\n};\n\nfunction quantizePrimitive(\n\tdoc: Document,\n\tprim: Primitive | PrimitiveTarget,\n\tnodeTransform: VectorTransform<vec3>,\n\toptions: Required<QuantizeOptions>\n): void {\n\tconst logger = doc.getLogger();\n\n\tfor (const semantic of prim.listSemantics()) {\n\t\tif (!options.pattern.test(semantic)) continue;\n\n\t\tconst srcAttribute = prim.getAttribute(semantic)!;\n\t\tconst { bits, ctor } = getQuantizationSettings(semantic, srcAttribute, logger, options);\n\n\t\tif (!ctor) continue;\n\t\tif (bits < 8 || bits > 16) throw new Error(`${NAME}: Requires bits = 816.`);\n\t\tif (srcAttribute.getComponentSize() <= bits / 8) continue;\n\n\t\tconst dstAttribute = srcAttribute.clone();\n\n\t\t// Remap position data.\n\t\tif (semantic === 'POSITION') {\n\t\t\tconst scale = nodeTransform.scale;\n\t\t\tconst transform: mat4 = [] as unknown as mat4;\n\t\t\t// Morph targets are relative offsets, don't translate them.\n\t\t\tprim instanceof Primitive\n\t\t\t\t? invert(transform, fromTransform(nodeTransform))\n\t\t\t\t: fromScaling(transform, [1 / scale, 1 / scale, 1 / scale]);\n\t\t\tfor (let i = 0, el: vec3 = [0, 0, 0], il = dstAttribute.getCount(); i < il; i++) {\n\t\t\t\tdstAttribute.getElement(i, el);\n\t\t\t\tdstAttribute.setElement(i, transformMat4(el, el, transform) as vec3);\n\t\t\t}\n\t\t}\n\n\t\t// Quantize the vertex attribute.\n\t\tquantizeAttribute(dstAttribute, ctor, bits);\n\t\tprim.swap(srcAttribute, dstAttribute);\n\t}\n\n\t// Normalize skinning weights.\n\tif (prim.getAttribute('WEIGHTS_0')) {\n\t\tnormalizeWeights(prim);\n\t}\n\n\tif (\n\t\tprim instanceof Primitive &&\n\t\tprim.getIndices() &&\n\t\tprim.listAttributes().length &&\n\t\tprim.listAttributes()[0]!.getCount() < 65535\n\t) {\n\t\tconst indices = prim.getIndices()!;\n\t\tindices.setArray(new Uint16Array(indices.getArray()!));\n\t}\n}\n\n/** Computes node quantization transforms in local space. */\nfunction getNodeTransform(volume: bbox): VectorTransform<vec3> {\n\tconst { min, max } = volume;\n\n\t// Scaling factor transforms [-1,1] box to the mesh AABB in local space.\n\t// See: https://github.com/donmccurdy/glTF-Transform/issues/328\n\tconst scale = Math.max(\n\t\t(max[0] - min[0]) / 2, // Divide because interval [-1,1] has length 2.\n\t\t(max[1] - min[1]) / 2,\n\t\t(max[2] - min[2]) / 2\n\t);\n\n\t// Original center of the mesh, in local space.\n\tconst offset: vec3 = [\n\t\tmin[0] + (max[0] - min[0]) / 2,\n\t\tmin[1] + (max[1] - min[1]) / 2,\n\t\tmin[2] + (max[2] - min[2]) / 2,\n\t];\n\n\treturn { offset, scale };\n}\n\n/** Applies corrective scale and offset to nodes referencing a quantized Mesh. */\nfunction transformMeshParents(doc: Document, mesh: Mesh, nodeTransform: VectorTransform<vec3>): void {\n\tconst transformMatrix = fromTransform(nodeTransform);\n\tfor (const parent of mesh.listParents()) {\n\t\tif (!(parent instanceof Node)) continue;\n\n\t\tconst animChannels = parent.listParents().filter((p) => p instanceof AnimationChannel) as AnimationChannel[];\n\t\tconst isAnimated = animChannels.some((channel) => TRS_CHANNELS.includes(channel.getTargetPath()!));\n\t\tconst isParentNode = parent.listChildren().length > 0;\n\n\t\tif (parent.getSkin()) {\n\t\t\tparent.setSkin(transformSkin(parent.getSkin()!, nodeTransform));\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet targetNode: Node;\n\t\tif (isParentNode || isAnimated) {\n\t\t\ttargetNode = doc.createNode('').setMesh(mesh);\n\t\t\tparent.addChild(targetNode).setMesh(null);\n\t\t\tanimChannels\n\t\t\t\t.filter((channel) => channel.getTargetPath() === WEIGHTS)\n\t\t\t\t.forEach((channel) => channel.setTargetNode(targetNode));\n\t\t} else {\n\t\t\ttargetNode = parent;\n\t\t}\n\n\t\tconst nodeMatrix = targetNode.getMatrix();\n\t\tmultiplyMat4(nodeMatrix, nodeMatrix, transformMatrix);\n\t\ttargetNode.setMatrix(nodeMatrix);\n\t}\n}\n\n/** Applies corrective scale and offset to skin IBMs. */\nfunction transformSkin(skin: Skin, nodeTransform: VectorTransform<vec3>): Skin {\n\tskin = skin.clone();\n\tconst transformMatrix = fromTransform(nodeTransform);\n\tconst inverseBindMatrices = skin.getInverseBindMatrices()!.clone();\n\tconst ibm = [] as unknown as mat4;\n\tfor (let i = 0, count = inverseBindMatrices.getCount(); i < count; i++) {\n\t\tinverseBindMatrices.getElement(i, ibm);\n\t\tmultiplyMat4(ibm, ibm, transformMatrix);\n\t\tinverseBindMatrices.setElement(i, ibm);\n\t}\n\treturn skin.setInverseBindMatrices(inverseBindMatrices);\n}\n\n/** Applies corrective scale to volumetric materials, which give thickness in local units. */\nfunction transformMeshMaterials(mesh: Mesh, scale: number) {\n\tfor (const prim of mesh.listPrimitives()) {\n\t\tlet material = prim.getMaterial();\n\t\tif (!material) continue;\n\n\t\tlet volume = material.getExtension<Volume>('KHR_materials_volume');\n\t\tif (!volume || volume.getThicknessFactor() <= 0) continue;\n\n\t\t// prune()+dedup() will clean this up later.\n\t\tvolume = volume.clone().setThicknessFactor(volume.getThicknessFactor() * scale);\n\t\tmaterial = material.clone().setExtension('KHR_materials_volume', volume);\n\t\tprim.setMaterial(material);\n\t}\n}\n\n/**\n * Quantizes an attribute to the given parameters.\n *\n * Uniformly remap 32-bit floats to reduced-precision 8- or 16-bit integers, so\n * that there are only 2^N unique values, for N within [8, 16].\n *\n * See: https://github.com/donmccurdy/glTF-Transform/issues/208\n */\nfunction quantizeAttribute(attribute: Accessor, ctor: TypedArrayConstructor, bits: number): void {\n\tconst dstArray = new ctor(attribute.getArray()!.length);\n\n\tconst signBits = SIGNED_INT.includes(ctor) ? 1 : 0;\n\tconst quantBits = bits - signBits;\n\tconst storageBits = ctor.BYTES_PER_ELEMENT * 8 - signBits;\n\n\tconst scale = Math.pow(2, quantBits) - 1;\n\tconst lo = storageBits - quantBits;\n\tconst hi = 2 * quantBits - storageBits;\n\n\tfor (let i = 0, di = 0, el: number[] = []; i < attribute.getCount(); i++) {\n\t\tattribute.getElement(i, el);\n\t\tfor (let j = 0; j < el.length; j++) {\n\t\t\t// Map [0.0 ... 1.0] to [0 ... scale].\n\t\t\tlet value = Math.round(Math.abs(el[j]) * scale);\n\n\t\t\t// Replicate msb to missing lsb.\n\t\t\tvalue = (value << lo) | (value >> hi);\n\n\t\t\t// Restore sign.\n\t\t\tdstArray[di++] = value * Math.sign(el[j]);\n\t\t}\n\t}\n\n\tattribute.setArray(dstArray).setNormalized(true);\n}\n\nfunction getQuantizationSettings(\n\tsemantic: string,\n\tattribute: Accessor,\n\tlogger: Logger,\n\toptions: Required<QuantizeOptions>\n): { bits: number; ctor?: TypedArrayConstructor } {\n\tconst min = attribute.getMinNormalized([]);\n\tconst max = attribute.getMaxNormalized([]);\n\n\tlet bits: number;\n\tlet ctor: TypedArrayConstructor;\n\n\tif (semantic === 'POSITION') {\n\t\tbits = options.quantizePosition;\n\t\tctor = bits <= 8 ? Int8Array : Int16Array;\n\t} else if (semantic === 'NORMAL' || semantic === 'TANGENT') {\n\t\tbits = options.quantizeNormal;\n\t\tctor = bits <= 8 ? Int8Array : Int16Array;\n\t} else if (semantic.startsWith('COLOR_')) {\n\t\tbits = options.quantizeColor;\n\t\tctor = bits <= 8 ? Uint8Array : Uint16Array;\n\t} else if (semantic.startsWith('TEXCOORD_')) {\n\t\tif (min.some((v) => v < 0) || max.some((v) => v > 1)) {\n\t\t\tlogger.warn(`${NAME}: Skipping ${semantic}; out of [0,1] range.`);\n\t\t\treturn { bits: -1 };\n\t\t}\n\t\tbits = options.quantizeTexcoord;\n\t\tctor = bits <= 8 ? Uint8Array : Uint16Array;\n\t} else if (semantic.startsWith('JOINTS_')) {\n\t\tbits = Math.max(...attribute.getMax([])) <= 255 ? 8 : 16;\n\t\tctor = bits <= 8 ? Uint8Array : Uint16Array;\n\t\tif (attribute.getComponentSize() > bits / 8) {\n\t\t\tattribute.setArray(new ctor(attribute.getArray()!));\n\t\t}\n\t\treturn { bits: -1 };\n\t} else if (semantic.startsWith('WEIGHTS_')) {\n\t\tif (min.some((v) => v < 0) || max.some((v) => v > 1)) {\n\t\t\tlogger.warn(`${NAME}: Skipping ${semantic}; out of [0,1] range.`);\n\t\t\treturn { bits: -1 };\n\t\t}\n\t\tbits = options.quantizeWeight;\n\t\tctor = bits <= 8 ? Uint8Array : Uint16Array;\n\t} else if (semantic.startsWith('_')) {\n\t\tif (min.some((v) => v < -1) || max.some((v) => v > 1)) {\n\t\t\tlogger.warn(`${NAME}: Skipping ${semantic}; out of [-1,1] range.`);\n\t\t\treturn { bits: -1 };\n\t\t}\n\t\tbits = options.quantizeGeneric;\n\t\tctor = min.some((v) => v < 0)\n\t\t\t? (ctor = bits <= 8 ? Int8Array : Int16Array)\n\t\t\t: (ctor = bits <= 8 ? Uint8Array : Uint16Array);\n\t} else {\n\t\tthrow new Error(`${NAME}: Unexpected semantic, \"${semantic}\".`);\n\t}\n\n\treturn { bits, ctor };\n}\n\nfunction getPositionQuantizationVolume(mesh: Mesh): bbox {\n\tconst positions: Accessor[] = [];\n\tconst relativePositions: Accessor[] = [];\n\tfor (const prim of mesh.listPrimitives()) {\n\t\tconst attribute = prim.getAttribute('POSITION');\n\t\tif (attribute) positions.push(attribute);\n\t\tfor (const target of prim.listTargets()) {\n\t\t\tconst attribute = target.getAttribute('POSITION');\n\t\t\tif (attribute) relativePositions.push(attribute);\n\t\t}\n\t}\n\n\tif (positions.length === 0) {\n\t\tthrow new Error(`${NAME}: Missing \"POSITION\" attribute.`);\n\t}\n\n\tconst bbox = flatBounds<vec3>(positions, 3);\n\n\t// Morph target quantization volume is computed differently. First, ensure that the origin\n\t// <0, 0, 0> is in the quantization volume. Because we can't offset target positions (they're\n\t// relative deltas), default remapping will only map to a [-2, 2] AABB. Double the bounding box\n\t// to ensure scaling puts them within a [-1, 1] AABB instead.\n\tif (relativePositions.length > 0) {\n\t\tconst { min: relMin, max: relMax } = flatBounds<vec3>(relativePositions, 3);\n\t\tmin(bbox.min, bbox.min, min(relMin, scale(relMin, relMin, 2), [0, 0, 0]));\n\t\tmax(bbox.max, bbox.max, max(relMax, scale(relMax, relMax, 2), [0, 0, 0]));\n\t}\n\n\treturn bbox;\n}\n\n/** Computes total min and max of all Accessors in a list. */\nfunction flatBounds<T = vec2 | vec3>(accessors: Accessor[], elementSize: number): { min: T; max: T } {\n\tconst min: number[] = new Array(elementSize).fill(Infinity);\n\tconst max: number[] = new Array(elementSize).fill(-Infinity);\n\n\tconst tmpMin: number[] = [];\n\tconst tmpMax: number[] = [];\n\n\tfor (const accessor of accessors) {\n\t\taccessor.getMinNormalized(tmpMin);\n\t\taccessor.getMaxNormalized(tmpMax);\n\t\tfor (let i = 0; i < elementSize; i++) {\n\t\t\tmin[i] = Math.min(min[i], tmpMin[i]);\n\t\t\tmax[i] = Math.max(max[i], tmpMax[i]);\n\t\t}\n\t}\n\n\treturn { min, max } as unknown as { min: T; max: T };\n}\n\nfunction expandBounds(bboxes: bbox[]): bbox {\n\tconst result = bboxes[0];\n\tfor (const bbox of bboxes) {\n\t\tmin(result.min, result.min, bbox.min);\n\t\tmax(result.max, result.max, bbox.max);\n\t}\n\treturn result;\n}\n\ninterface VectorTransform<T = vec2 | vec3 | vec4> {\n\toffset: T;\n\tscale: number;\n}\n\nfunction fromTransform(transform: VectorTransform<vec3>): mat4 {\n\treturn fromRotationTranslationScale([] as unknown as mat4, [0, 0, 0, 1], transform.offset, [\n\t\ttransform.scale,\n\t\ttransform.scale,\n\t\ttransform.scale,\n\t]) as mat4;\n}\n\nfunction normalizeWeights(prim: Primitive | PrimitiveTarget): void {\n\tconst vertexCount = prim.getAttribute('POSITION')!.getCount();\n\tconst weightsEl: number[] = [];\n\n\tfor (let i = 0; i < vertexCount; i++) {\n\t\tlet vertexWeightsSum = 0;\n\n\t\tlet leastWeight = Infinity;\n\t\tlet leastIndex = -1;\n\t\tlet leastAttribute: Accessor | null = null;\n\n\t\tlet weights: Accessor | null;\n\t\tlet attributeIndex = 0;\n\n\t\t// Find sum of weights and the joint with the lowest non-zero weight.\n\t\twhile ((weights = prim.getAttribute(`WEIGHTS_${attributeIndex++}`))) {\n\t\t\tweights.getElement(i, weightsEl);\n\t\t\tfor (let j = 0; j < weightsEl.length; j++) {\n\t\t\t\tvertexWeightsSum += weightsEl[j];\n\t\t\t\tif (weightsEl[j] > 0 && weightsEl[j] < leastWeight) {\n\t\t\t\t\tleastAttribute = weights;\n\t\t\t\t\tleastWeight = weightsEl[j];\n\t\t\t\t\tleastIndex = j;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Normalize by updating least-significant joint weight.\n\t\tif (leastAttribute && vertexWeightsSum !== 1) {\n\t\t\tleastAttribute.getElement(i, weightsEl);\n\t\t\tweightsEl[leastIndex] += 1 - vertexWeightsSum;\n\t\t\tleastAttribute.setElement(i, weightsEl);\n\t\t}\n\t}\n}\n\nexport { quantize };\n","import { Document, TextureChannel, Transform } from '@gltf-transform/core';\nimport { TextureWebP } from '@gltf-transform/extensions';\nimport { getTextureChannelMask } from './list-texture-channels';\nimport { listTextureSlots } from './list-texture-slots';\nimport type { SquooshLib } from './types/squoosh-lib';\nimport { formatBytes } from './utils';\n\nenum Codec {\n\tOXIPNG = 'oxipng',\n\tMOZJPEG = 'mozjpeg',\n\tWEBP = 'webp',\n}\n\nconst CODEC_TO_MIME_TYPE: Record<Codec, string> = {\n\t[Codec.OXIPNG]: 'image/png',\n\t[Codec.MOZJPEG]: 'image/jpeg',\n\t[Codec.WEBP]: 'image/webp',\n};\n\n// TODO(feat): There are _many_ other encoder options for each of the\n// codecs provided here, but the options are mostly undocumented. If\n// anyone is willing to contribute documentation on what the options\n// are, I'm happy to expose more here.\n// See: https://github.com/GoogleChromeLabs/squoosh/blob/dev/libsquoosh/src/codecs.ts\nexport interface SquooshOptions {\n\tsquoosh: unknown;\n\tformats?: RegExp;\n\tslots?: RegExp;\n\tauto?: boolean;\n}\n\ninterface SquooshInternalOptions extends SquooshOptions {\n\tcodec: Codec;\n}\n\nconst SQUOOSH_DEFAULTS: Required<Omit<Omit<SquooshInternalOptions, 'codec'>, 'squoosh'>> = {\n\tformats: /.*/,\n\tslots: /.*/,\n\tauto: false,\n};\n\nconst WEBP_DEFAULTS: Omit<SquooshInternalOptions, 'squoosh'> = {\n\t...SQUOOSH_DEFAULTS,\n\tcodec: Codec.WEBP,\n};\nconst MOZJPEG_DEFAULTS: Omit<SquooshInternalOptions, 'squoosh'> = {\n\t...SQUOOSH_DEFAULTS,\n\tcodec: Codec.MOZJPEG,\n\tformats: /^image\\/jpeg$/,\n};\nconst OXIPNG_DEFAULTS: Omit<SquooshInternalOptions, 'squoosh'> = {\n\t...SQUOOSH_DEFAULTS,\n\tcodec: Codec.OXIPNG,\n\tformats: /^image\\/png$/,\n};\n\nconst SUPPORTED_MIME_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\nlet pool: SquooshLib.ImagePool | null = null;\nlet poolUsers = 0;\n\nconst requestImagePool = (squoosh: typeof SquooshLib): SquooshLib.ImagePool => {\n\tif (!pool) {\n\t\tpool = new squoosh.ImagePool(require('os').cpus().length);\n\t}\n\tpoolUsers++;\n\treturn pool;\n};\n\nconst releaseImagePool = (): void => {\n\tpoolUsers--;\n\tif (pool && poolUsers <= 0) {\n\t\tpool.close(); // Required for process to exit.\n\t\tpool = null;\n\t}\n};\n\n/** @internal Shared base for {@link webp()}, {@link mozjpeg()}, and {@link oxipng()}. */\nexport const squoosh = function (_options: SquooshInternalOptions): Transform {\n\tconst options = { ...SQUOOSH_DEFAULTS, ..._options } as Required<SquooshInternalOptions>;\n\tconst squoosh = options.squoosh as typeof SquooshLib | null;\n\tconst codec = options.codec;\n\n\tif (!squoosh) {\n\t\tthrow new Error(`${codec}: squoosh dependency required  install \"@squoosh/lib\".`);\n\t}\n\n\treturn async (document: Document): Promise<void> => {\n\t\tconst logger = document.getLogger();\n\t\tconst textures = document.getRoot().listTextures();\n\t\tconst pool = requestImagePool(squoosh);\n\n\t\tawait Promise.all(\n\t\t\ttextures.map(async (texture, textureIndex) => {\n\t\t\t\tconst slots = listTextureSlots(document, texture);\n\t\t\t\tconst channels = getTextureChannelMask(document, texture);\n\t\t\t\tconst textureLabel =\n\t\t\t\t\ttexture.getURI() ||\n\t\t\t\t\ttexture.getName() ||\n\t\t\t\t\t`${textureIndex + 1}/${document.getRoot().listTextures().length}`;\n\t\t\t\tconst prefix = `${codec}:texture(${textureLabel})`;\n\n\t\t\t\t// FILTER: Exclude textures that don't match (a) 'slots' or (b) expected formats.\n\n\t\t\t\tif (!SUPPORTED_MIME_TYPES.includes(texture.getMimeType())) {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, unsupported texture type \"${texture.getMimeType()}\".`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (!options.formats.test(texture.getMimeType())) {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, \"${texture.getMimeType()}\" excluded by \"formats\" parameter.`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (slots.length && !slots.some((slot) => options.slots.test(slot))) {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, [${slots.join(', ')}] excluded by \"slots\" parameter.`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (options.codec === Codec.MOZJPEG && channels & TextureChannel.A) {\n\t\t\t\t\tlogger.warn(`${prefix}: Skipping, [${slots.join(', ')}] requires alpha channel.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlogger.debug(`${prefix}: Slots  [${slots.join(', ')}]`);\n\n\t\t\t\t// COMPRESS: Run `squoosh/lib` library.\n\n\t\t\t\tconst image = pool.ingestImage(texture.getImage()!);\n\t\t\t\tconst srcByteLength = texture.getImage()!.byteLength;\n\n\t\t\t\tawait image.encode({ [options.codec]: options.auto ? 'auto' : {} });\n\n\t\t\t\tconst encodedImage = await image.encodedWith[options.codec];\n\n\t\t\t\tlogger.debug(`${prefix}: ${JSON.stringify(encodedImage.optionsUsed)}`);\n\n\t\t\t\ttexture.setImage(encodedImage.binary).setMimeType(CODEC_TO_MIME_TYPE[options.codec]);\n\t\t\t\tconst dstByteLength = encodedImage.binary.byteLength;\n\n\t\t\t\tlogger.debug(`${prefix}: ${formatBytes(srcByteLength)}  ${formatBytes(dstByteLength)}`);\n\t\t\t})\n\t\t);\n\n\t\treleaseImagePool();\n\n\t\tlogger.debug(`${codec}: Complete.`);\n\t};\n};\n\n/**\n * Converts images to WebP, using the {@link TextureWebP} extension.\n *\n * Requires `@squoosh/lib`, and currently works only in Node.js\n * environments. Support for encoding in web browsers may be available pending\n * [GoogleChromeLabs/squoosh#1084](https://github.com/GoogleChromeLabs/squoosh/issues/1084).\n *\n * Example:\n *\n * ```javascript\n * import * as squoosh from '@squoosh/lib';\n * import { webp } from '@gltf-transform/functions';\n *\n * await document.transform(\n * \twebp({ squoosh, auto: false })\n * );\n * ```\n */\nexport const webp = function (options: SquooshOptions): Transform {\n\tconst _options = { ...WEBP_DEFAULTS, ...options } as SquooshInternalOptions;\n\treturn async (document: Document): Promise<void> => {\n\t\tawait squoosh(_options)(document);\n\n\t\t// Attach EXT_texture_web if needed.\n\t\tconst textures = document.getRoot().listTextures();\n\t\tif (textures.some((texture) => texture.getMimeType() === CODEC_TO_MIME_TYPE[Codec.WEBP])) {\n\t\t\tdocument.createExtension(TextureWebP).setRequired(true);\n\t\t}\n\t};\n};\n\n/**\n * Optimizes JPEG images by default, optionally converting PNG textures to JPEG.\n *\n * Requires `@squoosh/lib`, and currently works only in Node.js\n * environments. Support for encoding in web browsers may be available pending\n * [GoogleChromeLabs/squoosh#1084](https://github.com/GoogleChromeLabs/squoosh/issues/1084).\n *\n * Example:\n *\n * ```javascript\n * import * as squoosh from '@squoosh/lib';\n * import { mozjpeg } from '@gltf-transform/functions';\n *\n * await document.transform(\n * \tmozjpeg({ squoosh, auto: false })\n * );\n * ```\n */\nexport const mozjpeg = function (options: SquooshOptions): Transform {\n\tconst _options = { ...MOZJPEG_DEFAULTS, ...options } as SquooshInternalOptions;\n\treturn (document: Document): void => {\n\t\treturn squoosh(_options)(document);\n\t};\n};\n\n/**\n * Optimizes PNG images by default, optionally converting JPEG textures to PNG.\n *\n * Requires `@squoosh/lib`, and currently works only in Node.js\n * environments. Support for encoding in web browsers may be available pending\n * [GoogleChromeLabs/squoosh#1084](https://github.com/GoogleChromeLabs/squoosh/issues/1084).\n *\n * Example:\n *\n * ```javascript\n * import * as squoosh from '@squoosh/lib';\n * import { oxipng } from '@gltf-transform/functions';\n *\n * await document.transform(\n * \toxipng({ squoosh, auto: false })\n * );\n * ```\n */\nexport const oxipng = function (options: SquooshOptions): Transform {\n\tconst _options = { ...OXIPNG_DEFAULTS, ...options } as SquooshInternalOptions;\n\treturn (document: Document): void => {\n\t\treturn squoosh(_options)(document);\n\t};\n};\n","import ndarray from 'ndarray';\nimport { lanczos2, lanczos3 } from 'ndarray-lanczos';\nimport { getPixels, savePixels } from 'ndarray-pixels';\nimport type { Document, Transform, vec2 } from '@gltf-transform/core';\nimport { createTransform } from './utils';\n\nconst NAME = 'textureResize';\n\n/** Options for the {@link textureResize} function. */\nexport interface TextureResizeOptions {\n\t/**\n\t * Maximum width/height to enforce, preserving aspect ratio. For example,\n\t * a 4096x8192 texture, resized with limit [2048, 2048] will be reduced\n\t * to 1024x2048.\n\t */\n\tsize: vec2;\n\t/** Resampling filter method. LANCZOS3 is sharper, LANCZOS2 is smoother. */\n\tfilter?: TextureResizeFilter;\n\t/** Pattern identifying textures to resize, matched to name or URI. */\n\tpattern?: RegExp | null;\n}\n\n/** Resampling filter methods. LANCZOS3 is sharper, LANCZOS2 is smoother. */\nexport enum TextureResizeFilter {\n\t/** Lanczos3 (sharp) */\n\tLANCZOS3 = 'lanczos3',\n\t/** Lanczos2 (smooth) */\n\tLANCZOS2 = 'lanczos2',\n}\n\nexport const TEXTURE_RESIZE_DEFAULTS: TextureResizeOptions = {\n\tsize: [2048, 2048],\n\tfilter: TextureResizeFilter.LANCZOS3,\n\tpattern: null,\n};\n\n/**\n * Resize PNG or JPEG {@link Texture Textures}, with {@link https://en.wikipedia.org/wiki/Lanczos_algorithm Lanczos filtering}.\n * Implementation provided by {@link https://github.com/donmccurdy/ndarray-lanczos ndarray-lanczos} package.\n */\nexport function textureResize(_options: TextureResizeOptions = TEXTURE_RESIZE_DEFAULTS): Transform {\n\tconst options = { ...TEXTURE_RESIZE_DEFAULTS, ..._options } as Required<TextureResizeOptions>;\n\n\treturn createTransform(NAME, async (doc: Document): Promise<void> => {\n\t\tconst logger = doc.getLogger();\n\n\t\tfor (const texture of doc.getRoot().listTextures()) {\n\t\t\tconst name = texture.getName();\n\t\t\tconst uri = texture.getURI();\n\t\t\tconst match = !options.pattern || options.pattern.test(name) || options.pattern.test(uri);\n\t\t\tif (!match) continue;\n\n\t\t\tif (texture.getMimeType() !== 'image/png' && texture.getMimeType() !== 'image/jpeg') {\n\t\t\t\tlogger.warn(`Skipping unsupported texture type, \"${texture.getMimeType()}\".`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst [maxWidth, maxHeight] = options.size;\n\t\t\tconst [srcWidth, srcHeight] = texture.getSize()!;\n\n\t\t\tif (srcWidth <= maxWidth && srcHeight <= maxHeight) {\n\t\t\t\tlogger.debug(`${NAME}: Skipping \"${uri || name}\", within size range.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet dstWidth = srcWidth;\n\t\t\tlet dstHeight = srcHeight;\n\n\t\t\tif (dstWidth > maxWidth) {\n\t\t\t\tdstHeight = Math.floor(dstHeight * (maxWidth / dstWidth));\n\t\t\t\tdstWidth = maxWidth;\n\t\t\t}\n\n\t\t\tif (dstHeight > maxHeight) {\n\t\t\t\tdstWidth = Math.floor(dstWidth * (maxHeight / dstHeight));\n\t\t\t\tdstHeight = maxHeight;\n\t\t\t}\n\n\t\t\tconst srcImage = texture.getImage()!;\n\t\t\tconst srcPixels = await getPixels(srcImage, texture.getMimeType());\n\t\t\tconst dstPixels = ndarray(new Uint8Array(dstWidth * dstHeight * 4), [dstWidth, dstHeight, 4]);\n\n\t\t\tlogger.debug(`${NAME}: Resizing \"${uri || name}\", ${srcPixels.shape}  ${dstPixels.shape}...`);\n\n\t\t\ttry {\n\t\t\t\toptions.filter === TextureResizeFilter.LANCZOS3\n\t\t\t\t\t? lanczos3(srcPixels, dstPixels)\n\t\t\t\t\t: lanczos2(srcPixels, dstPixels);\n\t\t\t} catch (e) {\n\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\tlogger.warn(`${NAME}: Failed to resize \"${uri || name}\": \"${e.message}\".`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\ttexture.setImage(await savePixels(dstPixels, texture.getMimeType()));\n\t\t}\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t});\n}\n","import type { Document, Transform } from '@gltf-transform/core';\nimport { MaterialsUnlit } from '@gltf-transform/extensions';\n\nexport const unlit = (): Transform => {\n\treturn (doc: Document): void => {\n\t\tconst unlitExtension = doc.createExtension(MaterialsUnlit) as MaterialsUnlit;\n\t\tconst unlit = unlitExtension.createUnlit();\n\t\tdoc.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tmaterial.setExtension('KHR_materials_unlit', unlit);\n\t\t\t});\n\t};\n};\n","import { Accessor, Document, Primitive, PrimitiveTarget, Transform, TypedArray } from '@gltf-transform/core';\nimport { createTransform } from './utils';\n\nconst NAME = 'weld';\n\n/** Options for the {@link weld} function. */\nexport interface WeldOptions {\n\t/** Per-attribute tolerance used when merging similar vertices. */\n\ttolerance?: number;\n}\n\nconst WELD_DEFAULTS: Required<WeldOptions> = { tolerance: 1e-4 };\n\n/**\n * Index {@link Primitive}s and (optionally) merge similar vertices.\n */\nexport function weld(_options: WeldOptions = WELD_DEFAULTS): Transform {\n\tconst options = { ...WELD_DEFAULTS, ..._options } as Required<WeldOptions>;\n\n\treturn createTransform(NAME, (doc: Document): void => {\n\t\tconst logger = doc.getLogger();\n\n\t\tfor (const mesh of doc.getRoot().listMeshes()) {\n\t\t\tfor (const prim of mesh.listPrimitives()) {\n\t\t\t\tif (prim.getMode() === Primitive.Mode.POINTS) {\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (options.tolerance === 0) {\n\t\t\t\t\tweldOnly(doc, prim);\n\t\t\t\t} else {\n\t\t\t\t\tweldAndMerge(doc, prim, options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t});\n}\n\n/**  In-place weld, adds indices without changing number of vertices. */\nfunction weldOnly(doc: Document, prim: Primitive): void {\n\tif (prim.getIndices()) return;\n\tconst attr = prim.listAttributes()[0];\n\tconst numVertices = attr.getCount();\n\tconst buffer = attr.getBuffer();\n\tconst indicesArray = numVertices <= 65534 ? new Uint16Array(numVertices) : new Uint32Array(numVertices);\n\tconst indices = doc.createAccessor().setBuffer(buffer).setType(Accessor.Type.SCALAR).setArray(indicesArray);\n\tfor (let i = 0; i < indices.getCount(); i++) indices.setScalar(i, i);\n\tprim.setIndices(indices);\n}\n\n/**\n * Weld and merge, combining vertices that are similar on all vertex attributes. Morph target\n * attributes are not considered when scoring vertex similarity, but are retained when merging.\n */\nfunction weldAndMerge(doc: Document, prim: Primitive, options: Required<WeldOptions>): void {\n\tconst tolerance = Math.max(options.tolerance, Number.EPSILON);\n\tconst decimalShift = Math.log10(1 / tolerance);\n\tconst shiftFactor = Math.pow(10, decimalShift);\n\n\tconst hashToIndex: { [key: string]: number } = {};\n\tconst srcIndices = prim.getIndices();\n\tconst vertexCount = srcIndices ? srcIndices.getCount() : prim.listAttributes()[0].getCount();\n\n\t// Prepare storage for new elements of each attribute.\n\tconst dstAttributes = new Map<Accessor, number[][]>();\n\tprim.listAttributes().forEach((attr) => dstAttributes.set(attr, []));\n\tprim.listTargets().forEach((target) => {\n\t\ttarget.listAttributes().forEach((attr) => dstAttributes.set(attr, []));\n\t});\n\n\tconst dstIndicesArray = [];\n\tlet nextIndex = 0;\n\n\t// For each vertex, compute a hash based on its tolerance and merge with any sufficiently\n\t// similar vertices.\n\tfor (let i = 0; i < vertexCount; i++) {\n\t\tconst index = srcIndices ? srcIndices.getScalar(i) : i;\n\n\t\tconst hashElements: number[] = [];\n\t\tconst el: number[] = [];\n\t\tfor (const attribute of prim.listAttributes()) {\n\t\t\tfor (let j = 0; j < attribute.getElementSize(); j++) {\n\t\t\t\thashElements.push(~~(attribute.getElement(index, el)[j] * shiftFactor));\n\t\t\t}\n\t\t}\n\n\t\tconst hash = hashElements.join('|');\n\t\tif (hash in hashToIndex) {\n\t\t\tdstIndicesArray.push(hashToIndex[hash]);\n\t\t} else {\n\t\t\tfor (const attr of prim.listAttributes()) {\n\t\t\t\tdstAttributes.get(attr)!.push(attr.getElement(index, []));\n\t\t\t}\n\t\t\tfor (const target of prim.listTargets()) {\n\t\t\t\tfor (const attr of target.listAttributes()) {\n\t\t\t\t\tdstAttributes.get(attr)!.push(attr.getElement(index, []));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thashToIndex[hash] = nextIndex;\n\t\t\tdstIndicesArray.push(nextIndex);\n\t\t\tnextIndex++;\n\t\t}\n\t}\n\n\tconst srcVertexCount = prim.listAttributes()[0].getCount();\n\tconst dstVertexCount = dstAttributes.get(prim.getAttribute('POSITION')!)!.length;\n\tdoc.getLogger().debug(`${NAME}: ${srcVertexCount}  ${dstVertexCount} vertices.`);\n\n\t// Update the primitive.\n\tfor (const srcAttr of prim.listAttributes()) {\n\t\tswapAttributes(prim, srcAttr, dstAttributes.get(srcAttr)!);\n\n\t\t// Clean up.\n\t\tif (srcAttr.listParents().length === 1) srcAttr.dispose();\n\t}\n\tfor (const target of prim.listTargets()) {\n\t\tfor (const srcAttr of target.listAttributes()) {\n\t\t\tswapAttributes(target, srcAttr, dstAttributes.get(srcAttr)!);\n\n\t\t\t// Clean up.\n\t\t\tif (srcAttr.listParents().length === 1) srcAttr.dispose();\n\t\t}\n\t}\n\tif (srcIndices) {\n\t\tconst dstIndicesTypedArray = createArrayOfType(srcIndices.getArray()!, dstIndicesArray.length);\n\t\tdstIndicesTypedArray.set(dstIndicesArray);\n\t\tprim.setIndices(srcIndices.clone().setArray(dstIndicesTypedArray));\n\n\t\t// Clean up.\n\t\tif (srcIndices.listParents().length === 1) srcIndices.dispose();\n\t} else {\n\t\tconst indicesArray =\n\t\t\tsrcVertexCount <= 65534 ? new Uint16Array(dstIndicesArray) : new Uint32Array(dstIndicesArray);\n\t\tprim.setIndices(doc.createAccessor().setArray(indicesArray));\n\t}\n}\n\n/** Creates a new TypedArray of the same type as an original, with a new length. */\nfunction createArrayOfType<T extends TypedArray>(array: T, length: number): T {\n\tconst ArrayCtor = array.constructor as new (length: number) => T;\n\treturn new ArrayCtor(length);\n}\n\n/** Replaces an {@link Attribute}, creating a new one with the given elements. */\nfunction swapAttributes(parent: Primitive | PrimitiveTarget, srcAttr: Accessor, dstAttrElements: number[][]): void {\n\tconst dstAttrArrayLength = dstAttrElements.length * srcAttr.getElementSize();\n\tconst dstAttrArray = createArrayOfType(srcAttr.getArray()!, dstAttrArrayLength);\n\tconst dstAttr = srcAttr.clone().setArray(dstAttrArray);\n\n\tfor (let i = 0; i < dstAttrElements.length; i++) {\n\t\tdstAttr.setElement(i, dstAttrElements[i]);\n\t}\n\n\tparent.swap(srcAttr, dstAttr);\n}\n","// This file is part of meshoptimizer library and is distributed under the terms of MIT License.\n// Copyright (C) 2016-2021, by Arseny Kapoulkine (arseny.kapoulkine@gmail.com)\nvar MeshoptEncoder = (function() {\n\t\"use strict\";\n\n\t// Built with clang version 11.0.0 (https://github.com/llvm/llvm-project 176249bd6732a8044d457092ed932768724a6f06)\n\t// Built from meshoptimizer 0.17\n\tvar wasm = \"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\";\n\n\t// Used to unpack wasm\n\tvar wasmpack = new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);\n\n\tif (typeof WebAssembly !== 'object') {\n\t\t// This module requires WebAssembly to function\n\t\treturn {\n\t\t\tsupported: false,\n\t\t};\n\t}\n\n\tvar instance;\n\n\tvar promise =\n\t\tWebAssembly.instantiate(unpack(wasm), {})\n\t\t.then(function(result) {\n\t\t\tinstance = result.instance;\n\t\t\tinstance.exports.__wasm_call_ctors();\n\t\t\tinstance.exports.meshopt_encodeVertexVersion(0);\n\t\t\tinstance.exports.meshopt_encodeIndexVersion(1);\n\t\t});\n\n\tfunction unpack(data) {\n\t\tvar result = new Uint8Array(data.length);\n\t\tfor (var i = 0; i < data.length; ++i) {\n\t\t\tvar ch = data.charCodeAt(i);\n\t\t\tresult[i] = ch > 96 ? ch - 71 : ch > 64 ? ch - 65 : ch > 47 ? ch + 4 : ch > 46 ? 63 : 62;\n\t\t}\n\t\tvar write = 0;\n\t\tfor (var i = 0; i < data.length; ++i) {\n\t\t\tresult[write++] = (result[i] < 60) ? wasmpack[result[i]] : (result[i] - 60) * 64 + result[++i];\n\t\t}\n\t\treturn result.buffer.slice(0, write);\n\t}\n\n\tfunction assert(cond) {\n\t\tif (!cond) {\n\t\t\tthrow new Error(\"Assertion failed\");\n\t\t}\n\t}\n\n\tfunction reorder(indices, vertices, optf) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar ip = sbrk(indices.length * 4);\n\t\tvar rp = sbrk(vertices * 4);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\tvar indices8 = new Uint8Array(indices.buffer, indices.byteOffset, indices.byteLength);\n\t\theap.set(indices8, ip);\n\t\tif (optf) {\n\t\t\toptf(ip, ip, indices.length, vertices);\n\t\t}\n\t\tvar unique = instance.exports.meshopt_optimizeVertexFetchRemap(rp, ip, indices.length, vertices);\n\t\t// heap may have grown\n\t\theap = new Uint8Array(instance.exports.memory.buffer);\n\t\tvar remap = new Uint32Array(vertices);\n\t\tnew Uint8Array(remap.buffer).set(heap.subarray(rp, rp + vertices * 4));\n\t\tindices8.set(heap.subarray(ip, ip + indices.length * 4));\n\t\tsbrk(ip - sbrk(0));\n\n\t\tfor (var i = 0; i < indices.length; ++i)\n\t\t\tindices[i] = remap[indices[i]];\n\n\t\treturn [remap, unique];\n\t}\n\n\tfunction encode(fun, bound, source, count, size) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar tp = sbrk(bound);\n\t\tvar sp = sbrk(count * size);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\theap.set(new Uint8Array(source.buffer, source.byteOffset, source.byteLength), sp);\n\t\tvar res = fun(tp, bound, sp, count, size);\n\t\tvar target = new Uint8Array(res);\n\t\ttarget.set(heap.subarray(tp, tp + res));\n\t\tsbrk(tp - sbrk(0));\n\t\treturn target;\n\t}\n\n\tfunction maxindex(source) {\n\t\tvar result = 0;\n\t\tfor (var i = 0; i < source.length; ++i) {\n\t\t\tvar index = source[i];\n\t\t\tresult = result < index ? index : result;\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction index32(source, size) {\n\t\tassert(size == 2 || size == 4);\n\t\tif (size == 4) {\n\t\t\treturn new Uint32Array(source.buffer, source.byteOffset, source.byteLength / 4);\n\t\t} else {\n\t\t\tvar view = new Uint16Array(source.buffer, source.byteOffset, source.byteLength / 2);\n\t\t\treturn new Uint32Array(view); // copies each element\n\t\t}\n\t}\n\n\tfunction filter(fun, source, count, stride, bits, insize) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar tp = sbrk(count * stride);\n\t\tvar sp = sbrk(count * insize);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\theap.set(new Uint8Array(source.buffer, source.byteOffset, source.byteLength), sp);\n\t\tfun(tp, count, stride, bits, sp);\n\t\tvar target = new Uint8Array(count * stride);\n\t\ttarget.set(heap.subarray(tp, tp + count * stride));\n\t\tsbrk(tp - sbrk(0));\n\t\treturn target;\n\t}\n\n\treturn {\n\t\tready: promise,\n\t\tsupported: true,\n\t\treorderMesh: function(indices, triangles, optsize) {\n\t\t\tvar optf = triangles ? (optsize ? instance.exports.meshopt_optimizeVertexCacheStrip : instance.exports.meshopt_optimizeVertexCache) : undefined;\n\t\t\treturn reorder(indices, maxindex(indices) + 1, optf);\n\t\t},\n\t\tencodeVertexBuffer: function(source, count, size) {\n\t\t\tassert(size > 0 && size <= 256);\n\t\t\tassert(size % 4 == 0);\n\t\t\tvar bound = instance.exports.meshopt_encodeVertexBufferBound(count, size);\n\t\t\treturn encode(instance.exports.meshopt_encodeVertexBuffer, bound, source, count, size);\n\t\t},\n\t\tencodeIndexBuffer: function(source, count, size) {\n\t\t\tassert(size == 2 || size == 4);\n\t\t\tassert(count % 3 == 0);\n\t\t\tvar indices = index32(source, size);\n\t\t\tvar bound = instance.exports.meshopt_encodeIndexBufferBound(count, maxindex(indices) + 1);\n\t\t\treturn encode(instance.exports.meshopt_encodeIndexBuffer, bound, indices, count, 4);\n\t\t},\n\t\tencodeIndexSequence: function(source, count, size) {\n\t\t\tassert(size == 2 || size == 4);\n\t\t\tvar indices = index32(source, size);\n\t\t\tvar bound = instance.exports.meshopt_encodeIndexSequenceBound(count, maxindex(indices) + 1);\n\t\t\treturn encode(instance.exports.meshopt_encodeIndexSequence, bound, indices, count, 4);\n\t\t},\n\t\tencodeGltfBuffer: function(source, count, size, mode) {\n\t\t\tvar table = {\n\t\t\t\tATTRIBUTES: this.encodeVertexBuffer,\n\t\t\t\tTRIANGLES: this.encodeIndexBuffer,\n\t\t\t\tINDICES: this.encodeIndexSequence,\n\t\t\t};\n\t\t\tassert(table[mode]);\n\t\t\treturn table[mode](source, count, size);\n\t\t},\n\t\tencodeFilterOct: function(source, count, stride, bits) {\n\t\t\tassert(stride == 4 || stride == 8);\n\t\t\tassert(bits >= 1 && bits <= 16);\n\t\t\treturn filter(instance.exports.meshopt_encodeFilterOct, source, count, stride, bits, 16);\n\t\t},\n\t\tencodeFilterQuat: function(source, count, stride, bits) {\n\t\t\tassert(stride == 8);\n\t\t\tassert(bits >= 4 && bits <= 16);\n\t\t\treturn filter(instance.exports.meshopt_encodeFilterQuat, source, count, stride, bits, 16);\n\t\t},\n\t\tencodeFilterExp: function(source, count, stride, bits) {\n\t\t\tassert(stride > 0 && stride % 4 == 0);\n\t\t\tassert(bits >= 1 && bits <= 24);\n\t\t\treturn filter(instance.exports.meshopt_encodeFilterExp, source, count, stride, bits, stride);\n\t\t},\n\t};\n})();\n\nexport { MeshoptEncoder };\n","// This file is part of meshoptimizer library and is distributed under the terms of MIT License.\n// Copyright (C) 2016-2021, by Arseny Kapoulkine (arseny.kapoulkine@gmail.com)\nvar MeshoptDecoder = (function() {\n\t\"use strict\";\n\n\t// Built with clang version 11.0.0 (https://github.com/llvm/llvm-project 176249bd6732a8044d457092ed932768724a6f06)\n\t// Built from meshoptimizer 0.17\n\tvar wasm_base = \"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\";\n\tvar wasm_simd = \"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\";\n\n\t// Uses bulk-memory and simd extensions\n\tvar detector = new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);\n\n\t// Used to unpack wasm\n\tvar wasmpack = new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);\n\n\tif (typeof WebAssembly !== 'object') {\n\t\t// This module requires WebAssembly to function\n\t\treturn {\n\t\t\tsupported: false,\n\t\t};\n\t}\n\n\tvar wasm = wasm_base;\n\n\tif (WebAssembly.validate(detector)) {\n\t\twasm = wasm_simd;\n\t}\n\n\tvar instance;\n\n\tvar promise =\n\t\tWebAssembly.instantiate(unpack(wasm), {})\n\t\t.then(function(result) {\n\t\t\tinstance = result.instance;\n\t\t\tinstance.exports.__wasm_call_ctors();\n\t\t});\n\n\tfunction unpack(data) {\n\t\tvar result = new Uint8Array(data.length);\n\t\tfor (var i = 0; i < data.length; ++i) {\n\t\t\tvar ch = data.charCodeAt(i);\n\t\t\tresult[i] = ch > 96 ? ch - 71 : ch > 64 ? ch - 65 : ch > 47 ? ch + 4 : ch > 46 ? 63 : 62;\n\t\t}\n\t\tvar write = 0;\n\t\tfor (var i = 0; i < data.length; ++i) {\n\t\t\tresult[write++] = (result[i] < 60) ? wasmpack[result[i]] : (result[i] - 60) * 64 + result[++i];\n\t\t}\n\t\treturn result.buffer.slice(0, write);\n\t}\n\n\tfunction decode(fun, target, count, size, source, filter) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar count4 = (count + 3) & ~3; // pad for SIMD filter\n\t\tvar tp = sbrk(count4 * size);\n\t\tvar sp = sbrk(source.length);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\theap.set(source, sp);\n\t\tvar res = fun(tp, count, size, sp, source.length);\n\t\tif (res == 0 && filter) {\n\t\t\tfilter(tp, count4, size);\n\t\t}\n\t\ttarget.set(heap.subarray(tp, tp + count * size));\n\t\tsbrk(tp - sbrk(0));\n\t\tif (res != 0) {\n\t\t\tthrow new Error(\"Malformed buffer data: \" + res);\n\t\t}\n\t};\n\n\tvar filters = {\n\t\t// legacy index-based enums for glTF\n\t\t0: \"\",\n\t\t1: \"meshopt_decodeFilterOct\",\n\t\t2: \"meshopt_decodeFilterQuat\",\n\t\t3: \"meshopt_decodeFilterExp\",\n\t\t// string-based enums for glTF\n\t\tNONE: \"\",\n\t\tOCTAHEDRAL: \"meshopt_decodeFilterOct\",\n\t\tQUATERNION: \"meshopt_decodeFilterQuat\",\n\t\tEXPONENTIAL: \"meshopt_decodeFilterExp\",\n\t};\n\n\tvar decoders = {\n\t\t// legacy index-based enums for glTF\n\t\t0: \"meshopt_decodeVertexBuffer\",\n\t\t1: \"meshopt_decodeIndexBuffer\",\n\t\t2: \"meshopt_decodeIndexSequence\",\n\t\t// string-based enums for glTF\n\t\tATTRIBUTES: \"meshopt_decodeVertexBuffer\",\n\t\tTRIANGLES: \"meshopt_decodeIndexBuffer\",\n\t\tINDICES: \"meshopt_decodeIndexSequence\",\n\t};\n\n\treturn {\n\t\tready: promise,\n\t\tsupported: true,\n\t\tdecodeVertexBuffer: function(target, count, size, source, filter) {\n\t\t\tdecode(instance.exports.meshopt_decodeVertexBuffer, target, count, size, source, instance.exports[filters[filter]]);\n\t\t},\n\t\tdecodeIndexBuffer: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexBuffer, target, count, size, source);\n\t\t},\n\t\tdecodeIndexSequence: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexSequence, target, count, size, source);\n\t\t},\n\t\tdecodeGltfBuffer: function(target, count, size, source, mode, filter) {\n\t\t\tdecode(instance.exports[decoders[mode]], target, count, size, source, instance.exports[filters[filter]]);\n\t\t}\n\t};\n})();\n\nexport { MeshoptDecoder };\n","/* @license\n * Copyright 2020  Dassault Systemes - All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events'\n\nimport { SimpleDropzone } from 'simple-dropzone';\nimport { ThreeRenderer } from './three_renderer';\nimport { PathtracingRenderer, ThreeSceneAdapter } from 'dspbr-pt';\n\nimport { PerspectiveCamera, Box3, Vector3, Scene, Mesh, FloatType, MOUSE, MeshStandardMaterial, PlaneBufferGeometry } from 'three';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { GLTF } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { loadSceneFromBlobs, loadSceneFromUrl } from './scene_loader';\n\nif (!window.File || !window.FileReader || !window.FileList || !window.Blob) {\n  alert('The File APIs are not fully supported in this browser.');\n}\n\nexport class DemoViewer extends EventEmitter {\n  private canvas: HTMLCanvasElement;\n  private canvas_three: HTMLCanvasElement;\n  private canvas_pt: HTMLCanvasElement;\n  private spinner: HTMLElement;\n  private container?: HTMLElement;\n  private startpage?: HTMLElement;\n  private status?: HTMLElement;\n  private loadscreen?: HTMLElement;\n  // private scene: string;\n  private camera: PerspectiveCamera;\n  private controls: OrbitControls;\n  private sceneBoundingBox?: Box3;\n  private sceneAdapter?: ThreeSceneAdapter;\n\n  private autoScaleScene = false;\n  private interactionTimeoutId = null;\n  private tileRes = 4;\n\n  private three_renderer: ThreeRenderer;\n\n  private _renderer: PathtracingRenderer;\n  public get renderer() {\n    return this._renderer;\n  }\n\n  private _fps = 0.0;\n  public get fps() {\n    return this._fps;\n  }\n\n  public get autoRotate() {\n    return this.controls.autoRotate;\n  }\n  public set autoRotate(flag: boolean) {\n    this.toggleInteractionMode(flag);\n    this.controls.autoRotate = flag;\n  }\n\n  private _pathtracing = true;\n  public get togglePathtracing() {\n    return this._pathtracing;\n  }\n  public set togglePathtracing(flag: boolean) {\n    if (flag) {\n      this.startPathtracing();\n    } else {\n      this.startRasterizer();\n    }\n    this._pathtracing = flag;\n  }\n\n  private _pixelRatio = 1.0;\n  public get pixelRatio() {\n    return this._pixelRatio;\n  }\n  public set pixelRatio(val: number) {\n    this._pixelRatio = val;\n    this._renderer.pixelRatio = val;\n  }\n\n  private _pathtracedInteraction = true;\n  public get pathtracedInteraction() {\n    return this._pathtracedInteraction;\n  }\n  public set pathtracedInteraction(flag: boolean) {\n    this._pathtracedInteraction = flag;\n  }\n\n  private _interactionPixelRatio = 0.1;\n  public set interactionPixelRatio(val: number) {\n    this._interactionPixelRatio = val;\n  }\n  public get interactionPixelRatio() {\n    return this._interactionPixelRatio;\n  }\n\n  private _showGroundPlane = false;\n  public set showGroundPlane(val: boolean) {\n    this._showGroundPlane = val;\n  }\n\n  constructor(params: { container: HTMLElement }) {\n    super(); // EventEmitter\n    this.container = params.container;\n    document.body.appendChild(this.container);\n    this.canvas = document.createElement('canvas');\n    this.container.appendChild(this.canvas);\n\n    this.startpage = document.getElementById(\"startpage\")!;\n    this.loadscreen = document.getElementById(\"loadscreen\")!;\n    this.status = document.getElementById(\"status\")!;\n    this.spinner = document.getElementsByClassName('spinner')[0] as HTMLElement;\n\n    this.canvas_pt = document.createElement('canvas');\n    this.canvas_three = document.createElement('canvas');\n\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.canvas_pt.width = window.innerWidth;\n    this.canvas_pt.height = window.innerHeight;\n    this.canvas_three.width = window.innerWidth;\n    this.canvas_three.height = window.innerHeight;\n\n    let aspect = window.innerWidth / window.innerHeight;\n    this.camera = new PerspectiveCamera(45, aspect, 0.01, 1000);\n\n    this.controls = new OrbitControls(this.camera, this.canvas);\n    this.controls.screenSpacePanning = true;\n    this.controls.enableDamping = false;\n    this.controls.rotateSpeed = 2.0;\n    this.controls.panSpeed = 2.0;\n\n    this.controls.addEventListener('change', () => {\n      this.camera.updateMatrixWorld();\n      this._renderer.resetAccumulation();\n    });\n\n    this.controls.addEventListener('start', () => {\n      if (this._pathtracing) {\n        if (this.pathtracedInteraction) {\n          this.toggleInteractionMode(true);\n        } else {\n          this.startRasterizer();\n        }\n      }\n    });\n\n    this.controls.addEventListener('end', () => {\n      if (this.pathtracedInteraction) {\n        this.toggleInteractionMode(false);\n      } else {\n        this.startPathtracing();\n        this.stopRasterizer();\n      }\n    });\n\n    this.controls.mouseButtons = {\n      LEFT: MOUSE.ROTATE,\n      MIDDLE: MOUSE.PAN,\n      RIGHT: MOUSE.DOLLY\n    }\n\n    this._renderer = new PathtracingRenderer({ canvas: this.canvas_pt });\n    this.three_renderer = new ThreeRenderer({ canvas: this.canvas_three, powerPreference: \"high-performance\", alpha: true });\n    this._renderer.pixelRatio = 1.0;\n    this._renderer.maxBounces = 5;\n\n    window.addEventListener('resize', () => {\n      this.resize();\n    }, false);\n\n    const input = document.createElement('input');\n    const dropCtrlOverlay = new SimpleDropzone(this.startpage, input);\n    dropCtrlOverlay.on('dropstart', () => {\n      this.hideStartpage();\n    });\n    dropCtrlOverlay.on('drop', async ({ files }) => { await this.loadDropFiles(files) });\n\n    const dropCtrlCanvas = new SimpleDropzone(this.canvas, input);\n    dropCtrlCanvas.on('drop', async ({ files }) => {\n      await this.loadDropFiles(files);\n    });\n    // dropCtrl.on('droperror', () => this.hideSpinner());\n    this.container.addEventListener('dragover', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      if (e.dataTransfer)\n        e.dataTransfer.dropEffect = 'copy';\n    });\n  }\n\n  public toggleInteractionMode(flag: boolean, timeout?: number) {\n    if (flag) {\n      this._renderer.pixelRatio = this.interactionPixelRatio;\n      this._renderer.tileRes = 1;\n      if (timeout && !this.interactionTimeoutId) {\n        setTimeout(() => {\n          this.toggleInteractionMode(false);\n        }, timeout);\n      }\n    } else {\n      this._renderer.pixelRatio = this.pixelRatio;\n      this._renderer.tileRes = this.tileRes;\n    }\n  }\n\n  private async loadDropFiles(fileMap: any) {\n    for (const [key, value] of fileMap) {\n      if (key.match(/\\.hdr$/)) {\n        this.showStatusScreen(\"Loading HDR...\");\n        await this.loadIbl(URL.createObjectURL(value));\n        this.hideLoadscreen();\n      }\n      if (key.match(/\\.glb$/) || key.match(/\\.gltf$/)) {\n        this.showStatusScreen(\"Loading Scene...\");\n        const files: [string, File][] = Array.from(fileMap);\n        const gltf = await loadSceneFromBlobs(files, this.autoScaleScene) as GLTF;\n        await this.loadScene(gltf);\n      }\n    }\n  }\n\n  public async loadSceneFromUrl(sceneUrl: string) {\n    this.showStatusScreen(\"Loading Scene...\");\n    const gltf = await loadSceneFromUrl(sceneUrl, this.autoScaleScene) as GLTF;\n    await this.loadScene(gltf);\n    this.hideStartpage();\n  }\n\n  private async loadScene(gltf: GLTF) {\n    this.sceneBoundingBox = new Box3().setFromObject(gltf.scene);\n    this.updateCameraFromBoundingBox();\n    this.centerView();\n\n    if (this._showGroundPlane) {\n      this.addGroundPlane(gltf.scene);\n      this.sceneBoundingBox = new Box3().setFromObject(gltf.scene);\n    }\n\n    this.sceneAdapter = new ThreeSceneAdapter(gltf.scene, gltf)!;\n    await this.sceneAdapter.init();\n\n    await this._renderer.setScene(this.sceneAdapter.scene);\n    if (this._pathtracing)\n      this.startPathtracing();\n\n    this.three_renderer.setScene(new Scene().add(gltf.scene));\n    if (!this._pathtracing) {\n      this.startRasterizer();\n    }\n\n    this.hideLoadscreen();\n    this.emit('sceneLoaded', { scene: this.sceneAdapter.scene });\n  }\n\n  public async loadIbl(url: string) {\n    const setIbl = (ibl: any) => {\n      this._renderer.setIBL(ibl);\n      this.three_renderer.setIBL(ibl);\n      this._renderer.useIBL = true;\n      this.three_renderer.useIBL(true);\n      this.three_renderer.showBackground = true;\n      this._renderer.showBackground = true;\n    };\n\n    if (url == \"None\") {\n      this._renderer.useIBL = false;\n      this.three_renderer.showBackground = false;\n      this._renderer.showBackground = false;\n      return;\n    }\n\n    console.log(`Loading ${url}`);\n    new RGBELoader()\n      .setDataType(FloatType)\n      .loadAsync(url).then((ibl) => {\n        setIbl(ibl);\n      });\n  }\n\n  private addGroundPlane(scene: THREE.Scene | THREE.Group) {\n    if (!this.sceneBoundingBox) return;\n\n    const floorPlane = new Mesh(\n      new PlaneBufferGeometry(),\n      new MeshStandardMaterial({\n        transparent: false,\n        color: 0x080808,\n        roughness: 0.15,\n        metalness: 1.0\n      })\n    );\n    floorPlane.scale.setScalar((this.sceneBoundingBox.max.x - this.sceneBoundingBox.min.x) * 3.1415);\n    floorPlane.rotation.x = - Math.PI / 2;\n    floorPlane.position.y = this.sceneBoundingBox.min.y - 0.01;\n    scene.add(floorPlane);\n  }\n\n  private startRasterizer() {\n    this.stopPathtracing();\n    this.three_renderer.render(this.camera, () => {\n      var destCtx = this.canvas.getContext(\"2d\")!;\n      destCtx.drawImage(this.canvas_three, 0, 0);\n    });\n  }\n\n  private stopRasterizer() {\n    this.three_renderer.stopRendering();\n  }\n\n  private stopPathtracing() {\n    this._renderer.stopRendering();\n  }\n\n  private lastTimeStamp = 0.0;\n  private startPathtracing() {\n    this.stopRasterizer();\n\n    this._renderer.render(this.camera, -1,\n      () => { // on tile finished\n        this.controls.update();\n        if (this._pathtracing) {\n          var destCtx = this.canvas.getContext(\"2d\")!;\n          destCtx.drawImage(this.canvas_pt, 0, 0);\n        }\n      },\n      () => { // on frame finished\n        const now = performance.now();\n        this._fps = 1000.0 / (now - this.lastTimeStamp);\n        this.lastTimeStamp = now;\n      })\n  }\n\n  private resize() {\n    console.log(\"resizing\", window.innerWidth, window.innerHeight);\n    let res = [window.innerWidth, window.innerHeight];\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n    this.canvas_pt.width = window.innerWidth;\n    this.canvas_pt.height = window.innerHeight;\n    this.canvas_three.width = window.innerWidth;\n    this.canvas_three.height = window.innerHeight;\n\n    this._renderer.resize(window.innerWidth, window.innerHeight);\n    this.three_renderer.resize(window.innerWidth, window.innerHeight);\n\n    this.camera.aspect = window.innerWidth / window.innerHeight;\n    this.camera.updateProjectionMatrix();\n  }\n\n  private updateCameraFromBoundingBox() {\n    if (!this.sceneBoundingBox) return;\n\n    this.controls.reset();\n    let diag = this.sceneBoundingBox.max.distanceTo(this.sceneBoundingBox.min);\n    let dist = diag * 2 / Math.tan(45.0 * Math.PI / 180.0);\n\n    let center = new Vector3();\n    this.sceneBoundingBox.getCenter(center);\n\n    let pos = center.clone();\n    pos.add(new Vector3(0, 0, dist));\n    pos.add(new Vector3(0, diag, 0));\n\n    this.camera.position.set(pos.x, pos.y, pos.z);\n    this.camera.lookAt(center);\n    this.camera.updateMatrixWorld();\n    this.controls.update();\n  }\n\n  public saveImage() {\n    var dataURL = this.canvas.toDataURL('image/png');\n    const link = document.createElement(\"a\");\n    link.download = 'capture.png';\n    link.href = dataURL;\n    link.click();\n  }\n\n  public centerView() {\n    if (this.controls) {\n      let center = new Vector3();\n      this.sceneBoundingBox.getCenter(center);\n      this.controls.target = center;\n      this.controls.update();\n      this._renderer.resetAccumulation();\n    }\n  }\n\n  showStartpage() {\n    this.startpage.style.visibility = \"visible\";\n  }\n\n  hideStartpage() {\n    this.startpage.style.visibility = \"hidden\";\n    // GUI.toggleHide();\n  }\n\n  showStatusScreen(msg: string) {\n    this.status.innerText = msg;\n    this.loadscreen.style.visibility = \"visible\";\n    this.spinner.style.visibility = \"visible\";\n  }\n\n  hideLoadscreen() {\n    this.loadscreen.style.visibility = \"hidden\";\n    this.spinner.style.visibility = \"hidden\";\n  }\n}","export const scenes = {\n  \"Damaged Helmet\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/DamagedHelmet\\\">glTF Sample Model</a> (Original: Battle Damaged Sci-fi Helmet - PBR by <a href\\\"https://sketchfab.com/theblueturtle_\\\">theblueturtle_</a>, on <a href\\\"https://sketchfab.com/models/b81008d513954189a063ff901f7abfe4\\\">Sketchfab</a>.)\"\n  },\n  \"Tea Time\": {\n    \"url\": \"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/scenes/teatime/teatime.glb\",\n    \"credit\": \"by <a href=\\\"https://www.artstation.com/jamesray\\\">James Ray Cock</a>, Jurita Burger and <a href=\\\"https://www.artstation.com/ricocilliers\\\">Rico Cilliers</a> on <a href=\\\"https://polyhaven.com/a/tea_set_01\\\">polyhaven.com</a>\"\n  },\n  \"Potted Plant\": {\n    \"url\": \"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/scenes/potted_plant/potted_plant_1k.glb\",\n    \"credit\": \"by <a href=\\\"https://www.artstation.com/ricocilliers\\\">Rico Cilliers</a> on <a href=\\\"https://polyhaven.com/a/potted_plant_02\\\">polyhaven.com</a>\"\n  },\n  \"Dragon Attenuation\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DragonAttenuation/glTF-Binary/DragonAttenuation.glb\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/DragonAttenuation\\\">glTF Sample Model</a>\"\n  },\n  \"Emissive Strength Test\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/EmissiveStrengthTest/glTF-Binary/EmissiveStrengthTest.glb\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/EmissiveStrengthTest\\\">glTF Sample Model</a> (Copyright 2022 Analytical Graphics, Inc. <a href=\\\"https://creativecommons.org/licenses/by/4.0/\\\">CC-BY 4.0</a> Model and textures by Ed Mackey)\"\n  },\n  \"Iridescent Dish With Olives\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescentDishWithOlives/glTF/IridescentDishWithOlives.gltf\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescentDishWithOlives\\\">glTF Sample Model</a>. (Copyright 2021 Wayfair LLC. <a href=\\\"https://creativecommons.org/licenses/by/4.0/)\\\">CC BY 4.0 International</a>\"\n  },\n  \"Iridescence Metallic Spheres\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescenceMetallicSpheres/glTF/IridescenceMetallicSpheres.gltf\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescenceMetallicSpheres\\\">glTF Sample Model</a>.\"\n  },\n  \"Iridescence Suzanne\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescenceSuzanne/glTF/IridescenceSuzanne.gltf\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescenceSuzanne\\\">glTF Sample Model</a>.\"\n  },\n  \"Stained Glass Lamp\": {\n    \"url\": \"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/StainedGlassLamp/glTF/StainedGlassLamp.gltf\",\n    \"credit\": \"Official <a href=\\\"https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/StainedGlassLamp\\\">glTF Sample Model</a>. (Copyright 2021 Wayfair LLC. <a href=\\\"https://creativecommons.org/licenses/by/4.0/)\\\">CC BY 4.0 International</a>\"\n  }\n};\n\nexport const ibls = {\n  \"Artist Workshop\": {\n    \"url\": \"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/artist_workshop_1k.hdr\",\n    \"credit\": \"by Oliksiy Yakovlyev from <a href=\\\"polyhaven.com\\\">polyhaven.com</a> <a href=\\\"https://creativecommons.org/publicdomain/zero/1.0/\\\">(CC0)</a>\",\n    \"intensity\": 1.5\n  },\n  \"Studio_05\": {\n    \"url\": \"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/studio_small_05_1k.hdr\",\n    \"credit\": \"by <a href=\\\"https://gregzaal.com/\\\">Greg Zaal</a> from <a href=\\\"polyhaven.com\\\">polyhaven.com</a> <a href=\\\"https://creativecommons.org/publicdomain/zero/1.0/\\\">(CC0)</a>\",\n    \"intensity\": 1.5\n  },\n  \"Footprint Court\": {\n    \"url\": \"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/Footprint_Court_Env.hdr\",\n    \"credit\": \"from <a href=\\\"http://www.hdrlabs.com/sibl/archive.html\\\">hdrlabs.com</a> <a href=\\\"https://creativecommons.org/licenses/by-nc-sa/3.0/\\\">(CC BY-NC-SA 3.0)</a>\",\n    \"intensity\": 1.5\n  }\n};\n\n","/* @license\n * Copyright 2020  Dassault Systemes - All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Pane } from 'tweakpane';\nimport { DemoViewer } from 'dspbr-pt-viewer';\nimport { PathtracingRenderer, PathtracingSceneData } from 'dspbr-pt';\nimport * as Assets from './asset_index';\n\nif (!window.File || !window.FileReader || !window.FileList || !window.Blob) {\n  alert('The File APIs are not fully supported in this browser.');\n}\n\nif (process.env['NODE_ENV'] == 'dev') {\n  console.log(\"Local development: Replacing Asset URLs...\");\n  for (let [_, ibl] of Object.entries(Assets.ibls)) {\n    if (ibl[\"url\"]) {\n      ibl[\"url\"] = ibl[\"url\"].replace(\"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets\", '');\n    }\n  }\n  for (let [_, scene] of Object.entries(Assets.scenes)) {\n    if (scene[\"url\"]) {\n      scene[\"url\"] = scene[\"url\"].replace(\"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets\", '');\n    }\n  }\n}\n\nclass Demo {\n  private _viewer: DemoViewer;\n  private _renderer: PathtracingRenderer;\n  private _scene?: PathtracingSceneData;\n  private _ui: Pane;\n  private _uiTabs: any;\n  private _container: HTMLElement;\n\n  private _defaultIblKey = \"Artist Workshop\";\n  private _currentIbl = this._defaultIblKey;\n  private _currentScene = \"\";\n  private _params: any;\n\n  constructor() {\n    this._container = document.createElement('div');\n    this._viewer = new DemoViewer({ container: this._container });\n    this._renderer = this._viewer.renderer;\n    this._ui = new Pane({ title: \"dspbr-pt\" });\n\n    this._params = new Proxy(new URLSearchParams(window.location.search), {\n      get: (searchParams, prop) => searchParams.get(prop),\n    });\n\n    this._viewer.on(\"sceneLoaded\", (ev: any) => {\n      this._scene = ev.scene;\n      this.initMaterialSelector(this._params);\n    })\n\n    if(this._params.ground) {\n      this._viewer.showGroundPlane = true;\n    }\n\n    if (this._params.scene) {\n      this._viewer.loadSceneFromUrl(this.resolveUrlFromIndex(this._params.scene));\n    }\n    if (this._params.ibl) {\n      console.log(this.resolveUrlFromIndex(this._params.ibl));\n      this._viewer.loadIbl(this.resolveUrlFromIndex(this._params.ibl));\n    }\n    else {\n      this._viewer.loadIbl(this.resolveUrlFromIndex(this._defaultIblKey));\n    }\n\n    if(this._params.rotate) {\n      this._renderer.iblRotation = this._params.rotate;\n    }\n\n\n    this.initUI();\n  }\n\n  private initUI() {\n    this._ui.element.style.width = '350px';\n    this._ui.element.style.top = '5px';\n    this._ui.element.style.right = '5px';\n    this._ui.element.style.position = 'absolute';\n    this._ui.element.style.zIndex = \"2\";\n\n    // this.pane = pane;\n    this._uiTabs = this._ui.addTab({\n      pages: [\n        { title: 'Parameters' },\n        { title: 'Materials' },\n      ],\n    });\n    const params = this._uiTabs.pages[0];\n\n    params.addButton({\n      title: 'Center View'\n    }).on('click', () => {\n      this._viewer.centerView();\n    })\n\n    params.addButton({\n      title: 'Save Image'\n    }).on('click', () => {\n      this._viewer.saveImage();\n    });\n\n    const scene = params.addFolder({\n      title: 'Scene',\n    });\n\n    const optionsFromList = (l) => {\n      const obj = {\n        \"\": \"\"\n      };\n      for (let e in l) {\n        obj[l[e]] = l[e];\n      }\n      return obj;\n    };\n\n    scene.addInput(this, '_currentScene', {\n      label: \"Scene\",\n      options: optionsFromList(Object.keys(Assets.scenes)),\n    }).on('change', (ev) => {\n      if (ev.value != \"\") {\n        const url = this.resolveUrlFromIndex(ev.value);\n        this._viewer.loadSceneFromUrl(url);\n      }\n    });\n\n    scene.addInput(this._viewer, 'autoRotate', {\n      label: \"Auto Rotate\"\n    });\n\n    const lighting = params.addFolder({\n      title: 'Lighting',\n    });\n\n    lighting.addInput(this, '_currentIbl', {\n      label: \"IBL\",\n      options: optionsFromList(Object.keys(Assets.ibls)),\n    }).on('change', (ev) => {\n      const url = this.resolveUrlFromIndex(ev.value);\n      console.log(url);\n      this._viewer.loadIbl(url);\n    });\n\n    lighting.addInput(this._renderer, 'iblRotation', {\n      label: 'IBL Rotation',\n      step: 0.1,\n      min: -180,\n      max: 180\n    }).on('change', () => {\n      this._viewer.toggleInteractionMode(true, 100.0);\n    });\n\n    lighting.addInput(this._renderer, 'iblImportanceSampling', {\n      label: 'Importance Sampling'\n    })\n\n    const interator = params.addFolder({\n      title: 'Integrator',\n    });\n    interator.addInput(this._viewer, 'togglePathtracing', {\n      label: 'Pathtracing'\n    });\n    interator.addInput(this._renderer, 'debugMode', {\n      label: 'Debug Mode',\n      options: optionsFromList(this._renderer.debugModes)\n    });\n    interator.addInput(this._renderer, 'maxBounces', {\n      label: 'Max Bounces',\n      step: 1,\n      min: 0,\n      max: 32\n    });\n    interator.addInput(this._renderer, 'rayEps', {\n      label: 'Ray Offset',\n      step: 0.00001,\n      min: 0,\n      max: 10.0\n    });\n    interator.addInput(this._renderer, 'tileRes', {\n      label: 'Tile Res',\n      step: 1,\n      min: 1,\n      max: 8\n    });\n    interator.addInput(this._renderer, 'clampThreshold', {\n      label: 'Clamp Threshold',\n      step: 0.1,\n      min: 0,\n      max: 100\n    });\n\n    const display = params.addFolder({\n      title: 'Display',\n    });\n    display.addInput(this._renderer, 'exposure', {\n      label: 'Display Exposure',\n      step: 0.01,\n      min: 0,\n      max: 10\n    });\n    display.addInput(this._renderer, 'tonemapping', {\n      label: 'Tonemapping',\n      options: optionsFromList(this._renderer.tonemappingModes)\n    });\n    display.addInput(this._renderer, 'enableGamma', {\n      label: 'Gamma'\n    });\n    display.addInput(this._viewer, 'pathtracedInteraction', {\n      label: 'Pathtraced Navigation'\n    });\n    display.addInput(this._viewer, 'pixelRatio', {\n      label: 'Pixel Ratio',\n      step: 0.1,\n      min: 0.1,\n      max: 1\n    });\n    display.addInput(this._viewer, 'interactionPixelRatio', {\n      label: 'Interaction Ratio',\n      step: 0.1,\n      min: 0.1,\n      max: 1\n    });\n    display.addInput(this._renderer, 'enableFxaa', {\n      label: 'Fxaa'\n    });\n\n    const background = params.addFolder({\n      title: 'Background',\n    });\n    display.addInput(this._renderer, 'showBackground', {\n      label: 'Background from IBL'\n    });\n\n    background.color = { r: 0, g: 0, b: 0 };\n    background.addInput(background, 'color', {\n      label: 'Background Color',\n      picker: 'inline',\n      expanded: true,\n    }).on('change', (ev) => {\n      console.log(ev.value);\n      this._renderer.backgroundColor = [ev.value.r / 255.0, ev.value.g / 255.0, ev.value.g / 255.0, 1.0];\n    });\n\n    params.addMonitor(this._viewer, 'fps', {\n      label: 'Fps',\n      view: 'graph',\n      step: 0.1,\n      min: 0,\n      max: 10\n    });\n  }\n\n\n  private initMaterialSelector(params: any) {\n    const materials = this._scene.materials;\n\n    const matTab = this._uiTabs.pages[1];\n    for (let child of matTab.children) {\n      console.log(\"dispose\", child);\n      child.dispose();\n    }\n\n    const matNames = [];\n    for (let i = 0; i < materials.length; i++) {\n      matNames.push({ text: materials[i].name, value: i });\n    }\n    const opt = { name: materials[0].name };\n    matTab.addInput(opt, \"name\", {\n      options: matNames\n    }).on('change', (ev) => {\n      this.initMaterialParamUI(ev.value);\n    })\n\n    if (materials.length > 0) {\n      this.initMaterialParamUI(matNames[0].value, params);\n    }\n  }\n\n  private paneMatFolders = {};\n  private initMaterialParamUI(matIdx: number, params?: any) {\n    const matTab = this._uiTabs.pages[1];\n    const mat = this._scene.materials[matIdx];\n\n    for(let fn in this.paneMatFolders) {\n      this.paneMatFolders[fn].dispose();\n    };\n    this.paneMatFolders = {};\n\n    const colors = {\n      albedo: { r: mat.albedo[0] * 255, g: mat.albedo[1] * 255, b: mat.albedo[2] * 255 },\n      specularTint: { r: mat.specularTint[0] * 255, g: mat.specularTint[1] * 255, b: mat.specularTint[2] * 255 },\n      translucencyColor: {\n        r: mat.translucencyColor[0] * 255,\n        g: mat.translucencyColor[1] * 255, b: mat.translucencyColor[2] * 255\n      },\n      sheenColor: { r: mat.sheenColor[0] * 255, g: mat.sheenColor[1] * 255, b: mat.sheenColor[2] * 255 },\n      attenuationColor: { r: mat.attenuationColor[0] * 255, g: mat.attenuationColor[1] * 255, b: mat.attenuationColor[2] * 255 }\n    };\n    const vectors = {\n      emission: { x: mat.emission[0], y: mat.emission[1], z: mat.emission[2] }\n    };\n\n    const basicFloatParamSettings = {\n      step: 0.01,\n      min: 0.0,\n      max: 1.0\n    };\n\n    const base = matTab.addFolder({\n      title: 'Base',\n    }); this.paneMatFolders['base'] = base;\n\n    base.addInput(colors, \"albedo\").on('change', ev => {\n      mat.albedo = [ev.value.r / 255.0, ev.value.g / 255.0, ev.value.b / 255.0];\n    });\n\n    base.addInput(mat, 'roughness', basicFloatParamSettings);\n    base.addInput(mat, 'metallic', basicFloatParamSettings);\n    base.addInput(mat, 'specular', basicFloatParamSettings);\n    base.addInput(vectors, \"emission\", {\n      x: { min: 0, max: 10e6, step: 0.1 },\n      y: { min: 0, max: 10e6, step: 0.1 },\n      z: { min: 0, max: 10e6, step: 0.1 }\n    }).on('change', ev => {\n      mat.emission = [ev.value.x, ev.value.y, ev.value.z];\n    });\n\n    const anisotropy = matTab.addFolder({\n      title: 'Anisotropy',\n    }); this.paneMatFolders['anisotropy'] = anisotropy;\n    anisotropy.addInput(mat, 'anisotropy', {\n      step: 0.01,\n      min: -1.0,\n      max: 1.0\n    });\n    anisotropy.direction = { x: mat.anisotropyDirection[0], y: mat.anisotropyDirection[1] };\n    anisotropy.addInput(anisotropy, \"direction\", {\n      picker: 'inline',\n      expanded: true,\n      x: { min: -1, max: 1, step: 0.01 },\n      y: { min: -1, max: 1, step: 0.01 }\n    }).on('change', ev => {\n      mat.anisotropyDirection = [ev.value.x, ev.value.y];\n    });\n\n    const transmission = matTab.addFolder({\n      title: 'Transmission',\n    }); this.paneMatFolders['transmission'] = transmission;\n    transmission.addInput(mat, 'transparency', basicFloatParamSettings);\n    transmission.addInput(mat, 'cutoutOpacity', basicFloatParamSettings);\n    transmission.addInput(mat, 'translucency', { ...basicFloatParamSettings, ...{ label: 'diffuse transmission' } });\n    transmission.addInput(colors, \"translucencyColor\", {\n      ...basicFloatParamSettings,\n      ...{ label: 'diffuse transmission color' }\n    }).on('change', ev => {\n      mat.translucencyColor = [ev.value.r / 255.0, ev.value.g / 255.0, ev.value.b / 255.0];\n    });\n\n    const sheen = matTab.addFolder({\n      title: 'Sheen',\n    }); this.paneMatFolders['sheen'] = sheen;\n    sheen.addInput(mat, 'sheenRoughness', basicFloatParamSettings);\n    sheen.addInput(colors, \"sheenColor\").on('change', ev => {\n      mat.sheenColor = [ev.value.r / 255.0, ev.value.g / 255.0, ev.value.b / 255.0];\n    });\n\n    const clearcoat = matTab.addFolder({\n      title: 'Clearcoat',\n    }); this.paneMatFolders['clearcoat'] = clearcoat;\n    clearcoat.addInput(mat, 'clearcoat', basicFloatParamSettings);\n    clearcoat.addInput(mat, 'clearcoatRoughness', basicFloatParamSettings);\n\n    const volume = matTab.addFolder({\n      title: 'Volume',\n    }); this.paneMatFolders['volume'] = volume;\n    volume.thinWalled = mat.thinWalled > 0 ? true : false;\n    volume.addInput(volume, 'thinWalled').on('change', ev => {\n      mat.thinWalled = ev.value ? 1 : 0;\n    });\n    volume.addInput(mat, 'ior', {\n      min: 0,\n      max: 3,\n      step: 0.01\n    });\n    volume.addInput(mat, 'attenuationDistance', {\n      step: 0.00001,\n      min: 0.0,\n      max: 10e5\n    });\n    volume.addInput(colors, \"attenuationColor\").on('change', ev => {\n      mat.attenuationColor = [ev.value.r / 255.0, ev.value.g / 255.0, ev.value.b / 255.0];\n    });\n\n    const iridescence = matTab.addFolder({\n      title: 'Iridescence',\n    }); this.paneMatFolders['iridescence'] = iridescence;\n    iridescence.addInput(mat, 'iridescence', basicFloatParamSettings);\n    iridescence.addInput(mat, 'iridescenceIOR', {\n      min: 0,\n      max: 3,\n      step: 0.01\n    });\n    iridescence.addInput(mat, 'iridescenceThicknessMinimum', {\n      min: 10,\n      max: 1200,\n      step: 1\n    });\n    iridescence.addInput(mat, 'iridescenceThicknessMaximum', {\n      min: 10,\n      max: 1200,\n      step: 1\n    });\n\n    if (params && params.unfold) {\n      this._uiTabs.pages[1].selected = true;\n\n      for(let fn in this.paneMatFolders) {\n        this.paneMatFolders[fn].expanded = false;\n      };\n      const unfoldNames = params.unfold.split(\" \");\n\n      const folderNames = Object.keys(this.paneMatFolders);\n      for(let fn in unfoldNames) {\n        if(folderNames.includes(unfoldNames[fn])) {\n          this.paneMatFolders[unfoldNames[fn]].expanded = true;\n        }\n      }\n    }\n  }\n\n  private resolveUrlFromIndex(name: string) {\n    if (name == \"\") {\n      return \"None\";\n    }\n\n    let sceneUrl = \"\";\n    const key = name.replaceAll('%20', ' ');\n    if (key in Assets.scenes) {\n      const scene = Assets.scenes[key];\n      this.setSceneInfo(key, scene.credit);\n      sceneUrl = scene.url;\n    }\n    if (key in Assets.ibls) {\n      const ibl = Assets.ibls[key];\n      this.setIBLInfo(key, ibl.credit);\n      sceneUrl = ibl.url;\n      this._renderer.exposure = ibl.intensity ?? 1.0;\n      this._renderer.iblRotation = ibl.rotation ?? 180.0;\n    }\n\n    return sceneUrl != \"\" ? sceneUrl : name;\n  }\n\n\n  private setIBLInfo(name: string, credit?: any) {\n    document.getElementById(\"ibl-info\").innerHTML = `IBL: ${name}`;\n    if (credit) document.getElementById(\"ibl-info\").innerHTML += ` - ${credit}`;\n  }\n\n  private setSceneInfo(name: string, credit?: any) {\n    document.getElementById(\"scene-info\").innerHTML = `Scene: ${name}`;\n    if (credit) document.getElementById(\"scene-info\").innerHTML += ` - ${credit}`;\n  }\n\n}\n\nlet demo = new Demo();"],"names":["$8e2551e033e95cb5$export$9b60beb643db4d69","exports","Semver","constructor","text","core","prerelease","split","coreComps","this","major","parseInt","minor","patch","toString","join","BladeApi","controller","controller_","disabled","viewProps","get","set","hidden","dispose","TpEvent","target","TpChangeEvent","value","presetKey","last","super","TpUpdateEvent","TpFoldEvent","expanded","forceCast","v","isEmpty","deepEqualsArray","a1","a2","length","i","CREATE_MESSAGE_MAP","alreadydisposed","invalidparams","context","name","nomatchingcontroller","key","nomatchingview","JSON","stringify","params","notbindable","propertynotfound","shouldneverhappen","TpError","config","_a","message","type","stack","Error","static","BindingTarget","obj","opt_id","obj_","key_","presetKey_","read","write","writeProperty","valueObj","isBindable","notBindable","propertyNotFound","ButtonApi","label","props","title","valueController","on","eventName","handler","bh","bind","emitter","Emitter","observers_","observers","push","off","filter","observer","emit","event","forEach","PREFIX","ClassName","viewName","opt_elementName","opt_modifier","compose","h1","h2","input","extractValue","ev","rawValue","bindValue","applyValue","bindValueMap","valueMap","applyClass","elem","className","active","classList","add","remove","valueToClassName","bindValueToTextContent","textContent","className$q","ButtonView","doc","element","createElement","bindClassModifiers","buttonElem","bindDisabled","appendChild","buttonElement","titleElem","ButtonController","onClick_","view","addEventListener","sender","BoundValue","initialValue","constraint_","constraint","equals_","equals","v1","v2","rawValue_","setRawValue","forceEmit","options","opts","constrainedValue","constrain","PrimitiveValue","value_","createValue","ValueMap","valMap_","Object","keys","reduce","o","assign","createCore","parseObject","keyToParserMap","tmp","undefined","result","parser","succeeded","parseArray","parseItem","item","isObject","createParamsParserBuilder","parse","optional","createParamsParserBuilders","custom","boolean","number","string","function","constant","raw","object","array","itemParser","Array","isArray","ParamsParsers","required","parseParams","disposeElement","parentElement","removeChild","getAllBladePositions","className$p","POS_TO_CLASS_NAME_MAP","veryfirst","first","verylast","BladeController","parent_","blade","pos","handleDispose","parent","SVG_NS","forceReflow","offsetHeight","disableTransitionTemporarily","callback","t","style","transition","supportsTouch","ontouchstart","getGlobalObject","Function","getWindowDocument","document","getCanvasContext","canvasElement","win","ownerDocument","defaultView","getContext","ICON_ID_TO_INNER_HTML_MAP","check","dropdown","p2dpad","createSvgIconElement","iconId","createElementNS","innerHTML","insertElementAt","index","insertBefore","children","removeElement","removeChildElements","removeChildNodes","childNodes","findNextTarget","relatedTarget","explicitOriginalTarget","className$o","createLabelNode","frag","createDocumentFragment","map","line","createTextNode","lineNode","LabelView","labelElem","labelElement","valueElem","valueElement","LabelController","ButtonBladePlugin","id","accept","p","args","fromObject","api","ValueBladeController","createBlade","positions","Foldable","coreObj","completed","expandedHeight","shouldFixHeight","temporaryExpanded","styleExpanded","styleHeight","exHeight","bindExpandedClass","expandedClassName","onExpand","cleanUpTransition","computeExpandedFolderHeight","folder","containerElement","height","clientHeight","applyHeight","foldable","bindFoldable","propertyName","RackLikeApi","rackApi","rackApi_","addButtonAsBlade","addBlade","addFolderAsBlade","addSeparatorAsBlade","opt_params","addTabAsBlade","NestedOrderedSet","extract","items_","cache_","Set","onSubListAdd_","onSubListRemove_","extract_","items","allItems","from","find","includes","has","item1","opt_index","shouldNeverHappen","splice","subList","root","indexOf","delete","InputBindingApi","onBindingChange_","emitter_","binding","refresh","InputBindingController","MonitorBindingApi","onBindingUpdate_","MonitorBindingController","ticker","findSubBladeApiSet","RackApi","getApiByController","apiSet","api1","createBindingTarget","pool","onRackAdd_","onRackRemove_","onRackInputChange_","onRackMonitorUpdate_","apiSet_","pool_","rack","bc","setUpApi_","addInput","createInput","addMonitor","createMonitor","addFolder","addButton","addSeparator","addTab","gapi","a","createBladeApi","bladeController","isRoot","FolderApi","rackController","RackLikeController","PlainView","findInputBindingController","bcs","b","findMonitorBindingController","findValueBladeController","findSubRack","RackController","findSubBladeControllerSet","BladeRack","onBladePositionsChange_","onSetAdd_","onSetRemove_","onChildDispose_","onChildPositionsChange_","onChildInputChange_","onChildMonitorUpdate_","onChildValueChange_","onChildViewPropsChange_","onDescendantLayout_","onDescendantInputChange_","onDescendantMonitorUpdate_","blade_","bcSet_","controllerClass","updatePositions_","visibleItems","firstVisibleItem","lastVisibleItem","ps","_ev","_","bladeContainerClassName","FolderView","className_","foldable_","titleElement","markElem","containerElem","FolderController","create","rc","onTitleClick_","FolderBladePlugin","LabeledValueController","SeparatorApi","className$n","SeparatorView","hrElem","SeparatorController","SeparatorBladePlugin","className$m","valueToModifier","modifier","ViewProps","opt_initialValue","_b","disposed","bindTabIndex","tabIndex","className$l","TabItemView","selected","TabItemController","TabPageController","onItemClick_","ic_","itemProps","cc_","itemController","contentController","TabPageApi","contentRackApi","TabApi","onPageAdd_","onPageRemove_","pageApiMap_","Map","pageSet","pc","setUpPageApi_","pages","addPage","removePage","api3","className$k","TabView","empty","itemsElem","itemsElement","contentsElem","contentsElement","TabController","cr","onPageSelectedChange_","pageSet_","empty_","applyPages_","keepSelection_","firstSelIndex","findIndex","TabBladePlugin","c","createBladeController","plugin","ac","ManualTicker","tick","IntervalTicker","interval","disabled_","timerId_","onTick_","doc_","interval_","setTimer_","inactive","clearTimer_","clearInterval","setInterval","CompositeConstraint","constraints","findConstraint","constraintClass","tmpResult","sc","ListConstraint","RangeConstraint","maxValue","max","minValue","min","Math","StepConstraint","step","round","className$j","ListView","onValueChange_","props_","selectElem","optionElem","dataset","String","selectElement","update_","ListController","onSelectChange_","e","optElem","currentTarget","selectedOptions","itemIndex","Number","className$i","PopupView","shows","PopupController","className$h","TextView","onChange_","inputElem","inputElement","formatter","TextController","onInputChange_","parser_","parsedValue","boolToString","boolFromUnknown","BooleanFormatter","NumberLiteralNode","evaluate","BINARY_OPERATION_MAP","pow","BinaryOperationNode","operator","left","right","op","UNARY_OPERATION_MAP","UnaryOperationNode","expr","expression","combineReader","parsers","cursor","readWhitespace","m","substr","match","readNonZeroDigit","ch","readDecimalDigits","readSignedInteger","ds","sign","sds","readExponentPart","toLowerCase","si","readDecimalIntegerLiteral","nzd","readDecimalLiteral1","dil","dot","dds","readDecimalLiteral2","readDecimalLiteral3","readDecimalLiteral","parseBinaryDigits","readBinaryIntegerLiteral","prefix","bds","readOctalDigits","readOctalIntegerLiteral","ods","readHexDigits","readHexIntegerLiteral","hds","readNonDecimalIntegerLiteral","readNumericLiteral","parseLiteral","num","evaluable","parseParenthesizedExpression","parseExpression","cl","parsePrimaryExpression","parseUnaryExpression","readBinaryOperator","ops","op1","startsWith","createBinaryOperationExpressionParser","exprParser","firstExpr","nextExpr","parseBinaryOperationExpression","parseEcmaNumberExpression","parseNumber","r","numberFromUnknown","pv","numberToString","createNumberFormatter","digits","toFixed","innerFormatter","formatPercentage","stringFromUnknown","formatString","fillBuffer","buffer","bufferSize","initializeBuffer","createTrimmedBuffer","slice","createPushedBuffer","newValue","newBuffer","connectValues","primary","secondary","forward","backward","changing","preventFeedback","getStepForKey","baseStep","altKey","shiftKey","upKey","downKey","getVerticalStepKeys","getHorizontalStepKeys","isVerticalArrowKey","isArrowKey","computeOffset$1","rect","getBoundingClientRect","x","pageX","scrollX","y","pageY","scrollY","top","PointerHandler","lastTouch_","onDocumentMouseMove_","onDocumentMouseUp_","onMouseDown_","onTouchEnd_","onTouchMove_","onTouchStart_","elem_","passive","computePosition_","offset","bounds","width","point","preventDefault","focus","data","removeEventListener","touch","targetTouches","clientX","clientY","mapRange","start1","end1","start2","end2","getDecimalDigits","replace","constrainRange","loopRange","className$g","NumberTextView","arrayPosition","onDraggingChange_","dragging_","dragging","knobElem","knobElement","guideElem","bodyElem","guideBodyElem_","headElem","guideHeadElem_","tooltipElem","tooltipElem_","aox","adx","setAttributeNS","NumberTextController","originRawValue_","onInputKeyDown_","onInputKeyUp_","onPointerDown_","onPointerMove_","onPointerUp_","baseStep_","ph","computeDraggingValue_","dx","className$f","SliderView","trackElem","trackElement","SliderController","onKeyDown_","onKeyUp_","onPointerDownOrMove_","ptHandler_","handlePointerEvent_","d","className$e","SliderTextView","sliderElem","sliderView_","sliderView","textElem","textView_","textView","SliderTextController","sliderC_","sliderProps","textC_","textProps","sliderController","textController","writePrimitive","parseListOptions","parsePickerLayout","parsePointDimensionParams","normalizeListOptions","createListConstraint","findListItems","findStep","getSuitableDecimalDigits","getBaseStep","getSuitableDraggingScale","base","abs","floor","log10","className$d","CheckboxView","wrapperElem","checked","CheckboxController","createConstraint$5","lc","BooleanInputPlugin","reader","_args","writer","className$c","ColorView","swatchElem","swatchElement","textElement","pickerLayout","pickerElem","pickerElement","rgbToHsl","g","rp","gp","bp","cmax","cmin","h","s","l","hslToRgb","hp","sp","lp","rgbToHsv","hsvToRgb","vp","hslToHsv","sd","hsvToHsl","removeAlphaComponent","comps","appendAlphaComponent","alpha","MODE_CONVERTER_MAP","hsl","hsv","rgb","convertColorMode","components","fromMode","toMode","CONSTRAINT_MAP","isRgbColorComponent","Color","mode","mode_","comps_","color","toRgbaObject","isRgbColorObject","comps1","comps2","getComponents","opt_mode","rgbComps","className$b","ColorPickerView","alphaViews_","hsvElem","svElem","svPaletteView_","svPaletteView","hElem","hPaletteView_","hPaletteView","rgbElem","alphaViews","palette","aElem","apElem","atElem","allFocusableElements","elems","modeSelectElement","textViews","parseColorInputParams","picker","getBaseStepForColor","forAlpha","parseCssNumberOrPercentage","parseFloat","ANGLE_TO_DEG_MAP","deg","angle","grad","rad","PI","turn","parseCssNumberOrAngle","unit","NOTATION_TO_PARSER_MAP","isNaN","mRgb","mRrggbb","getColorNotation","notation","subparser","CompositeColorParser","hasAlphaComponent","colorFromString","cv","black","zerofill","comp","hex","colorToHexRgbString","colorToHexRgbaString","rgbaComps","colorToFunctionalRgbString","colorToFunctionalRgbaString","aFormatter","rgbFormatter","colorToFunctionalHslString","formatters","colorToFunctionalHslaString","NOTATION_TO_STRINGIFIER_MAP","getColorStringifier","className$a","APaletteView","barElem","colorElem","colorElem_","markerElem","markerElem_","previewElem","previewElem_","leftColor","rightColor","gradientComps","background","backgroundColor","APaletteController","className$9","createModeSelectElement","ColorTextView","modeElem","modeElem_","modeMarkerElem","textsElem","textsElem_","textViews_","applyTextViews_","colorMode","compElem","FORMATTER","MODE_TO_CONSTRAINT_MAP","createComponentController","draggingScale","ColorTextController","onModeSelectChange_","ccs_","createComponentControllers_","cc","ccs","cs","pickedMode","className$8","HPaletteView","HPaletteController","hue","className$7","CANVAS_RESOL","SvPaletteView","canvasElem","ctx","hsvComps","imgData","getImageData","iy","ix","putImageData","SvPaletteController","saturation","dv","ColorPickerController","hPaletteC_","svPaletteC_","alphaIcs_","supportsAlpha","className$6","ColorSwatchView","swatchElem_","ColorSwatchController","ColorController","onButtonBlur_","onButtonClick_","onPopupChildBlur_","onPopupChildKeydown_","swatchC_","popC_","pickerC","pickerC_","nextTarget","contains","colorFromObject","isColorObject","colorToRgbNumber","colorToRgbaNumber","numberToRgbColor","numberToRgbaColor","colorFromRgbNumber","colorFromRgbaNumber","createColorStringWriter","createColorNumberWriter","colorToNumber","writeRgbaColorObject","writeRgbColorObject","createColorObjectWriter","shouldSupportAlpha$1","inputParams","createFormatter$1","NumberColorInputPlugin","shouldSupportAlpha","isRgbaColorObject","ObjectColorInputPlugin","StringColorInputPlugin","stringifier","PointNdConstraint","asm_","assembly","toComponents","fromComponents","className$5","PointNdTextView","axisElem","createAxisController","axes","PointNdTextController","acs_","createStepConstraint","createRangeConstraint","createConstraint$4","findRange","estimateSuitableRange","NumberInputPlugin","format","Point2d","toObject","Point2dAssembly","className$4","Point2dView","className$3","Point2dPickerView","onFoldableChange_","invertsY_","invertsY","maxValue_","layout","padElem","padElement","svgElem","svgElem_","xAxisElem","yAxisElem","lineElem","lineElem_","px","py","ipy","computeOffset","baseSteps","Point2dPickerController","onPadKeyDown_","onPadKeyUp_","baseSteps_","dy","Point2dController","onPadButtonBlur_","onPadButtonClick_","padC","point2dFromUnknown","writePoint2d","createDimensionConstraint$2","createConstraint$3","getSuitableMaxDimensionValue","getSuitableMaxValue","xc","yc","xr","yr","createAxis$2","shouldInvertY","yParams","inverted","Point2dInputPlugin","Point3d","z","Point3dAssembly","point3dFromUnknown","writePoint3d","createDimensionConstraint$1","createConstraint$2","createAxis$1","Point3dInputPlugin","Point4d","w","Point4dAssembly","point4dFromUnknown","writePoint4d","createDimensionConstraint","createConstraint$1","createAxis","Point4dInputPlugin","createConstraint","StringInputPlugin","Constants","monitor","defaultInterval","defaultLineCount","className$2","MultiLogView","onValueUpdate_","formatter_","textareaElem","lineCount","readOnly","textareaElem_","shouldScroll","scrollTop","scrollHeight","lines","MultiLogController","className$1","SingleLogView","values","lastValue","SingleLogController","BooleanMonitorPlugin","GraphCursor","index_","className1","GraphLogView","onCursorChange_","minValue_","cursor_","graphElement","maxIndex","points","tx","ty","GraphLogController","onGraphMouseMove_","onGraphMouseLeave_","onGraphPointerDown_","onGraphPointerMove_","onGraphPointerUp_","offsetX","createFormatter","createTextMonitor","createGraphMonitor","_c","shouldShowGraph","NumberMonitorPlugin","defaultBufferSize","StringMonitorPlugin","multiline","InputBinding","targetValue","write_","createInputBindingController","valueArgs","MonitorBinding","reader_","createTicker","createMonitorBindingController","P","bindingArgs","PluginPool","pluginsMap_","blades","inputs","monitors","getAll","register","unshift","createDefaultPluginPool","ListApi","SliderApi","TextApi","ListBladePlugin","ic","exportPresetJson","targets","importPresetJson","preset","RootApi","importPreset","ibc","exportPreset","mbc","RootController","SliderBladePlugin","vc","TextBladePlugin","createDefaultWrapperElement","body","embedStyle","css","querySelector","styleElem","tpStyle","head","Pane","opt_config","containerElem_","container","usesDefaultWrapper_","setUpDefaultPlugins_","alreadyDisposed","parentElem","registerPlugin","bundle","plugins","embedPluginStyle_","VERSION","defineProperty","factory","$c398a0ea03e027b6$exports","$5440e9199a418654$var$ReflectOwnKeys","$5440e9199a418654$var$R","Reflect","$5440e9199a418654$var$ReflectApply","apply","receiver","prototype","call","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","$5440e9199a418654$var$NumberIsNaN","$5440e9199a418654$var$EventEmitter","init","$5440e9199a418654$exports","once","Promise","resolve","reject","errorListener","err","removeListener","resolver","arguments","$5440e9199a418654$var$eventTargetAgnosticAddListener","flags","$5440e9199a418654$var$addErrorHandlerIfEventEmitter","EventEmitter","_events","_eventsCount","_maxListeners","$5440e9199a418654$var$defaultMaxListeners","$5440e9199a418654$var$checkListener","listener","TypeError","$5440e9199a418654$var$_getMaxListeners","that","defaultMaxListeners","$5440e9199a418654$var$_addListener","prepend","events","existing","warning","newListener","warned","count","console","warn","$5440e9199a418654$var$onceWrapper","fired","wrapFn","$5440e9199a418654$var$_onceWrap","state","wrapped","$5440e9199a418654$var$_listeners","unwrap","evlistener","arr","ret","$5440e9199a418654$var$unwrapListeners","$5440e9199a418654$var$arrayClone","$5440e9199a418654$var$listenerCount","n","copy","wrapListener","arg","enumerable","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","pop","$5440e9199a418654$var$spliceOne","removeAllListeners","rawListeners","listenerCount","eventNames","_dist_code","Tree","bi_reverse","code","res","build_tree","node","tree","dyn_tree","stree","stat_desc","static_tree","max_code","heap_len","heap_max","heap","depth","opt_len","static_len","pqdownheap","bits","xbits","f","extra","extra_bits","extra_base","max_length","overflow","bl_count","next_code","StaticTree","Config","good_length","max_lazy","nice_length","max_chain","func","_length_code","base_length","base_dist","d_code","dist","extra_lbits","extra_dbits","extra_blbits","bl_order","static_ltree","static_dtree","static_l_desc","LITERALS","static_d_desc","static_bl_desc","config_table","z_errmsg","smaller","tn2","tm2","Deflate","strm","status","pending_buf_size","last_flush","w_size","w_bits","w_mask","window","window_size","prev","ins_h","hash_size","hash_bits","hash_mask","hash_shift","block_start","match_length","prev_match","match_available","strstart","match_start","lookahead","prev_length","max_chain_length","max_lazy_match","level","strategy","good_match","nice_match","dyn_ltree","dyn_dtree","bl_tree","l_buf","lit_bufsize","last_lit","d_buf","matches","last_eob_len","bi_buf","bi_valid","l_desc","d_desc","bl_desc","init_block","END_BLOCK","scan_tree","curlen","prevlen","nextlen","max_count","min_count","REP_3_6","REPZ_3_10","REPZ_11_138","put_byte","pending_buf","pending","put_short","send_bits","val","send_code","c2","send_tree","bi_flush","_tr_tally","out_length","in_length","dcode","compress_block","ltree","dtree","lx","bi_windup","_tr_stored_block","buf","stored_len","eof","subarray","flush_block_only","opt_lenb","static_lenb","max_blindex","BL_CODES","lcodes","dcodes","blcodes","rank","flush_pending","fill_window","more","avail_in","read_buf","longest_match","cur_match","chain_length","scan","best_len","limit","_nice_match","wmask","strend","scan_end1","scan_end","k","j","deflateInit","_level","_method","memLevel","_strategy","msg","dstate","Uint8Array","total_in","total_out","pending_out","MIN_MATCH","deflateEnd","deflateParams","deflate","deflateSetDictionary","dictionary","dictLength","_strm","flush","header","level_flags","old_flush","bstate","next_out","next_in","Z_NEED_DICT","avail_out","max_start","max_block_size","bflush","hash_head","max_insert","STATIC_TREES","ZStream","next_in_index","next_out_index","Deflater","bufsize","append","onprogress","buffers","lastIndex","bufferIndex","chunk","start","size","self","_zipjs_Deflater","inflate_mask","fixed_tl","fixed_td","cplens","cplext","cpdist","cpdext","InfTree","hn","u","huft_build","bindex","mask","q","xp","initWorkArea","vsize","Int32Array","BMAX","inflate_trees_bits","bb","tb","inflate_trees_dynamic","nl","nd","bl","bd","tl","td","InfCodes","tree_index","need","lit","lbits","dbits","ltree_index","dtree_index","inflate_fast","tl_index","td_index","tp","tp_index","ml","md","tp_index_t_3","bitb","bitk","end","read_byte","proc","tindex","inflate_flush","free","inflate_trees_fixed","border","InfBlocks","blens","table","codes","hufts","MANY","inftree","reset","bl_","bd_","tl_","td_","set_dictionary","sync_point","mark","Inflate","inflateReset","istate","blocks","method","was","marker","wbits","inflateEnd","inflateInit","inflate","inflateSetDictionary","inflateSync","inflateSyncPoint","Inflater","nomoreinput","_zipjs_Inflater","appendABViewSupported","Blob","DataView","ArrayBuffer","Crc32","crc","NOOP","getDataHelper","byteLength","bytes","dataBuffer","dataArray","Reader","TextReader","blobReader","onerror","blob","BlobReader","readUint8Array","Data64URIReader","dataURI","dataStart","dataEnd","charAt","ceil","atob","substring","delta","charCodeAt","FileReader","onload","readAsArrayBuffer","webkitSlice","mozSlice","msSlice","Writer","TextWriter","encoding","writeUint8Array","getData","readAsText","Data64URIWriter","contentType","dataString","fromCharCode","btoa","BlobWriter","launchWorkerProcess","worker","initialMessage","onend","onreaderror","onwriteerror","outputSize","chunkIndex","sn","onflush","onmessage","codecTime","crcTime","loaded","postMessage","ex","launchProcess","process","crcType","crcInput","crcOutput","outputData","inputData","setTimeout","computeCrc32","Zip","useWebWorkers","codecClass","decodeASCII","str","charCode","out","extendedASCII","decodeUTF8","e38","decodeURIComponent","escape","getString","readCommonHeader","entry","version","getUint16","bitFlag","e40","compressionMethod","t13","lastModDateRaw","getUint32","lastModDate","n11","time","e41","timeRaw","Date","date","e42","crc32","compressedSize","uncompressedSize","filenameLength","extraFieldLength","encodeUTF8","unescape","encodeURIComponent","$23479e1e9736d413$var$A","e46","e48","deflater","$23479e1e9736d413$var$I","$23479e1e9736d413$var$C","inflater","$23479e1e9736d413$var$L","$23479e1e9736d413$var$B","$23479e1e9736d413$var$H","workerScripts","workerScriptsPath","$23479e1e9736d413$var$K","i9","r8","href","Worker","scripts","terminate","errorHandler","e51","createReader","$23479e1e9736d413$var$W","$23479e1e9736d413$var$T","inflateSN","Entry","checkCrc32","t14","n12","e55","t15","n13","i11","dataCrc32","r10","setUint32","l4","e56","o4","$23479e1e9736d413$var$R","s6","e58","r11","e60","_worker","getWriterData","t16","e61","$23479e1e9736d413$var$N","a7","f3","u2","d2","eocdrCallback","eocdrNotFoundCallback","ERR_BAD_FORMAT","zipReader","getEntries","e62","ERR_READ","doSeek","EOCDR_MIN","datalength","dataView","i13","a8","o5","entries","fileslength","e63","commentLength","directory","$23479e1e9736d413$var$q","filename","comment","close","t17","createWorker","onerror_default","createWriter","$23479e1e9736d413$var$Y","dontDeflate","e65","a6","files","filenames","deflateSN","$23479e1e9736d413$var$J","e67","t18","n14","i14","t19","n15","i15","r13","a9","o6","s7","zipWriter","e69","u3","e70","writeFooter","t20","footer","compressedLength","trim","hasOwnProperty","headerArray","setUint8","setUint16","getHours","getMinutes","getSeconds","getFullYear","getMonth","e71","l5","writeFile","$23479e1e9736d413$var$Z","indexFilename","file","e68","e72","d3","ZipFileEntryProto","zip","ZipBlobReader","$23479e1e9736d413$var$le","e74","getTotalSize","e75","t21","$23479e1e9736d413$var$re","e77","child","initReaders","next","detach","resetFS","fs","ZipDirectoryEntry","$23479e1e9736d413$var$ce","e81","ZipFileEntry","$23479e1e9736d413$var$we","$23479e1e9736d413$var$_e","e82","ZipEntry","e83","FS","getChildByName","$23479e1e9736d413$var$he","e85","getFileEntry","zipVersion","fileEntry","totalSize","r14","childIndex","a10","$23479e1e9736d413$var$ue","processChild","n17","i18","r15","a11","e86","t22","n16","i17","$23479e1e9736d413$var$fe","isDescendantOf","t23","nextChild","childFileEntry","getDirectory","FileWriter","getMimeType","t24","getFile","currentIndex","moveTo","e91","getFullname","fullname","e92","ancestor","e93","r16","t25","stepCopy","i20","e95","getBlob","$23479e1e9736d413$var$Q","getText","getData64URI","ZipDirectoryEntryProto","addDirectory","e99","addChild","$23479e1e9736d413$var$ne","addText","$23479e1e9736d413$var$X","addBlob","e100","addData64URI","$23479e1e9736d413$var$ee","addFileEntry","$23479e1e9736d413$var$te","isDirectory","e103","zipEntry","$23479e1e9736d413$var$ae","readEntries","isFile","importZip","e104","t28","n22","e107","e106","childZipEntry","e108","addData","i21","importBlob","e105","importText","e109","importData64URI","exportBlob","exportZip","e112","exportText","e113","exportFileEntry","exportData64URI","e115","e116","path","e118","pathPart","e121","e120","n24","i22","r18","exportChild","e124","$23479e1e9736d413$var$ve","getById","e129","e132","e135","e136","e137","SimpleDropzone","el","inputEl","drop","dropstart","droperror","_onDragover","_onDrop","_onSelect","_emit","e138","e140","destroy","t32","e142","stopPropagation","dataTransfer","webkitGetAsEntry","_loadZip","getAsFile","_loadNextEntry","_fail","e146","e147","_isZip","e148","fileMap","webkitRelativePath","e149","fullPath","i24","e150","traverse","t33","$23479e1e9736d413$var$be","e152","archive","then","_this2","all","n27","e151","e154","e155","$ilwiq","parcelRequire","$16e8e6f827733a91$export$a2913a4de744d5fc","isRendering","dirty","exposure","renderer","toneMappingExposure","setBackground","tonemappingModes","LinearToneMapping","ReinhardToneMapping","CineonToneMapping","ACESFilmicToneMapping","tonemapping","toneMapping","_backgroundColor","_showBackground","showBackground","scene","ibl","useIBL","flag","environment","setPixelRatio","parameters","WebGLRenderer","outputEncoding","sRGBEncoding","physicallyCorrectLights","pmremGenerator","PMREMGenerator","compileEquirectangularShader","stopRendering","render","camera","frameFinishedCB","Camera","renderFrame","compile","requestAnimationFrame","resize","setSize","updateSceneIbl","setIBL","tex","fromEquirectangular","texture","setScene","$3bec5ab2a182c32e$export$ddf9e847a113aa9c","queue","workers","workersResolve","workerStatus","_initWorker","workerId","workerCreator","_onMessage","_getIdleWorker","transfer","setWorkerCreator","setWorkerLimit","$f1a4de4e39dd9e7f$var$_taskCache","WeakMap","$f1a4de4e39dd9e7f$var$_activeLoaders","$f1a4de4e39dd9e7f$export$f2e11b211e093ce0","Loader","manager","transcoderPath","transcoderBinary","transcoderPending","workerPool","workerSourceURL","workerConfig","MSC_TRANSCODER","setTranscoderPath","detectSupport","astcSupported","extensions","etc1Supported","etc2Supported","dxtSupported","bptcSupported","pvrtcSupported","capabilities","isWebGL2","jsLoader","FileLoader","setPath","setWithCredentials","withCredentials","jsContent1","loadAsync","binaryLoader","setResponseType","binaryContent1","jsContent","binaryContent","fn","BasisWorker","EngineFormat","TranscoderFormat","BasisFormat","lastIndexOf","URL","createObjectURL","load","url","onLoad","onProgress","onError","loader","CompressedTexture","promise","catch","_createTexture","_texture","needsUpdate","_createTextureFrom","transcodeResult","mipmaps","dfdTransferFn","dfdFlags","UnsignedByteType","minFilter","LinearFilter","LinearMipmapLinearFilter","magFilter","generateMipmaps","LinearEncoding","premultiplyAlpha","taskConfig","texturePending","revokeObjectURL","ETC1S","UASTC_4x4","ETC1","ETC2","BC1","BC3","BC4","BC5","BC7_M6_OPAQUE_ONLY","BC7_M5","PVRTC1_4_RGB","PVRTC1_4_RGBA","ASTC_4x4","ATC_RGB","ATC_RGBA_INTERPOLATED_ALPHA","RGBA32","RGB565","BGR565","RGBA4444","RGBAFormat","RGBA_ASTC_4x4_Format","RGBA_BPTC_Format","RGBA_ETC2_EAC_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_S3TC_DXT5_Format","RGB_ETC1_Format","RGB_ETC2_Format","RGB_PVRTC_4BPPV1_Format","RGB_S3TC_DXT1_Format","BasisModule","_EngineFormat","_TranscoderFormat","_BasisFormat","wasmBinary","onRuntimeInitialized","BASIS","initializeBasis","KTX2File","hasAlpha","ktx2File","cleanup","isValid","basisFormat","isUASTC","getWidth","getHeight","levels","getLevels","getHasAlpha","getDFDTransferFunc","getDFDFlags","transcoderFormat","engineFormat","ETC1S_OPTIONS","UASTC_OPTIONS","opt","if","needsPowerOfTwo","isPowerOfTwo","getTranscoderFormat","startTranscoding","mip","levelInfo","getImageLevelInfo","mipWidth","origWidth","mipHeight","origHeight","dst","getImageTranscodedSizeInBytes","transcodeImage","transcode","FORMAT_OPTIONS","priorityETC1S","Infinity","priorityUASTC","sort","EventDispatcher","_listeners","listenerArray","dispatchEvent","GraphEdge","_name","_parent","_child","_attributes","_disposed","isOnGraph","getName","getParent","getChild","setChild","getAttributes","isDisposed","Graph","_emptySet","_edges","_parentEdges","_childEdges","listEdges","listParentEdges","listParents","edge","listChildEdges","listChildren","disconnectParents","edges","createEdge","attributes","_registerEdge","_removeEdge","isRef","isRefList","isRefMap","$attributes","Symbol","$immutableKeys","GraphNode","graph","_createAttributes","getDefaults","defaultAttributes","ref","other","swap","old","replacement","attribute","setRef","refAttributes","removeRef","addRef","refMap","setRefMap","getRef","prevRef","listRefs","refs","retained","retainedRef","listRefMapKeys","listRefMapValues","getRefMap","metadata","$78ae820aa9ececfa$export$b67359430d3b1b2","Float32Array","random","$ab7f6dc0910e1ef7$export$f24224f1c91d8156","hypot","$ab7f6dc0910e1ef7$export$5ffbd13800309d59","sqrt","vec","$26675c4f95835ef1$export$2060d2db72cce88f","a00","a01","a02","a03","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","$26675c4f95835ef1$export$df3937d3b537df0a","mat","scaling","m11","m12","m13","m21","m22","m23","m31","m32","m33","$26675c4f95835ef1$export$71dc54d92bd04b57","is1","is2","is3","sm11","sm12","sm13","sm21","sm22","sm23","sm31","sm32","sm33","trace","S","$51861dfc7ca9d588$export$a143d493d941bafc","$eeb0961446aae8e3$export$d622b2ad8d90c771","$eeb0961446aae8e3$export$6100ba28696e12de","b64","lens","$eeb0961446aae8e3$var$getLens","validLen","placeHoldersLen","$eeb0961446aae8e3$var$Arr","$eeb0961446aae8e3$var$_byteLength","curByte","$eeb0961446aae8e3$var$revLookup","uint8","extraBytes","parts","maxChunkLength","len2","$eeb0961446aae8e3$var$encodeChunk","$eeb0961446aae8e3$var$lookup","$7221566bd4d49f44$export$aafa59e2e03f2942","$7221566bd4d49f44$export$68d8715fc104d294","$eeb0961446aae8e3$var$code","$eeb0961446aae8e3$var$i","$eeb0961446aae8e3$var$len","output","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","log","LN2","$51861dfc7ca9d588$var$customInspectSymbol","$51861dfc7ca9d588$var$Buffer","$51861dfc7ca9d588$var$createBuffer","setPrototypeOf","encodingOrOffset","$51861dfc7ca9d588$var$allocUnsafe","$51861dfc7ca9d588$var$from","isEncoding","$51861dfc7ca9d588$var$byteLength","actual","$51861dfc7ca9d588$var$fromString","isView","arrayView","$51861dfc7ca9d588$var$isInstance","$51861dfc7ca9d588$var$fromArrayBuffer","byteOffset","$51861dfc7ca9d588$var$fromArrayLike","$51861dfc7ca9d588$var$fromArrayView","SharedArrayBuffer","valueOf","isBuffer","$51861dfc7ca9d588$var$checked","$51861dfc7ca9d588$var$numberIsNaN","$51861dfc7ca9d588$var$fromObject","toPrimitive","$51861dfc7ca9d588$var$assertSize","mustMatch","loweredCase","$51861dfc7ca9d588$var$utf8ToBytes","$51861dfc7ca9d588$var$base64ToBytes","$51861dfc7ca9d588$var$slowToString","$51861dfc7ca9d588$var$hexSlice","$51861dfc7ca9d588$var$utf8Slice","$51861dfc7ca9d588$var$asciiSlice","$51861dfc7ca9d588$var$latin1Slice","$51861dfc7ca9d588$var$base64Slice","$51861dfc7ca9d588$var$utf16leSlice","$51861dfc7ca9d588$var$swap","$51861dfc7ca9d588$var$bidirectionalIndexOf","dir","$51861dfc7ca9d588$var$arrayIndexOf","i1","indexSize","arrLength","valLength","readUInt16BE","foundIndex","found","$51861dfc7ca9d588$var$hexWrite","remaining","strLen","parsed","$51861dfc7ca9d588$var$utf8Write","$51861dfc7ca9d588$var$blitBuffer","$51861dfc7ca9d588$var$asciiWrite","byteArray","$51861dfc7ca9d588$var$asciiToBytes","$51861dfc7ca9d588$var$base64Write","$51861dfc7ca9d588$var$ucs2Write","units","hi","lo","$51861dfc7ca9d588$var$utf16leToBytes","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","codePoints","$51861dfc7ca9d588$var$decodeCodePointsArray","TYPED_ARRAY_SUPPORT","proto","foo","$51861dfc7ca9d588$var$typedArraySupport","poolSize","alloc","fill","$51861dfc7ca9d588$var$alloc","allocUnsafe","allocUnsafeSlow","_isBuffer","compare","swap16","swap32","swap64","toLocaleString","inspect","thisStart","thisEnd","thisCopy","targetCopy","isFinite","toJSON","_arr","$51861dfc7ca9d588$var$hexSliceLookupTable","$51861dfc7ca9d588$var$checkOffset","ext","$51861dfc7ca9d588$var$checkInt","$51861dfc7ca9d588$var$wrtBigUInt64LE","$51861dfc7ca9d588$var$checkIntBI","BigInt","$51861dfc7ca9d588$var$wrtBigUInt64BE","$51861dfc7ca9d588$var$checkIEEE754","$51861dfc7ca9d588$var$writeFloat","littleEndian","noAssert","$51861dfc7ca9d588$var$writeDouble","newBuf","readUintLE","readUIntLE","mul","readUintBE","readUIntBE","readUint8","readUInt8","readUint16LE","readUInt16LE","readUint16BE","readUint32LE","readUInt32LE","readUint32BE","readUInt32BE","readBigUInt64LE","$51861dfc7ca9d588$var$defineBigIntMethod","$51861dfc7ca9d588$var$validateNumber","$51861dfc7ca9d588$var$boundsError","readBigUInt64BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readBigInt64LE","readBigInt64BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUintLE","writeUIntLE","writeUintBE","writeUIntBE","writeUint8","writeUInt8","writeUint16LE","writeUInt16LE","writeUint16BE","writeUInt16BE","writeUint32LE","writeUInt32LE","writeUint32BE","writeUInt32BE","writeBigUInt64LE","writeBigUInt64BE","writeIntLE","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeBigInt64LE","writeBigInt64BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","copyWithin","$51861dfc7ca9d588$var$errors","$51861dfc7ca9d588$var$E","sym","getMessage","Base","writable","configurable","$51861dfc7ca9d588$var$addNumericalSeparator","range","ERR_OUT_OF_RANGE","$51861dfc7ca9d588$var$checkBounds","ERR_INVALID_ARG_TYPE","ERR_BUFFER_OUT_OF_BOUNDS","received","isInteger","$51861dfc7ca9d588$var$INVALID_BASE64_RE","leadSurrogate","$51861dfc7ca9d588$var$base64clean","src","alphabet","i16","$51861dfc7ca9d588$var$BufferBigIntNotDefined","PropertyType","VertexLayout","BufferViewUsage","TextureChannel","Format","resultBounds","parents","propertyType","NODE","mesh","getMesh","meshBounds","getMeshBounds","getWorldMatrix","expandBounds","worldMatrix","prim","listPrimitives","getAttribute","localPos","worldPos","getCount","getElement","transformMat4","BufferUtils","[object Object]","$b304b9ace08cc8a2$require$Buffer","byteString","ia","isBase64","Buffer","TextEncoder","encode","TextDecoder","decode","arrays","totalByteLength","srcArray","paddingByte","paddedLength","padNumber","dstArray","ColorUtils","_target","convertSRGBToLinear","factor","convertLinearToSRGB","source","_source","PNGImageUtils","getSize","decodeText","PNG_FRIED_CHUNK_NAME","getChannels","_buffer","ImageUtils","mimeType","impl","impls","getGPUByteLength","uncompressedBytes","resolution","extension","validateJPEGBuffer","getUint8","image/jpeg","image/png","FileUtils","uri","fileName","mimeTypeToExtension","isPlainObject","ctor","prot","Logger","verbosity","debug","Verbosity","DEBUG","info","INFO","WARN","ERROR","SILENT","DEFAULT_INSTANCE","MathUtils","componentType","srcMat","dstTranslation","dstRotation","dstScale","sx","sy","sz","determinant","_m1","invSX","invSY","invSZ","getRotation","srcTranslation","srcRotation","srcScale","dstMat","te","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","equalsRef","refA","refB","equalsRefList","refListA","refListB","equalsRefMap","refMapA","refMapB","keysA","keysB","equalsArray","equalsObject","numKeysA","numKeysB","valueA","valueB","previousIDs","generateOne","rtn","uuid","retries","HTTPUtils","basename","pathname","isRelativePath","PROTOCOL_REGEXP","test","DEFAULT_INIT","COPY_IDENTITY","Property","extras","setName","getExtras","setExtras","clone","PropertyClass","subkey","thisValue","otherValue","ExtensibleProperty","getExtension","setExtension","extensionProperty","_validateParent","listExtensions","Accessor","_in","identity","_out","ACCESSOR","Type","SCALAR","ComponentType","FLOAT","normalized","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","UNSIGNED_INT","getMinNormalized","elementSize","getElementSize","getMin","getMaxNormalized","getMax","getType","setType","getComponentSize","BYTES_PER_ELEMENT","getComponentType","getNormalized","setNormalized","denormalize","normalize","getScalar","setScalar","setElement","getBuffer","setBuffer","getArray","setArray","Uint32Array","Uint16Array","Int16Array","Int8Array","getByteLength","Animation","ANIMATION","channels","samplers","addChannel","channel","removeChannel","listChannels","addSampler","sampler","removeSampler","listSamplers","AnimationChannel","ANIMATION_CHANNEL","targetPath","targetNode","getTargetPath","setTargetPath","getTargetNode","setTargetNode","getSampler","setSampler","TargetPath","TRANSLATION","ROTATION","SCALE","WEIGHTS","AnimationSampler","ANIMATION_SAMPLER","getDefaultAttributes","interpolation","Interpolation","LINEAR","getInterpolation","setInterpolation","getInput","setInput","usage","OTHER","getOutput","setOutput","STEP","CUBICSPLINE","BUFFER","getURI","setURI","CAMERA","PERSPECTIVE","znear","zfar","aspectRatio","yfov","xmag","ymag","getZNear","setZNear","getZFar","setZFar","getAspectRatio","setAspectRatio","getYFov","setYFov","getXMag","setXMag","getYMag","setYMag","ORTHOGRAPHIC","ExtensionProperty","parentTypes","EXTENSION_NAME","TextureInfo","TEXTURE_INFO","texCoord","wrapS","WrapMode","REPEAT","wrapT","getTexCoord","setTexCoord","getMagFilter","setMagFilter","getMinFilter","setMinFilter","getWrapS","setWrapS","getWrapT","setWrapT","CLAMP_TO_EDGE","MIRRORED_REPEAT","MagFilter","NEAREST","MinFilter","NEAREST_MIPMAP_NEAREST","LINEAR_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_LINEAR","R","G","B","A","Material","MATERIAL","alphaMode","AlphaMode","OPAQUE","alphaCutoff","doubleSided","baseColorFactor","baseColorTexture","baseColorTextureInfo","emissiveFactor","emissiveTexture","emissiveTextureInfo","normalScale","normalTexture","normalTextureInfo","occlusionStrength","occlusionTexture","occlusionTextureInfo","roughnessFactor","metallicFactor","metallicRoughnessTexture","metallicRoughnessTextureInfo","getDoubleSided","setDoubleSided","getAlpha","setAlpha","getAlphaMode","setAlphaMode","getAlphaCutoff","setAlphaCutoff","getBaseColorFactor","setBaseColorFactor","getBaseColorHex","factorToHex","setBaseColorHex","hexToFactor","getBaseColorTexture","getBaseColorTextureInfo","setBaseColorTexture","getEmissiveFactor","setEmissiveFactor","getEmissiveHex","setEmissiveHex","getEmissiveTexture","getEmissiveTextureInfo","setEmissiveTexture","getNormalScale","setNormalScale","scale","getNormalTexture","getNormalTextureInfo","setNormalTexture","getOcclusionStrength","setOcclusionStrength","strength","getOcclusionTexture","getOcclusionTextureInfo","setOcclusionTexture","getRoughnessFactor","setRoughnessFactor","getMetallicFactor","setMetallicFactor","getMetallicRoughnessTexture","getMetallicRoughnessTextureInfo","setMetallicRoughnessTexture","MASK","BLEND","Mesh","MESH","weights","primitives","addPrimitive","primitive","removePrimitive","getWeights","setWeights","Node","translation","rotation","skin","getTranslation","getScale","setTranslation","setRotation","setScale","getMatrix","setMatrix","matrix","decompose","getWorldTranslation","getWorldRotation","getWorldScale","ancestors","multiply","childrenRefs","setMesh","getCamera","setCamera","getSkin","setSkin","Primitive","PRIMITIVE","Mode","TRIANGLES","material","indices","getIndices","setIndices","ELEMENT_ARRAY_BUFFER","semantic","setAttribute","accessor","ARRAY_BUFFER","listAttributes","listSemantics","getMaterial","setMaterial","getMode","setMode","listTargets","addTarget","removeTarget","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLE_STRIP","TRIANGLE_FAN","PrimitiveTarget","PRIMITIVE_TARGET","$b304b9ace08cc8a2$var$ht","Scene","SCENE","Skin","SKIN","skeleton","inverseBindMatrices","joints","getSkeleton","setSkeleton","getInverseBindMatrices","setInverseBindMatrices","INVERSE_BIND_MATRICES","addJoint","joint","removeJoint","listJoints","Texture","TEXTURE","image","extensionToMimeType","setMimeType","getImage","setImage","assertView","Root","ROOT","asset","generator","defaultScene","accessors","animations","cameras","materials","meshes","nodes","scenes","skins","textures","_extensions","_addChildOfRoot","setDefaultScene","getDefaultScene","extensionName","otherExtension","getAsset","listExtensionsUsed","listExtensionsRequired","isRequired","_enableExtension","_disableExtension","listScenes","listNodes","listCameras","listSkins","listMeshes","listMaterials","listTextures","listAnimations","listAccessors","listBuffers","Document","_graph","_root","_logger","getRoot","getGraph","getLogger","setLogger","logger","merge","thisExtension","createExtension","setRequired","visited","propertyMap","thisProp","otherProp","resolved","transforms","transform","createScene","createNode","createCamera","createSkin","createMesh","createPrimitive","createPrimitiveTarget","createMaterial","createTexture","createAnimation","createAnimationChannel","createAnimationSampler","createAccessor","createBuffer","Extension","prereadTypes","prewriteTypes","readDependencies","writeDependencies","properties","_listener","_event","_addExtensionProperty","_removeExtensionProperty","property","install","dependency","preread","_readerContext","_propertyType","prewrite","_writerContext","ReaderContext","jsonDoc","bufferViews","bufferViewBuffers","textureInfos","setTextureInfo","textureInfo","textureInfoDef","textureDef","json","samplerDef","ComponentTypeToTypedArray","5120","5121","5122","5123","5125","5126","DEFAULT_OPTIONS","dependencies","getAccessorArray","accessorDef","bufferView","bufferViewDef","TypedArray","componentSize","byteStride","accessorByteOffset","getFloat32","getInt16","getInt8","BufferViewTarget","WriterContext","_doc","accessorIndexMap","animationIndexMap","bufferIndexMap","cameraIndexMap","skinIndexMap","materialIndexMap","meshIndexMap","nodeIndexMap","imageIndexMap","textureDefIndexMap","textureInfoDefMap","samplerDefIndexMap","sceneIndexMap","imageBufferViews","otherBufferViews","otherBufferViewsIndexMap","extensionData","bufferURIGenerator","imageURIGenerator","_accessorUsageMap","accessorUsageGroupedByParent","accessorParents","numBuffers","numImages","UniqueURIGenerator","createTextureInfoDef","samplerKey","textureKey","createPropertyDef","def","createAccessorDef","some","fround","createImageData","imageDef","GLB","createURI","resources","getAccessorUsage","cachedUsage","addAccessorToUsageGroup","prevUsage","listAccessorUsageGroups","USAGE_TO_TARGET","multiple","counter","ChunkType","PlatformIO","_dependencies","_vertexLayout","INTERLEAVED","lastReadBytes","lastWriteBytes","registerExtensions","registerDependencies","setVertexLayout","readJSON","readAsJSON","detectFormat","_readGLB","_readGLTF","_copyJSON","_readResourcesInternal","_options","validate","assetDef","copyright","extensionsUsed","extensionsRequired","bufferDefs","bufferDef","toView","sparse","sparseDef","indicesDef","valuesDef","imageDefs","images","textureDefs","imageData","materialDef","pbrDef","pbrMetallicRoughness","meshDefs","meshDef","primitiveDef","targetNames","targetDef","targetIndex","targetName","accessorIndex","cameraDef","perspectiveDef","perspective","orthoDef","orthographic","nodeDefs","nodeDef","skinDef","nodeIndex","animationDef","animation","channelDef","sceneDefs","sceneDef","glb","_binaryToJSON","jsonDocument","binaryToJSON","extensionsRegistered","concatAccessors","bufferByteOffset","bufferViewTarget","accessorArray","pad","interleaveAccessors","vertexCount","vertexByteOffset","viewByteOffset","setFloat32","setInt8","setInt16","accessorRefs","uses","textureIndex","groupByParent","accessorEdges","parentAccessors","bufferAccessors","bufferAccessorsSet","bufferByteLength","usageGroups","vertexLayout","imagePadding","eq","samplerIndexMap","samplerIndex","unused","GLTF","writeJSON","jsonText","jsonChunkData","encodeText","jsonChunkHeader","jsonChunk","binBuffer","binChunkData","binChunkHeader","binChunk","isAbsoluteURL","jsonContent","readURI","_readResourcesExternal","dirname","pendingResources","async","resource","_this","resolveResource","resourceUUID","createBufferFromDataURI","jsonByteLength","binByteOffset","BIN","@glb.bin","WebIO","fetchConfig","_fetchConfig","response","fetch","arrayBuffer","NUL","KTX2_ID","KTX2SupercompressionScheme","KTX2DescriptorType","KTX2Model","KTX2Primaries","KTX2Transfer","KTX2Flags","KTX2ChannelETC1S","KTX2ChannelUASTC","KTX2Container","NONE","vendorId","descriptorType","BASICFORMAT","versionNumber","descriptorBlockSize","colorModel","UNSPECIFIED","colorPrimaries","SRGB","transferFunction","ALPHA_STRAIGHT","texelBlockDimension","bytesPlane","samples","BufferReader","_dataView","_littleEndian","_offset","_nextUint8","_nextUint16","_nextUint32","_nextUint64","_skip","_scan","maxByteLength","term","headerByteLength","headerReader","vkFormat","typeSize","pixelWidth","pixelHeight","pixelDepth","layerCount","faceCount","levelCount","supercompressionScheme","dfdByteOffset","dfdByteLength","kvdByteOffset","kvdByteLength","sgdByteOffset","sgdByteLength","levelReader","levelData","uncompressedByteLength","dfdReader","dfd","numSamples","bitOffset","bitLength","channelID","samplePosition","sampleLower","sampleUpper","dataFormatDescriptor","kvdReader","keyValueByteLength","keyData","valueData","keyValue","sgdReader","endpointCount","selectorCount","endpointsByteLength","selectorsByteLength","tablesByteLength","extendedByteLength","imageDescs","imageFlags","rgbSliceByteOffset","rgbSliceByteLength","alphaSliceByteOffset","alphaSliceByteLength","endpointsByteOffset","selectorsByteOffset","tablesByteOffset","extendedByteOffset","endpointsData","selectorsData","tablesData","extendedData","globalData","InstancedMesh","MeshGPUInstancing","NAME","provideTypes","createInstancedMesh","instancedMeshDef","instancedMesh","prop","EncoderMethod","MeshoptMode","MeshoptFilter","prepareAccessor","encoder","filterOptions","ATTRIBUTES","EXPONENTIAL","encodeFilterExp","OCTAHEDRAL","il","encodeFilterOct","QUATERNION","encodeFilterQuat","elementStride","getMeshoptMode","INDICES","getMeshoptFilter","refName","refKey","DEFAULT_ENCODER_OPTIONS","QUANTIZE","MeshoptCompression","_decoder","_decoderFallbackBufferMap","_encoder","_encoderOptions","_encoderFallbackBuffer","_encoderBufferViews","_encoderBufferViewData","_encoderBufferViewAccessors","setEncoderOptions","supported","_prereadBuffers","_prereadPrimitives","viewDef","meshoptDef","stride","decodeGltfBuffer","EXT_meshopt_compression","fallback","_context","fallbackBuffer","_prewriteAccessors","_prewriteBuffers","fallbackBufferIndex","FILTER","preparedAccessor","bufferViewData","bufferViewAccessors","encodeGltfBuffer","compressedData","fallbackBufferByteOffset","bufferViewIndex","finalBufferViewDef","compressedByteOffset","fallbackBufferDef","WEBPImageUtils","RIFF","WEBP","chunkId","chunkByteLength","TextureWebP","registerFormat","imageIndex","decoderModule","COMPONENT_ARRAY","DATA_TYPE","encoderModule","decodeGeometry","decoder","DecoderBuffer","Init","GetEncodedGeometryType","TRIANGULAR_MESH","dracoMesh","DecodeBufferToMesh","ok","ptr","decodeIndex","numIndices","num_faces","num_points","_malloc","GetTrianglesUInt16Array","HEAPU16","GetTrianglesUInt32Array","HEAPU32","_free","decodeAttribute","dataType","ArrayCtor","numComponents","num_components","numValues","GetAttributeDataArrayForAllPoints","HEAPF32","AttributeEnum","DEFAULT_QUANTIZATION_BITS","POSITION","NORMAL","COLOR","TEX_COORD","GENERIC","decodeSpeed","encodeSpeed","EDGEBREAKER","quantizationBits","quantizationVolume","encodeGeometry","Encoder","builder","MeshBuilder","attributeIDs","dracoBuffer","DracoInt8Array","attributeEnum","getAttributeEnum","attributeID","addAttribute","SetAttributeQuantization","SetAttributeExplicitQuantization","AddFacesToMesh","SetSpeedOptions","SetTrackEncodedProperties","SEQUENTIAL","SetEncodingMethod","MESH_SEQUENTIAL_ENCODING","MESH_EDGEBREAKER_ENCODING","EncodeMeshToDracoBuffer","GetValue","prevNumVertices","numVertices","GetNumberOfEncodedPoints","GetNumberOfEncodedFaces","itemSize","AddUInt8Attribute","AddInt8Attribute","AddUInt16Attribute","AddInt16Attribute","AddUInt32Attribute","AddFloatAttribute","DracoMeshCompression","_decoderModule","_encoderModule","DT_FLOAT32","DT_UINT32","DT_UINT16","DT_UINT8","DT_INT16","DT_INT8","dracoMeshes","primDef","dracoDef","Decoder","dracoAttribute","GetAttributeByUniqueId","attributeArray","primitiveHashMap","included","excluded","accessorIndices","includedAccessors","includedHashKeys","primToHashKey","hashKey","createHashKey","dstIndices","dstAttribute","attr","primitiveEncodingMap","primHash","accessorDefs","encodedPrim","attributeDef","dracoContext","indexMap","hashElements","Light","intensity","POINT","innerConeAngle","outerConeAngle","getColor","setColor","getColorHex","setColorHex","getIntensity","setIntensity","getRange","setRange","getInnerConeAngle","setInnerConeAngle","getOuterConeAngle","setOuterConeAngle","SPOT","DIRECTIONAL","LightsPunctual","createLight","lights","lightDef","light","spot","lightDefs","lightIndexMap","Anisotropy","anisotropy","anisotropyTexture","anisotropyTextureInfo","anisotropyDirection","anisotropyDirectionTexture","anisotropyDirectionTextureInfo","getAnisotropy","setAnisotropy","getAnisotropyTexture","getAnisotropyTextureInfo","setAnisotropyTexture","getAnisotropyDirection","setAnisotropyDirection","direction","getAnisotropyDirectionTexture","getAnisotropyDirectionTextureInfo","setAnisotropyDirectionTexture","MaterialsAnisotropy","createAnisotropy","materialIndex","anisotropyDef","Clearcoat","clearcoatFactor","clearcoatTexture","clearcoatTextureInfo","clearcoatRoughnessFactor","clearcoatRoughnessTexture","clearcoatRoughnessTextureInfo","clearcoatNormalScale","clearcoatNormalTexture","clearcoatNormalTextureInfo","getClearcoatFactor","setClearcoatFactor","getClearcoatTexture","getClearcoatTextureInfo","setClearcoatTexture","getClearcoatRoughnessFactor","setClearcoatRoughnessFactor","getClearcoatRoughnessTexture","getClearcoatRoughnessTextureInfo","setClearcoatRoughnessTexture","getClearcoatNormalScale","setClearcoatNormalScale","getClearcoatNormalTexture","getClearcoatNormalTextureInfo","setClearcoatNormalTexture","MaterialsClearcoat","createClearcoat","clearcoat","clearcoatDef","EmissiveStrength","emissiveStrength","getEmissiveStrength","setEmissiveStrength","MaterialsEmissiveStrength","createEmissiveStrength","emissiveStrengthDef","IOR","ior","getIOR","setIOR","MaterialsIOR","createIOR","iorDef","Iridescence","iridescenceFactor","iridescenceTexture","iridescenceTextureInfo","iridescenceIOR","iridescenceThicknessMinimum","iridescenceThicknessMaximum","iridescenceThicknessTexture","iridescenceThicknessTextureInfo","getIridescenceFactor","setIridescenceFactor","getIridescenceTexture","getIridescenceTextureInfo","setIridescenceTexture","getIridescenceIOR","setIridescenceIOR","getIridescenceThicknessMinimum","setIridescenceThicknessMinimum","thickness","getIridescenceThicknessMaximum","setIridescenceThicknessMaximum","getIridescenceThicknessTexture","getIridescenceThicknessTextureInfo","setIridescenceThicknessTexture","MaterialsIridescence","createIridescence","iridescence","iridescenceDef","iridescenceIor","PBRSpecularGlossiness","diffuseFactor","diffuseTexture","diffuseTextureInfo","specularFactor","glossinessFactor","specularGlossinessTexture","specularGlossinessTextureInfo","getDiffuseFactor","setDiffuseFactor","getDiffuseHex","setDiffuseHex","getDiffuseTexture","getDiffuseTextureInfo","setDiffuseTexture","getSpecularFactor","setSpecularFactor","getGlossinessFactor","setGlossinessFactor","getSpecularGlossinessTexture","getSpecularGlossinessTextureInfo","setSpecularGlossinessTexture","MaterialsPBRSpecularGlossiness","createPBRSpecularGlossiness","specGloss","specGlossDef","Sheen","sheenColorFactor","sheenColorTexture","sheenColorTextureInfo","sheenRoughnessFactor","sheenRoughnessTexture","sheenRoughnessTextureInfo","getSheenColorFactor","getSheenColorHex","setSheenColorFactor","setSheenColorHex","getSheenColorTexture","getSheenColorTextureInfo","setSheenColorTexture","getSheenRoughnessFactor","setSheenRoughnessFactor","getSheenRoughnessTexture","getSheenRoughnessTextureInfo","setSheenRoughnessTexture","MaterialsSheen","createSheen","sheen","sheenDef","Specular","specularTexture","specularTextureInfo","specularColorFactor","specularColorTexture","specularColorTextureInfo","getSpecularColorFactor","setSpecularColorFactor","getSpecularColorHex","setSpecularColorHex","getSpecularTexture","getSpecularTextureInfo","setSpecularTexture","getSpecularColorTexture","getSpecularColorTextureInfo","setSpecularColorTexture","MaterialsSpecular","createSpecular","specular","specularDef","Translucency","translucencyFactor","translucencyTexture","translucencyTextureInfo","translucencyColorFactor","translucencyColorTexture","translucencyColorTextureInfo","getTranslucencyFactor","setTranslucencyFactor","getTranslucencyColorFactor","setTranslucencyColorFactor","getTranslucencyColorHex","setTranslucencyColorHex","getTranslucencyTexture","getTranslucencyTextureInfo","setTranslucencyTexture","getTranslucencyColorTexture","getTranslucencyColorTextureInfo","setTranslucencyColorTexture","MaterialsTranslucency","createTranslucency","translucency","translucencyDef","Transmission","transmissionFactor","transmissionTexture","transmissionTextureInfo","getTransmissionFactor","setTransmissionFactor","getTransmissionTexture","getTransmissionTextureInfo","setTransmissionTexture","MaterialsTransmission","createTransmission","transmission","transmissionDef","Unlit","MaterialsUnlit","createUnlit","Mapping","variants","addVariant","variant","removeVariant","listVariants","MappingList","mappings","addMapping","mapping","removeMapping","listMappings","Variant","MaterialsVariants","createMappingList","createVariant","createMapping","variantDef","meshIndex","primIndex","mappingList","variantPrimDef","mappingDef","variantIndex","variantDefs","variantIndexMap","mappingDefs","Volume","thicknessFactor","thicknessTexture","thicknessTextureInfo","attenuationDistance","attenuationColor","getThicknessFactor","setThicknessFactor","getThicknessTexture","getThicknessTextureInfo","setThicknessTexture","getAttenuationDistance","setAttenuationDistance","distance","getAttenuationColor","setAttenuationColor","getAttenuationColorHex","setAttenuationColorHex","MaterialsVolume","createVolume","volume","volumeDef","MeshQuantization","KTX2ImageUtils","readKTX","UASTC","TextureBasisu","Transform","getOffset","setOffset","TextureTransform","createTransform","transformDef","textureInfoEntries","PARENT_TYPES","Packet","setContext","$911c4d4d15ee4ae1$var$N","listProperties","getProperty","setProperty","_assertContext","toJSONLD","@context","copyJSON","fromJSONLD","jsonld","XMP","createPacket","listPackets","extensionDef","_context$jsonDoc$json","packets","packetDef","defLists","propertyLists","defs","packet","packetDefs","parentDef","KHRONOS_EXTENSIONS","ALL_EXTENSIONS","$00e9fa4a9055036b$exports","$58805e71bbbc0b37$var$isBuffer","$58805e71bbbc0b37$exports","$58805e71bbbc0b37$var$isSlowBuffer","$dff307a8ad5f5850$var$hasTypedArrays","Float64Array","$dff307a8ad5f5850$var$compare1st","$dff307a8ad5f5850$var$order","terms","$dff307a8ad5f5850$var$compileConstructor","dtype","dimension","useGetters","procedure","$dff307a8ad5f5850$var$CACHED_CONSTRUCTORS","index_str","shapeArg","strideArg","a_vars","c_vars","tShape","tStride","idx","float32","float64","int8","int16","int32","uint16","uint32","uint8_clamped","bigint64","biguint64","generic","$34f15ef9600f23fe$var$innerFill","order","nargs","arrayArgs","has_index","indexArgs","vars","pidx","$34f15ef9600f23fe$var$processBlock","block","dtypes","pre","post","carg","re","RegExp","ptrStr","arrNum","argTypes","offArgIndex","offsetArgIndex","offsetArgs","localStr","arrStr","arrayBlockIndices","lvalue","reStrArr","ptrStrArr","scalarArgs","$34f15ef9600f23fe$var$typeSummary","summary","allEqual","$b211879b1899badc$var$Procedure","shimArgs","shapeArgs","funcName","$b8f37a992d095d53$exports","sorted","$b8f37a992d095d53$var$unique_pred","$b8f37a992d095d53$var$unique_eq","$34f15ef9600f23fe$exports","typesig","orders","blockBegin","blockEnd","loopBegin","loopEnd","loopOrders","newOrder","arglist","zeros","off_arg","init_string","thisVars","matched","$34f15ef9600f23fe$var$countMatches","blockSize","indexStr","$34f15ef9600f23fe$var$outerFill","loopName","$e83628607396a6e5$exports","thunkName","string_typesig","proc_args","shapeLengthConditions","shapeConditions","thunk","$b211879b1899badc$exports","user_args","arg_type","blockIndices","printCode","$bd7058b3c940594f$var$EmptyProc","localVars","$bd7058b3c940594f$var$fixup","rvalue","$bd7058b3c940594f$var$makeOp","wrapper","$bd7058b3c940594f$var$pcompile","$bd7058b3c940594f$var$assign_ops","div","mod","band","bor","bxor","lshift","rshift","rrshift","$bd7058b3c940594f$exports","$bd7058b3c940594f$var$unary_ops","not","bnot","neg","recip","$bd7058b3c940594f$var$binary_ops","and","or","neq","lt","gt","leq","geq","$bd7058b3c940594f$var$math_unary","$bd7058b3c940594f$var$math_comm","$bd7058b3c940594f$var$math_noncomm","any","sum","prod","norm2squared","norm2","norminf","norm1","sup","inf","argmin","argmax","assigns","Method","$8732fa7a027f6a5c$var$J","pattern","DEQUANTIZE_DEFAULTS","$8732fa7a027f6a5c$var$B","dequantizeAttribute","e24","$8732fa7a027f6a5c$var$at","Codec","OXIPNG","MOZJPEG","CODEC_TO_MIME_TYPE","formats","slots","auto","WEBP_DEFAULTS","SQUOOSH_DEFAULTS","codec","MOZJPEG_DEFAULTS","TextureResizeFilter","TEXTURE_RESIZE_DEFAULTS","$8732fa7a027f6a5c$var$xt","tolerance","WELD_DEFAULTS","t37","$b304b9ace08cc8a2$export$250ffa63cdc0d034","weldOnly","weldAndMerge","indicesArray","EPSILON","shiftFactor","decimalShift","hashToIndex","srcIndices","hash","dstAttributes","t40","nextIndex","srcVertexCount","dstVertexCount","swapAttributes","$8732fa7a027f6a5c$var$qt","srcAttr","e87","t38","dstIndicesArray","dstIndicesTypedArray","$8732fa7a027f6a5c$var$vt","dstAttrElements","dstAttrArray","dstAttrArrayLength","dstAttr","$d7d285712895d7b4$export$b24a80cbca783e8e","instance","wasmpack","WebAssembly","assert","cond","fun","bound","sbrk","memory","maxindex","index32","insize","ready","instantiate","unpack","__wasm_call_ctors","meshopt_encodeVertexVersion","meshopt_encodeIndexVersion","reorderMesh","triangles","optsize","optf","meshopt_optimizeVertexCacheStrip","meshopt_optimizeVertexCache","vertices","ip","indices8","unique","meshopt_optimizeVertexFetchRemap","remap","reorder","encodeVertexBuffer","meshopt_encodeVertexBufferBound","meshopt_encodeVertexBuffer","encodeIndexBuffer","meshopt_encodeIndexBufferBound","meshopt_encodeIndexBuffer","encodeIndexSequence","meshopt_encodeIndexSequenceBound","meshopt_encodeIndexSequence","meshopt_encodeFilterOct","meshopt_encodeFilterQuat","meshopt_encodeFilterExp","$652a16c65ed52cce$export$1111800106ba519a","detector","wasm","count4","filters","decoders","decodeVertexBuffer","meshopt_decodeVertexBuffer","decodeIndexBuffer","meshopt_decodeIndexBuffer","decodeIndexSequence","meshopt_decodeIndexSequence","$cdf5b96ef188d6b3$export$7c4e589afcc7890","autoscale","io","$b304b9ace08cc8a2$export$873ba308a96a050a","$911c4d4d15ee4ae1$export$64b9e0af76e68b1f","$b304b9ace08cc8a2$export$f5ae2f144b95ebf4","SEPARATE","getFileExtension","createJSONDocument","uris","binaries","readBinary","$8732fa7a027f6a5c$export$cedb256e1b589121","$8732fa7a027f6a5c$export$dc57d49378f62ab","$cdf5b96ef188d6b3$var$loadScene","writeBinary","$7lx9d","GLTFLoader","setMeshoptDecoder","ktx2Loader","setKTX2Loader","gltf","bbox","Box3","setFromObject","updateMatrixWorld","File","FileList","alert","$a7d504fe664c4ba1$export$37b5e795519f3407","autoScaleScene","interactionTimeoutId","tileRes","_renderer","_fps","fps","autoRotate","controls","toggleInteractionMode","_pathtracing","togglePathtracing","startPathtracing","startRasterizer","_pixelRatio","pixelRatio","_pathtracedInteraction","pathtracedInteraction","_interactionPixelRatio","interactionPixelRatio","_showGroundPlane","showGroundPlane","canvas","startpage","getElementById","loadscreen","spinner","getElementsByClassName","canvas_pt","canvas_three","innerWidth","innerHeight","aspect","PerspectiveCamera","$5Rd1x","OrbitControls","screenSpacePanning","enableDamping","rotateSpeed","panSpeed","resetAccumulation","stopRasterizer","mouseButtons","LEFT","MOUSE","ROTATE","MIDDLE","PAN","RIGHT","DOLLY","$b69kM","PathtracingRenderer","three_renderer","powerPreference","maxBounces","dropCtrlOverlay","$23479e1e9736d413$export$3878b3f75c37188f","hideStartpage","loadDropFiles","dropEffect","timeout","showStatusScreen","loadIbl","hideLoadscreen","loadScene","sceneUrl","$cdf5b96ef188d6b3$export$1663d56c91fc78a4","sceneBoundingBox","updateCameraFromBoundingBox","centerView","addGroundPlane","sceneAdapter","ThreeSceneAdapter","setIbl","$891vQ","RGBELoader","setDataType","FloatType","floorPlane","PlaneBufferGeometry","MeshStandardMaterial","transparent","roughness","metalness","stopPathtracing","drawImage","lastTimeStamp","update","now","performance","updateProjectionMatrix","diag","distanceTo","tan","center","Vector3","getCenter","lookAt","saveImage","dataURL","toDataURL","link","download","click","showStartpage","visibility","innerText","$b679e4118c3fd2b2$export$d7def349cabdd169","credit","$b679e4118c3fd2b2$export$5c1932b377179eb0","Studio_05","_defaultIblKey","_currentIbl","_currentScene","_container","_viewer","_ui","_params","Proxy","URLSearchParams","location","search","searchParams","_scene","initMaterialSelector","ground","loadSceneFromUrl","resolveUrlFromIndex","rotate","iblRotation","initUI","zIndex","_uiTabs","optionsFromList","lighting","interator","debugModes","display","matTab","matNames","initMaterialParamUI","paneMatFolders","matIdx","colors","albedo","specularTint","translucencyColor","sheenColor","vectors","emission","basicFloatParamSettings","thinWalled","unfold","unfoldNames","folderNames","fn1","replaceAll","setSceneInfo","setIBLInfo"],"version":3,"file":"index.041bd954.js.map"}