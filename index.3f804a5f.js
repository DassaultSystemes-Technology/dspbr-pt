var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},r={},n=e.parcelRequire99a1;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in r){var n=r[e];delete r[e];var s={id:e,exports:{}};return t[e]=s,n.call(s.exports,s,s.exports),s.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},e.parcelRequire99a1=n),n.register("kjyEk",(function(e,t){})),n.register("ccDAZ",(function(e,t){var r,n,s,i,o;r=e.exports,n="cpus",s=()=>o,i=e=>o=e,Object.defineProperty(r,n,{get:s,set:i,enumerable:!0,configurable:!0}),o=function(){return[]}}));var s={};
/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */!function(e){class t{constructor(e){const[t,r]=e.split("-"),n=t.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=null!=r?r:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}class r{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class n{constructor(e){this.target=e}}class s extends n{constructor(e,t,r,n){super(e),this.value=t,this.presetKey=r,this.last=null==n||n}}class i extends n{constructor(e,t,r){super(e),this.value=t,this.presetKey=r}}class o extends n{constructor(e,t){super(e),this.expanded=t}}function a(e){return e}function l(e){return null==e}function c(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const u={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class h{constructor(e){var t;this.message=null!==(t=u[e.type](a(e.context)))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new h({type:"alreadydisposed"})}static notBindable(){return new h({type:"notbindable"})}static propertyNotFound(e){return new h({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new h({type:"shouldneverhappen"})}}class p{constructor(e,t,r){this.obj_=e,this.key_=t,this.presetKey_=null!=r?r:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const r=this.read();if(!p.isBindable(r))throw h.notBindable();if(!(e in r))throw h.propertyNotFound(e);r[e]=t}}class d extends r{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const r=t.bind(this);return this.controller_.valueController.emitter.on(e,(()=>{r(new n(this))})),this}}class f{constructor(){this.observers_={}}on(e,t){let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t}),this}off(e,t){const r=this.observers_[e];return r&&(this.observers_[e]=r.filter((e=>e.handler!==t))),this}emit(e,t){const r=this.observers_[e];r&&r.forEach((e=>{e.handler(t)}))}}const g="tp";function m(e){return(t,r)=>[g,"-",e,"v",t?`_${t}`:"",r?`-${r}`:""].join("")}function A(e,t){return r=>t(e(r))}function v(e){return e.rawValue}function B(e,t){e.emitter.on("change",A(v,t)),t(e.rawValue)}function _(e,t,r){B(e.value(t),r)}function C(e,t,r){r?e.classList.add(t):e.classList.remove(t)}function b(e,t){return r=>{C(e,t,r)}}function w(e,t){B(e,(e=>{t.textContent=null!=e?e:""}))}const E=m("btn");class x{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(E()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("button");r.classList.add(E("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const n=e.createElement("div");n.classList.add(E("t")),w(t.props.value("title"),n),this.buttonElement.appendChild(n)}}class y{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new x(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class D{constructor(e,t){var r;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(r=null==t?void 0:t.equals)&&void 0!==r?r:(e,t)=>e===t,this.emitter=new f,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(e):e;(!this.equals_(this.rawValue_,n)||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:r,rawValue:n,sender:this}))}}class T{constructor(e){this.emitter=new f,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0};(this.value_!==e||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:r,rawValue:this.value_,sender:this}))}}function I(e,t){const r=null==t?void 0:t.constraint,n=null==t?void 0:t.equals;return r||n?new D(e,t):new T(e)}class R{constructor(e){this.emitter=new f,this.valMap_=e;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}static createCore(e){return Object.keys(e).reduce(((t,r)=>Object.assign(t,{[r]:I(e[r])})),{})}static fromObject(e){const t=this.createCore(e);return new R(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function F(e,t){return a(Object.keys(t).reduce(((r,n)=>{if(void 0===r)return;const s=(0,t[n])(e[n]);return s.succeeded?Object.assign(Object.assign({},r),{[n]:s.value}):void 0}),{}))}function M(e,t){return e.reduce(((e,r)=>{if(void 0===e)return;const n=t(r);return n.succeeded&&void 0!==n.value?[...e,n.value]:void 0}),[])}function P(e){return null!==e&&"object"==typeof e}function S(e){return t=>r=>{if(!t&&void 0===r)return{succeeded:!1,value:void 0};if(t&&void 0===r)return{succeeded:!0,value:void 0};const n=e(r);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function L(e){return{custom:t=>S(t)(e),boolean:S((e=>"boolean"==typeof e?e:void 0))(e),number:S((e=>"number"==typeof e?e:void 0))(e),string:S((e=>"string"==typeof e?e:void 0))(e),function:S((e=>"function"==typeof e?e:void 0))(e),constant:t=>S((e=>e===t?t:void 0))(e),raw:S((e=>e))(e),object:t=>S((e=>{if(P(e))return F(e,t)}))(e),array:t=>S((e=>{if(Array.isArray(e))return M(e,t)}))(e)}}const O={optional:L(!0),required:L(!1)};function N(e,t){const r=O.required.object(t)(e);return r.succeeded?r.value:void 0}function k(e){return e&&e.parentElement&&e.parentElement.removeChild(e),null}function H(){return["veryfirst","first","last","verylast"]}const G=m(""),K={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class V{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{H().forEach((e=>{t.classList.remove(G(void 0,K[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(G(void 0,K[e]))}))})),this.viewProps.handleDispose((()=>{k(t)}))}get parent(){return this.parent_}}const U="http://www.w3.org/2000/svg";function j(e){e.offsetHeight}function J(e,t){const r=e.style.transition;e.style.transition="none",t(),e.style.transition=r}function W(e){return void 0!==e.ontouchstart}function X(){return new Function("return this")()}function z(){return a(X()).document}function Z(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d"):null}const q={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Y(e,t){const r=e.createElementNS(U,"svg");return r.innerHTML=q[t],r}function Q(e,t,r){e.insertBefore(t,e.children[r])}function $(e){e.parentElement&&e.parentElement.removeChild(e)}function ee(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function te(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}function re(e){return e.relatedTarget?a(e.relatedTarget):"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const ne=m("lbl");function se(e,t){const r=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,n)=>{n>0&&r.appendChild(e.createElement("br")),r.appendChild(t)})),r}class ie{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ne()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(ne("l")),_(t.props,"label",(t=>{l(t)?this.element.classList.add(ne(void 0,"nol")):(this.element.classList.remove(ne(void 0,"nol")),te(r),r.appendChild(se(e,t)))})),this.element.appendChild(r),this.labelElement=r;const n=e.createElement("div");n.classList.add(ne("v")),this.element.appendChild(n),this.valueElement=n}}class oe extends V{constructor(e,t){const r=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new ie(e,{props:t.props,viewProps:r}),viewProps:r})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const ae={id:"button",type:"blade",accept(e){const t=O,r=N(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return r?{params:r}:null},controller:e=>new oe(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:new y(e.document,{props:R.fromObject({title:e.params.title}),viewProps:e.viewProps})}),api:e=>e.controller instanceof oe&&e.controller.valueController instanceof y?new d(e.controller):null};class le extends V{constructor(e){super(e),this.value=e.value}}function ce(){return new R({positions:I([],{equals:c})})}class ue extends R{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},r=R.createCore(t);return new ue(r)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!l(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const r=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};_(this,"expanded",r),_(this,"temporaryExpanded",r)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function he(e,t){let r=0;return J(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),j(t),r=t.clientHeight,e.set("temporaryExpanded",null),j(t)})),r}function pe(e,t){t.style.height=e.styleHeight}function de(e,t){e.value("expanded").emitter.on("beforechange",(()=>{e.set("completed",!1),l(e.get("expandedHeight"))&&e.set("expandedHeight",he(e,t)),e.set("shouldFixHeight",!0),j(t)})),e.emitter.on("change",(()=>{pe(e,t)})),pe(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class fe extends r{constructor(e,t){super(e),this.rackApi_=t}}function ge(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function me(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Ae(e,t){const r=t||{};return e.addBlade(Object.assign(Object.assign({},r),{view:"separator"}))}function ve(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class Be{constructor(e){this.emitter=new f,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw h.shouldNeverHappen();const r=void 0!==t?t:this.items_.length;this.items_.splice(r,0,e),this.cache_.add(e);const n=this.extract_(e);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:r,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const r=this.extract_(e);r&&(r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class _e extends r{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new s(this,a(t),this.controller_.binding.target.presetKey,e.options.last)})}}class Ce extends oe{constructor(e,t){super(e,t),this.binding=t.binding}}class be extends r{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new f,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new i(this,a(t),this.controller_.binding.target.presetKey)})}}class we extends oe{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function Ee(e){return e instanceof De?e.apiSet_:e instanceof fe?e.rackApi_.apiSet_:null}function xe(e,t){const r=e.find((e=>e.controller_===t));if(!r)throw h.shouldNeverHappen();return r}function ye(e,t,r){if(!p.isBindable(e))throw h.notBindable();return new p(e,t,r)}class De extends r{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new f,this.apiSet_=new Be(Ee),this.pool_=t;const r=this.controller_.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),r.emitter.on("inputchange",this.onRackInputChange_),r.emitter.on("monitorupdate",this.onRackMonitorUpdate_),r.children.forEach((e=>{this.setUpApi_(e)}))}get children(){return this.controller_.rack.children.map((e=>xe(this.apiSet_,e)))}addInput(e,t,r){const n=r||{},s=this.controller_.view.element.ownerDocument,i=this.pool_.createInput(s,ye(e,t,n.presetKey),n),o=new _e(i);return this.add(o,n.index)}addMonitor(e,t,r){const n=r||{},s=this.controller_.view.element.ownerDocument,i=this.pool_.createMonitor(s,ye(e,t),n),o=new be(i);return a(this.add(o,n.index))}addFolder(e){return me(this,e)}addButton(e){return ge(this,e)}addSeparator(e){return Ae(this,e)}addTab(e){return ve(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const r=this.apiSet_.find((t=>t.controller_===e.controller_));return r&&this.apiSet_.remove(r),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,r=this.pool_.createBlade(t,e),n=this.pool_.createBladeApi(r);return this.add(n,e.index)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}setUpApi_(e){this.apiSet_.find((t=>t.controller_===e))||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=xe(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof Ce){const r=xe(this.apiSet_,t),n=t.binding;this.emitter_.emit("change",{event:new s(r,a(n.target.read()),n.target.presetKey,e.options.last)})}else if(t instanceof le){const r=xe(this.apiSet_,t);this.emitter_.emit("change",{event:new s(r,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof we))throw h.shouldNeverHappen();const t=xe(this.apiSet_,e.bladeController),r=e.bladeController.binding;this.emitter_.emit("update",{event:new i(t,a(r.target.read()),r.target.presetKey)})}}class Te extends fe{constructor(e,t){super(e,new De(e.rackController,t)),this.emitter_=new f,this.controller_.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",{event:new o(this,e.sender.rawValue)})})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,r){return this.rackApi_.addInput(e,t,r)}addMonitor(e,t,r){return this.rackApi_.addMonitor(e,t,r)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}}class Ie extends V{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class Re{constructor(e,t){const r=m(t.viewName);this.element=e.createElement("div"),this.element.classList.add(r()),t.viewProps.bindClassModifiers(this.element)}}function Fe(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n instanceof Ce&&n.binding===t)return n}return null}function Me(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n instanceof we&&n.binding===t)return n}return null}function Pe(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n instanceof le&&n.value===t)return n}return null}function Se(e){return e instanceof Ne?e.rack:e instanceof Ie?e.rackController.rack:null}function Le(e){const t=Se(e);return t?t.bcSet_:null}class Oe{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new f,this.blade_=null!=e?e:null,null===(t=this.blade_)||void 0===t||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Be(Le),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return a(this.bcSet_.allItems().filter((t=>t instanceof e)))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const r=e.item;if(r.viewProps.emitter.on("change",this.onChildViewPropsChange_),r.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),r.viewProps.handleDispose(this.onChildDispose_),r instanceof Ce)r.binding.emitter.on("change",this.onChildInputChange_);else if(r instanceof we)r.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(r instanceof le)r.value.emitter.on("change",this.onChildValueChange_);else{const e=Se(r);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const r=e.item;if(r instanceof Ce)r.binding.emitter.off("change",this.onChildInputChange_);else if(r instanceof we)r.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(r instanceof le)r.value.emitter.off("change",this.onChildValueChange_);else{const e=Se(r);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],r=e[e.length-1];this.bcSet_.items.forEach((e=>{const n=[];e===t&&(n.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||n.push("veryfirst")),e===r&&(n.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||n.push("verylast")),e.blade.set("positions",n)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildInputChange_(e){const t=Fe(this.find(Ce),e.sender);if(!t)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=Me(this.find(we),e.sender);if(!t)throw h.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=Pe(this.find(le),e.sender);if(!t)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ne extends V{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Re(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=new Oe(t.root?void 0:t.blade);r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.rack=r,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--)this.rack.children[e].viewProps.set("disposed",!0)}))}onRackAdd_(e){e.isRoot&&Q(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&$(e.bladeController.view.element)}}const ke=m("cnt");class He{constructor(e,t){this.className_=m(t.viewName||"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),ke()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),_(this.foldable_,"completed",b(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),_(t.props,"title",(e=>{l(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const n=e.createElement("div");n.classList.add(this.className_("t")),w(t.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n;const s=e.createElement("div");s.classList.add(this.className_("m")),this.buttonElement.appendChild(s);const i=t.containerElement;i.classList.add(this.className_("c")),this.element.appendChild(i),this.containerElement=i}}class Ge extends Ie{constructor(e,t){var r;const n=ue.create(null===(r=t.expanded)||void 0===r||r),s=new Ne(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:s,view:new He(e,{containerElement:s.view.element,foldable:n,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=n,de(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ke={id:"folder",type:"blade",accept(e){const t=O,r=N(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return r?{params:r}:null},controller:e=>new Ge(e.document,{blade:e.blade,expanded:e.params.expanded,props:R.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof Ge?new Te(e.controller,e.pool):null};class Ve extends le{constructor(e,t){const r=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new ie(e,{props:t.props,viewProps:r}),viewProps:r})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ue extends r{}const je=m("spr");class Je{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(je()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("hr");r.classList.add(je("r")),this.element.appendChild(r)}}class We extends V{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Je(e,{viewProps:t.viewProps})}))}}const Xe={id:"separator",type:"blade",accept(e){const t=N(e,{view:O.required.constant("separator")});return t?{params:t}:null},controller:e=>new We(e.document,{blade:e.blade,viewProps:e.viewProps}),api:e=>e.controller instanceof We?new Ue(e.controller):null},ze=m("");function Ze(e,t){return b(e,ze(void 0,t))}class qe extends R{constructor(e){super(e)}static create(e){var t,r;const n=null!=e?e:{},s={disabled:null!==(t=n.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(r=n.hidden)&&void 0!==r&&r},i=R.createCore(s);return new qe(i)}bindClassModifiers(e){_(this,"disabled",Ze(e,"disabled")),_(this,"hidden",Ze(e,"hidden"))}bindDisabled(e){_(this,"disabled",(t=>{e.disabled=t}))}bindTabIndex(e){_(this,"disabled",(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}}const Ye=m("tbi");class Qe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ye()),t.viewProps.bindClassModifiers(this.element),_(t.props,"selected",(e=>{e?this.element.classList.add(Ye(void 0,"sel")):this.element.classList.remove(Ye(void 0,"sel"))}));const r=e.createElement("button");r.classList.add(Ye("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const n=e.createElement("div");n.classList.add(Ye("t")),w(t.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}}class $e{constructor(e,t){this.emitter=new f,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Qe(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class et{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new $e(e,{props:t.itemProps,viewProps:qe.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ne(e,{blade:ce(),viewProps:qe.create()}),this.props=t.props,_(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class tt{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,r){return this.rackApi_.addInput(e,t,r)}addMonitor(e,t,r){return this.rackApi_.addMonitor(e,t,r)}addBlade(e){return this.rackApi_.addBlade(e)}}class rt extends fe{constructor(e,t){super(e,new De(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new f,this.pageApiMap_=new Map,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})})),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((e=>{this.setUpPageApi_(e)}))}get pages(){return this.controller_.pageSet.items.map((e=>{const t=this.pageApiMap_.get(e);if(!t)throw h.shouldNeverHappen();return t}))}addPage(e){const t=this.controller_.view.element.ownerDocument,r=new et(t,{itemProps:R.fromObject({selected:!1,title:e.title}),props:R.fromObject({selected:!1})});this.controller_.add(r,e.index);const n=this.pageApiMap_.get(r);if(!n)throw h.shouldNeverHappen();return n}removePage(e){this.controller_.remove(e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find((t=>t.controller_===e.contentController));if(!t)throw h.shouldNeverHappen();const r=new tt(e,t);this.pageApiMap_.set(e,r)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw h.shouldNeverHappen();this.pageApiMap_.delete(e.item)}}const nt=m("tab");class st{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nt(),ke()),t.viewProps.bindClassModifiers(this.element),B(t.empty,b(this.element,nt(void 0,"nop")));const r=e.createElement("div");r.classList.add(nt("i")),this.element.appendChild(r),this.itemsElement=r;const n=t.contentsElement;n.classList.add(nt("c")),this.element.appendChild(n),this.contentsElement=n}}class it extends Ie{constructor(e,t){const r=new Ne(e,{blade:t.blade,viewProps:t.viewProps}),n=I(!0);super({blade:t.blade,rackController:r,view:new st(e,{contentsElement:r.view.element,empty:n,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Be((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=n,this.applyPages_()}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,null!=t?t:this.pageSet_.items.length)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}onPageAdd_(e){const t=e.item;Q(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),t.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(e){const t=e.item;$(t.itemController.view.element),this.rackController.rack.remove(t.contentController),t.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(0===this.pageSet_.items.length)return;const e=this.pageSet_.items.findIndex((e=>e.props.get("selected")));e<0?this.pageSet_.items.forEach(((e,t)=>{e.props.set("selected",0===t)})):this.pageSet_.items.forEach(((t,r)=>{t.props.set("selected",r===e)}))}onPageSelectedChange_(e){if(e.rawValue){const t=this.pageSet_.items.findIndex((t=>t.props.value("selected")===e.sender));this.pageSet_.items.forEach(((e,r)=>{e.props.set("selected",r===t)}))}else this.keepSelection_()}}const ot={id:"tab",type:"blade",accept(e){const t=O,r=N(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return r&&0!==r.pages.length?{params:r}:null},controller(e){const t=new it(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((r=>{const n=new et(e.document,{itemProps:R.fromObject({selected:!1,title:r.title}),props:R.fromObject({selected:!1})});t.add(n)})),t},api:e=>e.controller instanceof it?new rt(e.controller,e.pool):null};function at(e,t){const r=e.accept(t.params);if(!r)return null;const n=O.optional.boolean(t.params.disabled).value,s=O.optional.boolean(t.params.hidden).value;return e.controller({blade:ce(),document:t.document,params:a(Object.assign(Object.assign({},r.params),{disabled:n,hidden:s})),viewProps:qe.create({disabled:n,hidden:s})})}class lt{constructor(){this.disabled=!1,this.emitter=new f}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class ct{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new f,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ut{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function ht(e,t){if(e instanceof t)return e;if(e instanceof ut){const r=e.constraints.reduce(((e,r)=>e||(r instanceof t?r:null)),null);if(r)return r}return null}class pt{constructor(e){this.options=e}constrain(e){const t=this.options;return 0===t.length||t.filter((t=>t.value===e)).length>0?e:t[0].value}}class dt{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return l(this.minValue)||(t=Math.max(t,this.minValue)),l(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class ft{constructor(e){this.step=e}constrain(e){return(e<0?-Math.round(-e/this.step):Math.round(e/this.step))*this.step}}const gt=m("lst");class mt{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(gt()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("select");r.classList.add(gt("s")),_(this.props_,"options",(t=>{ee(r),t.forEach(((t,n)=>{const s=e.createElement("option");s.dataset.index=String(n),s.textContent=t.text,s.value=String(t.value),r.appendChild(s)}))})),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const n=e.createElement("div");n.classList.add(gt("m")),n.appendChild(Y(e,"dropdown")),this.element.appendChild(n),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class At{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new mt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=a(e.currentTarget).selectedOptions.item(0);if(!t)return;const r=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[r].value}}const vt=m("pop");class Bt{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vt()),t.viewProps.bindClassModifiers(this.element),B(t.shows,b(this.element,vt(void 0,"v")))}}class _t{constructor(e,t){this.shows=I(!1),this.viewProps=t.viewProps,this.view=new Bt(e,{shows:this.shows,viewProps:this.viewProps})}}const Ct=m("txt");class bt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ct()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const r=e.createElement("input");r.classList.add(Ct("i")),r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class wt{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new bt(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=a(e.currentTarget).value,r=this.parser_(t);l(r)||(this.value.rawValue=r),this.view.refresh()}}function Et(e){return String(e)}function xt(e){return"false"!==e&&!!e}function yt(e){return Et(e)}class Dt{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Tt={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class It{constructor(e,t,r){this.left=t,this.operator=e,this.right=r}evaluate(){const e=Tt[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Rt={"+":e=>e,"-":e=>-e,"~":e=>~e};class Ft{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Rt[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Mt(e){return(t,r)=>{for(let n=0;n<e.length;n++){const s=e[n](t,r);if(""!==s)return s}return""}}function Pt(e,t){var r;const n=e.substr(t).match(/^\s+/);return null!==(r=n&&n[0])&&void 0!==r?r:""}function St(e,t){const r=e.substr(t,1);return r.match(/^[1-9]$/)?r:""}function Lt(e,t){var r;const n=e.substr(t).match(/^[0-9]+/);return null!==(r=n&&n[0])&&void 0!==r?r:""}function Ot(e,t){const r=Lt(e,t);if(""!==r)return r;const n=e.substr(t,1);if("-"!==n&&"+"!==n)return"";const s=Lt(e,t+=1);return""===s?"":n+s}function Nt(e,t){const r=e.substr(t,1);if(t+=1,"e"!==r.toLowerCase())return"";const n=Ot(e,t);return""===n?"":r+n}function kt(e,t){const r=e.substr(t,1);if("0"===r)return r;const n=St(e,t);return t+=n.length,""===n?"":n+Lt(e,t)}function Ht(e,t){const r=kt(e,t);if(t+=r.length,""===r)return"";const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const s=Lt(e,t);return r+n+s+Nt(e,t+=s.length)}function Gt(e,t){const r=e.substr(t,1);if(t+=r.length,"."!==r)return"";const n=Lt(e,t);return t+=n.length,""===n?"":r+n+Nt(e,t)}function Kt(e,t){const r=kt(e,t);return t+=r.length,""===r?"":r+Nt(e,t)}const Vt=Mt([Ht,Gt,Kt]);function Ut(e,t){var r;const n=e.substr(t).match(/^[01]+/);return null!==(r=n&&n[0])&&void 0!==r?r:""}function jt(e,t){const r=e.substr(t,2);if(t+=r.length,"0b"!==r.toLowerCase())return"";const n=Ut(e,t);return""===n?"":r+n}function Jt(e,t){var r;const n=e.substr(t).match(/^[0-7]+/);return null!==(r=n&&n[0])&&void 0!==r?r:""}function Wt(e,t){const r=e.substr(t,2);if(t+=r.length,"0o"!==r.toLowerCase())return"";const n=Jt(e,t);return""===n?"":r+n}function Xt(e,t){var r;const n=e.substr(t).match(/^[0-9a-f]+/i);return null!==(r=n&&n[0])&&void 0!==r?r:""}function zt(e,t){const r=e.substr(t,2);if(t+=r.length,"0x"!==r.toLowerCase())return"";const n=Xt(e,t);return""===n?"":r+n}const Zt=Mt([jt,Wt,zt]),qt=Mt([Zt,Vt]);function Yt(e,t){const r=qt(e,t);return t+=r.length,""===r?null:{evaluable:new Dt(r),cursor:t}}function Qt(e,t){const r=e.substr(t,1);if(t+=r.length,"("!==r)return null;const n=sr(e,t);if(!n)return null;t=n.cursor,t+=Pt(e,t).length;const s=e.substr(t,1);return t+=s.length,")"!==s?null:{evaluable:n.evaluable,cursor:t}}function $t(e,t){return Yt(e,t)||Qt(e,t)}function er(e,t){const r=$t(e,t);if(r)return r;const n=e.substr(t,1);if(t+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const s=er(e,t);return s?{cursor:t=s.cursor,evaluable:new Ft(n,s.evaluable)}:null}function tr(e,t,r){r+=Pt(t,r).length;const n=e.filter((e=>t.startsWith(e,r)))[0];return n?(r+=n.length,{cursor:r+=Pt(t,r).length,operator:n}):null}function rr(e,t){return(r,n)=>{const s=e(r,n);if(!s)return null;n=s.cursor;let i=s.evaluable;for(;;){const s=tr(t,r,n);if(!s)break;n=s.cursor;const o=e(r,n);if(!o)return null;n=o.cursor,i=new It(s.operator,i,o.evaluable)}return i?{cursor:n,evaluable:i}:null}}const nr=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>rr(e,t)),er);function sr(e,t){return t+=Pt(e,t).length,nr(e,t)}function ir(e){const t=sr(e,0);return t?t.cursor+Pt(e,t.cursor).length!==e.length?null:t.evaluable:null}function or(e){var t;const r=ir(e);return null!==(t=null==r?void 0:r.evaluate())&&void 0!==t?t:null}function ar(e){if("number"==typeof e)return e;if("string"==typeof e){const t=or(e);if(!l(t))return t}return 0}function lr(e){return String(e)}function cr(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const ur=cr(0);function hr(e){return ur(e)+"%"}function pr(e){return String(e)}function dr(e){return e}function fr(e,t){for(;e.length<t;)e.push(void 0)}function gr(e){const t=[];return fr(t,e),I(t)}function mr(e){const t=e.indexOf(void 0);return a(t<0?e:e.slice(0,t))}function Ar(e,t){const r=[...mr(e),t];return r.length>e.length?r.splice(0,r.length-e.length):fr(r,e.length),r}function vr({primary:e,secondary:t,forward:r,backward:n}){let s=!1;function i(e){s||(s=!0,e(),s=!1)}e.emitter.on("change",(n=>{i((()=>{t.setRawValue(r(e,t),n.options)}))})),t.emitter.on("change",(s=>{i((()=>{e.setRawValue(n(e,t),s.options)})),i((()=>{t.setRawValue(r(e,t),s.options)}))})),i((()=>{t.setRawValue(r(e,t),{forceEmit:!1,last:!0})}))}function Br(e,t){const r=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+r:t.downKey?-r:0}function _r(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function Cr(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function br(e){return"ArrowUp"===e||"ArrowDown"===e}function wr(e){return br(e)||"ArrowLeft"===e||"ArrowRight"===e}function Er(e,t){const r=t.ownerDocument.defaultView,n=t.getBoundingClientRect();return{x:e.pageX-((r&&r.scrollX||0)+n.left),y:e.pageY-((r&&r.scrollY||0)+n.top)}}class xr{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new f,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const r=this.elem_.ownerDocument;r.addEventListener("mousemove",this.onDocumentMouseMove_),r.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Er(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Er(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Er(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-r.left,y:t.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-r.left,y:t.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const r=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(r?{x:r.clientX-n.left,y:r.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function yr(e,t,r,n,s){return n+(e-t)/(r-t)*(s-n)}function Dr(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Tr(e,t,r){return Math.min(Math.max(e,t),r)}function Ir(e,t){return(e%t+t)%t}const Rr=m("txt");class Fr{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Rr(),Rr(void 0,"num")),t.arrayPosition&&this.element.classList.add(Rr(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(Rr("i")),r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Rr()),this.inputElement.classList.add(Rr("i"));const n=e.createElement("div");n.classList.add(Rr("k")),this.element.appendChild(n),this.knobElement=n;const s=e.createElementNS(U,"svg");s.classList.add(Rr("g")),this.knobElement.appendChild(s);const i=e.createElementNS(U,"path");i.classList.add(Rr("gb")),s.appendChild(i),this.guideBodyElem_=i;const o=e.createElementNS(U,"path");o.classList.add(Rr("gh")),s.appendChild(o),this.guideHeadElem_=o;const a=e.createElement("div");a.classList.add(m("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Rr(void 0,"drg"));this.element.classList.add(Rr(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),r=t+(t>0?-1:t<0?1:0),n=Tr(-r,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${r+n},0 L${r},4 L${r+n},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Mr{constructor(e,t){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=I(null),this.view=new Fr(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new xr(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}onInputChange_(e){const t=a(e.currentTarget).value,r=this.parser_(t);l(r)||(this.value.rawValue=r),this.view.refresh()}onInputKeyDown_(e){const t=Br(this.baseStep_,_r(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==Br(this.baseStep_,_r(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.originRawValue_+t*this.props.get("draggingScale")}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Pr=m("sld");class Sr{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Pr()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Pr("t")),t.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;const n=e.createElement("div");n.classList.add(Pr("k")),this.trackElement.appendChild(n),this.knobElement=n,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Tr(yr(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Lr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Sr(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xr(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(yr(Tr(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Br(this.baseStep_,Cr(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Br(this.baseStep_,Cr(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Or=m("sldtxt");class Nr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Or());const r=e.createElement("div");r.classList.add(Or("s")),this.sliderView_=t.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);const n=e.createElement("div");n.classList.add(Or("t")),this.textView_=t.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}}class kr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Lr(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Mr(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,value:t.value,viewProps:t.viewProps}),this.view=new Nr(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Hr(e,t){e.write(t)}function Gr(e){const t=O;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function Kr(e){if("inline"===e||"popup"===e)return e}function Vr(e){const t=O;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function Ur(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((r=>{t.push({text:r,value:e[r]})})),t}function jr(e){return l(e)?null:new pt(Ur(a(e)))}function Jr(e){const t=e?ht(e,pt):null;return t?t.options:null}function Wr(e){const t=e?ht(e,ft):null;return t?t.step:null}function Xr(e,t){const r=e&&ht(e,ft);return r?Dr(r.step):Math.max(Dr(t),2)}function zr(e){const t=Wr(e);return null!=t?t:1}function Zr(e,t){var r;const n=e&&ht(e,ft),s=Math.abs(null!==(r=null==n?void 0:n.step)&&void 0!==r?r:t);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}const qr=m("ckb");class Yr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(qr()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("label");r.classList.add(qr("l")),this.element.appendChild(r);const n=e.createElement("input");n.classList.add(qr("i")),n.type="checkbox",r.appendChild(n),this.inputElement=n,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(qr("w")),r.appendChild(s);const i=Y(e,"check");s.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Qr{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Yr(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=a(e.currentTarget);this.value.rawValue=t.checked}}function $r(e){const t=[],r=jr(e.options);return r&&t.push(r),new ut(t)}const en={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const r=N(t,{options:O.optional.custom(Gr)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>xt,constraint:e=>$r(e.params),writer:e=>Hr},controller:e=>{var t;const r=e.document,n=e.value,s=e.constraint;return s&&ht(s,pt)?new At(r,{props:R.fromObject({options:null!==(t=Jr(s))&&void 0!==t?t:[]}),value:n,viewProps:e.viewProps}):new Qr(r,{value:n,viewProps:e.viewProps})}},tn=m("col");class rn{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(tn()),t.foldable.bindExpandedClass(this.element,tn(void 0,"expanded")),_(t.foldable,"completed",b(this.element,tn(void 0,"cpl")));const r=e.createElement("div");r.classList.add(tn("h")),this.element.appendChild(r);const n=e.createElement("div");n.classList.add(tn("s")),r.appendChild(n),this.swatchElement=n;const s=e.createElement("div");if(s.classList.add(tn("t")),r.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(tn("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function nn(e,t,r){const n=Tr(e/255,0,1),s=Tr(t/255,0,1),i=Tr(r/255,0,1),o=Math.max(n,s,i),a=Math.min(n,s,i),l=o-a;let c=0,u=0;const h=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=n===o?(s-i)/l:s===o?2+(i-n)/l:4+(n-s)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*h]}function sn(e,t,r){const n=(e%360+360)%360,s=Tr(t/100,0,1),i=Tr(r/100,0,1),o=(1-Math.abs(2*i-1))*s,a=o*(1-Math.abs(n/60%2-1)),l=i-o/2;let c,u,h;return[c,u,h]=n>=0&&n<60?[o,a,0]:n>=60&&n<120?[a,o,0]:n>=120&&n<180?[0,o,a]:n>=180&&n<240?[0,a,o]:n>=240&&n<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function on(e,t,r){const n=Tr(e/255,0,1),s=Tr(t/255,0,1),i=Tr(r/255,0,1),o=Math.max(n,s,i),a=o-Math.min(n,s,i);let l;return l=0===a?0:o===n?((s-i)/a%6+6)%6*60:o===s?60*((i-n)/a+2):60*((n-s)/a+4),[l,100*(0===o?0:a/o),100*o]}function an(e,t,r){const n=Ir(e,360),s=Tr(t/100,0,1),i=Tr(r/100,0,1),o=i*s,a=o*(1-Math.abs(n/60%2-1)),l=i-o;let c,u,h;return[c,u,h]=n>=0&&n<60?[o,a,0]:n>=60&&n<120?[a,o,0]:n>=120&&n<180?[0,o,a]:n>=180&&n<240?[0,a,o]:n>=240&&n<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function ln(e,t,r){const n=r+t*(100-Math.abs(2*r-100))/200;return[e,0!==n?t*(100-Math.abs(2*r-100))/n:0,r+t*(100-Math.abs(2*r-100))/200]}function cn(e,t,r){const n=100-Math.abs(r*(200-t)/100-100);return[e,0!==n?t*r/n:0,r*(200-t)/200]}function un(e){return[e[0],e[1],e[2]]}function hn(e,t){return[e[0],e[1],e[2],t]}const pn={hsl:{hsl:(e,t,r)=>[e,t,r],hsv:ln,rgb:sn},hsv:{hsl:cn,hsv:(e,t,r)=>[e,t,r],rgb:an},rgb:{hsl:nn,hsv:on,rgb:(e,t,r)=>[e,t,r]}};function dn(e,t,r){return pn[t][r](...e)}const fn={hsl:e=>{var t;return[Ir(e[0],360),Tr(e[1],0,100),Tr(e[2],0,100),Tr(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},hsv:e=>{var t;return[Ir(e[0],360),Tr(e[1],0,100),Tr(e[2],0,100),Tr(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},rgb:e=>{var t;return[Tr(e[0],0,255),Tr(e[1],0,255),Tr(e[2],0,255),Tr(null!==(t=e[3])&&void 0!==t?t:1,0,1)]}};function gn(e,t){return"object"==typeof e&&!l(e)&&t in e&&"number"==typeof e[t]}class mn{constructor(e,t){this.mode_=t,this.comps_=fn[t](e)}static black(){return new mn([0,0,0],"rgb")}static fromObject(e){const t="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new mn(t,"rgb")}static toRgbaObject(e){return e.toRgbaObject()}static isRgbColorObject(e){return gn(e,"r")&&gn(e,"g")&&gn(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&gn(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode_!==t.mode_)return!1;const r=e.comps_,n=t.comps_;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}get mode(){return this.mode_}getComponents(e){return hn(dn(un(this.comps_),this.mode_,e||this.mode_),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const An=m("colp");class vn{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(An());const r=e.createElement("div");r.classList.add(An("hsv"));const n=e.createElement("div");n.classList.add(An("sv")),this.svPaletteView_=t.svPaletteView,n.appendChild(this.svPaletteView_.element),r.appendChild(n);const s=e.createElement("div");s.classList.add(An("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),r.appendChild(s),this.element.appendChild(r);const i=e.createElement("div");if(i.classList.add(An("rgb")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const r=e.createElement("div");r.classList.add(An("a"));const n=e.createElement("div");n.classList.add(An("ap")),n.appendChild(this.alphaViews_.palette.element),r.appendChild(n);const s=e.createElement("div");s.classList.add(An("at")),s.appendChild(this.alphaViews_.text.element),r.appendChild(s),this.element.appendChild(r)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Bn(e){const t=O;return N(e,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom(Kr)})}function _n(e){return e?.1:1}function Cn(e,t){const r=e.match(/^(.+)%$/);return r?Math.min(.01*parseFloat(r[1])*t,t):Math.min(parseFloat(e),t)}const bn={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function wn(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const r=parseFloat(t[1]),n=t[2];return bn[n](r)}const En={"func.rgb":e=>{const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[Cn(t[1],255),Cn(t[2],255),Cn(t[3],255)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:new mn(r,"rgb")},"func.rgba":e=>{const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[Cn(t[1],255),Cn(t[2],255),Cn(t[3],255),Cn(t[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:new mn(r,"rgb")},"func.hsl":e=>{const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[wn(t[1]),Cn(t[2],100),Cn(t[3],100)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:new mn(r,"hsl")},"func.hsla":e=>{const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[wn(t[1]),Cn(t[2],100),Cn(t[3],100),Cn(t[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:new mn(r,"hsl")},"hex.rgb":e=>{const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new mn([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const r=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?new mn([parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)],"rgb"):null},"hex.rgba":e=>{const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new mn([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),yr(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const r=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?new mn([parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16),yr(parseInt(r[4],16),0,255,0,1)],"rgb"):null}};function xn(e){return Object.keys(En).reduce(((t,r)=>t||((0,En[r])(e)?r:null)),null)}const yn=e=>{const t=xn(e);return t?En[t](e):null};function Dn(e){return"func.hsla"===e||"func.rgba"===e||"hex.rgba"===e}function Tn(e){if("string"==typeof e){const t=yn(e);if(t)return t}return mn.black()}function In(e){const t=Tr(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function Rn(e,t="#"){return`${t}${un(e.getComponents("rgb")).map(In).join("")}`}function Fn(e,t="#"){const r=e.getComponents("rgb");return`${t}${[r[0],r[1],r[2],255*r[3]].map(In).join("")}`}function Mn(e){const t=cr(0);return`rgb(${un(e.getComponents("rgb")).map((e=>t(e))).join(", ")})`}function Pn(e){const t=cr(2),r=cr(0);return`rgba(${e.getComponents("rgb").map(((e,n)=>(3===n?t:r)(e))).join(", ")})`}function Sn(e){const t=[cr(0),hr,hr];return`hsl(${un(e.getComponents("hsl")).map(((e,r)=>t[r](e))).join(", ")})`}function Ln(e){const t=[cr(0),hr,hr,cr(2)];return`hsla(${e.getComponents("hsl").map(((e,r)=>t[r](e))).join(", ")})`}const On={"func.hsl":Sn,"func.hsla":Ln,"func.rgb":Mn,"func.rgba":Pn,"hex.rgb":Rn,"hex.rgba":Fn};function Nn(e){return On[e]}const kn=m("apl");class Hn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(kn()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(kn("b")),this.element.appendChild(r);const n=e.createElement("div");n.classList.add(kn("c")),r.appendChild(n),this.colorElem_=n;const s=e.createElement("div");s.classList.add(kn("m")),this.element.appendChild(s),this.markerElem_=s;const i=e.createElement("div");i.classList.add(kn("p")),this.markerElem_.appendChild(i),this.previewElem_=i,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),r=new mn([t[0],t[1],t[2],0],"rgb"),n=new mn([t[0],t[1],t[2],255],"rgb"),s=["to right",Pn(r),Pn(n)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Pn(e);const i=yr(t[3],0,1,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Gn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Hn(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=e.point.x/e.bounds.width,n=this.value.rawValue,[s,i,o]=n.getComponents("hsv");this.value.setRawValue(new mn([s,i,o,r],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Br(_n(!0),Cr(e));if(0===t)return;const r=this.value.rawValue,[n,s,i,o]=r.getComponents("hsv");this.value.setRawValue(new mn([n,s,i,o+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Br(_n(!0),Cr(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Kn=m("coltxt");function Vn(e){const t=e.createElement("select"),r=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(r.reduce(((t,r)=>{const n=e.createElement("option");return n.textContent=r.text,n.value=r.value,t.appendChild(n),t}),e.createDocumentFragment())),t}class Un{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kn());const r=e.createElement("div");r.classList.add(Kn("m")),this.modeElem_=Vn(e),this.modeElem_.classList.add(Kn("ms")),r.appendChild(this.modeSelectElement);const n=e.createElement("div");n.classList.add(Kn("mm")),n.appendChild(Y(e,"dropdown")),r.appendChild(n),this.element.appendChild(r);const s=e.createElement("div");s.classList.add(Kn("w")),this.element.appendChild(s),this.textsElem_=s,this.textViews_=t.textViews,this.applyTextViews_(),B(t.colorMode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){ee(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach((t=>{const r=e.createElement("div");r.classList.add(Kn("c")),r.appendChild(t.element),this.textsElem_.appendChild(r)}))}}const jn=cr(0),Jn={rgb:()=>new dt({min:0,max:255}),hsl:e=>new dt(0===e?{min:0,max:360}:{min:0,max:100}),hsv:e=>new dt(0===e?{min:0,max:360}:{min:0,max:100})};function Wn(e,t,r){return new Mr(e,{arrayPosition:0===r?"fst":2===r?"lst":"mid",baseStep:_n(!1),parser:t.parser,props:R.fromObject({draggingScale:1,formatter:jn}),value:I(0,{constraint:Jn[t.colorMode](r)}),viewProps:t.viewProps})}class Xn{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=I(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Un(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},r=[Wn(e,t,0),Wn(e,t,1),Wn(e,t,2)];return r.forEach(((e,t)=>{vr({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue)[t],backward:(e,r)=>{const n=this.colorMode.rawValue,s=e.rawValue.getComponents(n);return s[t]=r.rawValue,new mn(hn(un(s),s[3]),n)}})})),r}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const zn=m("hpl");class Zn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(zn()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(zn("c")),this.element.appendChild(r);const n=e.createElement("div");n.classList.add(zn("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=Mn(new mn([t,100,100],"hsv"));const r=yr(t,0,360,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class qn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Zn(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=yr(Tr(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),n=this.value.rawValue,[,s,i,o]=n.getComponents("hsv");this.value.setRawValue(new mn([r,s,i,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Br(_n(!1),Cr(e));if(0===t)return;const r=this.value.rawValue,[n,s,i,o]=r.getComponents("hsv");this.value.setRawValue(new mn([n+t,s,i,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Br(_n(!1),Cr(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Yn=m("svp"),Qn=64;class $n{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Yn()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("canvas");r.height=Qn,r.width=Qn,r.classList.add(Yn("c")),this.element.appendChild(r),this.canvasElement=r;const n=e.createElement("div");n.classList.add(Yn("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const e=Z(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,n=this.canvasElement.height,s=e.getImageData(0,0,r,n),i=s.data;for(let e=0;e<n;e++)for(let s=0;s<r;s++){const o=yr(s,0,r,0,100),a=yr(e,0,n,100,0),l=an(t[0],o,a),c=4*(e*r+s);i[c]=l[0],i[c+1]=l[1],i[c+2]=l[2],i[c+3]=255}e.putImageData(s,0,0);const o=yr(t[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=yr(t[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class es{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new $n(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=yr(e.point.x,0,e.bounds.width,0,100),n=yr(e.point.y,0,e.bounds.height,100,0),[s,,,i]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new mn([s,r,n,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){wr(e.key)&&e.preventDefault();const[t,r,n,s]=this.value.rawValue.getComponents("hsv"),i=_n(!1),o=Br(i,Cr(e)),a=Br(i,_r(e));0===o&&0===a||this.value.setRawValue(new mn([t,r+o,n+a,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=_n(!1),r=Br(t,Cr(e)),n=Br(t,_r(e));0===r&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ts{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new qn(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new es(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Gn(e,{value:this.value,viewProps:this.viewProps}),text:new Mr(e,{parser:or,baseStep:.1,props:R.fromObject({draggingScale:.01,formatter:cr(2)}),value:I(0,{constraint:new dt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&vr({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const r=e.rawValue.getComponents();return r[3]=t.rawValue,new mn(r,e.rawValue.mode)}}),this.textC_=new Xn(e,{parser:or,value:this.value,viewProps:this.viewProps}),this.view=new vn(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const rs=m("colsw");class ns{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(rs()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(rs("sw")),this.element.appendChild(r),this.swatchElem_=r;const n=e.createElement("button");n.classList.add(rs("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Fn(e)}onValueChange_(){this.update_()}}class ss{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ns(e,{value:this.value,viewProps:this.viewProps})}}class is{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ue.create(t.expanded),this.swatchC_=new ss(e,{value:this.value,viewProps:this.viewProps});const r=this.swatchC_.view.buttonElement;r.addEventListener("blur",this.onButtonBlur_),r.addEventListener("click",this.onButtonClick_),this.textC_=new wt(e,{parser:t.parser,props:R.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new rn(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new _t(e,{viewProps:this.viewProps}):null;const n=new ts(e,{supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),vr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),de(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,r=a(e.relatedTarget);r&&t.contains(r)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,r=re(e);r&&t.contains(r)||r&&r===this.swatchC_.view.buttonElement&&!W(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function os(e){return mn.isColorObject(e)?mn.fromObject(e):mn.black()}function as(e){return un(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function ls(e){return e.getComponents("rgb").reduce(((e,t,r)=>e<<8|255&Math.floor(3===r?255*t:t)),0)>>>0}function cs(e){return new mn([e>>16&255,e>>8&255,255&e],"rgb")}function us(e){return new mn([e>>24&255,e>>16&255,e>>8&255,yr(255&e,0,255,0,1)],"rgb")}function hs(e){return"number"!=typeof e?mn.black():cs(e)}function ps(e){return"number"!=typeof e?mn.black():us(e)}function ds(e){const t=Nn(e);return(e,r)=>{Hr(e,t(r))}}function fs(e){const t=e?ls:as;return(e,r)=>{Hr(e,t(r))}}function gs(e,t){const r=t.toRgbaObject();e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)}function ms(e,t){const r=t.toRgbaObject();e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b)}function As(e){return e?gs:ms}function vs(e){return"alpha"in e&&!0===e.alpha}function Bs(e){return e?e=>Fn(e,"0x"):e=>Rn(e,"0x")}const _s={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!("view"in t))return null;if("color"!==t.view)return null;const r=Bn(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>vs(e.params)?ps:hs,equals:mn.equals,writer:e=>fs(vs(e.params))},controller:e=>{const t=vs(e.params),r="expanded"in e.params?e.params.expanded:void 0,n="picker"in e.params?e.params.picker:void 0;return new is(e.document,{expanded:null!=r&&r,formatter:Bs(t),parser:yn,pickerLayout:null!=n?n:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function Cs(e){return mn.isRgbaColorObject(e)}const bs={id:"input-color-object",type:"input",accept:(e,t)=>{if(!mn.isColorObject(e))return null;const r=Bn(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>os,equals:mn.equals,writer:e=>As(Cs(e.initialValue))},controller:e=>{const t=mn.isRgbaColorObject(e.initialValue),r="expanded"in e.params?e.params.expanded:void 0,n="picker"in e.params?e.params.picker:void 0,s=t?Fn:Rn;return new is(e.document,{expanded:null!=r&&r,formatter:s,parser:yn,pickerLayout:null!=n?n:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},ws={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;if(!xn(e))return null;const r=Bn(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>Tn,equals:mn.equals,writer:e=>{const t=xn(e.initialValue);if(!t)throw h.shouldNeverHappen();return ds(t)}},controller:e=>{const t=xn(e.initialValue);if(!t)throw h.shouldNeverHappen();const r=Nn(t),n="expanded"in e.params?e.params.expanded:void 0,s="picker"in e.params?e.params.picker:void 0;return new is(e.document,{expanded:null!=n&&n,formatter:r,parser:yn,pickerLayout:null!=s?s:"popup",supportsAlpha:Dn(t),value:e.value,viewProps:e.viewProps})}};class Es{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var r,n;return null!==(n=null===(r=this.components[t])||void 0===r?void 0:r.constrain(e))&&void 0!==n?n:e}));return this.asm_.fromComponents(t)}}const xs=m("pndtxt");class ys{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(xs()),this.textViews.forEach((t=>{const r=e.createElement("div");r.classList.add(xs("a")),r.appendChild(t.element),this.element.appendChild(r)}))}}function Ds(e,t,r){return new Mr(e,{arrayPosition:0===r?"fst":r===t.axes.length-1?"lst":"mid",baseStep:t.axes[r].baseStep,parser:t.parser,props:t.axes[r].textProps,value:I(0,{constraint:t.axes[r].constraint}),viewProps:t.viewProps})}class Ts{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((r,n)=>Ds(e,t,n))),this.acs_.forEach(((e,r)=>{vr({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[r],backward:(e,n)=>{const s=t.assembly.toComponents(e.rawValue);return s[r]=n.rawValue,t.assembly.fromComponents(s)}})})),this.view=new ys(e,{textViews:this.acs_.map((e=>e.view))})}}function Is(e){return"step"in e&&!l(e.step)?new ft(e.step):null}function Rs(e){return"max"in e&&!l(e.max)||"min"in e&&!l(e.min)?new dt({max:e.max,min:e.min}):null}function Fs(e){const t=[],r=Is(e);r&&t.push(r);const n=Rs(e);n&&t.push(n);const s=jr(e.options);return s&&t.push(s),new ut(t)}function Ms(e){const t=e?ht(e,dt):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function Ps(e){const[t,r]=Ms(e);return[null!=t?t:0,null!=r?r:100]}const Ss={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const r=O,n=N(t,{format:r.optional.function,max:r.optional.number,min:r.optional.number,options:r.optional.custom(Gr),step:r.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ar,constraint:e=>Fs(e.params),writer:e=>Hr},controller:e=>{var t,r;const n=e.value,s=e.constraint;if(s&&ht(s,pt))return new At(e.document,{props:R.fromObject({options:null!==(t=Jr(s))&&void 0!==t?t:[]}),value:n,viewProps:e.viewProps});const i=null!==(r="format"in e.params?e.params.format:void 0)&&void 0!==r?r:cr(Xr(s,n.rawValue));if(s&&ht(s,dt)){const[t,r]=Ps(s);return new kr(e.document,{baseStep:zr(s),parser:or,sliderProps:R.fromObject({maxValue:r,minValue:t}),textProps:R.fromObject({draggingScale:Zr(s,n.rawValue),formatter:i}),value:n,viewProps:e.viewProps})}return new Mr(e.document,{baseStep:zr(s),parser:or,props:R.fromObject({draggingScale:Zr(s,n.rawValue),formatter:i}),value:n,viewProps:e.viewProps})}};class Ls{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(l(e))return!1;const t=e.x,r=e.y;return"number"==typeof t&&"number"==typeof r}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const Os={toComponents:e=>e.getComponents(),fromComponents:e=>new Ls(...e)},Ns=m("p2d");class ks{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ns()),t.viewProps.bindClassModifiers(this.element),B(t.expanded,b(this.element,Ns(void 0,"expanded")));const r=e.createElement("div");r.classList.add(Ns("h")),this.element.appendChild(r);const n=e.createElement("button");n.classList.add(Ns("b")),n.appendChild(Y(e,"p2dpad")),t.viewProps.bindDisabled(n),r.appendChild(n),this.buttonElement=n;const s=e.createElement("div");if(s.classList.add(Ns("t")),r.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(Ns("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const Hs=m("p2dp");class Gs{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(Hs()),"popup"===t.layout&&this.element.classList.add(Hs(void 0,"p"));const r=e.createElement("div");r.classList.add(Hs("p")),t.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;const n=e.createElementNS(U,"svg");n.classList.add(Hs("g")),this.padElement.appendChild(n),this.svgElem_=n;const s=e.createElementNS(U,"line");s.classList.add(Hs("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const i=e.createElementNS(U,"line");i.classList.add(Hs("ax")),i.setAttributeNS(null,"x1","50%"),i.setAttributeNS(null,"y1","0"),i.setAttributeNS(null,"x2","50%"),i.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(i);const o=e.createElementNS(U,"line");o.classList.add(Hs("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=e.createElement("div");a.classList.add(Hs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),r=this.maxValue_,n=yr(e,-r,+r,0,100),s=yr(t,-r,+r,0,100),i=this.invertsY_?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${i}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${i}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Ks(e,t,r){return[Br(t[0],Cr(e)),Br(t[1],_r(e))*(r?1:-1)]}class Vs{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new Gs(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xr(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=this.maxValue_,n=yr(e.point.x,0,e.bounds.width,-r,+r),s=yr(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-r,+r);this.value.setRawValue(new Ls(n,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){wr(e.key)&&e.preventDefault();const[t,r]=Ks(e,this.baseSteps_,this.invertsY_);0===t&&0===r||this.value.setRawValue(new Ls(this.value.rawValue.x+t,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,r]=Ks(e,this.baseSteps_,this.invertsY_);0===t&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Us{constructor(e,t){var r,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ue.create(t.expanded),this.popC_="popup"===t.pickerLayout?new _t(e,{viewProps:this.viewProps}):null;const s=new Vs(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new Ts(e,{assembly:Os,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new ks(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("blur",this.onPadButtonBlur_),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),vr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),de(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,r=a(e.relatedTarget);r&&t.contains(r)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,r=re(e);r&&t.contains(r)||r&&r===this.view.buttonElement&&!W(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function js(e){return Ls.isObject(e)?new Ls(e.x,e.y):new Ls}function Js(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function Ws(e){if(!e)return;const t=[];return l(e.step)||t.push(new ft(e.step)),l(e.max)&&l(e.min)||t.push(new dt({max:e.max,min:e.min})),new ut(t)}function Xs(e){return new Es({assembly:Os,components:[Ws("x"in e?e.x:void 0),Ws("y"in e?e.y:void 0)]})}function zs(e,t){const r=e&&ht(e,dt);if(r)return Math.max(Math.abs(r.minValue||0),Math.abs(r.maxValue||0));const n=zr(e);return Math.max(10*Math.abs(n),10*Math.abs(t))}function Zs(e,t){const r=t instanceof Es?t.components[0]:void 0,n=t instanceof Es?t.components[1]:void 0,s=zs(r,e.x),i=zs(n,e.y);return Math.max(s,i)}function qs(e,t){return{baseStep:zr(t),constraint:t,textProps:R.fromObject({draggingScale:Zr(t,e),formatter:cr(Xr(t,e))})}}function Ys(e){if(!("y"in e))return!1;const t=e.y;return!!t&&"inverted"in t&&!!t.inverted}const Qs={id:"input-point2d",type:"input",accept:(e,t)=>{if(!Ls.isObject(e))return null;const r=O,n=N(t,{expanded:r.optional.boolean,picker:r.optional.custom(Kr),x:r.optional.custom(Vr),y:r.optional.object({inverted:r.optional.boolean,max:r.optional.number,min:r.optional.number,step:r.optional.number})});return n?{initialValue:e,params:n}:null},binding:{reader:e=>js,constraint:e=>Xs(e.params),equals:Ls.equals,writer:e=>Js},controller:e=>{const t=e.document,r=e.value,n=e.constraint;if(!(n instanceof Es))throw h.shouldNeverHappen();const s="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new Us(t,{axes:[qs(r.rawValue.x,n.components[0]),qs(r.rawValue.y,n.components[1])],expanded:null!=s&&s,invertsY:Ys(e.params),maxValue:Zs(r.rawValue,n),parser:or,pickerLayout:null!=i?i:"popup",value:r,viewProps:e.viewProps})}};class $s{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(l(e))return!1;const t=e.x,r=e.y,n=e.z;return"number"==typeof t&&"number"==typeof r&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ei={toComponents:e=>e.getComponents(),fromComponents:e=>new $s(...e)};function ti(e){return $s.isObject(e)?new $s(e.x,e.y,e.z):new $s}function ri(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function ni(e){if(!e)return;const t=[];return l(e.step)||t.push(new ft(e.step)),l(e.max)&&l(e.min)||t.push(new dt({max:e.max,min:e.min})),new ut(t)}function si(e){return new Es({assembly:ei,components:[ni("x"in e?e.x:void 0),ni("y"in e?e.y:void 0),ni("z"in e?e.z:void 0)]})}function ii(e,t){return{baseStep:zr(t),constraint:t,textProps:R.fromObject({draggingScale:Zr(t,e),formatter:cr(Xr(t,e))})}}const oi={id:"input-point3d",type:"input",accept:(e,t)=>{if(!$s.isObject(e))return null;const r=O,n=N(t,{x:r.optional.custom(Vr),y:r.optional.custom(Vr),z:r.optional.custom(Vr)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ti,constraint:e=>si(e.params),equals:$s.equals,writer:e=>ri},controller:e=>{const t=e.value,r=e.constraint;if(!(r instanceof Es))throw h.shouldNeverHappen();return new Ts(e.document,{assembly:ei,axes:[ii(t.rawValue.x,r.components[0]),ii(t.rawValue.y,r.components[1]),ii(t.rawValue.z,r.components[2])],parser:or,value:t,viewProps:e.viewProps})}};class ai{constructor(e=0,t=0,r=0,n=0){this.x=e,this.y=t,this.z=r,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(l(e))return!1;const t=e.x,r=e.y,n=e.z,s=e.w;return"number"==typeof t&&"number"==typeof r&&"number"==typeof n&&"number"==typeof s}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const li={toComponents:e=>e.getComponents(),fromComponents:e=>new ai(...e)};function ci(e){return ai.isObject(e)?new ai(e.x,e.y,e.z,e.w):new ai}function ui(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}function hi(e){if(!e)return;const t=[];return l(e.step)||t.push(new ft(e.step)),l(e.max)&&l(e.min)||t.push(new dt({max:e.max,min:e.min})),new ut(t)}function pi(e){return new Es({assembly:li,components:[hi("x"in e?e.x:void 0),hi("y"in e?e.y:void 0),hi("z"in e?e.z:void 0),hi("w"in e?e.w:void 0)]})}function di(e,t){return{baseStep:zr(t),constraint:t,textProps:R.fromObject({draggingScale:Zr(t,e),formatter:cr(Xr(t,e))})}}const fi={id:"input-point4d",type:"input",accept:(e,t)=>{if(!ai.isObject(e))return null;const r=O,n=N(t,{x:r.optional.custom(Vr),y:r.optional.custom(Vr),z:r.optional.custom(Vr),w:r.optional.custom(Vr)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>ci,constraint:e=>pi(e.params),equals:ai.equals,writer:e=>ui},controller:e=>{const t=e.value,r=e.constraint;if(!(r instanceof Es))throw h.shouldNeverHappen();return new Ts(e.document,{assembly:li,axes:t.rawValue.getComponents().map(((e,t)=>di(e,r.components[t]))),parser:or,value:t,viewProps:e.viewProps})}};function gi(e){const t=[],r=jr(e.options);return r&&t.push(r),new ut(t)}const mi={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const r=N(t,{options:O.optional.custom(Gr)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>pr,constraint:e=>gi(e.params),writer:e=>Hr},controller:e=>{var t;const r=e.document,n=e.value,s=e.constraint;return s&&ht(s,pt)?new At(r,{props:R.fromObject({options:null!==(t=Jr(s))&&void 0!==t?t:[]}),value:n,viewProps:e.viewProps}):new wt(r,{parser:e=>e,props:R.fromObject({formatter:dr}),value:n,viewProps:e.viewProps})}},Ai={monitor:{defaultInterval:200,defaultLineCount:3}},vi=m("mll");class Bi{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(vi()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("textarea");r.classList.add(vi("i")),r.style.height=`calc(var(--bld-us) * ${t.lineCount})`,r.readOnly=!0,t.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,r=[];this.value.rawValue.forEach((e=>{void 0!==e&&r.push(this.formatter_(e))})),e.textContent=r.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class _i{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Bi(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const Ci=m("sgl");class bi{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ci()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(Ci("i")),r.readOnly=!0,r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class wi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new bi(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Ei={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const r=N(t,{lineCount:O.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>xt},controller:e=>{var t;return 1===e.value.rawValue.length?new wi(e.document,{formatter:yt,value:e.value,viewProps:e.viewProps}):new _i(e.document,{formatter:yt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Ai.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}};class xi{constructor(){this.emitter=new f,this.index_=-1}get index(){return this.index_}set index(e){this.index_!==e&&(this.index_=e,this.emitter.emit("change",{index:e,sender:this}))}}const yi=m("grl");class Di{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(yi()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.minValue_=t.minValue,this.maxValue_=t.maxValue,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const r=e.createElementNS(U,"svg");r.classList.add(yi("g")),r.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(r),this.svgElem_=r;const n=e.createElementNS(U,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;const s=e.createElement("div");s.classList.add(yi("t"),m("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,r=this.minValue_,n=this.maxValue_,s=[];this.value.rawValue.forEach(((i,o)=>{if(void 0===i)return;const a=yr(o,0,t,0,e.width),l=yr(i,r,n,e.height,0);s.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const i=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0===o)return void i.classList.remove(yi("t","a"));const a=yr(this.cursor_.index,0,t,0,e.width),l=yr(o,r,n,e.height,0);i.style.left=`${a}px`,i.style.top=`${l}px`,i.textContent=`${this.formatter_(o)}`,i.classList.contains(yi("t","a"))||(i.classList.add(yi("t","a"),yi("t","in")),j(i),i.classList.remove(yi("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ti{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.cursor_=new xi,this.view=new Di(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,maxValue:t.maxValue,minValue:t.minValue,value:this.value,viewProps:this.viewProps}),W(e)){const e=new xr(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(yr(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.index=Math.floor(yr(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function Ii(e){return"format"in e&&!l(e.format)?e.format:cr(2)}function Ri(e){var t;return 1===e.value.rawValue.length?new wi(e.document,{formatter:Ii(e.params),value:e.value,viewProps:e.viewProps}):new _i(e.document,{formatter:Ii(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Ai.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}function Fi(e){var t,r,n;return new Ti(e.document,{formatter:Ii(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Ai.monitor.defaultLineCount,maxValue:null!==(r="max"in e.params?e.params.max:null)&&void 0!==r?r:100,minValue:null!==(n="min"in e.params?e.params.min:null)&&void 0!==n?n:0,value:e.value,viewProps:e.viewProps})}function Mi(e){return"view"in e&&"graph"===e.view}const Pi={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const r=O,n=N(t,{format:r.optional.function,lineCount:r.optional.number,max:r.optional.number,min:r.optional.number,view:r.optional.string});return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>Mi(e)?64:1,reader:e=>ar},controller:e=>Mi(e.params)?Fi(e):Ri(e)},Si={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const r=O,n=N(t,{lineCount:r.optional.number,multiline:r.optional.boolean});return n?{initialValue:e,params:n}:null},binding:{reader:e=>pr},controller:e=>{var t;const r=e.value;return r.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new _i(e.document,{formatter:dr,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Ai.monitor.defaultLineCount,value:r,viewProps:e.viewProps}):new wi(e.document,{formatter:dr,value:r,viewProps:e.viewProps})}};class Li{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new f,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function Oi(e,t){const r=e.accept(t.target.read(),t.params);if(l(r))return null;const n=O,s={target:t.target,initialValue:r.initialValue,params:r.params},i=e.binding.reader(s),o=e.binding.constraint?e.binding.constraint(s):void 0,a=I(i(r.initialValue),{constraint:o,equals:e.binding.equals}),c=new Li({reader:i,target:t.target,value:a,writer:e.binding.writer(s)}),u=n.optional.boolean(t.params.disabled).value,h=n.optional.boolean(t.params.hidden).value,p=e.controller({constraint:o,document:t.document,initialValue:r.initialValue,params:r.params,value:c.value,viewProps:qe.create({disabled:u,hidden:h})}),d=n.optional.string(t.params.label).value;return new Ce(t.document,{binding:c,blade:ce(),props:R.fromObject({label:d||t.target.key}),valueController:p})}class Ni{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new f,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,r=this.reader_(e);this.value.rawValue=Ar(t,r),this.emitter.emit("update",{rawValue:r,sender:this})}onTick_(e){this.read()}}function ki(e,t){return 0===t?new lt:new ct(e,null!=t?t:Ai.monitor.defaultInterval)}function Hi(e,t){var r,n,s;const i=O,o=e.accept(t.target.read(),t.params);if(l(o))return null;const a={target:t.target,initialValue:o.initialValue,params:o.params},c=e.binding.reader(a),u=null!==(n=null!==(r=i.optional.number(t.params.bufferSize).value)&&void 0!==r?r:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(o.params))&&void 0!==n?n:1,h=i.optional.number(t.params.interval).value,p=new Ni({reader:c,target:t.target,ticker:ki(t.document,h),value:gr(u)}),d=i.optional.boolean(t.params.disabled).value,f=i.optional.boolean(t.params.hidden).value,g=e.controller({document:t.document,params:o.params,value:p.value,viewProps:qe.create({disabled:d,hidden:f})}),m=null!==(s=i.optional.string(t.params.label).value)&&void 0!==s?s:t.target.key;return new we(t.document,{binding:p,blade:ce(),props:R.fromObject({label:m}),valueController:g})}class Gi{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,r){if(l(t.read()))throw new h({context:{key:t.key},type:"nomatchingcontroller"});const n=this.pluginsMap_.inputs.reduce(((n,s)=>n||Oi(s,{document:e,target:t,params:r})),null);if(n)return n;throw new h({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,r){const n=this.pluginsMap_.monitors.reduce(((n,s)=>n||Hi(s,{document:e,params:r,target:t})),null);if(n)return n;throw new h({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const r=this.pluginsMap_.blades.reduce(((r,n)=>r||at(n,{document:e,params:t})),null);if(!r)throw new h({type:"nomatchingview",context:{params:t}});return r}createBladeApi(e){if(e instanceof Ce)return new _e(e);if(e instanceof we)return new be(e);if(e instanceof Ne)return new De(e,this);const t=this.pluginsMap_.blades.reduce(((t,r)=>t||r.api({controller:e,pool:this})),null);if(!t)throw h.shouldNeverHappen();return t}}function Ki(){const e=new Gi;return[Qs,oi,fi,mi,Ss,ws,bs,_s,en,Ei,Si,Pi,ae,Ke,Xe,ot].forEach((t=>{e.register(t)})),e}class Vi extends r{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}}class Ui extends r{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}}class ji extends r{constructor(e){super(e),this.emitter_=new f,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}}const Ji={id:"list",type:"blade",accept(e){const t=O,r=N(e,{options:t.required.custom(Gr),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return r?{params:r}:null},controller(e){const t=new At(e.document,{props:R.fromObject({options:Ur(e.params.options)}),value:I(e.params.value),viewProps:e.viewProps});return new Ve(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:t})},api:e=>e.controller instanceof Ve&&e.controller.valueController instanceof At?new Vi(e.controller):null};function Wi(e){return e.reduce(((e,t)=>Object.assign(e,{[t.presetKey]:t.read()})),{})}function Xi(e,t){e.forEach((e=>{const r=t[e.presetKey];void 0!==r&&e.write(r)}))}class zi extends Te{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){Xi(this.controller_.rackController.rack.find(Ce).map((e=>e.binding.target)),e),this.refresh()}exportPreset(){return Wi(this.controller_.rackController.rack.find(Ce).map((e=>e.binding.target)))}refresh(){this.controller_.rackController.rack.find(Ce).forEach((e=>{e.binding.read()})),this.controller_.rackController.rack.find(we).forEach((e=>{e.binding.read()}))}}class Zi extends Ge{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const qi={id:"slider",type:"blade",accept(e){const t=O,r=N(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return r?{params:r}:null},controller(e){var t,r;const n=null!==(t=e.params.value)&&void 0!==t?t:0,s=new kr(e.document,{baseStep:1,parser:or,sliderProps:R.fromObject({maxValue:e.params.max,minValue:e.params.min}),textProps:R.fromObject({draggingScale:Zr(void 0,n),formatter:null!==(r=e.params.format)&&void 0!==r?r:lr}),value:I(n),viewProps:e.viewProps});return new Ve(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:s})},api:e=>e.controller instanceof Ve&&e.controller.valueController instanceof kr?new Ui(e.controller):null},Yi={id:"text",type:"blade",accept(e){const t=O,r=N(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return r?{params:r}:null},controller(e){var t;const r=new wt(e.document,{parser:e.params.parse,props:R.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:I(e.params.value),viewProps:e.viewProps});return new Ve(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:r})},api:e=>e.controller instanceof Ve&&e.controller.valueController instanceof wt?new ji(e.controller):null};function Qi(e){const t=e.createElement("div");return t.classList.add(m("dfw")()),e.body&&e.body.appendChild(t),t}function $i(e,t,r){if(e.querySelector(`style[data-tp-style=${t}]`))return;const n=e.createElement("style");n.dataset.tpStyle=t,n.textContent=r,e.head.appendChild(n)}class eo extends zi{constructor(e){var t;const r=e||{},n=null!==(t=r.document)&&void 0!==t?t:z(),s=Ki();super(new Zi(n,{expanded:r.expanded,blade:ce(),props:R.fromObject({title:r.title}),viewProps:qe.create()}),s),this.pool_=s,this.containerElem_=r.container||Qi(n),this.containerElem_.appendChild(this.element),this.doc_=n,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw h.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw h.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach((e=>{this.pool_.register(e),this.embedPluginStyle_(e)}))}embedPluginStyle_(e){e.css&&$i(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){$i(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((e=>{this.embedPluginStyle_(e)})),this.registerPlugin({plugins:[qi,Ji,ot,Yi]})}}const to=new t("3.0.8");e.BladeApi=r,e.ButtonApi=d,e.FolderApi=Te,e.InputBindingApi=_e,e.ListApi=Vi,e.MonitorBindingApi=be,e.Pane=eo,e.SeparatorApi=Ue,e.SliderApi=Ui,e.TabApi=rt,e.TabPageApi=tt,e.TextApi=ji,e.TpChangeEvent=s,e.VERSION=to,Object.defineProperty(e,"__esModule",{value:!0})}(s);var i,o={},a="object"==typeof Reflect?Reflect:null,l=a&&"function"==typeof a.apply?a.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};i=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var c=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}(o=u).once=function(e,t){return new Promise((function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}_(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&_(e,"error",t,r)}(e,s,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var h=10;function p(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function f(e,t,r,n){var s,i,o,a;if(p(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(s=d(e))>0&&o.length>s&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return e}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=g.bind(n);return s.listener=r,n.wrapFn=s,s}function A(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):B(s,s.length)}function v(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function B(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function _(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){n.once&&e.removeEventListener(t,s),r(i)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e||e<0||c(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");h=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||c(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return d(this)},u.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var a=s[e];if(void 0===a)return!1;if("function"==typeof a)l(a,this,t);else{var c=a.length,u=B(a,c);for(r=0;r<c;++r)l(u[r],this,t)}return!0},u.prototype.addListener=function(e,t){return f(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return f(this,e,t,!0)},u.prototype.once=function(e,t){return p(t),this.on(e,m(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return p(t),this.prependListener(e,m(this,e,t)),this},u.prototype.removeListener=function(e,t){var r,n,s,i,o;if(p(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return A(this,e,!0)},u.prototype.rawListeners=function(e){return A(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},u.prototype.listenerCount=v,u.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};var C=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];function b(){var e=this;function t(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}e.build_tree=function(r){var n,s,i,o=e.dyn_tree,a=e.stat_desc.static_tree,l=e.stat_desc.elems,c=-1;for(r.heap_len=0,r.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(r.heap[++r.heap_len]=c=n,r.depth[n]=0):o[2*n+1]=0;for(;r.heap_len<2;)o[2*(i=r.heap[++r.heap_len]=c<2?++c:0)]=1,r.depth[i]=0,r.opt_len--,a&&(r.static_len-=a[2*i+1]);for(e.max_code=c,n=Math.floor(r.heap_len/2);n>=1;n--)r.pqdownheap(o,n);i=l;do{n=r.heap[1],r.heap[1]=r.heap[r.heap_len--],r.pqdownheap(o,1),s=r.heap[1],r.heap[--r.heap_max]=n,r.heap[--r.heap_max]=s,o[2*i]=o[2*n]+o[2*s],r.depth[i]=Math.max(r.depth[n],r.depth[s])+1,o[2*n+1]=o[2*s+1]=i,r.heap[1]=i++,r.pqdownheap(o,1)}while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],function(t){var r,n,s,i,o,a,l=e.dyn_tree,c=e.stat_desc.static_tree,u=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,p=e.stat_desc.max_length,d=0;for(i=0;i<=15;i++)t.bl_count[i]=0;for(l[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<573;r++)(i=l[2*l[2*(n=t.heap[r])+1]+1]+1)>p&&(i=p,d++),l[2*n+1]=i,n>e.max_code||(t.bl_count[i]++,o=0,n>=h&&(o=u[n-h]),t.opt_len+=(a=l[2*n])*(i+o),c&&(t.static_len+=a*(c[2*n+1]+o)));if(0!==d){do{for(i=p-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[p]--,d-=2}while(d>0);for(i=p;0!==i;i--)for(n=t.bl_count[i];0!==n;)(s=t.heap[--r])>e.max_code||(l[2*s+1]!=i&&(t.opt_len+=(i-l[2*s+1])*l[2*s],l[2*s+1]=i),n--)}}(r),function(e,r,n){var s,i,o,a=[],l=0;for(s=1;s<=15;s++)a[s]=l=l+n[s-1]<<1;for(i=0;i<=r;i++)0!==(o=e[2*i+1])&&(e[2*i]=t(a[o]++,o))}(o,e.max_code,r.bl_count)}}function w(e,t,r,n,s){var i=this;i.static_tree=e,i.extra_bits=t,i.extra_base=r,i.elems=n,i.max_length=s}function E(e,t,r,n,s){var i=this;i.good_length=e,i.max_lazy=t,i.nice_length=r,i.max_chain=n,i.func=s}b._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],b.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],b.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],b.d_code=function(e){return e<256?C[e]:C[256+(e>>>7)]},b.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],b.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],w.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],w.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],w.static_l_desc=new w(w.static_ltree,b.extra_lbits,257,286,15),w.static_d_desc=new w(w.static_dtree,b.extra_dbits,0,30,15),w.static_bl_desc=new w(null,b.extra_blbits,0,19,7);var x=[new E(0,0,0,0,0),new E(4,4,8,4,1),new E(4,5,16,8,1),new E(4,6,32,32,1),new E(4,4,16,16,2),new E(8,16,32,32,2),new E(8,16,128,128,2),new E(8,32,128,256,2),new E(32,128,258,1024,2),new E(32,258,258,4096,2)],y=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function D(e,t,r,n){var s=e[2*t],i=e[2*r];return s<i||s==i&&n[t]<=n[r]}function T(){var e,t,r,n,s,i,o,a,l,c,u,h,p,d,f,g,m,A,v,B,_,C,E,T,I,R,F,M,P,S,L,O,N,k,H,G,K,V,U,j,J,W=this,X=new b,z=new b,Z=new b;function q(){var e;for(e=0;e<286;e++)L[2*e]=0;for(e=0;e<30;e++)O[2*e]=0;for(e=0;e<19;e++)N[2*e]=0;L[512]=1,W.opt_len=W.static_len=0,G=V=0}function Y(e,t){var r,n,s=-1,i=e[1],o=0,a=7,l=4;for(0===i&&(a=138,l=3),e[2*(t+1)+1]=65535,r=0;r<=t;r++)n=i,i=e[2*(r+1)+1],++o<a&&n==i||(o<l?N[2*n]+=o:0!==n?(n!=s&&N[2*n]++,N[32]++):o<=10?N[34]++:N[36]++,o=0,s=n,0===i?(a=138,l=3):n==i?(a=6,l=3):(a=7,l=4))}function Q(e){W.pending_buf[W.pending++]=e}function $(e){Q(255&e),Q(e>>>8&255)}function ee(e,t){var r,n=t;J>16-n?($(j|=(r=e)<<J&65535),j=r>>>16-J,J+=n-16):(j|=e<<J&65535,J+=n)}function te(e,t){var r=2*e;ee(65535&t[r],65535&t[r+1])}function re(e,t){var r,n,s=-1,i=e[1],o=0,a=7,l=4;for(0===i&&(a=138,l=3),r=0;r<=t;r++)if(n=i,i=e[2*(r+1)+1],!(++o<a&&n==i)){if(o<l)do{te(n,N)}while(0!=--o);else 0!==n?(n!=s&&(te(n,N),o--),te(16,N),ee(o-3,2)):o<=10?(te(17,N),ee(o-3,3)):(te(18,N),ee(o-11,7));o=0,s=n,0===i?(a=138,l=3):n==i?(a=6,l=3):(a=7,l=4)}}function ne(){16==J?($(j),j=0,J=0):J>=8&&(Q(255&j),j>>>=8,J-=8)}function se(e,t){var r,n,s;if(W.pending_buf[K+2*G]=e>>>8&255,W.pending_buf[K+2*G+1]=255&e,W.pending_buf[k+G]=255&t,G++,0===e?L[2*t]++:(V++,e--,L[2*(b._length_code[t]+256+1)]++,O[2*b.d_code(e)]++),0==(8191&G)&&F>2){for(r=8*G,n=_-m,s=0;s<30;s++)r+=O[2*s]*(5+b.extra_dbits[s]);if(r>>>=3,V<Math.floor(G/2)&&r<Math.floor(n/2))return!0}return G==H-1}function ie(e,t){var r,n,s,i,o=0;if(0!==G)do{r=W.pending_buf[K+2*o]<<8&65280|255&W.pending_buf[K+2*o+1],n=255&W.pending_buf[k+o],o++,0===r?te(n,e):(te((s=b._length_code[n])+256+1,e),0!==(i=b.extra_lbits[s])&&ee(n-=b.base_length[s],i),r--,te(s=b.d_code(r),t),0!==(i=b.extra_dbits[s])&&ee(r-=b.base_dist[s],i))}while(o<G);te(256,e),U=e[513]}function oe(){J>8?$(j):J>0&&Q(255&j),j=0,J=0}function ae(e,t,r){var n,s;ee(0+(r?1:0),3),n=e,s=t,oe(),U=8,$(s),$(~s),W.pending_buf.set(a.subarray(n,n+s),W.pending),W.pending+=s}function le(t){var r,n,s,i,o,a;r=m>=0?m:-1,n=_-m,s=t,a=0,F>0?(X.build_tree(W),z.build_tree(W),a=function(){var e;for(Y(L,X.max_code),Y(O,z.max_code),Z.build_tree(W),e=18;e>=3&&0===N[2*b.bl_order[e]+1];e--);return W.opt_len+=3*(e+1)+5+5+4,e}(),(o=W.static_len+3+7>>>3)<=(i=W.opt_len+3+7>>>3)&&(i=o)):i=o=n+5,n+4<=i&&-1!=r?ae(r,n,s):o==i?(ee(2+(s?1:0),3),ie(w.static_ltree,w.static_dtree)):(ee(4+(s?1:0),3),function(e,t,r){var n;for(ee(e-257,5),ee(t-1,5),ee(r-4,4),n=0;n<r;n++)ee(N[2*b.bl_order[n]+1],3);re(L,e-1),re(O,t-1)}(X.max_code+1,z.max_code+1,a+1),ie(L,O)),q(),s&&oe(),m=_,e.flush_pending()}function ce(){var t,r,n,i;do{if(0==(i=l-E-_)&&0===_&&0===E)i=s;else if(-1==i)i--;else if(_>=s+s-262){a.set(a.subarray(s,s+s),0),C-=s,_-=s,m-=s,n=t=p;do{r=65535&u[--n],u[n]=r>=s?r-s:0}while(0!=--t);n=t=s;do{r=65535&c[--n],c[n]=r>=s?r-s:0}while(0!=--t);i+=s}if(0===e.avail_in)return;t=e.read_buf(a,_+E,i),(E+=t)>=3&&(h=((h=255&a[_])<<g^255&a[_+1])&f)}while(E<262&&0!==e.avail_in)}function ue(e){var t,r,n=I,i=_,l=T,u=_>s-262?_-(s-262):0,h=S,p=o,d=_+258,f=a[i+l-1],g=a[i+l];T>=P&&(n>>=2),h>E&&(h=E);do{if(a[(t=e)+l]==g&&a[t+l-1]==f&&a[t]==a[i]&&a[++t]==a[i+1]){i+=2,t++;do{}while(a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&a[++i]==a[++t]&&i<d);if(r=258-(d-i),i=d-258,r>l){if(C=e,l=r,r>=h)break;f=a[i+l-1],g=a[i+l]}}}while((e=65535&c[e&p])>u&&0!=--n);return l<=E?l:E}W.depth=[],W.bl_count=[],W.heap=[],L=[],O=[],N=[],W.pqdownheap=function(e,t){for(var r=W.heap,n=r[t],s=t<<1;s<=W.heap_len&&(s<W.heap_len&&D(e,r[s+1],r[s],W.depth)&&s++,!D(e,n,r[s],W.depth));)r[t]=r[s],t=s,s<<=1;r[t]=n},W.deflateInit=function(e,v,C,b,y,D){return b||(b=8),y||(y=8),D||(D=0),e.msg=null,-1==v&&(v=6),y<1||y>9||8!=b||C<9||C>15||v<0||v>9||D<0||D>2?-2:(e.dstate=W,o=(s=1<<(i=C))-1,f=(p=1<<(d=y+7))-1,g=Math.floor((d+3-1)/3),a=new Uint8Array(2*s),c=[],u=[],H=1<<y+6,W.pending_buf=new Uint8Array(4*H),r=4*H,K=Math.floor(H/2),k=3*H,F=v,M=D,(G=e).total_in=G.total_out=0,G.msg=null,W.pending=0,W.pending_out=0,t=113,n=0,X.dyn_tree=L,X.stat_desc=w.static_l_desc,z.dyn_tree=O,z.stat_desc=w.static_d_desc,Z.dyn_tree=N,Z.stat_desc=w.static_bl_desc,j=0,J=0,U=8,q(),function(){var e;for(l=2*s,u[p-1]=0,e=0;e<p-1;e++)u[e]=0;R=x[F].max_lazy,P=x[F].good_length,S=x[F].nice_length,I=x[F].max_chain,_=0,m=0,E=0,A=T=2,B=0,h=0}(),0);var G},W.deflateEnd=function(){return 42!=t&&113!=t&&666!=t?-2:(W.pending_buf=null,u=null,c=null,a=null,W.dstate=null,113==t?-3:0)},W.deflateParams=function(e,t,r){var n=0;return-1==t&&(t=6),t<0||t>9||r<0||r>2?-2:(x[F].func!=x[t].func&&0!==e.total_in&&(n=e.deflate(1)),F!=t&&(R=x[F=t].max_lazy,P=x[F].good_length,S=x[F].nice_length,I=x[F].max_chain),M=r,n)},W.deflateSetDictionary=function(e,r,n){var i,l=n,p=0;if(!r||42!=t)return-2;if(l<3)return 0;for(l>s-262&&(p=n-(l=s-262)),a.set(r.subarray(p,p+l),0),_=l,m=l,h=((h=255&a[0])<<g^255&a[1])&f,i=0;i<=l-3;i++)c[i&o]=u[h=(h<<g^255&a[i+2])&f],u[h]=i;return 0},W.deflate=function(l,d){var b,D,I,P,S,L;if(d>4||d<0)return-2;if(!l.next_out||!l.next_in&&0!==l.avail_in||666==t&&4!=d)return l.msg=y[4],-2;if(0===l.avail_out)return l.msg=y[7],-5;if(e=l,P=n,n=d,42==t&&(D=8+(i-8<<4)<<8,(I=(F-1&255)>>1)>3&&(I=3),D|=I<<6,0!==_&&(D|=32),t=113,Q((L=D+=31-D%31)>>8&255),Q(255&L)),0!==W.pending){if(e.flush_pending(),0===e.avail_out)return n=-1,0}else if(0===e.avail_in&&d<=P&&4!=d)return e.msg=y[7],-5;if(666==t&&0!==e.avail_in)return l.msg=y[7],-5;if(0!==e.avail_in||0!==E||0!=d&&666!=t){switch(S=-1,x[F].func){case 0:S=function(t){var n,i=65535;for(i>r-5&&(i=r-5);;){if(E<=1){if(ce(),0===E&&0==t)return 0;if(0===E)break}if(_+=E,E=0,n=m+i,(0===_||_>=n)&&(E=_-n,_=n,le(!1),0===e.avail_out))return 0;if(_-m>=s-262&&(le(!1),0===e.avail_out))return 0}return le(4==t),0===e.avail_out?4==t?2:0:4==t?3:1}(d);break;case 1:S=function(t){for(var r,n=0;;){if(E<262){if(ce(),E<262&&0==t)return 0;if(0===E)break}if(E>=3&&(n=65535&u[h=(h<<g^255&a[_+2])&f],c[_&o]=u[h],u[h]=_),0!==n&&(_-n&65535)<=s-262&&2!=M&&(A=ue(n)),A>=3)if(r=se(_-C,A-3),E-=A,A<=R&&E>=3){A--;do{_++,n=65535&u[h=(h<<g^255&a[_+2])&f],c[_&o]=u[h],u[h]=_}while(0!=--A);_++}else _+=A,A=0,h=((h=255&a[_])<<g^255&a[_+1])&f;else r=se(0,255&a[_]),E--,_++;if(r&&(le(!1),0===e.avail_out))return 0}return le(4==t),0===e.avail_out?4==t?2:0:4==t?3:1}(d);break;case 2:S=function(t){for(var r,n,i=0;;){if(E<262){if(ce(),E<262&&0==t)return 0;if(0===E)break}if(E>=3&&(i=65535&u[h=(h<<g^255&a[_+2])&f],c[_&o]=u[h],u[h]=_),T=A,v=C,A=2,0!==i&&T<R&&(_-i&65535)<=s-262&&(2!=M&&(A=ue(i)),A<=5&&(1==M||3==A&&_-C>4096)&&(A=2)),T>=3&&A<=T){n=_+E-3,r=se(_-1-v,T-3),E-=T-1,T-=2;do{++_<=n&&(i=65535&u[h=(h<<g^255&a[_+2])&f],c[_&o]=u[h],u[h]=_)}while(0!=--T);if(B=0,A=2,_++,r&&(le(!1),0===e.avail_out))return 0}else if(0!==B){if((r=se(0,255&a[_-1]))&&le(!1),_++,E--,0===e.avail_out)return 0}else B=1,_++,E--}return 0!==B&&(r=se(0,255&a[_-1]),B=0),le(4==t),0===e.avail_out?4==t?2:0:4==t?3:1}(d)}if(2!=S&&3!=S||(t=666),0==S||2==S)return 0===e.avail_out&&(n=-1),0;if(1==S){if(1==d)ee(2,3),te(256,w.static_ltree),ne(),1+U+10-J<9&&(ee(2,3),te(256,w.static_ltree),ne()),U=7;else if(ae(0,0,!1),3==d)for(b=0;b<p;b++)u[b]=0;if(e.flush_pending(),0===e.avail_out)return n=-1,0}}return 4!=d?0:1}}function I(){var e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}function R(e){var t=new I,r=512,n=new Uint8Array(r),s=e?e.level:-1;void 0===s&&(s=-1),t.deflateInit(s),t.next_out=n,this.append=function(e,s){var i,o=[],a=0,l=0,c=0;if(e.length){t.next_in_index=0,t.next_in=e,t.avail_in=e.length;do{if(t.next_out_index=0,t.avail_out=r,0!=t.deflate(0))throw new Error("deflating: "+t.msg);t.next_out_index&&o.push(t.next_out_index==r?new Uint8Array(n):new Uint8Array(n.subarray(0,t.next_out_index))),c+=t.next_out_index,s&&t.next_in_index>0&&t.next_in_index!=a&&(s(t.next_in_index),a=t.next_in_index)}while(t.avail_in>0||0===t.avail_out);return i=new Uint8Array(c),o.forEach((function(e){i.set(e,l),l+=e.length})),i}},this.flush=function(){var e,s,i=[],o=0,a=0;do{if(t.next_out_index=0,t.avail_out=r,1!=(e=t.deflate(4))&&0!=e)throw new Error("deflating: "+t.msg);r-t.avail_out>0&&i.push(new Uint8Array(n.subarray(0,t.next_out_index))),a+=t.next_out_index}while(t.avail_in>0||0===t.avail_out);return t.deflateEnd(),s=new Uint8Array(a),i.forEach((function(e){s.set(e,o),o+=e.length})),s}}I.prototype={deflateInit:function(e,t){var r=this;return r.dstate=new T,t||(t=15),r.dstate.deflateInit(r,e,t)},deflate:function(e){var t=this;return t.dstate?t.dstate.deflate(t,e):-2},deflateEnd:function(){var e=this;if(!e.dstate)return-2;var t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams:function(e,t){var r=this;return r.dstate?r.dstate.deflateParams(r,e,t):-2},deflateSetDictionary:function(e,t){var r=this;return r.dstate?r.dstate.deflateSetDictionary(r,e,t):-2},read_buf:function(e,t,r){var n=this,s=n.avail_in;return s>r&&(s=r),0===s?0:(n.avail_in-=s,e.set(n.next_in.subarray(n.next_in_index,n.next_in_index+s),t),n.next_in_index+=s,n.total_in+=s,s)},flush_pending:function(){var e=this,t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),0!==t&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,0===e.dstate.pending&&(e.dstate.pending_out=0))}},self._zipjs_Deflater=R;var F=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],M=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],P=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],O=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function k(){var e,t,r,n,s,i;function o(e,t,o,a,l,c,u,h,p,d,f){var g,m,A,v,B,_,C,b,w,E,x,y,D,T,I;E=0,B=o;do{r[e[t+E]]++,E++,B--}while(0!==B);if(r[0]==o)return u[0]=-1,h[0]=0,0;for(b=h[0],_=1;_<=15&&0===r[_];_++);for(C=_,b<_&&(b=_),B=15;0!==B&&0===r[B];B--);for(A=B,b>B&&(b=B),h[0]=b,T=1<<_;_<B;_++,T<<=1)if((T-=r[_])<0)return-3;if((T-=r[B])<0)return-3;for(r[B]+=T,i[1]=_=0,E=1,D=2;0!=--B;)i[D]=_+=r[E],D++,E++;B=0,E=0;do{0!==(_=e[t+E])&&(f[i[_]++]=B),E++}while(++B<o);for(o=i[A],i[0]=B=0,E=0,v=-1,y=-b,s[0]=0,x=0,I=0;C<=A;C++)for(g=r[C];0!=g--;){for(;C>y+b;){if(v++,I=(I=A-(y+=b))>b?b:I,(m=1<<(_=C-y))>g+1&&(m-=g+1,D=C,_<I))for(;++_<I&&!((m<<=1)<=r[++D]);)m-=r[D];if(d[0]+(I=1<<_)>1440)return-3;s[v]=x=d[0],d[0]+=I,0!==v?(i[v]=B,n[0]=_,n[1]=b,n[2]=x-s[v-1]-(_=B>>>y-b),p.set(n,3*(s[v-1]+_))):u[0]=x}for(n[1]=C-y,E>=o?n[0]=192:f[E]<a?(n[0]=f[E]<256?0:96,n[2]=f[E++]):(n[0]=c[f[E]-a]+16+64,n[2]=l[f[E++]-a]),m=1<<C-y,_=B>>>y;_<I;_+=m)p.set(n,3*(x+_));for(_=1<<C-1;0!=(B&_);_>>>=1)B^=_;for(B^=_,w=(1<<y)-1;(B&w)!=i[v];)v--,w=(1<<(y-=b))-1}return 0!==T&&1!=A?-5:0}function a(o){var a;for(e||(e=[],t=[],r=new Int32Array(16),n=[],s=new Int32Array(15),i=new Int32Array(16)),t.length<o&&(t=[]),a=0;a<o;a++)t[a]=0;for(a=0;a<16;a++)r[a]=0;for(a=0;a<3;a++)n[a]=0;s.set(r.subarray(0,15),0),i.set(r.subarray(0,16),0)}this.inflate_trees_bits=function(r,n,s,i,l){var c;return a(19),e[0]=0,-3==(c=o(r,0,19,19,null,null,s,n,i,e,t))?l.msg="oversubscribed dynamic bit lengths tree":-5!=c&&0!==n[0]||(l.msg="incomplete dynamic bit lengths tree",c=-3),c},this.inflate_trees_dynamic=function(r,n,s,i,l,c,u,h,p){var d;return a(288),e[0]=0,0!=(d=o(s,0,r,257,S,L,c,i,h,e,t))||0===i[0]?(-3==d?p.msg="oversubscribed literal/length tree":-4!=d&&(p.msg="incomplete literal/length tree",d=-3),d):(a(288),0!=(d=o(s,r,n,0,O,N,u,l,h,e,t))||0===l[0]&&r>257?(-3==d?p.msg="oversubscribed distance tree":-5==d?(p.msg="incomplete distance tree",d=-3):-4!=d&&(p.msg="empty distance tree with lengths",d=-3),d):0)}}function H(){var e,t,r,n,s=this,i=0,o=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0;function g(e,t,r,n,s,i,o,a){var l,c,u,h,p,d,f,g,m,A,v,B,_,C,b,w;f=a.next_in_index,g=a.avail_in,p=o.bitb,d=o.bitk,A=(m=o.write)<o.read?o.read-m-1:o.end-m,v=F[e],B=F[t];do{for(;d<20;)g--,p|=(255&a.read_byte(f++))<<d,d+=8;if(0!==(h=(c=r)[w=3*((u=n)+(l=p&v))]))for(;;){if(p>>=c[w+1],d-=c[w+1],0!=(16&h)){for(_=c[w+2]+(p&F[h&=15]),p>>=h,d-=h;d<15;)g--,p|=(255&a.read_byte(f++))<<d,d+=8;for(h=(c=s)[w=3*((u=i)+(l=p&B))];;){if(p>>=c[w+1],d-=c[w+1],0!=(16&h)){for(h&=15;d<h;)g--,p|=(255&a.read_byte(f++))<<d,d+=8;if(C=c[w+2]+(p&F[h]),p>>=h,d-=h,A-=_,m>=C)m-(b=m-C)>0&&2>m-b?(o.window[m++]=o.window[b++],o.window[m++]=o.window[b++],_-=2):(o.window.set(o.window.subarray(b,b+2),m),m+=2,b+=2,_-=2);else{b=m-C;do{b+=o.end}while(b<0);if(_>(h=o.end-b)){if(_-=h,m-b>0&&h>m-b)do{o.window[m++]=o.window[b++]}while(0!=--h);else o.window.set(o.window.subarray(b,b+h),m),m+=h,b+=h,h=0;b=0}}if(m-b>0&&_>m-b)do{o.window[m++]=o.window[b++]}while(0!=--_);else o.window.set(o.window.subarray(b,b+_),m),m+=_,b+=_,_=0;break}if(0!=(64&h))return a.msg="invalid distance code",g+=_=d>>3<(_=a.avail_in-g)?d>>3:_,f-=_,d-=_<<3,o.bitb=p,o.bitk=d,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,o.write=m,-3;l+=c[w+2],h=c[w=3*(u+(l+=p&F[h]))]}break}if(0!=(64&h))return 0!=(32&h)?(g+=_=d>>3<(_=a.avail_in-g)?d>>3:_,f-=_,d-=_<<3,o.bitb=p,o.bitk=d,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,o.write=m,1):(a.msg="invalid literal/length code",g+=_=d>>3<(_=a.avail_in-g)?d>>3:_,f-=_,d-=_<<3,o.bitb=p,o.bitk=d,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,o.write=m,-3);if(l+=c[w+2],0===(h=c[w=3*(u+(l+=p&F[h]))])){p>>=c[w+1],d-=c[w+1],o.window[m++]=c[w+2],A--;break}}else p>>=c[w+1],d-=c[w+1],o.window[m++]=c[w+2],A--}while(A>=258&&g>=10);return g+=_=d>>3<(_=a.avail_in-g)?d>>3:_,f-=_,d-=_<<3,o.bitb=p,o.bitk=d,a.avail_in=g,a.total_in+=f-a.next_in_index,a.next_in_index=f,o.write=m,0}s.init=function(s,i,o,a,l,c){e=0,h=s,p=i,r=o,d=a,n=l,f=c,t=null},s.proc=function(s,m,A){var v,B,_,C,b,w,E,x=0,y=0,D=0;for(D=m.next_in_index,C=m.avail_in,x=s.bitb,y=s.bitk,w=(b=s.write)<s.read?s.read-b-1:s.end-b;;)switch(e){case 0:if(w>=258&&C>=10&&(s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,A=g(h,p,r,d,n,f,s,m),D=m.next_in_index,C=m.avail_in,x=s.bitb,y=s.bitk,w=(b=s.write)<s.read?s.read-b-1:s.end-b,0!=A)){e=1==A?7:9;break}a=h,t=r,o=d,e=1;case 1:for(v=a;y<v;){if(0===C)return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);A=0,C--,x|=(255&m.read_byte(D++))<<y,y+=8}if(x>>>=t[1+(B=3*(o+(x&F[v])))],y-=t[B+1],0===(_=t[B])){l=t[B+2],e=6;break}if(0!=(16&_)){c=15&_,i=t[B+2],e=2;break}if(0==(64&_)){a=_,o=B/3+t[B+2];break}if(0!=(32&_)){e=7;break}return e=9,m.msg="invalid literal/length code",A=-3,s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);case 2:for(v=c;y<v;){if(0===C)return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);A=0,C--,x|=(255&m.read_byte(D++))<<y,y+=8}i+=x&F[v],x>>=v,y-=v,a=p,t=n,o=f,e=3;case 3:for(v=a;y<v;){if(0===C)return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);A=0,C--,x|=(255&m.read_byte(D++))<<y,y+=8}if(x>>=t[1+(B=3*(o+(x&F[v])))],y-=t[B+1],0!=(16&(_=t[B]))){c=15&_,u=t[B+2],e=4;break}if(0==(64&_)){a=_,o=B/3+t[B+2];break}return e=9,m.msg="invalid distance code",A=-3,s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);case 4:for(v=c;y<v;){if(0===C)return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);A=0,C--,x|=(255&m.read_byte(D++))<<y,y+=8}u+=x&F[v],x>>=v,y-=v,e=5;case 5:for(E=b-u;E<0;)E+=s.end;for(;0!==i;){if(0===w&&(b==s.end&&0!==s.read&&(w=(b=0)<s.read?s.read-b-1:s.end-b),0===w&&(s.write=b,A=s.inflate_flush(m,A),w=(b=s.write)<s.read?s.read-b-1:s.end-b,b==s.end&&0!==s.read&&(w=(b=0)<s.read?s.read-b-1:s.end-b),0===w)))return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);s.window[b++]=s.window[E++],w--,E==s.end&&(E=0),i--}e=0;break;case 6:if(0===w&&(b==s.end&&0!==s.read&&(w=(b=0)<s.read?s.read-b-1:s.end-b),0===w&&(s.write=b,A=s.inflate_flush(m,A),w=(b=s.write)<s.read?s.read-b-1:s.end-b,b==s.end&&0!==s.read&&(w=(b=0)<s.read?s.read-b-1:s.end-b),0===w)))return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);A=0,s.window[b++]=l,w--,e=0;break;case 7:if(y>7&&(y-=8,C++,D--),s.write=b,A=s.inflate_flush(m,A),w=(b=s.write)<s.read?s.read-b-1:s.end-b,s.read!=s.write)return s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);e=8;case 8:return A=1,s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);case 9:return A=-3,s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A);default:return A=-2,s.bitb=x,s.bitk=y,m.avail_in=C,m.total_in+=D-m.next_in_index,m.next_in_index=D,s.write=b,s.inflate_flush(m,A)}},s.free=function(){}}k.inflate_trees_fixed=function(e,t,r,n){return e[0]=9,t[0]=5,r[0]=M,n[0]=P,0};var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function K(e,t){var r,n=this,s=0,i=0,o=0,a=0,l=[0],c=[0],u=new H,h=0,p=new Int32Array(4320),d=new k;n.bitk=0,n.bitb=0,n.window=new Uint8Array(t),n.end=t,n.read=0,n.write=0,n.reset=function(e,t){t&&(t[0]=0),6==s&&u.free(e),s=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(e,null),n.inflate_flush=function(e,t){var r,s,i;return s=e.next_out_index,(r=((i=n.read)<=n.write?n.write:n.end)-i)>e.avail_out&&(r=e.avail_out),0!==r&&-5==t&&(t=0),e.avail_out-=r,e.total_out+=r,e.next_out.set(n.window.subarray(i,i+r),s),s+=r,(i+=r)==n.end&&(i=0,n.write==n.end&&(n.write=0),(r=n.write-i)>e.avail_out&&(r=e.avail_out),0!==r&&-5==t&&(t=0),e.avail_out-=r,e.total_out+=r,e.next_out.set(n.window.subarray(i,i+r),s),s+=r,i+=r),e.next_out_index=s,n.read=i,t},n.proc=function(e,t){var f,g,m,A,v,B,_,C;for(A=e.next_in_index,v=e.avail_in,g=n.bitb,m=n.bitk,_=(B=n.write)<n.read?n.read-B-1:n.end-B;;)switch(s){case 0:for(;m<3;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}switch(h=1&(f=7&g),f>>>1){case 0:g>>>=3,g>>>=f=7&(m-=3),m-=f,s=1;break;case 1:var b=[],w=[],E=[[]],x=[[]];k.inflate_trees_fixed(b,w,E,x),u.init(b[0],w[0],E[0],0,x[0],0),g>>>=3,m-=3,s=6;break;case 2:g>>>=3,m-=3,s=3;break;case 3:return g>>>=3,m-=3,s=9,e.msg="invalid block type",t=-3,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t)}break;case 1:for(;m<32;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}if((~g>>>16&65535)!=(65535&g))return s=9,e.msg="invalid stored block lengths",t=-3,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);i=65535&g,g=m=0,s=0!==i?2:0!==h?7:0;break;case 2:if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);if(0===_&&(B==n.end&&0!==n.read&&(_=(B=0)<n.read?n.read-B-1:n.end-B),0===_&&(n.write=B,t=n.inflate_flush(e,t),_=(B=n.write)<n.read?n.read-B-1:n.end-B,B==n.end&&0!==n.read&&(_=(B=0)<n.read?n.read-B-1:n.end-B),0===_)))return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);if(t=0,(f=i)>v&&(f=v),f>_&&(f=_),n.window.set(e.read_buf(A,f),B),A+=f,v-=f,B+=f,_-=f,0!=(i-=f))break;s=0!==h?7:0;break;case 3:for(;m<14;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}if(o=f=16383&g,(31&f)>29||(f>>5&31)>29)return s=9,e.msg="too many length or distance symbols",t=-3,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);if(f=258+(31&f)+(f>>5&31),!r||r.length<f)r=[];else for(C=0;C<f;C++)r[C]=0;g>>>=14,m-=14,a=0,s=4;case 4:for(;a<4+(o>>>10);){for(;m<3;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}r[G[a++]]=7&g,g>>>=3,m-=3}for(;a<19;)r[G[a++]]=0;if(l[0]=7,0!=(f=d.inflate_trees_bits(r,l,c,p,e)))return-3==(t=f)&&(r=null,s=9),n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);a=0,s=5;case 5:for(;!(a>=258+(31&(f=o))+(f>>5&31));){var y,D;for(f=l[0];m<f;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}if((D=p[3*(c[0]+(g&F[f=p[3*(c[0]+(g&F[f]))+1]]))+2])<16)g>>>=f,m-=f,r[a++]=D;else{for(C=18==D?7:D-14,y=18==D?11:3;m<f+C;){if(0===v)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);t=0,v--,g|=(255&e.read_byte(A++))<<m,m+=8}if(m-=f,y+=(g>>>=f)&F[C],g>>>=C,m-=C,(C=a)+y>258+(31&(f=o))+(f>>5&31)||16==D&&C<1)return r=null,s=9,e.msg="invalid bit length repeat",t=-3,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);D=16==D?r[C-1]:0;do{r[C++]=D}while(0!=--y);a=C}}c[0]=-1;var T=[],I=[],R=[],M=[];if(T[0]=9,I[0]=6,0!=(f=d.inflate_trees_dynamic(257+(31&(f=o)),1+(f>>5&31),r,T,I,R,M,p,e)))return-3==f&&(r=null,s=9),t=f,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);u.init(T[0],I[0],p,R[0],p,M[0]),s=6;case 6:if(n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,1!=(t=u.proc(n,e,t)))return n.inflate_flush(e,t);if(t=0,u.free(e),A=e.next_in_index,v=e.avail_in,g=n.bitb,m=n.bitk,_=(B=n.write)<n.read?n.read-B-1:n.end-B,0===h){s=0;break}s=7;case 7:if(n.write=B,t=n.inflate_flush(e,t),_=(B=n.write)<n.read?n.read-B-1:n.end-B,n.read!=n.write)return n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);s=8;case 8:return t=1,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);case 9:return t=-3,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t);default:return t=-2,n.bitb=g,n.bitk=m,e.avail_in=v,e.total_in+=A-e.next_in_index,e.next_in_index=A,n.write=B,n.inflate_flush(e,t)}},n.free=function(e){n.reset(e,null),n.window=null,p=null},n.set_dictionary=function(e,t,r){n.window.set(e.subarray(t,t+r),0),n.read=n.write=r},n.sync_point=function(){return 1==s?1:0}}var V=[0,0,255,255];function U(){var e=this;function t(e){return e&&e.istate?(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=7,e.istate.blocks.reset(e,null),0):-2}e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0,e.inflateEnd=function(t){return e.blocks&&e.blocks.free(t),e.blocks=null,0},e.inflateInit=function(r,n){return r.msg=null,e.blocks=null,n<8||n>15?(e.inflateEnd(r),-2):(e.wbits=n,r.istate.blocks=new K(r,1<<n),t(r),0)},e.inflate=function(e,t){var r,n;if(!e||!e.istate||!e.next_in)return-2;for(t=4==t?-5:0,r=-5;;)switch(e.istate.mode){case 0:if(0===e.avail_in)return r;if(r=t,e.avail_in--,e.total_in++,8!=(15&(e.istate.method=e.read_byte(e.next_in_index++)))){e.istate.mode=13,e.msg="unknown compression method",e.istate.marker=5;break}if(8+(e.istate.method>>4)>e.istate.wbits){e.istate.mode=13,e.msg="invalid window size",e.istate.marker=5;break}e.istate.mode=1;case 1:if(0===e.avail_in)return r;if(r=t,e.avail_in--,e.total_in++,n=255&e.read_byte(e.next_in_index++),((e.istate.method<<8)+n)%31!=0){e.istate.mode=13,e.msg="incorrect header check",e.istate.marker=5;break}if(0==(32&n)){e.istate.mode=7;break}e.istate.mode=2;case 2:if(0===e.avail_in)return r;r=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.read_byte(e.next_in_index++))<<24&4278190080,e.istate.mode=3;case 3:if(0===e.avail_in)return r;r=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.read_byte(e.next_in_index++))<<16&16711680,e.istate.mode=4;case 4:if(0===e.avail_in)return r;r=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.read_byte(e.next_in_index++))<<8&65280,e.istate.mode=5;case 5:return 0===e.avail_in?r:(r=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.read_byte(e.next_in_index++),e.istate.mode=6,2);case 6:return e.istate.mode=13,e.msg="need dictionary",e.istate.marker=0,-2;case 7:if(-3==(r=e.istate.blocks.proc(e,r))){e.istate.mode=13,e.istate.marker=0;break}if(0==r&&(r=t),1!=r)return r;r=t,e.istate.blocks.reset(e,e.istate.was),e.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}},e.inflateSetDictionary=function(e,t,r){var n=0,s=r;return e&&e.istate&&6==e.istate.mode?(s>=1<<e.istate.wbits&&(n=r-(s=(1<<e.istate.wbits)-1)),e.istate.blocks.set_dictionary(t,n,s),e.istate.mode=7,0):-2},e.inflateSync=function(e){var r,n,s,i,o;if(!e||!e.istate)return-2;if(13!=e.istate.mode&&(e.istate.mode=13,e.istate.marker=0),0===(r=e.avail_in))return-5;for(n=e.next_in_index,s=e.istate.marker;0!==r&&s<4;)e.read_byte(n)==V[s]?s++:s=0!==e.read_byte(n)?0:4-s,n++,r--;return e.total_in+=n-e.next_in_index,e.next_in_index=n,e.avail_in=r,e.istate.marker=s,4!=s?-3:(i=e.total_in,o=e.total_out,t(e),e.total_in=i,e.total_out=o,e.istate.mode=7,0)},e.inflateSyncPoint=function(e){return e&&e.istate&&e.istate.blocks?e.istate.blocks.sync_point():-2}}function j(){}function J(){var e=new j,t=new Uint8Array(512),r=!1;e.inflateInit(),e.next_out=t,this.append=function(n,s){var i,o,a=[],l=0,c=0,u=0;if(0!==n.length){e.next_in_index=0,e.next_in=n,e.avail_in=n.length;do{if(e.next_out_index=0,e.avail_out=512,0!==e.avail_in||r||(e.next_in_index=0,r=!0),i=e.inflate(0),r&&-5===i){if(0!==e.avail_in)throw new Error("inflating: bad input")}else if(0!==i&&1!==i)throw new Error("inflating: "+e.msg);if((r||1===i)&&e.avail_in===n.length)throw new Error("inflating: bad input");e.next_out_index&&a.push(512===e.next_out_index?new Uint8Array(t):new Uint8Array(t.subarray(0,e.next_out_index))),u+=e.next_out_index,s&&e.next_in_index>0&&e.next_in_index!=l&&(s(e.next_in_index),l=e.next_in_index)}while(e.avail_in>0||0===e.avail_out);return o=new Uint8Array(u),a.forEach((function(e){o.set(e,c),c+=e.length})),o}},this.flush=function(){e.inflateEnd()}}j.prototype={inflateInit:function(e){var t=this;return t.istate=new U,e||(e=15),t.istate.inflateInit(t,e)},inflate:function(e){var t=this;return t.istate?t.istate.inflate(t,e):-2},inflateEnd:function(){var e=this;if(!e.istate)return-2;var t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync:function(){var e=this;return e.istate?e.istate.inflateSync(e):-2},inflateSetDictionary:function(e,t){var r=this;return r.istate?r.istate.inflateSetDictionary(r,e,t):-2},read_byte:function(e){return this.next_in.subarray(e,e+1)[0]},read_buf:function(e,t){return this.next_in.subarray(e,e+t)}},self._zipjs_Inflater=J;var W;try{W=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch($n){}function X(){this.crc=-1}function z(){}function Z(e,t){var r,n;return r=new ArrayBuffer(e),n=new Uint8Array(r),t&&n.set(t,0),{buffer:r,array:n,view:new DataView(r)}}function q(){}function Y(e){var t,r=this;r.size=0,r.init=function(n,s){var i=new Blob([e],{type:"text/plain"});(t=new $(i)).init((function(){r.size=t.size,n()}),s)},r.readUint8Array=function(e,r,n,s){t.readUint8Array(e,r,n,s)}}function Q(e){var t,r=this;r.size=0,r.init=function(n){for(var s=e.length;"="==e.charAt(s-1);)s--;t=e.indexOf(",")+1,r.size=Math.floor(.75*(s-t)),n()},r.readUint8Array=function(r,n,s){var i,o=Z(n),a=4*Math.floor(r/3),l=4*Math.ceil((r+n)/3),c=self.atob(e.substring(a+t,l+t)),u=r-3*Math.floor(a/4);for(i=u;i<u+n;i++)o.array[i-u]=c.charCodeAt(i);s(o.array)}}function $(e){var t=this;t.size=0,t.init=function(r){t.size=e.size,r()},t.readUint8Array=function(t,r,n,s){var i=new FileReader;i.onload=function(e){n(new Uint8Array(e.target.result))},i.onerror=s;try{i.readAsArrayBuffer(function(e,t,r){if(t<0||r<0||t+r>e.size)throw new RangeError("offset:"+t+", length:"+r+", size:"+e.size);return e.slice?e.slice(t,t+r):e.webkitSlice?e.webkitSlice(t,t+r):e.mozSlice?e.mozSlice(t,t+r):e.msSlice?e.msSlice(t,t+r):void 0}(e,t,r))}catch(e){s(e)}}}function ee(){}function te(e){var t,r=this;r.init=function(e){t=new Blob([],{type:"text/plain"}),e()},r.writeUint8Array=function(e,r){t=new Blob([t,W?e:e.buffer],{type:"text/plain"}),r()},r.getData=function(r,n){var s=new FileReader;s.onload=function(e){r(e.target.result)},s.onerror=n,s.readAsText(t,e)}}function re(e){var t=this,r="",n="";t.init=function(t){r+="data:"+(e||"")+";base64,",t()},t.writeUint8Array=function(e,t){var s,i=n.length,o=n;for(n="",s=0;s<3*Math.floor((i+e.length)/3)-i;s++)o+=String.fromCharCode(e[s]);for(;s<e.length;s++)n+=String.fromCharCode(e[s]);o.length>2?r+=self.btoa(o):n=o,t()},t.getData=function(e){e(r+self.btoa(n))}}function ne(e){var t,r=this;r.init=function(r){t=new Blob([],{type:e}),r()},r.writeUint8Array=function(r,n){t=new Blob([t,W?r:r.buffer],{type:e}),n()},r.getData=function(e){e(t)}}function se(e,t,r,n,s,i,o,a,l,c){var u,h,p,d=0,f=t.sn;function g(){e.removeEventListener("message",m,!1),a(h,p)}function m(t){var r=t.data,s=r.data,a=r.error;if(a)return a.toString=function(){return"Error: "+this.message},void l(a);if(r.sn===f)switch("number"==typeof r.codecTime&&(e.codecTime+=r.codecTime),"number"==typeof r.crcTime&&(e.crcTime+=r.crcTime),r.type){case"append":s?(h+=s.length,n.writeUint8Array(s,(function(){A()}),c)):A();break;case"flush":p=r.crc,s?(h+=s.length,n.writeUint8Array(s,(function(){g()}),c)):g();break;case"progress":o&&o(u+r.loaded,i);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",r)}}function A(){(u=524288*d)<=i?r.readUint8Array(s+u,Math.min(524288,i-u),(function(r){o&&o(u,i);var n=0===u?t:{sn:f};n.type="append",n.data=r;try{e.postMessage(n,[r.buffer])}catch(t){e.postMessage(n)}d++}),l):e.postMessage({sn:f,type:"flush"})}h=0,e.addEventListener("message",m,!1),A()}function ie(e,t,r,n,s,i,o,a,l,c){var u,h=0,p=0,d="input"===i,f="output"===i,g=new X;!function i(){var m;if((u=524288*h)<s)t.readUint8Array(n+u,Math.min(524288,s-u),(function(t){var n;try{n=e.append(t,(function(e){o&&o(u+e,s)}))}catch(e){return void l(e)}n?(p+=n.length,r.writeUint8Array(n,(function(){h++,setTimeout(i,1)}),c),f&&g.append(n)):(h++,setTimeout(i,1)),d&&g.append(t),o&&o(u,s)}),l);else{try{m=e.flush()}catch(e){return void l(e)}m?(f&&g.append(m),p+=m.length,r.writeUint8Array(m,(function(){a(p,g.get())}),c)):a(p,g.get())}}()}function oe(e,t,r,n,s,i,o,a,l,c,u){var h="input";me.useWebWorkers&&o?se(e,{sn:t,codecClass:"_zipjs_NOOP",crcType:h},r,n,s,i,l,a,c,u):ie(new z,r,n,s,i,h,l,a,c,u)}function ae(e){var t,r,n="",s=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)n+=(r=255&e.charCodeAt(t))>127?s[r-128]:String.fromCharCode(r);return n}function le(e){return decodeURIComponent(escape(e))}function ce(e){var t,r="";for(t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}function ue(e,t,r,n,s){e.version=t.view.getUint16(r,!0),e.bitFlag=t.view.getUint16(r+2,!0),e.compressionMethod=t.view.getUint16(r+4,!0),e.lastModDateRaw=t.view.getUint32(r+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,r=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&r)>>11,(2016&r)>>5,2*(31&r),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((n||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(r+10,!0),e.compressedSize=t.view.getUint32(r+14,!0),e.uncompressedSize=t.view.getUint32(r+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(r+22,!0),e.extraFieldLength=t.view.getUint16(r+24,!0)):s("File is using Zip64 (4gb+ file size).")):s("File contains encrypted entry.")}function he(e){return unescape(encodeURIComponent(e))}function pe(e){var t,r=[];for(t=0;t<e.length;t++)r.push(e.charCodeAt(t));return r}X.prototype.append=function(e){for(var t=0|this.crc,r=this.table,n=0,s=0|e.length;n<s;n++)t=t>>>8^r[255&(t^e[n])];this.crc=t},X.prototype.get=function(){return~this.crc},X.prototype.table=function(){var e,t,r,n=[];for(e=0;e<256;e++){for(r=e,t=0;t<8;t++)1&r?r=r>>>1^3988292384:r>>>=1;n[e]=r}return n}(),z.prototype.append=function(e,t){return e},z.prototype.flush=function(){},(Y.prototype=new q).constructor=Y,(Q.prototype=new q).constructor=Q,($.prototype=new q).constructor=$,ee.prototype.getData=function(e){e(this.data)},(te.prototype=new ee).constructor=te,(re.prototype=new ee).constructor=re,(ne.prototype=new ee).constructor=ne;var de={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function fe(e,t,r){if(null===me.workerScripts||null===me.workerScriptsPath){var n,s,i;if(me.workerScripts){if(n=me.workerScripts[e],!Array.isArray(n))return void r(new Error("zip.workerScripts."+e+" is not an array!"));s=n,i=document.createElement("a"),n=s.map((function(e){return i.href=e,i.href}))}else(n=de[e].slice(0))[0]=(me.workerScriptsPath||"")+n[0];var o=new Worker(n[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:n.slice(1)}),o.addEventListener("message",(function e(n){var s=n.data;if(s.error)return o.terminate(),void r(s.error);"importScripts"===s.type&&(o.removeEventListener("message",e),o.removeEventListener("error",a),t(o))})),o.addEventListener("error",a)}else r(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function a(e){o.terminate(),r(e)}}function ge(e){console.error(e)}const me={Reader:q,Writer:ee,BlobReader:$,Data64URIReader:Q,TextReader:Y,BlobWriter:ne,Data64URIWriter:re,TextWriter:te,createReader:function(e,t,r){e.init((function(){!function(e,t,r){var n=0;function s(){}s.prototype.getData=function(t,s,i,o){var a=this;function l(e,n){var i,l;o&&(i=n,(l=Z(4)).view.setUint32(0,i),a.crc32!=l.view.getUint32(0))?r("CRC failed."):t.getData((function(e){s(e)}))}function c(e){r(e||"Error while reading file data.")}function u(e){r(e||"Error while writing file data.")}e.readUint8Array(a.offset,30,(function(s){var h,p=Z(s.length,s);1347093252==p.view.getUint32(0)?(ue(a,p,4,!1,r),h=a.offset+30+a.filenameLength+a.extraFieldLength,t.init((function(){var r,s,p,d,f,g,m,A,v,B,_;0===a.compressionMethod?oe(a._worker,n++,e,t,h,a.compressedSize,o,l,i,c,u):(r=a._worker,s=n++,p=e,d=t,f=h,g=a.compressedSize,m=l,A=i,v=c,B=u,_=o?"output":"none",me.useWebWorkers?se(r,{sn:s,codecClass:"_zipjs_Inflater",crcType:_},p,d,f,g,A,m,v,B):ie(new J,p,d,f,g,_,A,m,v,B))}),u)):r("File format is not recognized.")}),c)};var i={getEntries:function(t){var n=this._worker;!function(t){function n(n,s){e.readUint8Array(e.size-n,n,(function(e){for(var r=e.length-22;r>=0;r--)if(80===e[r]&&75===e[r+1]&&5===e[r+2]&&6===e[r+3])return void t(new DataView(e.buffer,r,22));s()}),(function(){r("Error while reading zip file.")}))}e.size<22?r("File format is not recognized."):n(22,(function(){n(Math.min(65558,e.size),(function(){r("File format is not recognized.")}))}))}((function(i){var o,a;o=i.getUint32(16,!0),a=i.getUint16(8,!0),o<0||o>=e.size?r("File format is not recognized."):e.readUint8Array(o,e.size-o,(function(e){var i,o,l,c,u=0,h=[],p=Z(e.length,e);for(i=0;i<a;i++){if((o=new s)._worker=n,1347092738!=p.view.getUint32(u))return void r("File format is not recognized.");ue(o,p,u+6,!0,r),o.commentLength=p.view.getUint16(u+32,!0),o.directory=16==(16&p.view.getUint8(u+38)),o.offset=p.view.getUint32(u+42,!0),l=ce(p.array.subarray(u+46,u+46+o.filenameLength)),o.filename=2048==(2048&o.bitFlag)?le(l):ae(l),o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),c=ce(p.array.subarray(u+46+o.filenameLength+o.extraFieldLength,u+46+o.filenameLength+o.extraFieldLength+o.commentLength)),o.comment=2048==(2048&o.bitFlag)?le(c):ae(c),h.push(o),u+=46+o.filenameLength+o.extraFieldLength+o.commentLength}t(h)}),(function(){r("Error while reading zip file.")}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};me.useWebWorkers?fe("inflater",(function(e){i._worker=e,t(i)}),(function(e){r(e)})):t(i)}(e,t,r)}),r=r||ge)},createWriter:function(e,t,r,n){n=!!n,e.init((function(){!function(e,t,r,n){var s={},i=[],o=0,a=0;function l(e){r(e||"Error while writing zip file.")}function c(e){r(e||"Error while reading file data.")}var u={add:function(t,u,h,p,d){var f,g,m,A=this._worker;function v(t,r){var n=Z(16);o+=t||0,n.view.setUint32(0,1347094280),void 0!==r&&(f.view.setUint32(10,r,!0),n.view.setUint32(4,r,!0)),u&&(n.view.setUint32(8,t,!0),f.view.setUint32(14,t,!0),n.view.setUint32(12,u.size,!0),f.view.setUint32(18,u.size,!0)),e.writeUint8Array(n.array,(function(){o+=16,h()}),l)}function B(){var h;d=d||{},t=t.trim(),d.directory&&"/"!=t.charAt(t.length-1)&&(t+="/"),s.hasOwnProperty(t)?r("File already exists."):(g=pe(he(t)),i.push(t),m=d.lastModDate||new Date,f=Z(26),s[t]={headerArray:f.array,directory:d.directory,filename:g,offset:o,comment:pe(he(d.comment||""))},f.view.setUint32(0,335546376),d.version&&f.view.setUint8(0,d.version),n||0===d.level||d.directory||f.view.setUint16(4,2048),f.view.setUint16(6,(m.getHours()<<6|m.getMinutes())<<5|m.getSeconds()/2,!0),f.view.setUint16(8,(m.getFullYear()-1980<<4|m.getMonth()+1)<<5|m.getDate(),!0),f.view.setUint16(22,g.length,!0),(h=Z(30+g.length)).view.setUint32(0,1347093252),h.array.set(f.array,4),h.array.set(g,30),o+=h.array.length,e.writeUint8Array(h.array,(function(){var t,r,s,i,o,h,f,g,m,B;u?n||0===d.level?oe(A,a++,u,e,0,u.size,!0,v,p,c,l):(t=A,r=a++,s=u,i=e,o=d.level,h=v,f=p,g=c,m=l,B="input",me.useWebWorkers?se(t,{sn:r,options:{level:o},codecClass:"_zipjs_Deflater",crcType:B},s,i,0,s.size,f,h,g,m):ie(new R,s,i,0,s.size,B,f,h,g,m)):v()}),l))}u?u.init(B,c):B()},close:function(t){this._worker&&(this._worker.terminate(),this._worker=null);var r,n,a,c=0,u=0;for(n=0;n<i.length;n++)c+=46+(a=s[i[n]]).filename.length+a.comment.length;for(r=Z(c+22),n=0;n<i.length;n++)a=s[i[n]],r.view.setUint32(u,1347092738),r.view.setUint16(u+4,5120),r.array.set(a.headerArray,u+6),r.view.setUint16(u+32,a.comment.length,!0),a.directory&&r.view.setUint8(u+38,16),r.view.setUint32(u+42,a.offset,!0),r.array.set(a.filename,u+46),r.array.set(a.comment,u+46+a.filename.length),u+=46+a.filename.length+a.comment.length;r.view.setUint32(u,1347093766),r.view.setUint16(u+8,i.length,!0),r.view.setUint16(u+10,i.length,!0),r.view.setUint32(u+12,c,!0),r.view.setUint32(u+16,o,!0),e.writeUint8Array(r.array,(function(){e.getData(t)}),l)},_worker:null};me.useWebWorkers?fe("deflater",(function(e){u._worker=e,t(u)}),(function(e){r(e)})):t(u)}(e,t,r,n)}),r=r||ge)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null};var Ae,ve,Be=me.TextWriter,_e=me.BlobWriter,Ce=me.Data64URIWriter,be=me.TextReader,we=me.BlobReader,Ee=me.Data64URIReader,xe=me.createReader,ye=me.createWriter;function De(e){var t,r=this;r.size=0,r.init=function(t){r.size=e.uncompressedSize,t()},r.readUint8Array=function(n,s,i,o){var a;a=function(){t.readUint8Array(n,s,i,o)},r.data?a():e.getData(new _e,(function(e){r.data=e,t=new we(e),a()}),null,r.checkCrc32)}}function Te(e){var t=0;return function e(r){t+=r.uncompressedSize||0,r.children.forEach(e)}(e),t}function Ie(e,t,r){var n=0;function s(){++n<e.children.length?i(e.children[n]):t()}function i(e){e.directory?Ie(e,s,r):(e.reader=new e.Reader(e.data,r),e.reader.init((function(){e.uncompressedSize=e.reader.size,s()})))}e.children.length?i(e.children[n]):t()}function Re(e){var t=e.parent.children;t.forEach((function(r,n){r.id==e.id&&t.splice(n,1)}))}function Fe(e){e.entries=[],e.root=new Le(e)}function Me(e,t,r,n){if(e.directory)return n?new Le(e.fs,t,r,e):new Se(e.fs,t,r,e);throw"Parent entry is not a directory."}function Pe(){}function Se(e,t,r,n){var s=this;Pe.prototype.init.call(s,e,t,r,n),s.Reader=r.Reader,s.Writer=r.Writer,s.data=r.data,r.getData&&(s.getData=r.getData)}function Le(e,t,r,n){Pe.prototype.init.call(this,e,t,r,n),this.directory=!0}function Oe(){Fe(this)}(De.prototype=new me.Reader).constructor=De,De.prototype.checkCrc32=!1,(Pe.prototype={init:function(e,t,r,n){var s=this;if(e.root&&n&&n.getChildByName(t))throw"Entry filename already exists.";r||(r={}),s.fs=e,s.name=t,s.id=e.entries.length,s.parent=n,s.children=[],s.zipVersion=r.zipVersion||20,s.uncompressedSize=0,e.entries.push(s),n&&s.parent.children.push(s)},getFileEntry:function(e,t,r,n,s){var i=this;Ie(i,(function(){var o,a,l,c,u,h,p,d;o=e,a=i,l=t,c=r,u=n,h=Te(i),p=s,d=0,a.directory?function e(t,r,n,s,i,o){var a=0;!function l(){var c=r.children[a];c?function(r){function n(t){d+=r.uncompressedSize||0,e(t,r,(function(){a++,l()}),s,i,o)}r.directory?t.getDirectory(r.name,{create:!0},n,i):t.getFile(r.name,{create:!0},(function(e){r.getData(new me.FileWriter(e,me.getMimeType(r.name)),n,(function(e){s&&s(d+e,o)}),p)}),i)}(c):n()}()}(o,a,l,c,u,h):a.getData(new me.FileWriter(o,me.getMimeType(a.name)),l,c,p)}),n)},moveTo:function(e){var t=this;if(!e.directory)throw"Target entry is not a directory.";if(e.isDescendantOf(t))throw"Entry is a ancestor of target entry.";if(t!=e){if(e.getChildByName(t.name))throw"Entry filename already exists.";Re(t),t.parent=e,e.children.push(t)}},getFullname:function(){for(var e=this.name,t=this.parent;t;)e=(t.name?t.name+"/":"")+e,t=t.parent;return e},isDescendantOf:function(e){for(var t=this.parent;t&&t.id!=e.id;)t=t.parent;return!!t}}).constructor=Pe,Se.prototype=Ae=new Pe,Ae.constructor=Se,Ae.getData=function(e,t,r,n){var s=this;!e||e.constructor==s.Writer&&s.data?t(s.data):(s.reader||(s.reader=new s.Reader(s.data,n)),s.reader.init((function(){e.init((function(){var i,o,a,l,c,u;i=s.reader,o=e,a=t,l=r,c=n,u=0,function e(){var t=524288*u;l&&l(t,i.size),t<i.size?i.readUint8Array(t,Math.min(524288,i.size-t),(function(t){o.writeUint8Array(new Uint8Array(t),(function(){u++,e()}))}),c):o.getData(a)}()}),n)})))},Ae.getText=function(e,t,r,n){this.getData(new Be(n),e,t,r)},Ae.getBlob=function(e,t,r,n){this.getData(new _e(e),t,r,n)},Ae.getData64URI=function(e,t,r,n){this.getData(new Ce(e),t,r,n)},Le.prototype=ve=new Pe,ve.constructor=Le,ve.addDirectory=function(e){return Me(this,e,null,!0)},ve.addText=function(e,t){return Me(this,e,{data:t,Reader:be,Writer:Be})},ve.addBlob=function(e,t){return Me(this,e,{data:t,Reader:we,Writer:_e})},ve.addData64URI=function(e,t){return Me(this,e,{data:t,Reader:Ee,Writer:Ce})},ve.addFileEntry=function(e,t,r){var n,s,i,o;n=this,i=t,o=r,(s=e).isDirectory?function e(t,r,n){var s,i;i=function(r){var s=0;!function i(){var a=r[s];a?function(r){function n(t){e(t,r,(function(){s++,i()}))}r.isDirectory&&n(t.addDirectory(r.name)),r.isFile&&r.file((function(e){var s=t.addBlob(r.name,e);s.uncompressedSize=e.size,n(s)}),o)}(a):n()}()},(s=r).isDirectory&&s.createReader().readEntries(i),s.isFile&&i([])}(n,s,i):s.file((function(e){n.addBlob(s.name,e),i()}),o)},ve.addData=function(e,t){return Me(this,e,t)},ve.importBlob=function(e,t,r){this.importZip(new we(e),t,r)},ve.importText=function(e,t,r){this.importZip(new be(e),t,r)},ve.importData64URI=function(e,t,r){this.importZip(new Ee(e),t,r)},ve.exportBlob=function(e,t,r){this.exportZip(new _e("application/zip"),e,t,r)},ve.exportText=function(e,t,r){this.exportZip(new Be,e,t,r)},ve.exportFileEntry=function(e,t,r,n){this.exportZip(new me.FileWriter(e,"application/zip"),t,r,n)},ve.exportData64URI=function(e,t,r){this.exportZip(new Ce("application/zip"),e,t,r)},ve.importZip=function(e,t,r){var n=this;xe(e,(function(e){e.getEntries((function(e){e.forEach((function(e){var t=n,r=e.filename.split("/"),s=r.pop();r.forEach((function(e){t=t.getChildByName(e)||new Le(n.fs,e,null,t)})),e.directory||Me(t,s,{data:e,Reader:De})})),t()}))}),r)},ve.exportZip=function(e,t,r,n){var s=this;Ie(s,(function(){ye(e,(function(e){var n,i,o,a,l;n=e,i=s,o=r,a=Te(s),l=0,function e(t,r,n,s,i){var o=0;!function a(){var c=r.children[o];c?t.add(c.getFullname(),c.reader,(function(){l+=c.uncompressedSize||0,e(t,c,(function(){o++,a()}),s,i)}),(function(e){s&&s(l+e,i)}),{directory:c.directory,version:c.zipVersion}):n()}()}(n,i,(function(){e.close(t)}),o,a)}),n)}),n)},ve.getChildByName=function(e){var t,r;for(t=0;t<this.children.length;t++)if((r=this.children[t]).name==e)return r},Oe.prototype={remove:function(e){Re(e),this.entries[e.id]=null},find:function(e){var t,r=e.split("/"),n=this.root;for(t=0;n&&t<r.length;t++)n=n.getChildByName(r[t]);return n},getById:function(e){return this.entries[e]},importBlob:function(e,t,r){Fe(this),this.root.importBlob(e,t,r)},importText:function(e,t,r){Fe(this),this.root.importText(e,t,r)},importData64URI:function(e,t,r){Fe(this),this.root.importData64URI(e,t,r)},exportBlob:function(e,t,r){this.root.exportBlob(e,t,r)},exportText:function(e,t,r){this.root.exportText(e,t,r)},exportFileEntry:function(e,t,r,n){this.root.exportFileEntry(e,t,r,n)},exportData64URI:function(e,t,r){this.root.exportData64URI(e,t,r)}},me.getMimeType=function(){return"application/octet-stream"};var Ne={FS:Oe,ZipDirectoryEntry:Le,ZipFileEntry:Se};me.useWebWorkers=!1;var ke=function(){function e(e,t){this.el=e,this.inputEl=t,this.listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e.addEventListener("dragover",this._onDragover,!1),e.addEventListener("drop",this._onDrop,!1),t.addEventListener("change",this._onSelect)}var t=e.prototype;return t.on=function(e,t){return this.listeners[e].push(t),this},t._emit=function(e,t){return this.listeners[e].forEach((function(e){return e(t)})),this},t.destroy=function(){var e=this.el,t=this.inputEl;e.removeEventListener("dragover",this._onDragover,!1),e.removeEventListener("drop",this._onDrop,!1),t.removeEventListener("change",this._onSelect),delete this.el,delete this.inputEl,delete this.listeners},t._onDrop=function(e){e.stopPropagation(),e.preventDefault(),this._emit("dropstart");var t=Array.from(e.dataTransfer.files||[]),r=Array.from(e.dataTransfer.items||[]);if(0!==t.length||0!==r.length)if(r.length>0){var n=r.map((function(e){return e.webkitGetAsEntry()}));n[0].name.match(/\.zip$/)?this._loadZip(r[0].getAsFile()):this._loadNextEntry(new Map,n)}else 1===t.length&&t[0].name.match(/\.zip$/)&&this._loadZip(t[0]),this._emit("drop",{files:new Map(t.map((function(e){return[e.name,e]})))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")},t._onDragover=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},t._onSelect=function(e){this._emit("dropstart");var t=[].slice.call(this.inputEl.files);if(1===t.length&&this._isZip(t[0]))this._loadZip(t[0]);else{var r=new Map;t.forEach((function(e){return r.set(e.webkitRelativePath||e.name,e)})),this._emit("drop",{files:r})}},t._loadNextEntry=function(e,t){var r=this,n=t.pop();if(n)if(n.isFile)n.file((function(s){e.set(n.fullPath,s),r._loadNextEntry(e,t)}),(function(){return console.error("Could not load file: %s",n.fullPath)}));else if(n.isDirectory){var s=n.createReader();s.readEntries((function n(i){i.length?(t=t.concat(i),s.readEntries(n)):r._loadNextEntry(e,t)}))}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})},t._loadZip=function(e){var t=this,r=[],n=new Map,s=new Ne.FS,i=function e(t){t.directory?t.children.forEach(e):"."!==t.name[0]&&r.push(new Promise((function(e){t.getData(new me.BlobWriter,(function(r){r.name=t.name,n.set(t.getFullname(),r),e()}))})))};s.importBlob(e,(function(){i(s.root),Promise.all(r).then((function(){t._emit("drop",{files:n,archive:e})}))}))},t._isZip=function(e){return"application/zip"===e.type||e.name.match(/\.zip$/)},t._fail=function(e){this._emit("droperror",{message:e})},e}(),He=n("ilwiq");class Ge{isRendering=!1;dirty=!1;set exposure(e){this.renderer.toneMappingExposure=e,this.setBackground()}get exposure(){return this.renderer.toneMappingExposure}tonemappingModes=new Map([["None",He.LinearToneMapping],["Reinhard",He.ReinhardToneMapping],["Cineon",He.CineonToneMapping],["AcesFilm",He.ACESFilmicToneMapping]]);set tonemapping(e){this.tonemappingModes.has(e)&&(this.renderer.toneMapping=this.tonemappingModes.get(e),this.dirty=!0)}_backgroundColor=[0,0,0];get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.setBackground()}_showBackground=!0;get showBackground(){return this._showBackground}set showBackground(e){this._showBackground=e,this.setBackground()}setBackground(){this.scene&&(this._showBackground?this.scene.background=this.ibl:this.scene.background=new He.Color(this._backgroundColor[0]*this.renderer.toneMappingExposure,this._backgroundColor[1]*this.renderer.toneMappingExposure,this._backgroundColor[2]*this.renderer.toneMappingExposure))}useIBL(e){this.scene&&(e?(this.scene.environment=this.ibl,this.showBackground=!0):(this.scene.environment=null,this.showBackground=!1))}setPixelRatio(e){this.renderer.setPixelRatio(e)}constructor(e){this.renderer=new He.WebGLRenderer(e),this.renderer.toneMapping=He.LinearToneMapping,this.renderer.outputEncoding=He.sRGBEncoding,this.renderer.physicallyCorrectLights=!0,this.pmremGenerator=new He.PMREMGenerator(this.renderer),this.pmremGenerator.compileEquirectangularShader()}stopRendering(){this.isRendering=!1}render(e,t){if(e instanceof He.Camera==!1)return void console.error("PathtracingRenderer.render: camera is not an instance of THREE.Camera.");this.isRendering=!0;let r=()=>{this.isRendering&&(this.dirty&&(this.renderer.compile(this.scene,e),this.dirty=!1),this.renderer.render(this.scene,e),t&&t(),requestAnimationFrame(r))};requestAnimationFrame(r)}resize(e,t){this.renderer.setSize(e,t)}updateSceneIbl(){this.scene&&this.ibl&&(this.scene.background=this.ibl,this.scene.environment=this.ibl)}setIBL(e){void 0!==this.ibl&&this.ibl.dispose(),this.ibl=this.pmremGenerator.fromEquirectangular(e).texture,this.updateSceneIbl()}setScene(e){this.scene=e,this.updateSceneIbl()}}var Ke=n("b69kM"),Ve=(He=n("ilwiq"),n("891vQ")),Ue=n("5Rd1x"),je=(He=n("ilwiq"),n("7lx9d"));He=n("ilwiq");class Je{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const r=this.workersResolve[e];if(r&&r(t),this.queue.length){const{resolve:t,msg:r,transfer:n}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,n)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((r=>{const n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=r,this.workers[n].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const We=new WeakMap;let Xe=0;class ze extends He.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Je,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new He.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new He.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const n=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then((([e,t])=>{const r=ze.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(ze.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ze.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ze.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Xe>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Xe++}return this.transcoderPending}load(e,t,r,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new He.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=new He.CompressedTexture;return s.load(e,(e=>{if(We.has(e)){return We.get(e).promise.then(t).catch(n)}this._createTexture([e]).then((function(e){i.copy(e),i.needsUpdate=!0,t&&t(i)})).catch(n)}),r,n),i}_createTextureFrom(e){const{mipmaps:t,width:r,height:n,format:s,type:i,error:o,dfdTransferFn:a,dfdFlags:l}=e;if("error"===i)return Promise.reject(o);const c=new He.CompressedTexture(t,r,n,s,He.UnsignedByteType);return c.minFilter=1===t.length?He.LinearFilter:He.LinearMipmapLinearFilter,c.magFilter=He.LinearFilter,c.generateMipmaps=!1,c.needsUpdate=!0,c.encoding=2===a?He.sRGBEncoding:He.LinearEncoding,c.premultiplyAlpha=!!(1&l),c}_createTexture(e,t={}){const r=t,n=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:r},e))).then((e=>this._createTextureFrom(e.data)));return We.set(e[0],{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Xe--,this}}ze.BasisFormat={ETC1S:0,UASTC_4x4:1},ze.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},ze.EngineFormat={RGBAFormat:He.RGBAFormat,RGBA_ASTC_4x4_Format:He.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:He.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:He.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:He.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:He.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:He.RGB_ETC1_Format,RGB_ETC2_Format:He.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:He.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:He.RGB_S3TC_DXT1_Format},ze.BasisWorker=function(){let e,t,r;const n=_EngineFormat,s=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",(function(o){const u=o.data;switch(u.type){case"init":e=u.config,h=u.transcoderBinary,t=new Promise((e=>{r={wasmBinary:h,onRuntimeInitialized:e},BASIS(r)})).then((()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{width:t,height:o,hasAlpha:h,mipmaps:p,format:d,dfdTransferFn:f,dfdFlags:g}=function(t){const o=new r.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const h=o.isUASTC()?i.UASTC_4x4:i.ETC1S,p=o.getWidth(),d=o.getHeight(),f=o.getLevels(),g=o.getHasAlpha(),m=o.getDFDTransferFunc(),A=o.getDFDFlags(),{transcoderFormat:v,engineFormat:B}=function(t,r,o,u){let h,p;const d=t===i.ETC1S?a:l;for(let n=0;n<d.length;n++){const s=d[n];if(e[s.if]&&(s.basisFormat.includes(t)&&!(u&&s.transcoderFormat.length<2)&&(!s.needsPowerOfTwo||c(r)&&c(o))))return h=s.transcoderFormat[u?1:0],p=s.engineFormat[u?1:0],{transcoderFormat:h,engineFormat:p}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),h=s.RGBA32,p=n.RGBAFormat,{transcoderFormat:h,engineFormat:p}}(h,p,d,g);if(!p||!d||!f)throw u(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw u(),new Error("THREE.KTX2Loader: .startTranscoding failed");const _=[];for(let e=0;e<f;e++){const t=o.getImageLevelInfo(e,0,0),r=t.origWidth,n=t.origHeight,s=new Uint8Array(o.getImageTranscodedSizeInBytes(e,0,0,v));if(!o.transcodeImage(s,e,0,0,v,0,-1,-1))throw u(),new Error("THREE.KTX2Loader: .transcodeImage failed.");_.push({data:s,width:r,height:n})}return u(),{width:p,height:d,hasAlpha:g,mipmaps:_,format:B,dfdTransferFn:m,dfdFlags:A}}(u.buffers[0]),m=[];for(let e=0;e<p.length;++e)m.push(p[e].data.buffer);self.postMessage({type:"transcode",id:u.id,width:t,height:o,hasAlpha:h,mipmaps:p,format:d,dfdTransferFn:f,dfdFlags:g},m)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}}))}var h}));const o=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),l=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(e){return e<=2||0==(e&e-1)&&0!==e}};class Ze{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,n=r.length;t<n;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class qe extends Ze{constructor(e,t,r,n={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=n,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Ye extends Ze{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter((e=>t(e.getParent())))),r.forEach((e=>e.dispose())),this}createEdge(e,t,r,n){return this._registerEdge(new qe(e,t,r,n))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Qe(){return Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Qe.apply(this,arguments)}function $e(e){return e instanceof qe}function et(e){return Array.isArray(e)&&e[0]instanceof qe}function tt(e){return!!(e&&"object"==typeof e&&Object.values(e)[0]instanceof qe)}const rt=Symbol("attributes"),nt=Symbol("immutableKeys");class st extends Ze{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[rt]=void 0,this[nt]=void 0,this.graph=e,this[nt]=new Set,this[rt]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const n=e[r];if(n instanceof st){const e=this.graph.createEdge(r,this,n);e.addEventListener("dispose",(()=>n.dispose())),this[nt].add(r),t[r]=e}else t[r]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[rt]){const n=this[rt][r];if($e(n)){const s=n;s.getChild()===e&&this.setRef(r,t,s.getAttributes())}else if(et(n)){const s=n.find((t=>t.getChild()===e));if(s){const n=s.getAttributes();this.removeRef(r,e).addRef(r,t,n)}}else if(tt(n)){const s=n;for(const n in s){const i=s[n];i.getChild()===e&&this.setRefMap(r,n,t,i.getAttributes())}}}return this}get(e){return this[rt][e]}set(e,t){return this[rt][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[rt][e];return t?t.getChild():null}setRef(e,t,r){if(this[nt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[rt][e];if(n&&n.dispose(),!t)return this;const s=this.graph.createEdge(e,this,t,r);return s.addEventListener("dispose",(()=>{delete this[rt][e],this.dispatchEvent({type:"change",attribute:e})})),this[rt][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[rt][e].map((e=>e.getChild()))}addRef(e,t,r){const n=this.graph.createEdge(e,this,t,r),s=this[rt][e];return s.push(n),n.addEventListener("dispose",(()=>{const t=s.filter((e=>e!==n));s.length=0;for(const e of t)s.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[rt][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[rt][e])}listRefMapValues(e){return Object.values(this[rt][e]).map((e=>e.getChild()))}getRefMap(e,t){const r=this[rt][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,n){const s=this[rt][e],i=s[t];if(i&&i.dispose(),!r)return this;n=Object.assign(n||{},{key:t});const o=this.graph.createEdge(e,this,r,Qe({},n,{key:t}));return o.addEventListener("dispose",(()=>{delete s[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),s[t]=o,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(Qe({},e,{target:this})),this.graph.dispatchEvent(Qe({},e,{target:this,type:`node:${e.type}`})),this}}var it="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function ot(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function at(e,t,r){var n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var lt,ct;lt=new it(3),it!=Float32Array&&(lt[0]=0,lt[1]=0,lt[2]=0),ct=lt;function ut(e,t,r){var n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=t[9],d=t[10],f=t[11],g=t[12],m=t[13],A=t[14],v=t[15],B=r[0],_=r[1],C=r[2],b=r[3];return e[0]=B*n+_*a+C*h+b*g,e[1]=B*s+_*l+C*p+b*m,e[2]=B*i+_*c+C*d+b*A,e[3]=B*o+_*u+C*f+b*v,B=r[4],_=r[5],C=r[6],b=r[7],e[4]=B*n+_*a+C*h+b*g,e[5]=B*s+_*l+C*p+b*m,e[6]=B*i+_*c+C*d+b*A,e[7]=B*o+_*u+C*f+b*v,B=r[8],_=r[9],C=r[10],b=r[11],e[8]=B*n+_*a+C*h+b*g,e[9]=B*s+_*l+C*p+b*m,e[10]=B*i+_*c+C*d+b*A,e[11]=B*o+_*u+C*f+b*v,B=r[12],_=r[13],C=r[14],b=r[15],e[12]=B*n+_*a+C*h+b*g,e[13]=B*s+_*l+C*p+b*m,e[14]=B*i+_*c+C*d+b*A,e[15]=B*o+_*u+C*f+b*v,e}function ht(e,t){var r=new it(3);!function(e,t){var r=t[0],n=t[1],s=t[2],i=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];e[0]=Math.hypot(r,n,s),e[1]=Math.hypot(i,o,a),e[2]=Math.hypot(l,c,u)}(r,t);var n=1/r[0],s=1/r[1],i=1/r[2],o=t[0]*n,a=t[1]*s,l=t[2]*i,c=t[4]*n,u=t[5]*s,h=t[6]*i,p=t[8]*n,d=t[9]*s,f=t[10]*i,g=o+u+f,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(h-d)/m,e[1]=(p-l)/m,e[2]=(a-c)/m):o>u&&o>f?(m=2*Math.sqrt(1+o-u-f),e[3]=(h-d)/m,e[0]=.25*m,e[1]=(a+c)/m,e[2]=(p+l)/m):u>f?(m=2*Math.sqrt(1+u-o-f),e[3]=(p-l)/m,e[0]=(a+c)/m,e[1]=.25*m,e[2]=(h+d)/m):(m=2*Math.sqrt(1+f-o-u),e[3]=(a-c)/m,e[0]=(p+l)/m,e[1]=(h+d)/m,e[2]=.25*m),e}var pt,dt,ft;dt=function(e){var t,r,n=wt(e),s=n[0],i=n[1],o=new Bt(function(e,t,r){return 3*(t+r)/4-r}(0,s,i)),a=0,l=i>0?s-4:s;for(r=0;r<l;r+=4)t=vt[e.charCodeAt(r)]<<18|vt[e.charCodeAt(r+1)]<<12|vt[e.charCodeAt(r+2)]<<6|vt[e.charCodeAt(r+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;2===i&&(t=vt[e.charCodeAt(r)]<<2|vt[e.charCodeAt(r+1)]>>4,o[a++]=255&t);1===i&&(t=vt[e.charCodeAt(r)]<<10|vt[e.charCodeAt(r+1)]<<4|vt[e.charCodeAt(r+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t);return o},ft=function(e){for(var t,r=e.length,n=r%3,s=[],i=16383,o=0,a=r-n;o<a;o+=i)s.push(Et(e,o,o+i>a?a:o+i));1===n?(t=e[r-1],s.push(At[t>>2]+At[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],s.push(At[t>>10]+At[t>>4&63]+At[t<<2&63]+"="));return s.join("")}
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */;for(var gt,mt,At=[],vt=[],Bt="undefined"!=typeof Uint8Array?Uint8Array:Array,_t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ct=0,bt=_t.length;Ct<bt;++Ct)At[Ct]=_t[Ct],vt[_t.charCodeAt(Ct)]=Ct;function wt(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function Et(e,t,r){for(var n,s,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(At[(s=n)>>18&63]+At[s>>12&63]+At[s>>6&63]+At[63&s]);return i.join("")}vt["-".charCodeAt(0)]=62,vt["_".charCodeAt(0)]=63,gt=function(e,t,r,n,s){var i,o,a=8*s-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=r?s-1:0,p=r?-1:1,d=e[t+h];for(h+=p,i=d&(1<<-u)-1,d>>=-u,u+=a;u>0;i=256*i+e[t+h],h+=p,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=p,u-=8);if(0===i)i=1-c;else{if(i===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),i-=c}return(d?-1:1)*o*Math.pow(2,i-n)},mt=function(e,t,r,n,s,i){var o,a,l,c=8*i-s-1,u=(1<<c)-1,h=u>>1,p=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:i-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*l-1)*Math.pow(2,s),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,s),o=0));s>=8;e[r+d]=255&a,d+=f,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;e[r+d]=255&o,d+=f,o/=256,c-=8);e[r+d-f]|=128*g};const xt="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;pt=Dt;function yt(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,Dt.prototype),t}function Dt(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return Rt(e)}return Tt(e,t,r)}function Tt(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!Dt.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|St(e,t);let n=yt(r);const s=n.write(e,t);s!==r&&(n=n.slice(0,s));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(dr(e,Uint8Array)){const t=new Uint8Array(e);return Mt(t.buffer,t.byteOffset,t.byteLength)}return Ft(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(dr(e,ArrayBuffer)||e&&dr(e.buffer,ArrayBuffer))return Mt(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(dr(e,SharedArrayBuffer)||e&&dr(e.buffer,SharedArrayBuffer)))return Mt(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Dt.from(n,t,r);const s=function(e){if(Dt.isBuffer(e)){const t=0|Pt(e.length),r=yt(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||fr(e.length)?yt(0):Ft(e);if("Buffer"===e.type&&Array.isArray(e.data))return Ft(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Dt.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function It(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function Rt(e){return It(e),yt(e<0?0:0|Pt(e))}function Ft(e){const t=e.length<0?0:0|Pt(e.length),r=yt(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function Mt(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,Dt.prototype),n}function Pt(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function St(e,t){if(Dt.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||dr(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return ur(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return hr(e).length;default:if(s)return n?-1:ur(e).length;t=(""+t).toLowerCase(),s=!0}}function Lt(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return zt(this,t,r);case"utf8":case"utf-8":return Jt(this,t,r);case"ascii":return Wt(this,t,r);case"latin1":case"binary":return Xt(this,t,r);case"base64":return jt(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zt(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function Ot(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function Nt(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),fr(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=Dt.from(t,n)),Dt.isBuffer(t))return 0===t.length?-1:kt(e,t,r,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):kt(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function kt(e,t,r,n,s){let i,o=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){let n=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===l)return n*o}else-1!==n&&(i-=i-n),n=-1}else for(r+l>a&&(r=a-l),i=r;i>=0;i--){let r=!0;for(let n=0;n<l;n++)if(c(e,i+n)!==c(t,n)){r=!1;break}if(r)return i}return-1}function Ht(e,t,r,n){r=Number(r)||0;const s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;const i=t.length;let o;for(n>i/2&&(n=i/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(fr(n))return o;e[r+o]=n}return o}function Gt(e,t,r,n){return pr(ur(t,e.length-r),e,r,n)}function Kt(e,t,r,n){return pr(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function Vt(e,t,r,n){return pr(hr(t),e,r,n)}function Ut(e,t,r,n){return pr(function(e,t){let r,n,s;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function jt(e,t,r){return 0===t&&r===e.length?ft(e):ft(e.slice(t,r))}function Jt(e,t,r){r=Math.min(e.length,r);const n=[];let s=t;for(;s<r;){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=r){let r,n,a,l;switch(o){case 1:t<128&&(i=t);break;case 2:r=e[s+1],128==(192&r)&&(l=(31&t)<<6|63&r,l>127&&(i=l));break;case 3:r=e[s+1],n=e[s+2],128==(192&r)&&128==(192&n)&&(l=(15&t)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:r=e[s+1],n=e[s+2],a=e[s+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,l>65535&&l<1114112&&(i=l))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),s+=o}return function(e){const t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}Dt.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),Dt.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Dt.prototype,"parent",{enumerable:!0,get:function(){if(Dt.isBuffer(this))return this.buffer}}),Object.defineProperty(Dt.prototype,"offset",{enumerable:!0,get:function(){if(Dt.isBuffer(this))return this.byteOffset}}),Dt.poolSize=8192,Dt.from=function(e,t,r){return Tt(e,t,r)},Object.setPrototypeOf(Dt.prototype,Uint8Array.prototype),Object.setPrototypeOf(Dt,Uint8Array),Dt.alloc=function(e,t,r){return function(e,t,r){return It(e),e<=0?yt(e):void 0!==t?"string"==typeof r?yt(e).fill(t,r):yt(e).fill(t):yt(e)}(e,t,r)},Dt.allocUnsafe=function(e){return Rt(e)},Dt.allocUnsafeSlow=function(e){return Rt(e)},Dt.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Dt.prototype},Dt.compare=function(e,t){if(dr(e,Uint8Array)&&(e=Dt.from(e,e.offset,e.byteLength)),dr(t,Uint8Array)&&(t=Dt.from(t,t.offset,t.byteLength)),!Dt.isBuffer(e)||!Dt.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},Dt.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Dt.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Dt.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=Dt.allocUnsafe(t);let s=0;for(r=0;r<e.length;++r){let t=e[r];if(dr(t,Uint8Array))s+t.length>n.length?(Dt.isBuffer(t)||(t=Dt.from(t)),t.copy(n,s)):Uint8Array.prototype.set.call(n,t,s);else{if(!Dt.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,s)}s+=t.length}return n},Dt.byteLength=St,Dt.prototype._isBuffer=!0,Dt.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)Ot(this,t,t+1);return this},Dt.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)Ot(this,t,t+3),Ot(this,t+1,t+2);return this},Dt.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)Ot(this,t,t+7),Ot(this,t+1,t+6),Ot(this,t+2,t+5),Ot(this,t+3,t+4);return this},Dt.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?Jt(this,0,e):Lt.apply(this,arguments)},Dt.prototype.toLocaleString=Dt.prototype.toString,Dt.prototype.equals=function(e){if(!Dt.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Dt.compare(this,e)},Dt.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},xt&&(Dt.prototype[xt]=Dt.prototype.inspect),Dt.prototype.compare=function(e,t,r,n,s){if(dr(e,Uint8Array)&&(e=Dt.from(e,e.offset,e.byteLength)),!Dt.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;let i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(i,o),l=this.slice(n,s),c=e.slice(t,r);for(let e=0;e<a;++e)if(l[e]!==c[e]){i=l[e],o=c[e];break}return i<o?-1:o<i?1:0},Dt.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Dt.prototype.indexOf=function(e,t,r){return Nt(this,e,t,r,!0)},Dt.prototype.lastIndexOf=function(e,t,r){return Nt(this,e,t,r,!1)},Dt.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return Ht(this,e,t,r);case"utf8":case"utf-8":return Gt(this,e,t,r);case"ascii":case"latin1":case"binary":return Kt(this,e,t,r);case"base64":return Vt(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ut(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Dt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Wt(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function Xt(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function zt(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let s="";for(let n=t;n<r;++n)s+=gr[e[n]];return s}function Zt(e,t,r){const n=e.slice(t,r);let s="";for(let e=0;e<n.length-1;e+=2)s+=String.fromCharCode(n[e]+256*n[e+1]);return s}function qt(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Yt(e,t,r,n,s,i){if(!Dt.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Qt(e,t,r,n,s){or(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function $t(e,t,r,n,s){or(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r+7]=i,i>>=8,e[r+6]=i,i>>=8,e[r+5]=i,i>>=8,e[r+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function er(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function tr(e,t,r,n,s){return t=+t,r>>>=0,s||er(e,0,r,4),mt(e,t,r,n,23,4),r+4}function rr(e,t,r,n,s){return t=+t,r>>>=0,s||er(e,0,r,8),mt(e,t,r,n,52,8),r+8}Dt.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,Dt.prototype),n},Dt.prototype.readUintLE=Dt.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||qt(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return n},Dt.prototype.readUintBE=Dt.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||qt(e,t,this.length);let n=this[e+--t],s=1;for(;t>0&&(s*=256);)n+=this[e+--t]*s;return n},Dt.prototype.readUint8=Dt.prototype.readUInt8=function(e,t){return e>>>=0,t||qt(e,1,this.length),this[e]},Dt.prototype.readUint16LE=Dt.prototype.readUInt16LE=function(e,t){return e>>>=0,t||qt(e,2,this.length),this[e]|this[e+1]<<8},Dt.prototype.readUint16BE=Dt.prototype.readUInt16BE=function(e,t){return e>>>=0,t||qt(e,2,this.length),this[e]<<8|this[e+1]},Dt.prototype.readUint32LE=Dt.prototype.readUInt32LE=function(e,t){return e>>>=0,t||qt(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Dt.prototype.readUint32BE=Dt.prototype.readUInt32BE=function(e,t){return e>>>=0,t||qt(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Dt.prototype.readBigUInt64LE=mr((function(e){ar(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||lr(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(s)<<BigInt(32))})),Dt.prototype.readBigUInt64BE=mr((function(e){ar(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||lr(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(s)})),Dt.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||qt(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*t)),n},Dt.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||qt(e,t,this.length);let n=t,s=1,i=this[e+--n];for(;n>0&&(s*=256);)i+=this[e+--n]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i},Dt.prototype.readInt8=function(e,t){return e>>>=0,t||qt(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Dt.prototype.readInt16LE=function(e,t){e>>>=0,t||qt(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Dt.prototype.readInt16BE=function(e,t){e>>>=0,t||qt(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Dt.prototype.readInt32LE=function(e,t){return e>>>=0,t||qt(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Dt.prototype.readInt32BE=function(e,t){return e>>>=0,t||qt(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Dt.prototype.readBigInt64LE=mr((function(e){ar(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||lr(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),Dt.prototype.readBigInt64BE=mr((function(e){ar(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||lr(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),Dt.prototype.readFloatLE=function(e,t){return e>>>=0,t||qt(e,4,this.length),gt(this,e,!0,23,4)},Dt.prototype.readFloatBE=function(e,t){return e>>>=0,t||qt(e,4,this.length),gt(this,e,!1,23,4)},Dt.prototype.readDoubleLE=function(e,t){return e>>>=0,t||qt(e,8,this.length),gt(this,e,!0,52,8)},Dt.prototype.readDoubleBE=function(e,t){return e>>>=0,t||qt(e,8,this.length),gt(this,e,!1,52,8)},Dt.prototype.writeUintLE=Dt.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){Yt(this,e,t,r,Math.pow(2,8*r)-1,0)}let s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},Dt.prototype.writeUintBE=Dt.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){Yt(this,e,t,r,Math.pow(2,8*r)-1,0)}let s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},Dt.prototype.writeUint8=Dt.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,1,255,0),this[t]=255&e,t+1},Dt.prototype.writeUint16LE=Dt.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Dt.prototype.writeUint16BE=Dt.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Dt.prototype.writeUint32LE=Dt.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Dt.prototype.writeUint32BE=Dt.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Dt.prototype.writeBigUInt64LE=mr((function(e,t=0){return Qt(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),Dt.prototype.writeBigUInt64BE=mr((function(e,t=0){return $t(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),Dt.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);Yt(this,e,t,r,n-1,-n)}let s=0,i=1,o=0;for(this[t]=255&e;++s<r&&(i*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},Dt.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);Yt(this,e,t,r,n-1,-n)}let s=r-1,i=1,o=0;for(this[t+s]=255&e;--s>=0&&(i*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},Dt.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Dt.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Dt.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Dt.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Dt.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||Yt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Dt.prototype.writeBigInt64LE=mr((function(e,t=0){return Qt(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Dt.prototype.writeBigInt64BE=mr((function(e,t=0){return $t(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Dt.prototype.writeFloatLE=function(e,t,r){return tr(this,e,t,!0,r)},Dt.prototype.writeFloatBE=function(e,t,r){return tr(this,e,t,!1,r)},Dt.prototype.writeDoubleLE=function(e,t,r){return rr(this,e,t,!0,r)},Dt.prototype.writeDoubleBE=function(e,t,r){return rr(this,e,t,!1,r)},Dt.prototype.copy=function(e,t,r,n){if(!Dt.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const s=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),s},Dt.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Dt.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{const i=Dt.isBuffer(e)?e:Dt.from(e,n),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=i[s%o]}return this};const nr={};function sr(e,t,r){nr[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function ir(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function or(e,t,r,n,s,i){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let s;throw s=i>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new nr.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,r){ar(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||lr(t,e.length-(r+1))}(n,s,i)}function ar(e,t){if("number"!=typeof e)throw new nr.ERR_INVALID_ARG_TYPE(t,"number",e)}function lr(e,t,r){if(Math.floor(e)!==e)throw ar(e,r),new nr.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new nr.ERR_BUFFER_OUT_OF_BOUNDS;throw new nr.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}sr("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),sr("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),sr("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,s=r;return Number.isInteger(r)&&Math.abs(r)>2**32?s=ir(String(r)):"bigint"==typeof r&&(s=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(s=ir(s)),s+="n"),n+=` It must be ${t}. Received ${s}`,n}),RangeError);const cr=/[^+/0-9A-Za-z-_]/g;function ur(e,t){let r;t=t||1/0;const n=e.length;let s=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function hr(e){return dt(function(e){if((e=(e=e.split("=")[0]).trim().replace(cr,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function pr(e,t,r,n){let s;for(s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function dr(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function fr(e){return e!=e}const gr=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let s=0;s<16;++s)t[n+s]=e[r]+e[s]}return t}();function mr(e){return"undefined"==typeof BigInt?Ar:e}function Ar(){throw new Error("BigInt not supported")}var vr=pt;var Br,_r,Cr,br,wr,Er;function xr(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===Br.NODE?[e]:e.listChildren();for(const e of r)e.traverse((e=>{const r=e.getMesh();if(!r)return;const n=yr(r,e.getWorldMatrix());Dr(n.min,t),Dr(n.max,t)}));return t}function yr(e,t){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of e.listPrimitives()){const e=n.getAttribute("POSITION");if(!e)continue;let s=[0,0,0],i=[0,0,0];for(let n=0;n<e.getCount();n++)s=e.getElement(n,s),i=at(i,s,t),Dr(i,r)}return r}function Dr(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}(Er=Br||(Br={})).ACCESSOR="Accessor",Er.ANIMATION="Animation",Er.ANIMATION_CHANNEL="AnimationChannel",Er.ANIMATION_SAMPLER="AnimationSampler",Er.BUFFER="Buffer",Er.CAMERA="Camera",Er.MATERIAL="Material",Er.MESH="Mesh",Er.PRIMITIVE="Primitive",Er.PRIMITIVE_TARGET="PrimitiveTarget",Er.NODE="Node",Er.ROOT="Root",Er.SCENE="Scene",Er.SKIN="Skin",Er.TEXTURE="Texture",Er.TEXTURE_INFO="TextureInfo",function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(_r||(_r={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER"}(Cr||(Cr={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(br||(br={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(wr||(wr={}));class Tr{static createBufferFromDataURI(e){if(void 0===vr){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return vr.from(t,r?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):vr.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):vr.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const n=new Uint8Array(r);if(n.set(e),0!==t)for(let s=e.byteLength;s<r;s++)n[s]=t;return n}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Ir{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,n,s]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*n<<8^255*s<<0}static convertSRGBToLinear(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,n=t;for(let e=0;e<3;e++)n[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class Rr{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Tr.decodeText(e.slice(12,16))===Rr.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Rr.PNG_FRIED_CHUNK_NAME="CgBI";class Fr{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let r=0;const n=this.getSize(e,t);if(!n)return null;for(;n[0]>1||n[1]>1;)r+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function Mr(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}Fr.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,n=new DataView(e.buffer,e.byteOffset+4);for(;n.byteLength;){if(t=n.getUint16(0,!1),Mr(n,t),r=n.getUint8(t+1),192===r||193===r||194===r)return[n.getUint16(t+7,!1),n.getUint16(t+5,!1)];n=new DataView(e.buffer,n.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new Rr};class Pr{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return Fr.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function Sr(e){return"[object Object]"===Object.prototype.toString.call(e)}function Lr(e){if(!1===Sr(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==Sr(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}class Or{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Or.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Or.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Or.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Or.Verbosity.ERROR&&console.error(e)}}Or.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},Or.DEFAULT_INSTANCE=new Or(Or.Verbosity.INFO);class Nr{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,r,n){let s=ot([e[0],e[1],e[2]]);const i=ot([e[4],e[5],e[6]]),o=ot([e[8],e[9],e[10]]);(function(e){var t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11],d=e[12],f=e[13],g=e[14],m=e[15];return(t*o-r*i)*(h*m-p*g)-(t*a-n*i)*(u*m-p*f)+(t*l-s*i)*(u*g-h*f)+(r*a-n*o)*(c*m-p*d)-(r*l-s*o)*(c*g-h*d)+(n*l-s*a)*(c*f-u*d)})(e)<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const a=e.slice(),l=1/s,c=1/i,u=1/o;a[0]*=l,a[1]*=l,a[2]*=l,a[4]*=c,a[5]*=c,a[6]*=c,a[8]*=u,a[9]*=u,a[10]*=u,ht(r,a),n[0]=s,n[1]=i,n[2]=o}static compose(e,t,r,n){const s=n,i=t[0],o=t[1],a=t[2],l=t[3],c=i+i,u=o+o,h=a+a,p=i*c,d=i*u,f=i*h,g=o*u,m=o*h,A=a*h,v=l*c,B=l*u,_=l*h,C=r[0],b=r[1],w=r[2];return s[0]=(1-(g+A))*C,s[1]=(d+_)*C,s[2]=(f-B)*C,s[3]=0,s[4]=(d-_)*b,s[5]=(1-(p+A))*b,s[6]=(m+v)*b,s[7]=0,s[8]=(f+B)*w,s[9]=(m-v)*w,s[10]=(1-(p+g))*w,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function kr(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),n=t.getChild();return r===n||r.equals(n)}function Hr(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const n=e[r],s=t[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function Gr(e,t){if(!!e!=!!t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const r in e){const n=e[r],s=t[r];if(!!n!=!!s)return!1;const i=n.getChild(),o=s.getChild();if(i!==o&&!i.equals(o))return!1}return!0}function Kr(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Vr(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!Lr(e)||!Lr(t))return e===t;const r=e,n=t;let s,i=0,o=0;for(s in r)i++;for(s in n)o++;if(i!==o)return!1;for(s in r){const e=r[s],t=n[s];if(Ur(e)&&Ur(t)){if(!Kr(e,t))return!1}else if(Lr(e)&&Lr(t)){if(!Vr(e,t))return!1}else if(e!==t)return!1}return!0}function Ur(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const jr=new Set,Jr=function(){let e="";for(let t=0;t<6;t++)e+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(Math.random()*"23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".length));return e},Wr=function(){for(let e=0;e<999;e++){const e=Jr();if(!jr.has(e))return jr.add(e),e}return""};class Xr{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return Pr.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Pr.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),n=t.split("/");r.pop();for(let e=0;e<n.length;e++)"."!==n[e]&&(".."===n[e]?r.pop():r.push(n[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Xr.DEFAULT_INIT={},Xr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const zr=e=>e;class Zr extends st{constructor(e,t=""){super(e),this[rt].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,zr)}copy(e,t=zr){for(const e in this[rt]){const t=this[rt][e];if(t instanceof qe)this[nt].has(e)||t.dispose();else if(Array.isArray(t)&&t[0]instanceof qe)for(const e of t)e.dispose();else if(Lr(t)&&Object.values(t)[0]instanceof qe)for(const e in t)t[e].dispose()}for(const r in e[rt]){const n=this[rt][r],s=e[rt][r];if(s instanceof qe)this[nt].has(r)?n.getChild().copy(t(s.getChild()),t):this.setRef(r,t(s.getChild()),s.getAttributes());else if(Array.isArray(s)&&s[0]instanceof qe)for(const e of s)this.addRef(r,t(e.getChild()),e.getAttributes());else if(Lr(s)&&Object.values(s)[0]instanceof qe)for(const e in s){const n=s[e];this.setRefMap(r,e,t(n.getChild()),n.getAttributes())}else this[rt][r]=Lr(s)?JSON.parse(JSON.stringify(s)):Array.isArray(s)||s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.slice():s}return this}equals(e){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const t in this[rt]){const r=this[rt][t],n=e[rt][t];if($e(r)||$e(n)){if(!kr(r,n))return!1}else if(et(r)||et(n)){if(!Hr(r,n))return!1}else if(tt(r)||tt(n)){if(!Gr(r,n))return!1}else if(Lr(r)||Lr(n)){if(!Vr(r,n))return!1}else if(Ur(r)||Ur(n)){if(!Kr(r,n))return!1}else if(r!==n)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class qr extends Zr{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Yr extends qr{constructor(...e){super(...e),this.i=Nr.identity,this.o=Nr.identity}init(){this.propertyType=Br.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Yr.Type.SCALAR,componentType:Yr.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=zr){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Yr.Type.SCALAR:return 1;case Yr.Type.VEC2:return 2;case Yr.Type.VEC3:return 3;case Yr.Type.VEC4:case Yr.Type.MAT2:return 4;case Yr.Type.MAT3:return 9;case Yr.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Yr.ComponentType.BYTE:case Yr.ComponentType.UNSIGNED_BYTE:return 1;case Yr.ComponentType.SHORT:case Yr.ComponentType.UNSIGNED_SHORT:return 2;case Yr.ComponentType.UNSIGNED_INT:case Yr.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.min(e[r],n))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),n=this.getElementSize();for(let t=0;t<n;t++)e[t]=-1/0;for(let s=0;s<r*n;s+=n)for(let r=0;r<n;r++){const n=t[s+r];Number.isFinite(n)&&(e[r]=Math.max(e[r],n))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Yr.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>Nr.denormalize(e,this.get("componentType")),this.i=e=>Nr.normalize(e,this.get("componentType"))):(this.o=Nr.identity,this.i=Nr.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let s=0;s<r;s++)t[s]=this.o(n[e*r+s]);return t}setElement(e,t){const r=this.getElementSize(),n=this.get("array");for(let s=0;s<r;s++)n[e*r+s]=this.i(t[s]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return Yr.ComponentType.FLOAT;case Uint32Array:return Yr.ComponentType.UNSIGNED_INT;case Uint16Array:return Yr.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Yr.ComponentType.UNSIGNED_BYTE;case Int16Array:return Yr.ComponentType.SHORT;case Int8Array:return Yr.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Yr.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Yr.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Yr.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Qr extends qr{init(){this.propertyType=Br.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class $r extends qr{init(){this.propertyType=Br.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}$r.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class en extends qr{init(){this.propertyType=Br.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:en.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Cr.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Cr.OTHER})}}en.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class tn extends qr{init(){this.propertyType=Br.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class rn extends qr{init(){this.propertyType=Br.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:rn.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}rn.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class nn extends Zr{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}nn.EXTENSION_NAME=void 0;class sn extends qr{init(){this.propertyType=Br.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:sn.WrapMode.REPEAT,wrapT:sn.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}sn.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},sn.MagFilter={NEAREST:9728,LINEAR:9729},sn.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:on,G:an,B:ln,A:cn}=br;class un extends qr{init(){this.propertyType=Br.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:un.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new sn(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new sn(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new sn(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new sn(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new sn(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ir.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ir.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:on|an|ln|cn})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ir.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ir.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:on|an|ln})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:on|an|ln})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:on})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:an|ln})}}un.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class hn extends qr{init(){this.propertyType=Br.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class pn extends qr{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Br.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=zr){if(t===zr)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Nr.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),n=this.get("scale").slice();return Nr.decompose(e,t,r,n),this.set("translation",t).set("rotation",r).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return Nr.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Nr.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Nr.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;t instanceof pn;t=t.u)e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)ut(r,r,t.getMatrix());return r}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[rt].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class dn extends qr{init(){this.propertyType=Br.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:dn.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Cr.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Cr.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}dn.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class fn extends Zr{init(){this.propertyType=Br.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Cr.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function gn(){return(gn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class mn extends qr{init(){this.propertyType=Br.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=zr){if(t===zr)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[rt].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class An extends qr{init(){this.propertyType=Br.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Cr.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class vn extends qr{init(){this.propertyType=Br.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Fr.extensionToMimeType(Pr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",Fr.extensionToMimeType(Pr.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Tr.assertView(e))}getSize(){const e=this.get("image");return e?Fr.getSize(e,this.getMimeType()):null}}class Bn extends qr{init(){this.propertyType=Br.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.1.4",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=zr){if(t===zr)throw new Error("Root cannot be copied.");this.set("asset",gn({},e.get("asset"))),this.setName(e.getName()),this.setExtras(gn({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const n=e.getExtension(r);this.setExtension(r,t(n))}return this}l(e){return e instanceof mn?this.addRef("scenes",e):e instanceof pn?this.addRef("nodes",e):e instanceof rn?this.addRef("cameras",e):e instanceof An?this.addRef("skins",e):e instanceof hn?this.addRef("meshes",e):e instanceof un?this.addRef("materials",e):e instanceof vn?this.addRef("textures",e):e instanceof Qr?this.addRef("animations",e):e instanceof Yr?this.addRef("accessors",e):e instanceof tn&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class _n{constructor(){this.m=new Ye,this.T=new Bn(this.m),this.v=Or.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return(new _n).setLogger(this.v).merge(this)}merge(e){for(const t of e.getRoot().listExtensionsUsed()){const e=this.createExtension(t.constructor);t.isRequired()&&e.setRequired(!0)}const t=new Set,r=new Map;t.add(e.T),r.set(e.T,this.T);for(const n of e.m.listEdges())for(const e of[n.getParent(),n.getChild()]){if(t.has(e))continue;let n;n=e.propertyType===Br.TEXTURE_INFO?e:new e.constructor(this.m),r.set(e,n),t.add(e)}const n=e=>{const t=r.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const e of t){const t=r.get(e);if(!t)throw new Error("Could resolve property.");t.copy(e,n)}return this}async transform(...e){const t=e.map((e=>e.name));for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new mn(this.m,e)}createNode(e=""){return new pn(this.m,e)}createCamera(e=""){return new rn(this.m,e)}createSkin(e=""){return new An(this.m,e)}createMesh(e=""){return new hn(this.m,e)}createPrimitive(){return new dn(this.m)}createPrimitiveTarget(e=""){return new fn(this.m,e)}createMaterial(e=""){return new un(this.m,e)}createTexture(e=""){return new vn(this.m,e)}createAnimation(e=""){return new Qr(this.m,e)}createAnimationChannel(e=""){return new $r(this.m,e)}createAnimationSampler(e=""){return new en(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Yr(this.m,e).setBuffer(t)}createBuffer(e=""){return new tn(this.m,e)}}class Cn{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,r=t.target;r instanceof nn&&r.extensionName===this.extensionName&&("node:create"===t.type&&this.M(r),"node:dispose"===t.type&&this.I(r))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Cn.EXTENSION_NAME=void 0;class bn{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const n=this.jsonDoc.json.samplers[r.sampler];void 0!==n.magFilter&&e.setMagFilter(n.magFilter),void 0!==n.minFilter&&e.setMinFilter(n.minFilter),void 0!==n.wrapS&&e.setWrapS(n.wrapS),void 0!==n.wrapT&&e.setWrapT(n.wrapT)}}const wn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},En={logger:Or.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function xn(e,t){const r=t.bufferViews[e.bufferView],n=t.jsonDoc.json.bufferViews[e.bufferView],s=wn[e.componentType],i=Yr.getElementSize(e.type),o=s.BYTES_PER_ELEMENT;if(void 0!==n.byteStride&&n.byteStride!==i*o)return function(e,t){const r=t.bufferViews[e.bufferView],n=t.jsonDoc.json.bufferViews[e.bufferView],s=wn[e.componentType],i=Yr.getElementSize(e.type),o=s.BYTES_PER_ELEMENT,a=e.byteOffset||0,l=new s(e.count*i),c=new DataView(r.buffer,r.byteOffset,r.byteLength),u=n.byteStride;for(let t=0;t<e.count;t++)for(let r=0;r<i;r++){const n=a+t*u+r*o;let s;switch(e.componentType){case Yr.ComponentType.FLOAT:s=c.getFloat32(n,!0);break;case Yr.ComponentType.UNSIGNED_INT:s=c.getUint32(n,!0);break;case Yr.ComponentType.UNSIGNED_SHORT:s=c.getUint16(n,!0);break;case Yr.ComponentType.UNSIGNED_BYTE:s=c.getUint8(n);break;case Yr.ComponentType.SHORT:s=c.getInt16(n,!0);break;case Yr.ComponentType.BYTE:s=c.getInt8(n);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}l[t*i+r]=s}return l}(e,t);const a=r.byteOffset+(e.byteOffset||0);return new s(r.buffer.slice(a,a+e.count*i*o))}var yn;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(yn||(yn={}));class Dn{constructor(e,t,r){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=r;const n=e.getRoot(),s=n.listBuffers().length,i=n.listTextures().length;this.bufferURIGenerator=new Tn(s>1,r.basename),this.imageURIGenerator=new Tn(i>1,r.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(r);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},i=JSON.stringify(s);this.textureDefIndexMap.has(i)||(this.textureDefIndexMap.set(i,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const o={index:this.textureDefIndexMap.get(i)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===wr.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=Fr.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,n),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const t of this.N.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==Br.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return Dn.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const r=this.O.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.O.entries()))e[r]=e[r]||[],e[r].push(t);return e}}Dn.BufferViewTarget=yn,Dn.BufferViewUsage=Cr,Dn.USAGE_TO_TARGET={[Cr.ARRAY_BUFFER]:yn.ARRAY_BUFFER,[Cr.ELEMENT_ARRAY_BUFFER]:yn.ELEMENT_ARRAY_BUFFER};class Tn{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:In}=Dn;var Rn;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Rn||(Rn={}));class Fn{constructor(){this.v=Or.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=_r.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===wr.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(e,t=En){const r=gn({},En,t),{json:n}=e,s=new _n;this.validate(e,r);const i=new bn(e),o=n.asset,a=s.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==n.extras&&s.getRoot().setExtras(gn({},n.extras));const l=n.extensionsUsed||[],c=n.extensionsRequired||[];for(const e of r.extensions)if(l.includes(e.EXTENSION_NAME)){const t=s.createExtension(e).setRequired(c.includes(e.EXTENSION_NAME));for(const e of t.readDependencies)t.install(e,r.dependencies[e])}const u=n.buffers||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(Br.BUFFER))).forEach((e=>e.preread(i,Br.BUFFER))),i.buffers=u.map((e=>{const t=s.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),i.bufferViewBuffers=(n.bufferViews||[]).map(((t,r)=>{if(!i.bufferViews[r]){const n=e.json.buffers[t.buffer];i.bufferViews[r]=Tr.toView(n.uri?e.resources[n.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return i.buffers[t.buffer]})),i.accessors=(n.accessors||[]).map((e=>{const t=s.createAccessor(e.name,i.bufferViewBuffers[e.bufferView]).setType(e.type);if(e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView&&!e.sparse)return t;let r;return r=void 0!==e.sparse?function(e,t){const r=wn[e.componentType],n=Yr.getElementSize(e.type);let s;s=void 0!==e.bufferView?xn(e,t):new r(e.count*n);const i=e.sparse,o=i.count,a=gn({},e,i.indices,{count:o,type:"SCALAR"}),l=gn({},e,i.values,{count:o}),c=xn(a,t),u=xn(l,t);for(let e=0;e<a.count;e++)for(let t=0;t<n;t++)s[c[e]*n+t]=u[e*n+t];return s}(e,i):xn(e,i),t.setArray(r),t}));const h=n.images||[],p=n.textures||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(Br.TEXTURE))).forEach((e=>e.preread(i,Br.TEXTURE))),i.textures=h.map((t=>{const r=s.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const s=n.bufferViews[t.bufferView],i=e.json.buffers[s.buffer],o=s.byteOffset||0,a=(i.uri?e.resources[i.uri]:e.resources["@glb.bin"]).slice(o,o+s.byteLength);r.setImage(a)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=Pr.extension(t.uri);r.setMimeType(Fr.extensionToMimeType(e))}return r})),i.materials=(n.materials||[]).map((e=>{const t=s.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture;t.setBaseColorTexture(i.textures[p[e.index].source]),i.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture;t.setEmissiveTexture(i.textures[p[r.index].source]),i.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture;t.setNormalTexture(i.textures[p[r.index].source]),i.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture;t.setOcclusionTexture(i.textures[p[r.index].source]),i.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture;t.setMetallicRoughnessTexture(i.textures[p[e.index].source]),i.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const d=n.meshes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(Br.PRIMITIVE))).forEach((e=>e.preread(i,Br.PRIMITIVE))),i.meshes=d.map((e=>{const t=s.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((r=>{const n=s.createPrimitive();r.extras&&n.setExtras(r.extras),void 0!==r.material&&n.setMaterial(i.materials[r.material]),void 0!==r.mode&&n.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))n.setAttribute(e,i.accessors[t]);void 0!==r.indices&&n.setIndices(i.accessors[r.indices]);const o=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach(((e,t)=>{const r=o[t]||t.toString(),a=s.createPrimitiveTarget(r);for(const[t,r]of Object.entries(e))a.setAttribute(t,i.accessors[r]);n.addTarget(a)})),t.addPrimitive(n)})),t})),i.cameras=(n.cameras||[]).map((e=>{const t=s.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===rn.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return t}));const f=n.nodes||[];s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(Br.NODE))).forEach((e=>e.preread(i,Br.NODE))),i.nodes=f.map((e=>{const t=s.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],n=[0,0,0,1],s=[1,1,1];Nr.decompose(e.matrix,r,n,s),t.setTranslation(r),t.setRotation(n),t.setScale(s)}return void 0!==e.weights&&t.setWeights(e.weights),t})),i.skins=(n.skins||[]).map((e=>{const t=s.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(i.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(i.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(i.nodes[r]);return t})),f.map(((e,t)=>{const r=i.nodes[t];(e.children||[]).forEach((e=>r.addChild(i.nodes[e]))),void 0!==e.mesh&&r.setMesh(i.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(i.cameras[e.camera]),void 0!==e.skin&&r.setSkin(i.skins[e.skin])})),i.animations=(n.animations||[]).map((e=>{const t=s.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map((e=>{const r=s.createAnimationSampler().setInput(i.accessors[e.input]).setOutput(i.accessors[e.output]).setInterpolation(e.interpolation||en.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r}));return(e.channels||[]).forEach((e=>{const n=s.createAnimationChannel().setSampler(r[e.sampler]).setTargetNode(i.nodes[e.target.node]).setTargetPath(e.target.path);e.extras&&n.setExtras(e.extras),t.addChannel(n)})),t}));const g=n.scenes||[];return s.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(Br.SCENE))).forEach((e=>e.preread(i,Br.SCENE))),i.scenes=g.map((e=>{const t=s.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>i.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==n.scene&&s.getRoot().setDefaultScene(i.scenes[n.scene]),s.getRoot().listExtensionsUsed().forEach((e=>e.read(i))),s}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const e of r.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(r.extensionsUsed)for(const e of r.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(Tr.assertView(e));this.L(t);const r=t.json;if(r.buffers&&r.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Tr.assertView(e)))}async writeJSON(e,t={}){if(t.format===wr.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(e,t){const r=e.getRoot(),n={asset:gn({generator:"glTF-Transform v2.1.4"},r.getAsset()),extras:gn({},r.getExtras())},s={json:n,resources:{}},i=new Dn(e,s,t),o=t.logger||Or.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),l=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),c=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));l.length<e.getRoot().listExtensionsUsed().length&&o.debug("Some extensions were not registered for I/O, and will not be written.");for(const e of l)for(const r of e.writeDependencies)e.install(r,t.dependencies[r]);function u(e,t,r,s){const o=[];let a=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=n.bufferViews.length;const r=t.getArray(),s=Tr.pad(Tr.toView(r));e.byteOffset=a,a+=s.byteLength,o.push(s),i.accessorIndexMap.set(t,n.accessors.length),n.accessors.push(e)}const l={buffer:t,byteOffset:r,byteLength:Tr.concat(o).byteLength};return s&&(l.target=s),n.bufferViews.push(l),{buffers:o,byteLength:a}}function h(e,t,r){const s=e[0].getCount();let o=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=n.bufferViews.length,e.byteOffset=o;const r=t.getElementSize(),s=t.getComponentSize();o+=Tr.padNumber(r*s),i.accessorIndexMap.set(t,n.accessors.length),n.accessors.push(e)}const a=s*o,l=new ArrayBuffer(a),c=new DataView(l);for(let t=0;t<s;t++){let r=0;for(const n of e){const e=n.getElementSize(),s=n.getComponentSize(),i=n.getComponentType(),a=n.getArray();for(let n=0;n<e;n++){const l=t*o+r+n*s,u=a[t*e+n];switch(i){case Yr.ComponentType.FLOAT:c.setFloat32(l,u,!0);break;case Yr.ComponentType.BYTE:c.setInt8(l,u);break;case Yr.ComponentType.SHORT:c.setInt16(l,u,!0);break;case Yr.ComponentType.UNSIGNED_BYTE:c.setUint8(l,u);break;case Yr.ComponentType.UNSIGNED_SHORT:c.setUint16(l,u,!0);break;case Yr.ComponentType.UNSIGNED_INT:c.setUint32(l,u,!0);break;default:throw new Error("Unexpected component type: "+i)}}r+=Tr.padNumber(e*s)}}return n.bufferViews.push({buffer:t,byteOffset:r,byteLength:a,byteStride:o,target:Dn.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(l)]}}const p=new Map;for(const t of e.getGraph().listEdges()){if(t.getParent()===r)continue;const e=t.getChild();if(e instanceof Yr){const r=p.get(e)||[];r.push(t),p.set(e,r)}}if(n.accessors=[],n.bufferViews=[],n.samplers=[],n.textures=[],n.images=r.listTextures().map(((e,t)=>{const r=i.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const n=e.getImage();return n&&i.createImageData(r,n,e),i.imageIndexMap.set(e,t),r})),l.filter((e=>e.prewriteTypes.includes(Br.ACCESSOR))).forEach((e=>e.prewrite(i,Br.ACCESSOR))),r.listAccessors().forEach((e=>{const t=i.accessorUsageGroupedByParent,r=i.accessorParents;if(i.accessorIndexMap.has(e))return;const n=p.get(e)||[],s=i.getAccessorUsage(e);if(i.addAccessorToUsageGroup(e,s),t.has(s)){const t=n[0].getParent(),s=r.get(t)||new Set;s.add(e),r.set(t,s)}})),l.filter((e=>e.prewriteTypes.includes(Br.BUFFER))).forEach((e=>e.prewrite(i,Br.BUFFER))),(r.listAccessors().length>0||r.listTextures().length>0||i.otherBufferViews.size>0)&&0===r.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");n.buffers=[],r.listBuffers().forEach(((e,r)=>{const o=i.createPropertyDef(e),a=i.accessorUsageGroupedByParent,l=i.accessorParents,c=e.listParents().filter((e=>e instanceof Yr)),p=new Set(c),d=[],f=n.buffers.length;let g=0;const m=i.listAccessorUsageGroups();for(const e in m)if(a.has(e))for(const r of Array.from(l.values())){const n=Array.from(r).filter((e=>p.has(e))).filter((t=>i.getAccessorUsage(t)===e));if(n.length)if(e!==In.ARRAY_BUFFER||t.vertexLayout===_r.INTERLEAVED){const t=e===In.ARRAY_BUFFER?h(n,f,g):u(n,f,g);g+=t.byteLength,d.push(...t.buffers)}else for(const e of n){const t=h([e],f,g);g+=t.byteLength,d.push(...t.buffers)}}else{const t=m[e].filter((e=>p.has(e)));if(!t.length)continue;const r=u(t,f,g,e===In.ELEMENT_ARRAY_BUFFER?Dn.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);g+=r.byteLength,d.push(...r.buffers)}if(i.imageBufferViews.length&&0===r)for(let e=0;e<i.imageBufferViews.length;e++)if(n.bufferViews[n.images[e].bufferView].byteOffset=g,g+=i.imageBufferViews[e].byteLength,d.push(i.imageBufferViews[e]),g%8){const e=8-g%8;g+=e,d.push(new Uint8Array(e))}if(i.otherBufferViews.has(e))for(const t of i.otherBufferViews.get(e))n.bufferViews.push({buffer:f,byteOffset:g,byteLength:t.byteLength}),i.otherBufferViewsIndexMap.set(t,n.bufferViews.length-1),g+=t.byteLength,d.push(t);if(g){let r;t.format===wr.GLB?r="@glb.bin":(r=i.bufferURIGenerator.createURI(e,"bin"),o.uri=r),o.byteLength=g,s.resources[r]=Tr.concat(d)}n.buffers.push(o),i.bufferIndexMap.set(e,r)})),r.listAccessors().find((e=>!e.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),n.materials=r.listMaterials().map(((e,t)=>{const r=i.createPropertyDef(e);if(e.getAlphaMode()!==un.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===un.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},Nr.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),Nr.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),n=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(t,n)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),n=e.getEmissiveTextureInfo();r.emissiveTexture=i.createTextureInfoDef(t,n)}if(e.getNormalTexture()){const t=e.getNormalTexture(),n=e.getNormalTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getNormalScale()&&(s.scale=e.getNormalScale()),r.normalTexture=s}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),n=e.getOcclusionTextureInfo(),s=i.createTextureInfoDef(t,n);1!==e.getOcclusionStrength()&&(s.strength=e.getOcclusionStrength()),r.occlusionTexture=s}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),n=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(t,n)}return i.materialIndexMap.set(e,t),r})),n.meshes=r.listMeshes().map(((e,t)=>{const r=i.createPropertyDef(e);let n=null;return r.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=i.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const s=e.getIndices();s&&(t.indices=i.accessorIndexMap.get(s));for(const r of e.listSemantics())t.attributes[r]=i.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=i.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!n&&(n=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(r.weights=e.getWeights()),n&&(r.extras=r.extras||{},r.extras.targetNames=n),i.meshIndexMap.set(e,t),r})),n.cameras=r.listCameras().map(((e,t)=>{const r=i.createPropertyDef(e);if(r.type=e.getType(),r.type===rn.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return i.cameraIndexMap.set(e,t),r})),n.nodes=r.listNodes().map(((e,t)=>{const r=i.createPropertyDef(e);return Nr.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),Nr.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),Nr.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),i.nodeIndexMap.set(e,t),r})),n.skins=r.listSkins().map(((e,t)=>{const r=i.createPropertyDef(e),n=e.getInverseBindMatrices();n&&(r.inverseBindMatrices=i.accessorIndexMap.get(n));const s=e.getSkeleton();return s&&(r.skeleton=i.nodeIndexMap.get(s)),r.joints=e.listJoints().map((e=>i.nodeIndexMap.get(e))),i.skinIndexMap.set(e,t),r})),r.listNodes().forEach(((e,t)=>{const r=n.nodes[t],s=e.getMesh();s&&(r.mesh=i.meshIndexMap.get(s));const o=e.getCamera();o&&(r.camera=i.cameraIndexMap.get(o));const a=e.getSkin();a&&(r.skin=i.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map((e=>i.nodeIndexMap.get(e))))})),n.animations=r.listAnimations().map(((e,t)=>{const r=i.createPropertyDef(e),n=new Map;return r.samplers=e.listSamplers().map(((e,t)=>{const r=i.createPropertyDef(e);return r.input=i.accessorIndexMap.get(e.getInput()),r.output=i.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),n.set(e,t),r})),r.channels=e.listChannels().map((e=>{const t=i.createPropertyDef(e);return t.sampler=n.get(e.getSampler()),t.target={node:i.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),i.animationIndexMap.set(e,t),r})),n.scenes=r.listScenes().map(((e,t)=>{const r=i.createPropertyDef(e);return r.nodes=e.listChildren().map((e=>i.nodeIndexMap.get(e))),i.sceneIndexMap.set(e,t),r}));const d=r.getDefaultScene();return d&&(n.scene=r.listScenes().indexOf(d)),n.extensionsUsed=l.map((e=>e.extensionName)),n.extensionsRequired=c.map((e=>e.extensionName)),l.forEach((e=>e.write(i))),function(e){const t=[];for(const r in e){const n=e[r];(Array.isArray(n)&&0===n.length||null===n||""===n||n&&"object"==typeof n&&0===Object.keys(n).length)&&t.push(r)}for(const r of t)delete e[r]}(n),s}}.write(e,{format:t.format||wr.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:gn({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:wr.GLB}),n=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),i=Tr.pad(Tr.encodeText(s),32),o=Tr.toView(new Uint32Array([i.byteLength,1313821514])),a=Tr.concat([o,i]);n[n.length-1]+=a.byteLength;const l=Object.values(r)[0];if(!l||!l.byteLength)return Tr.concat([Tr.toView(n),a]);const c=Tr.pad(l,0),u=Tr.toView(new Uint32Array([c.byteLength,5130562])),h=Tr.concat([u,c]);return n[n.length-1]+=h.byteLength,Tr.concat([Tr.toView(n),a,h])}detectFormat(e){return"glb"===(Xr.isAbsoluteURL(e)?Xr.extension(e):Pr.extension(e))?wr.GLB:wr.GLTF}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const r={json:JSON.parse(t),resources:{}};return await this.D(r,this.dirname(e)),this.L(r),r}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=this._(t);return await this.D(r,this.dirname(e)),this.L(r),r}async D(e,t){var r=this;const n=[...e.json.images||[],...e.json.buffers||[]].map((async function(n){const s=n.uri;if(!s||s.match(/data:/))return Promise.resolve();e.resources[s]=await r.readURI(r.resolve(t,s),"view"),r.lastReadBytes+=e.resources[s].byteLength}));await Promise.all(n)}L(e){function t(t){if(t.uri)if(t.uri in e.resources)Tr.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${Wr()}.${Pr.extension(t.uri)}`;e.resources[r]=Tr.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:r}=e.json;return e={json:gn({},e.json),resources:gn({},e.resources)},t&&(e.json.images=t.map((e=>gn({},e)))),r&&(e.json.buffers=r.map((e=>gn({},e)))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Rn.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=Tr.decodeText(Tr.toView(e,20,n)),i=JSON.parse(s),o=20+n;if(e.byteLength<=o)return{json:i,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+o,2);if(a[1]!==Rn.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:i,resources:{"@glb.bin":Tr.toView(e,o+8,a[0])}}}}class Mn extends Fn{constructor(e=Xr.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const r=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return Xr.resolve(e,t)}dirname(e){return Xr.dirname(e)}detectFormat(e){return"glb"===Xr.extension(e)?wr.GLB:wr.GLTF}}var Pn=pt;new Uint8Array([0]);const Sn=[171,75,84,88,32,50,48,187,13,10,26,10];var Ln,On,Nn,kn,Hn,Gn,Kn,Vn;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(Ln||(Ln={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(On||(On={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(Nn||(Nn={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(kn||(kn={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(Hn||(Hn={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Gn||(Gn={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(Kn||(Kn={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(Vn||(Vn={}));class Un{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Ln.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:On.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:Nn.UNSPECIFIED,colorPrimaries:kn.SRGB,transferFunction:kn.SRGB,flags:Gn.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class jn{constructor(e,t,r,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}function Jn(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Pn.from(e).toString("utf8")}function Wn(e){const t=new Uint8Array(e.buffer,e.byteOffset,Sn.length);if(t[0]!==Sn[0]||t[1]!==Sn[1]||t[2]!==Sn[2]||t[3]!==Sn[3]||t[4]!==Sn[4]||t[5]!==Sn[5]||t[6]!==Sn[6]||t[7]!==Sn[7]||t[8]!==Sn[8]||t[9]!==Sn[9]||t[10]!==Sn[10]||t[11]!==Sn[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Un,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new jn(e,Sn.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const i=s._nextUint32();r.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),u=s._nextUint64(),h=s._nextUint64(),p=new jn(e,Sn.length+n,3*i*8,!0);for(let t=0;t<i;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const d=new jn(e,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:{x:d._nextUint8()+1,y:d._nextUint8()+1,z:d._nextUint8()+1,w:d._nextUint8()+1},bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<g;e++)f.samples[e]={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelID:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:d._nextUint32(),sampleUpper:d._nextUint32()};r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);const m=new jn(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),n=Jn(t),s=m._scan(e-t.byteLength);r.keyValue[n]=n.match(/^ktx/i)?Jn(s):s,m._offset%4&&m._skip(4-m._offset%4)}if(h<=0)return r;const A=new jn(e,u,h,!0),v=A._nextUint16(),B=A._nextUint16(),_=A._nextUint32(),C=A._nextUint32(),b=A._nextUint32(),w=A._nextUint32(),E=[];for(let e=0;e<i;e++)E.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const x=u+A._offset,y=x+_,D=y+C,T=D+b,I=new Uint8Array(e.buffer,e.byteOffset+x,_),R=new Uint8Array(e.buffer,e.byteOffset+y,C),F=new Uint8Array(e.buffer,e.byteOffset+D,b),M=new Uint8Array(e.buffer,e.byteOffset+T,w);return r.globalData={endpointCount:v,selectorCount:B,imageDescs:E,endpointsData:I,selectorsData:R,tablesData:F,extendedData:M},r}class Xn extends nn{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Br.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Xn.EXTENSION_NAME="EXT_mesh_gpu_instancing";class zn extends Cn{constructor(...e){super(...e),this.extensionName="EXT_mesh_gpu_instancing",this.provideTypes=[Br.NODE],this.prewriteTypes=[Br.ACCESSOR]}createInstancedMesh(){return new Xn(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions.EXT_mesh_gpu_instancing)return;const n=t.extensions.EXT_mesh_gpu_instancing,s=this.createInstancedMesh();for(const t in n.attributes)s.setAttribute(t,e.accessors[n.attributes[t]]);e.nodes[r].setExtension("EXT_mesh_gpu_instancing",s)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((r=>{const n=r.getExtension("EXT_mesh_gpu_instancing");if(n){const s=e.nodeIndexMap.get(r),i=t.json.nodes[s],o={attributes:{}};n.listSemantics().forEach((t=>{const r=n.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(r)})),i.extensions=i.extensions||{},i.extensions.EXT_mesh_gpu_instancing=o}})),this}}function Zn(){return(Zn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var qn,Yn,Qn,$n;zn.EXTENSION_NAME="EXT_mesh_gpu_instancing",($n=qn||(qn={})).QUANTIZE="quantize",$n.FILTER="filter",function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(Yn||(Yn={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(Qn||(Qn={}));const{BYTE:es,SHORT:ts,FLOAT:rs}=Yr.ComponentType,{normalize:ns,denormalize:ss}=Nr;function is(e,t,r,n){const{filter:s,bits:i}=n,o={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==Yn.ATTRIBUTES)return o;if(s!==Qn.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=ss(r[e],t);return n}(e):new Float32Array(o.array);switch(s){case Qn.EXPONENTIAL:o.byteStride=4*e.getElementSize(),o.componentType=rs,o.normalized=!1,o.array=t.encodeFilterExp(r,e.getCount(),o.byteStride,i);break;case Qn.OCTAHEDRAL:o.byteStride=i>8?8:4,o.componentType=i>8?ts:es,o.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,n=e.length/3;r<n;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,o.array=t.encodeFilterOct(r,e.getCount(),o.byteStride,i);break;case Qn.QUATERNION:o.byteStride=8,o.componentType=ts,o.normalized=!0,o.array=t.encodeFilterQuat(r,e.getCount(),o.byteStride,i);break;default:throw new Error("Invalid filter.")}o.min=e.getMin([]),o.max=e.getMax([]),e.getNormalized()&&(o.min=o.min.map((t=>ss(t,e.getComponentType()))),o.max=o.max.map((t=>ss(t,e.getComponentType())))),o.normalized&&(o.min=o.min.map((e=>ns(e,o.componentType))),o.max=o.max.map((e=>ns(e,o.componentType))))}else o.byteStride%4&&(o.array=function(e,t){const r=Tr.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,n=new e.constructor(e.length/t*r);for(let s=0;s*t<e.length;s++)for(let i=0;i<t;i++)n[s*r+i]=e[s*t+i];return n}(o.array,e.getElementSize()),o.byteStride=o.array.byteLength/e.getCount());return o}function os(e,t){return t===Dn.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof dn&&e.getMode()===dn.Mode.TRIANGLES))?Yn.TRIANGLES:Yn.INDICES:Yn.ATTRIBUTES}function as(e,t){const r=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof Bn)));for(const t of r){const r=t.getName(),n=t.getAttributes().key||"";if("indices"===r)return{filter:Qn.NONE};if("attributes"===r){if("POSITION"===n)return{filter:Qn.NONE};if("TEXCOORD_0"===n)return{filter:Qn.NONE};if("NORMAL"===n)return{filter:Qn.OCTAHEDRAL,bits:8};if("TANGENT"===n)return{filter:Qn.OCTAHEDRAL,bits:8};if(n.startsWith("JOINTS_"))return{filter:Qn.NONE};if(n.startsWith("WEIGHTS_"))return{filter:Qn.NONE}}if("output"===r){const t=ls(e);return"rotation"===t?{filter:Qn.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:Qn.EXPONENTIAL,bits:12}:{filter:Qn.NONE}}if("input"===r)return{filter:Qn.NONE};if("inverseBindMatrices"===r)return{filter:Qn.NONE}}return{filter:Qn.NONE}}function ls(e){for(const t of e.listParents())if(t instanceof en)for(const e of t.listParents())if(e instanceof $r)return e.getTargetPath();return null}const cs={method:qn.QUANTIZE};class us extends Cn{constructor(...e){super(...e),this.extensionName="EXT_meshopt_compression",this.prereadTypes=[Br.BUFFER,Br.PRIMITIVE],this.prewriteTypes=[Br.BUFFER,Br.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=cs,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=Zn({},cs,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error('[EXT_meshopt_compression] Please install extension dependency, "meshopt.decoder".')}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error("[EXT_meshopt_compression]: Missing WASM support.")}return t===Br.BUFFER?this._prereadBuffers(e):t===Br.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((r,n)=>{if(!r.extensions||!r.extensions.EXT_meshopt_compression)return;const s=r.extensions.EXT_meshopt_compression,i=s.byteOffset||0,o=s.byteLength||0,a=s.count,l=s.byteStride,c=new Uint8Array(a*l),u=t.json.buffers[r.buffer],h=Tr.toView(u.uri?t.resources[u.uri]:t.resources["@glb.bin"],i,o);this._decoder.decodeGltfBuffer(c,a,l,h,s.mode,s.filter),e.bufferViews[n]=c}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r=>{var n;r.extensions&&r.extensions.EXT_meshopt_compression&&(n=t.json.buffers[r.buffer]).extensions&&n.extensions.EXT_meshopt_compression&&n.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[r.buffer],e.buffers[r.extensions.EXT_meshopt_compression.buffer])}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const r of e.listParents())r instanceof Yr&&r.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===Br.ACCESSOR?this._prewriteAccessors(e):t===Br.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,n=this._encoderOptions,s=this.document.createBuffer(),i=this.document.getRoot().listBuffers().indexOf(s);this._encoderFallbackBuffer=s,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const s of this.document.getRoot().listAccessors()){if("weights"===ls(s))continue;const o=e.getAccessorUsage(s),a=os(s,o),l=n.method===qn.FILTER?as(s,this.document):{filter:Qn.NONE},c=is(s,r,a,l),{array:u,byteStride:h}=c,p=s.getBuffer();if(!p)throw new Error("EXT_meshopt_compression: Missing buffer for accessor.");const d=this.document.getRoot().listBuffers().indexOf(p),f=[o,a,l.filter,h,d].join(":");let g=this._encoderBufferViews[f],m=this._encoderBufferViewData[f],A=this._encoderBufferViewAccessors[f];g&&m||(A=this._encoderBufferViewAccessors[f]=[],m=this._encoderBufferViewData[f]=[],g=this._encoderBufferViews[f]={buffer:i,target:Dn.USAGE_TO_TARGET[o],byteOffset:0,byteLength:0,byteStride:o===Dn.BufferViewUsage.ARRAY_BUFFER?h:void 0,extensions:{EXT_meshopt_compression:{buffer:d,byteOffset:0,byteLength:0,mode:a,filter:l.filter!==Qn.NONE?l.filter:void 0,byteStride:h,count:0}}});const v=e.createAccessorDef(s);v.componentType=c.componentType,v.normalized=c.normalized,v.byteOffset=g.byteLength,v.min&&c.min&&(v.min=c.min),v.max&&c.max&&(v.max=c.max),e.accessorIndexMap.set(s,t.accessors.length),t.accessors.push(v),A.push(v),m.push(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),g.byteLength+=u.byteLength,g.extensions.EXT_meshopt_compression.count+=s.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=this._encoderBufferViewData[r],i=this.document.getRoot().listBuffers()[n.extensions.EXT_meshopt_compression.buffer],o=e.otherBufferViews.get(i)||[],{count:a,byteStride:l,mode:c}=n.extensions.EXT_meshopt_compression,u=Tr.concat(s),h=t.encodeGltfBuffer(u,a,l,c),p=Tr.pad(h);n.extensions.EXT_meshopt_compression.byteLength=h.byteLength,s.length=0,s.push(p),o.push(p),e.otherBufferViews.set(i,o)}}write(e){let t=0;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],s=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[r][0]),i=this._encoderBufferViewAccessors[r];for(const e of i)e.bufferView=s;const o=e.jsonDoc.json.bufferViews[s],a=o.byteOffset||0;Object.assign(o,n),o.byteOffset=t,o.extensions.EXT_meshopt_compression.byteOffset=a,t+=Tr.padNumber(n.byteLength)}const r=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(r),s=e.jsonDoc.json.buffers[n];return s.byteLength=t,s.extensions={EXT_meshopt_compression:{fallback:!0}},r.dispose(),this}}us.EXTENSION_NAME="EXT_meshopt_compression",us.EncoderMethod=qn;class hs{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=Tr.decodeText(e.slice(0,4)),r=Tr.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const n=new DataView(e.buffer,e.byteOffset);let s=12;for(;s<n.byteLength;){const e=Tr.decodeText(new Uint8Array([n.getUint8(s),n.getUint8(s+1),n.getUint8(s+2),n.getUint8(s+3)])),t=n.getUint32(s+4,!0);if("VP8 "===e)return[16383&n.getInt16(s+14,!0),16383&n.getInt16(s+16,!0)];if("VP8L"===e){const e=n.getUint8(s+9),t=n.getUint8(s+10),r=n.getUint8(s+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(s+12))<<10|r<<2|(192&t)>>6)]}s+=8+t+t%2}return null}getChannels(e){return 4}}class ps extends Cn{constructor(...e){super(...e),this.extensionName="EXT_texture_webp",this.prereadTypes=[Br.TEXTURE]}static register(){Fr.registerFormat("image/webp",new hs)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/webp"===r.getMimeType()){const n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions.EXT_texture_webp={source:e.source},delete e.source)}))}})),this}}ps.EXTENSION_NAME="EXT_texture_webp";let ds,fs,gs,ms;function As(e,t){const r=new ds.DecoderBuffer;try{if(r.Init(t,t.length),e.GetEncodedGeometryType(r)!==ds.TRIANGULAR_MESH)throw new Error("[KHR_draco_mesh_compression] Unknown geometry type.");const n=new ds.Mesh;if(!e.DecodeBufferToMesh(r,n).ok()||0===n.ptr)throw new Error("[KHR_draco_mesh_compression] Decoding failure.");return n}finally{ds.destroy(r)}}function vs(e,t){const r=3*t.num_faces();let n,s;if(t.num_points()<=65534){const i=r*Uint16Array.BYTES_PER_ELEMENT;n=ds._malloc(i),e.GetTrianglesUInt16Array(t,i,n),s=new Uint16Array(ds.HEAPU16.buffer,n,r).slice()}else{const i=r*Uint32Array.BYTES_PER_ELEMENT;n=ds._malloc(i),e.GetTrianglesUInt32Array(t,i,n),s=new Uint32Array(ds.HEAPU32.buffer,n,r).slice()}return ds._free(n),s}function Bs(e,t,r,n){const s=gs[n.componentType],i=fs[n.componentType],o=r.num_components(),a=t.num_points()*o,l=a*i.BYTES_PER_ELEMENT,c=ds._malloc(l);e.GetAttributeDataArrayForAllPoints(t,r,s,l,c);const u=new i(ds.HEAPF32.buffer,c,a).slice();return ds._free(c),u}var _s,Cs;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(_s||(_s={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(Cs||(Cs={}));const bs={[Cs.POSITION]:14,[Cs.NORMAL]:10,[Cs.COLOR]:8,[Cs.TEX_COORD]:12,[Cs.GENERIC]:12},ws={decodeSpeed:5,encodeSpeed:5,method:_s.EDGEBREAKER,quantizationBits:bs,quantizationVolume:"mesh"};function Es(e,t=ws){const r=Zn({},ws,t);r.quantizationBits=Zn({},bs,t.quantizationBits);const n=new ms.Encoder,s=new ms.MeshBuilder,i=new ms.Mesh,o={},a=new ms.DracoInt8Array;for(const t of e.listSemantics()){const a=e.getAttribute(t),l=xs(t),c=ys(s,a.getComponentType(),i,ms[l],a.getCount(),a.getElementSize(),a.getArray());if(-1===c)throw new Error(`Error compressing "${t}" attribute.`);if(o[t]=c,"mesh"===r.quantizationVolume||"POSITION"!==t)n.SetAttributeQuantization(ms[l],r.quantizationBits[l]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);n.SetAttributeExplicitQuantization(ms[l],r.quantizationBits[l],a.getElementSize(),e.min,t)}}}const l=e.getIndices();if(!l)throw new Error("Primitive must have indices.");s.AddFacesToMesh(i,l.getCount()/3,l.getArray()),n.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),n.SetTrackEncodedProperties(!0),r.method===_s.SEQUENTIAL||e.listTargets().length>0?n.SetEncodingMethod(ms.MESH_SEQUENTIAL_ENCODING):n.SetEncodingMethod(ms.MESH_EDGEBREAKER_ENCODING);const c=n.EncodeMeshToDracoBuffer(i,a);if(c<=0)throw new Error("Error applying Draco compression.");const u=new Uint8Array(c);for(let e=0;e<c;++e)u[e]=a.GetValue(e);const h=e.getAttribute("POSITION").getCount(),p=n.GetNumberOfEncodedPoints(),d=3*n.GetNumberOfEncodedFaces();if(e.listTargets().length>0&&p!==h)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return ms.destroy(a),ms.destroy(i),ms.destroy(s),ms.destroy(n),{numVertices:p,numIndices:d,data:u,attributeIDs:o}}function xs(e){return"POSITION"===e?Cs.POSITION:"NORMAL"===e?Cs.NORMAL:e.startsWith("COLOR_")?Cs.COLOR:e.startsWith("TEXCOORD_")?Cs.TEX_COORD:Cs.GENERIC}function ys(e,t,r,n,s,i,o){switch(t){case Yr.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,n,s,i,o);case Yr.ComponentType.BYTE:return e.AddInt8Attribute(r,n,s,i,o);case Yr.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,n,s,i,o);case Yr.ComponentType.SHORT:return e.AddInt16Attribute(r,n,s,i,o);case Yr.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,n,s,i,o);case Yr.ComponentType.FLOAT:return e.AddFloatAttribute(r,n,s,i,o);default:throw new Error(`Unexpected component type, "${t}".`)}}const Ds="KHR_draco_mesh_compression";class Ts extends Cn{constructor(...e){super(...e),this.extensionName=Ds,this.prereadTypes=[Br.PRIMITIVE],this.prewriteTypes=[Br.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,ds=this._decoderModule,fs={[Yr.ComponentType.FLOAT]:Float32Array,[Yr.ComponentType.UNSIGNED_INT]:Uint32Array,[Yr.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Yr.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Yr.ComponentType.SHORT]:Int16Array,[Yr.ComponentType.BYTE]:Int8Array},gs={[Yr.ComponentType.FLOAT]:ds.DT_FLOAT32,[Yr.ComponentType.UNSIGNED_INT]:ds.DT_UINT32,[Yr.ComponentType.UNSIGNED_SHORT]:ds.DT_UINT16,[Yr.ComponentType.UNSIGNED_BYTE]:ds.DT_UINT8,[Yr.ComponentType.SHORT]:ds.DT_INT16,[Yr.ComponentType.BYTE]:ds.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,ms=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error('[KHR_draco_mesh_compression] Please install extension dependency, "draco3d.decoder".');const t=this.document.getLogger(),r=e.jsonDoc,n=new Map;try{const s=r.json.meshes||[];for(const i of s)for(const s of i.primitives){if(!s.extensions||!s.extensions[Ds])continue;const i=s.extensions[Ds];let[o,a]=n.get(i.bufferView)||[];if(!a||!o){const e=r.json.bufferViews[i.bufferView],s=r.json.buffers[e.buffer],l=Tr.toView(s.uri?r.resources[s.uri]:r.resources["@glb.bin"],e.byteOffset||0,e.byteLength);o=new this._decoderModule.Decoder,a=As(o,l),n.set(i.bufferView,[o,a]),t.debug(`[KHR_draco_mesh_compression] Decompressed ${l.byteLength} bytes.`)}for(const t in s.attributes){const r=e.jsonDoc.json.accessors[s.attributes[t]],n=o.GetAttributeByUniqueId(a,i.attributes[t]),l=Bs(o,a,n,r);e.accessors[s.attributes[t]].setArray(l)}void 0!==s.indices&&e.accessors[s.indices].setArray(vs(o,a))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error('[KHR_draco_mesh_compression] Please install extension dependency, "draco3d.encoder".');const r=this.document.getLogger();r.debug(`[KHR_draco_mesh_compression] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),r=new Set,n=new Set;for(const s of e.getRoot().listMeshes())for(const e of s.listPrimitives())e.getIndices()?e.getMode()!==dn.Mode.TRIANGLES?(n.add(e),t.warn("[KHR_draco_mesh_compression] Skipping Draco compression on non-TRIANGLES primitive.")):r.add(e):(n.add(e),t.warn("[KHR_draco_mesh_compression] Skipping Draco compression on non-indexed primitive."));const s=e.getRoot().listAccessors(),i=new Map;for(let e=0;e<s.length;e++)i.set(s[e],e);const o=new Map,a=new Set,l=new Map;for(const t of Array.from(r)){let r=Is(t,i);if(a.has(r))l.set(t,r);else{if(o.has(t.getIndices())){const r=t.getIndices(),n=r.clone();i.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}for(const r of t.listAttributes())if(o.has(r)){const n=r.clone();i.set(n,e.getRoot().listAccessors().length-1),t.swap(r,n)}r=Is(t,i),a.add(r),l.set(t,r),o.set(t.getIndices(),r);for(const e of t.listAttributes())o.set(e,r)}}for(const e of Array.from(o.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(Br.PRIMITIVE)||!t.has(Br.ROOT))throw new Error("[KHR_draco_mesh_compression] Compressed accessors must only be used as indices or vertex attributes.")}for(const e of Array.from(r)){const t=l.get(e),r=e.getIndices();if(o.get(r)!==t||e.listAttributes().some((e=>o.get(e)!==t)))throw new Error("[KHR_draco_mesh_compression] Draco primitives must share all, or no, accessors.")}for(const e of Array.from(n)){const t=e.getIndices();if(o.has(t)||e.listAttributes().some((e=>o.has(e))))throw new Error("[KHR_draco_mesh_compression] Accessor cannot be shared by compressed and uncompressed primitives.")}return l}(this.document),s=new Map;let i="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn("[KHR_draco_mesh_compression]: quantizationVolume=scene requires exactly 1 scene."):i=xr(this.document.getRoot().listScenes().pop()));for(const t of Array.from(n.keys())){const r=n.get(t);if(!r)throw new Error("Unexpected primitive.");if(s.has(r)){s.set(r,s.get(r));continue}const o=t.getIndices(),a=e.jsonDoc.json.accessors,l=Es(t,Zn({},this._encoderOptions,{quantizationVolume:i}));s.set(r,l);const c=e.createAccessorDef(o);c.count=l.numIndices,e.accessorIndexMap.set(o,a.length),a.push(c);for(const r of t.listSemantics()){const n=t.getAttribute(r),s=e.createAccessorDef(n);s.count=l.numVertices,e.accessorIndexMap.set(n,a.length),a.push(s)}const u=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(u)||e.otherBufferViews.set(u,[]),e.otherBufferViews.get(u).push(l.data)}return r.debug(`[KHR_draco_mesh_compression] Compressed ${n.size} primitives.`),e.extensionData[Ds]={primitiveHashMap:n,primitiveEncodingMap:s},this}write(e){const t=e.extensionData[Ds];for(const r of this.document.getRoot().listMeshes()){const n=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let s=0;s<r.listPrimitives().length;s++){const i=r.listPrimitives()[s],o=n.primitives[s],a=t.primitiveHashMap.get(i);if(!a)continue;const l=t.primitiveEncodingMap.get(a);o.extensions=o.extensions||{},o.extensions[Ds]={bufferView:e.otherBufferViewsIndexMap.get(l.data),attributes:l.attributeIDs}}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==Ds)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==Ds))}return this}}function Is(e,t){const r=[],n=e.getIndices();r.push(t.get(n));for(const n of e.listAttributes())r.push(t.get(n));return r.sort().join("|")}Ts.EXTENSION_NAME=Ds,Ts.EncoderMethod=_s;class Rs extends nn{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Br.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Rs.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ir.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Ir.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}Rs.EXTENSION_NAME="KHR_lights_punctual",Rs.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class Fs extends Cn{constructor(...e){super(...e),this.extensionName="KHR_lights_punctual"}createLight(e=""){return new Rs(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions.KHR_lights_punctual)return this;const r=(t.json.extensions.KHR_lights_punctual.lights||[]).map((e=>{var t,r;const n=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&n.setColor(e.color),void 0!==e.intensity&&n.setIntensity(e.intensity),void 0!==e.range&&n.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&n.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&n.setOuterConeAngle(e.spot.outerConeAngle),n}));return t.json.nodes.forEach(((t,n)=>{t.extensions&&t.extensions.KHR_lights_punctual&&e.nodes[n].setExtension("KHR_lights_punctual",r[t.extensions.KHR_lights_punctual.light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],n=new Map;for(const e of this.properties){const t=e,s={type:t.getType()};Nr.eq(t.getColor(),[1,1,1])||(s.color=t.getColor()),1!==t.getIntensity()&&(s.intensity=t.getIntensity()),null!=t.getRange()&&(s.range=t.getRange()),t.getName()&&(s.name=t.getName()),t.getType()===Rs.Type.SPOT&&(s.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),r.push(s),n.set(t,r.length-1)}return this.document.getRoot().listNodes().forEach((r=>{const s=r.getExtension("KHR_lights_punctual");if(s){const i=e.nodeIndexMap.get(r),o=t.json.nodes[i];o.extensions=o.extensions||{},o.extensions.KHR_lights_punctual={light:n.get(s)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions.KHR_lights_punctual={lights:r},this}}Fs.EXTENSION_NAME="KHR_lights_punctual";const{R:Ms,G:Ps}=br;class Ss extends nn{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropy:0,anisotropyTexture:null,anisotropyTextureInfo:new sn(this.graph,"anisotropyTextureInfo"),anisotropyDirection:[1,0,0],anisotropyDirectionTexture:null,anisotropyDirectionTextureInfo:new sn(this.graph,"anisotropyDirectionTextureInfo")})}getAnisotropy(){return this.get("anisotropy")}setAnisotropy(e){return this.set("anisotropy",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Ms})}getAnisotropyDirection(){return this.get("anisotropyDirection")}setAnisotropyDirection(e){return this.set("anisotropyDirection",e)}getAnisotropyDirectionTexture(){return this.getRef("anisotropyDirectionTexture")}getAnisotropyDirectionTextureInfo(){return this.getRef("anisotropyDirectionTexture")?this.getRef("anisotropyDirectionTextureInfo"):null}setAnisotropyDirectionTexture(e){return this.setRef("anisotropyDirectionTexture",e,{channels:Ps})}}Ss.EXTENSION_NAME="KHR_materials_anisotropy";class Ls extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_anisotropy"}createAnisotropy(){return new Ss(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_anisotropy){const s=this.createAnisotropy();e.materials[n].setExtension("KHR_materials_anisotropy",s);const i=t.extensions.KHR_materials_anisotropy;if(void 0!==i.anisotropy&&s.setAnisotropy(i.anisotropy),void 0!==i.anisotropyDirection&&s.setAnisotropyDirection(i.anisotropyDirection),void 0!==i.anisotropyTexture){const t=i.anisotropyTexture;s.setAnisotropyTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getAnisotropyTextureInfo(),t)}if(void 0!==i.anisotropyDirectionTexture){const t=i.anisotropyDirectionTexture;s.setAnisotropyDirectionTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getAnisotropyDirectionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_anisotropy");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_anisotropy={anisotropy:n.getAnisotropy(),anisotropyDirection:n.getAnisotropyDirection()};if(n.getAnisotropyTexture()){const t=n.getAnisotropyTexture(),r=n.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(t,r)}if(n.getAnisotropyDirectionTexture()){const t=n.getAnisotropyDirectionTexture(),r=n.getAnisotropyDirectionTextureInfo();o.anisotropyDirectionTexture=e.createTextureInfoDef(t,r)}}})),this}}Ls.EXTENSION_NAME="KHR_materials_anisotropy";const{R:Os,G:Ns,B:ks}=br;class Hs extends nn{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new sn(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new sn(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new sn(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Os})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Ns})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Os|Ns|ks})}}Hs.EXTENSION_NAME="KHR_materials_clearcoat";class Gs extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_clearcoat"}createClearcoat(){return new Hs(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_clearcoat){const s=this.createClearcoat();e.materials[n].setExtension("KHR_materials_clearcoat",s);const i=t.extensions.KHR_materials_clearcoat;if(void 0!==i.clearcoatFactor&&s.setClearcoatFactor(i.clearcoatFactor),void 0!==i.clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(i.clearcoatRoughnessFactor),void 0!==i.clearcoatTexture){const t=i.clearcoatTexture;s.setClearcoatTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getClearcoatTextureInfo(),t)}if(void 0!==i.clearcoatRoughnessTexture){const t=i.clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==i.clearcoatNormalTexture){const t=i.clearcoatNormalTexture;s.setClearcoatNormalTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&s.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_clearcoat");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_clearcoat={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const t=n.getClearcoatTexture(),r=n.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatRoughnessTexture()){const t=n.getClearcoatRoughnessTexture(),r=n.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(n.getClearcoatNormalTexture()){const t=n.getClearcoatNormalTexture(),r=n.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==n.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}})),this}}Gs.EXTENSION_NAME="KHR_materials_clearcoat";class Ks extends nn{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Ks.EXTENSION_NAME="KHR_materials_emissive_strength";const Vs="KHR_materials_emissive_strength";class Us extends Cn{constructor(...e){super(...e),this.extensionName=Vs}createEmissiveStrength(){return new Ks(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Vs]){const n=this.createEmissiveStrength();e.materials[r].setExtension(Vs,n);const s=t.extensions[Vs];void 0!==s.emissiveStrength&&n.setEmissiveStrength(s.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(Vs);if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{},i.extensions[Vs]={emissiveStrength:n.getEmissiveStrength()}}})),this}}Us.EXTENSION_NAME=Vs;class js extends nn{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}js.EXTENSION_NAME="KHR_materials_ior";class Js extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_ior"}createIOR(){return new js(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions.KHR_materials_ior){const n=this.createIOR();e.materials[r].setExtension("KHR_materials_ior",n);const s=t.extensions.KHR_materials_ior;void 0!==s.ior&&n.setIOR(s.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_ior");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{},i.extensions.KHR_materials_ior={ior:n.getIOR()}}})),this}}Js.EXTENSION_NAME="KHR_materials_ior";const{R:Ws,G:Xs}=br;class zs extends nn{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new sn(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new sn(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Ws})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Xs})}}zs.EXTENSION_NAME="KHR_materials_iridescence";class Zs extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_iridescence"}createIridescence(){return new zs(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_iridescence){const s=this.createIridescence();e.materials[n].setExtension("KHR_materials_iridescence",s);const i=t.extensions.KHR_materials_iridescence;if(void 0!==i.iridescenceFactor&&s.setIridescenceFactor(i.iridescenceFactor),void 0!==i.iridescenceIor&&s.setIridescenceIOR(i.iridescenceIor),void 0!==i.iridescenceThicknessMinimum&&s.setIridescenceThicknessMinimum(i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&s.setIridescenceThicknessMaximum(i.iridescenceThicknessMaximum),void 0!==i.iridescenceTexture){const t=i.iridescenceTexture;s.setIridescenceTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getIridescenceTextureInfo(),t)}if(void 0!==i.iridescenceThicknessTexture){const t=i.iridescenceThicknessTexture;s.setIridescenceThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getIridescenceThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_iridescence");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_iridescence={};if(n.getIridescenceFactor()>0&&(o.iridescenceFactor=n.getIridescenceFactor()),1.3!==n.getIridescenceIOR()&&(o.iridescenceIor=n.getIridescenceIOR()),100!==n.getIridescenceThicknessMinimum()&&(o.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),400!==n.getIridescenceThicknessMaximum()&&(o.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const t=n.getIridescenceTexture(),r=n.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(t,r)}if(n.getIridescenceThicknessTexture()){const t=n.getIridescenceThicknessTexture(),r=n.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Zs.EXTENSION_NAME="KHR_materials_iridescence";const{R:qs,G:Ys,B:Qs,A:$s}=br;class ei extends nn{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new sn(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new sn(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ir.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ir.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:qs|Ys|Qs|$s})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:qs|Ys|Qs|$s})}}ei.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const ti="KHR_materials_pbrSpecularGlossiness";class ri extends Cn{constructor(...e){super(...e),this.extensionName=ti}createPBRSpecularGlossiness(){return new ei(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions[ti]){const s=this.createPBRSpecularGlossiness();e.materials[n].setExtension(ti,s);const i=t.extensions[ti];if(void 0!==i.diffuseFactor&&s.setDiffuseFactor(i.diffuseFactor),void 0!==i.specularFactor&&s.setSpecularFactor(i.specularFactor),void 0!==i.glossinessFactor&&s.setGlossinessFactor(i.glossinessFactor),void 0!==i.diffuseTexture){const t=i.diffuseTexture;s.setDiffuseTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getDiffuseTextureInfo(),t)}if(void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;s.setSpecularGlossinessTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(ti);if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions[ti]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const t=n.getDiffuseTexture(),r=n.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularGlossinessTexture()){const t=n.getSpecularGlossinessTexture(),r=n.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}})),this}}ri.EXTENSION_NAME=ti;const{R:ni,G:si,B:ii,A:oi}=br;class ai extends nn{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new sn(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new sn(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ir.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ir.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:ni|si|ii})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:oi})}}ai.EXTENSION_NAME="KHR_materials_sheen";class li extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_sheen"}createSheen(){return new ai(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_sheen){const s=this.createSheen();e.materials[n].setExtension("KHR_materials_sheen",s);const i=t.extensions.KHR_materials_sheen;if(void 0!==i.sheenColorFactor&&s.setSheenColorFactor(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&s.setSheenRoughnessFactor(i.sheenRoughnessFactor),void 0!==i.sheenColorTexture){const t=i.sheenColorTexture;s.setSheenColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getSheenColorTextureInfo(),t)}if(void 0!==i.sheenRoughnessTexture){const t=i.sheenRoughnessTexture;s.setSheenRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_sheen");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_sheen={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const t=n.getSheenColorTexture(),r=n.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,r)}if(n.getSheenRoughnessTexture()){const t=n.getSheenRoughnessTexture(),r=n.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}})),this}}li.EXTENSION_NAME="KHR_materials_sheen";const{R:ci,G:ui,B:hi,A:pi}=br;class di extends nn{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new sn(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new sn(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ir.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ir.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:pi})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:ci|ui|hi})}}di.EXTENSION_NAME="KHR_materials_specular";class fi extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_specular"}createSpecular(){return new di(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_specular){const s=this.createSpecular();e.materials[n].setExtension("KHR_materials_specular",s);const i=t.extensions.KHR_materials_specular;if(void 0!==i.specularFactor&&s.setSpecularFactor(i.specularFactor),void 0!==i.specularColorFactor&&s.setSpecularColorFactor(i.specularColorFactor),void 0!==i.specularTexture){const t=i.specularTexture;s.setSpecularTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getSpecularTextureInfo(),t)}if(void 0!==i.specularColorTexture){const t=i.specularColorTexture;s.setSpecularColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_specular");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_specular={};if(1!==n.getSpecularFactor()&&(o.specularFactor=n.getSpecularFactor()),Nr.eq(n.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),r=n.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),r=n.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(t,r)}}})),this}}fi.EXTENSION_NAME="KHR_materials_specular";const{R:gi,G:mi,B:Ai,A:vi}=br;class Bi extends nn{init(){this.extensionName="KHR_materials_translucency",this.propertyType="Translucency",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{translucencyFactor:1,translucencyTexture:null,translucencyTextureInfo:new sn(this.graph,"translucencyTextureInfo"),translucencyColorFactor:[1,1,1],translucencyColorTexture:null,translucencyColorTextureInfo:new sn(this.graph,"translucencyColorTextureInfo")})}getTranslucencyFactor(){return this.get("translucencyFactor")}setTranslucencyFactor(e){return this.set("translucencyFactor",e)}getTranslucencyColorFactor(){return this.get("translucencyColorFactor")}setTranslucencyColorFactor(e){return this.set("translucencyColorFactor",e)}getTranslucencyColorHex(){return Ir.factorToHex(this.getTranslucencyColorFactor())}setTranslucencyColorHex(e){const t=this.getTranslucencyColorFactor().slice();return this.set("translucencyColorFactor",Ir.hexToFactor(e,t))}getTranslucencyTexture(){return this.getRef("translucencyTexture")}getTranslucencyTextureInfo(){return this.getRef("translucencyTexture")?this.getRef("translucencyTextureInfo"):null}setTranslucencyTexture(e){return this.setRef("translucencyTexture",e,{channels:vi})}getTranslucencyColorTexture(){return this.getRef("translucencyColorTexture")}getTranslucencyColorTextureInfo(){return this.getRef("translucencyColorTexture")?this.getRef("translucencyColorTextureInfo"):null}setTranslucencyColorTexture(e){return this.setRef("translucencyColorTexture",e,{channels:gi|mi|Ai})}}Bi.EXTENSION_NAME="KHR_materials_translucency";class _i extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_translucency"}createTranslucency(){return new Bi(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_translucency){const s=this.createTranslucency();e.materials[n].setExtension("KHR_materials_translucency",s);const i=t.extensions.KHR_materials_translucency;if(void 0!==i.translucencyFactor&&s.setTranslucencyFactor(i.translucencyFactor),void 0!==i.translucencyColorFactor&&s.setTranslucencyColorFactor(i.translucencyColorFactor),void 0!==i.translucencyTexture){const t=i.translucencyTexture;s.setTranslucencyTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getTranslucencyTextureInfo(),t)}if(void 0!==i.translucencyColorTexture){const t=i.translucencyColorTexture;s.setTranslucencyColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getTranslucencyColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_translucency");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_translucency={};if(1!==n.getTranslucencyFactor()&&(o.translucencyFactor=n.getTranslucencyFactor()),Nr.eq(n.getTranslucencyColorFactor(),[1,1,1])||(o.translucencyColorFactor=n.getTranslucencyColorFactor()),n.getTranslucencyTexture()){const t=n.getTranslucencyTexture(),r=n.getTranslucencyTextureInfo();o.translucencyTexture=e.createTextureInfoDef(t,r)}if(n.getTranslucencyColorTexture()){const t=n.getTranslucencyColorTexture(),r=n.getTranslucencyColorTextureInfo();o.translucencyColorTexture=e.createTextureInfoDef(t,r)}}})),this}}_i.EXTENSION_NAME="KHR_materials_translucency";const{R:Ci}=br;class bi extends nn{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new sn(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Ci})}}bi.EXTENSION_NAME="KHR_materials_transmission";class wi extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_transmission"}createTransmission(){return new bi(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_transmission){const s=this.createTransmission();e.materials[n].setExtension("KHR_materials_transmission",s);const i=t.extensions.KHR_materials_transmission;if(void 0!==i.transmissionFactor&&s.setTransmissionFactor(i.transmissionFactor),void 0!==i.transmissionTexture){const t=i.transmissionTexture;s.setTransmissionTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_transmission");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_transmission={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const t=n.getTransmissionTexture(),r=n.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,r)}}})),this}}wi.EXTENSION_NAME="KHR_materials_transmission";class Ei extends nn{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Br.MATERIAL]}}Ei.EXTENSION_NAME="KHR_materials_unlit";class xi extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_unlit"}createUnlit(){return new Ei(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{t.extensions&&t.extensions.KHR_materials_unlit&&e.materials[r].setExtension("KHR_materials_unlit",this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{if(r.getExtension("KHR_materials_unlit")){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions.KHR_materials_unlit={}}})),this}}xi.EXTENSION_NAME="KHR_materials_unlit";class yi extends nn{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}yi.EXTENSION_NAME="KHR_materials_variants";class Di extends nn{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Br.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Di.EXTENSION_NAME="KHR_materials_variants";class Ti extends nn{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Ti.EXTENSION_NAME="KHR_materials_variants";class Ii extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_variants"}createMappingList(){return new Di(this.document.getGraph())}createVariant(e=""){return new Ti(this.document.getGraph(),e)}createMapping(){return new yi(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof Ti))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions.KHR_materials_variants)return this;const r=(t.json.extensions.KHR_materials_variants.variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,n)=>{const s=e.meshes[n];(t.primitives||[]).forEach(((t,n)=>{if(!t.extensions||!t.extensions.KHR_materials_variants)return;const i=this.createMappingList(),o=t.extensions.KHR_materials_variants;for(const t of o.mappings){const n=this.createMapping();void 0!==t.material&&n.setMaterial(e.materials[t.material]);for(const e of t.variants||[])n.addVariant(r[e]);i.addMapping(n)}s.listPrimitives()[n].setExtension("KHR_materials_variants",i)}))})),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const n=[],s=new Map;for(const t of r)s.set(t,n.length),n.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const r=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,n)=>{const i=t.getExtension("KHR_materials_variants");if(!i)return;const o=e.jsonDoc.json.meshes[r].primitives[n],a=i.listMappings().map((t=>{const r=e.createPropertyDef(t),n=t.getMaterial();return n&&(r.material=e.materialIndexMap.get(n)),r.variants=t.listVariants().map((e=>s.get(e))),r}));o.extensions=o.extensions||{},o.extensions.KHR_materials_variants={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions.KHR_materials_variants={variants:n},this}}Ii.EXTENSION_NAME="KHR_materials_variants";const{G:Ri}=br;class Fi extends nn{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Br.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new sn(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Ri})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ir.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Ir.hexToFactor(e,t))}}Fi.EXTENSION_NAME="KHR_materials_volume";class Mi extends Cn{constructor(...e){super(...e),this.extensionName="KHR_materials_volume"}createVolume(){return new Fi(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_volume){const s=this.createVolume();e.materials[n].setExtension("KHR_materials_volume",s);const i=t.extensions.KHR_materials_volume;if(void 0!==i.thicknessFactor&&s.setThicknessFactor(i.thicknessFactor),void 0!==i.attenuationDistance&&s.setAttenuationDistance(i.attenuationDistance),void 0!==i.attenuationColor&&s.setAttenuationColor(i.attenuationColor),void 0!==i.thicknessTexture){const t=i.thicknessTexture;s.setThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(s.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension("KHR_materials_volume");if(n){const s=e.materialIndexMap.get(r),i=t.json.materials[s];i.extensions=i.extensions||{};const o=i.extensions.KHR_materials_volume={};if(n.getThicknessFactor()>0&&(o.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(o.attenuationDistance=n.getAttenuationDistance()),Nr.eq(n.getAttenuationColor(),[1,1,1])||(o.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),r=n.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}Mi.EXTENSION_NAME="KHR_materials_volume";class Pi extends Cn{constructor(...e){super(...e),this.extensionName="KHR_mesh_quantization"}read(e){return this}write(e){return this}}Pi.EXTENSION_NAME="KHR_mesh_quantization";class Si{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=Wn(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Wn(e).dataFormatDescriptor[0];if(t.colorModel===Nn.ETC1S)return 2===t.samples.length&&15==(15&t.samples[1].channelID)?4:3;if(t.colorModel===Nn.UASTC)return 3==(15&t.samples[0].channelID)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=Wn(e),r=this.getChannels(e)>3;let n=0;for(let e=0;e<t.levels.length;e++){const s=t.levels[e];n+=s.uncompressedByteLength?s.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(r?16:8)}return n}}class Li extends Cn{constructor(...e){super(...e),this.extensionName="KHR_texture_basisu",this.prereadTypes=[Br.TEXTURE]}static register(){Fr.registerFormat("image/ktx2",new Si)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions.KHR_texture_basisu&&(e.source=e.extensions.KHR_texture_basisu.source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/ktx2"===r.getMimeType()){const n=e.imageIndexMap.get(r);t.json.textures.forEach((e=>{e.source===n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_basisu={source:e.source},delete e.source)}))}})),this}}Li.EXTENSION_NAME="KHR_texture_basisu";class Oi extends nn{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Br.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Oi.EXTENSION_NAME="KHR_texture_transform";class Ni extends Cn{constructor(...e){super(...e),this.extensionName="KHR_texture_transform"}createTransform(){return new Oi(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions.KHR_texture_transform)continue;const e=this.createTransform(),n=r.extensions.KHR_texture_transform;void 0!==n.offset&&e.setOffset(n.offset),void 0!==n.rotation&&e.setRotation(n.rotation),void 0!==n.scale&&e.setScale(n.scale),void 0!==n.texCoord&&e.setTexCoord(n.texCoord),t.setExtension("KHR_texture_transform",e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,r]of t){const t=e.getExtension("KHR_texture_transform");if(!t)continue;r.extensions=r.extensions||{};const n={},s=Nr.eq;s(t.getOffset(),[0,0])||(n.offset=t.getOffset()),0!==t.getRotation()&&(n.rotation=t.getRotation()),s(t.getScale(),[1,1])||(n.scale=t.getScale()),null!=t.getTexCoord()&&(n.texCoord=t.getTexCoord()),r.extensions.KHR_texture_transform=n}return this}}Ni.EXTENSION_NAME="KHR_texture_transform";const ki=[Br.ROOT,Br.SCENE,Br.NODE,Br.MESH,Br.MATERIAL,Br.TEXTURE,Br.ANIMATION];class Hi extends nn{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=ki}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Zn({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=Zn({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return Zn({"@context":Gi(this.get("context"))},Gi(this.get("properties")))}fromJSONLD(e){const t=(e=Gi(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function Gi(e){return JSON.parse(JSON.stringify(e))}Hi.EXTENSION_NAME="KHR_xmp_json_ld";class Ki extends Cn{constructor(...e){super(...e),this.extensionName="KHR_xmp_json_ld"}createPacket(){return new Hi(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t.KHR_xmp_json_ld;if(!r||!r.packets)return this;const n=e.jsonDoc.json,s=this.document.getRoot(),i=r.packets.map((e=>this.createPacket().fromJSONLD(e))),o=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],a=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let e=0;e<o.length;e++){const t=o[e]||[];for(let r=0;r<t.length;r++){const n=t[r];n.extensions&&n.extensions.KHR_xmp_json_ld&&a[e][r].setExtension("KHR_xmp_json_ld",i[n.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const n of this.properties){r.push(n.toJSONLD());for(const s of n.listParents()){let n;switch(s.propertyType){case Br.ROOT:n=t.asset;break;case Br.SCENE:n=t.scenes[e.sceneIndexMap.get(s)];break;case Br.NODE:n=t.nodes[e.nodeIndexMap.get(s)];break;case Br.MESH:n=t.meshes[e.meshIndexMap.get(s)];break;case Br.MATERIAL:n=t.materials[e.materialIndexMap.get(s)];break;case Br.TEXTURE:n=t.images[e.imageIndexMap.get(s)];break;case Br.ANIMATION:n=t.animations[e.animationIndexMap.get(s)];break;default:n=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${s.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions.KHR_xmp_json_ld={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions.KHR_xmp_json_ld={packets:r}),this}}Ki.EXTENSION_NAME="KHR_xmp_json_ld";const Vi=[zn,us,ps,...[Ts,Fs,Ls,Gs,Us,Js,Zs,ri,fi,li,_i,wi,xi,Ii,Mi,Pi,Li,Ni,Ki]];var Ui={};Ui=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t};var ji;
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */function Ji(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}ji=function(e){return null!=e&&(Ji(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Ji(e.slice(0,0))}(e)||!!e._isBuffer)};var Wi="undefined"!=typeof Float64Array;function Xi(e,t){return e[0]-t[0]}function zi(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(Xi);var n=new Array(r.length);for(e=0;e<n.length;++e)n[e]=r[e][1];return n}function Zi(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var s="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(s)()}if(0===t){s="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",s)(qi[e][0])}s=["'use strict'"];var i=Ui(t),o=i.map((function(e){return"i"+e})),a="this.offset+"+i.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=i.map((function(e){return"b"+e})).join(","),c=i.map((function(e){return"c"+e})).join(",");s.push("function "+r+"(a,"+l+","+c+",d){this.data=a","this.shape=["+l+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),s.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+i.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),t<4?(s.push("function "+r+"_order(){"),2===t?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+r+"_set("+o.join(",")+",v){"),n?s.push("return this.data.set("+a+",v)}"):s.push("return this.data["+a+"]=v}"),s.push("proto.get=function "+r+"_get("+o.join(",")+"){"),n?s.push("return this.data.get("+a+")}"):s.push("return this.data["+a+"]}"),s.push("proto.index=function "+r+"_index(",o.join(),"){return "+a+"}"),s.push("proto.hi=function "+r+"_hi("+o.join(",")+"){return new "+r+"(this.data,"+i.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+i.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var u=i.map((function(e){return"a"+e+"=this.shape["+e+"]"})),h=i.map((function(e){return"c"+e+"=this.stride["+e+"]"}));s.push("proto.lo=function "+r+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+h.join(","));for(var p=0;p<t;++p)s.push("if(typeof i"+p+"==='number'&&i"+p+">=0){d=i"+p+"|0;b+=c"+p+"*d;a"+p+"-=d}");s.push("return new "+r+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"c"+e})).join(",")+",b)}"),s.push("proto.step=function "+r+"_step("+o.join(",")+"){var "+i.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+i.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(p=0;p<t;++p)s.push("if(typeof i"+p+"==='number'){d=i"+p+"|0;if(d<0){c+=b"+p+"*(a"+p+"-1);a"+p+"=ceil(-a"+p+"/d)}else{a"+p+"=ceil(a"+p+"/d)}b"+p+"*=d}");s.push("return new "+r+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"b"+e})).join(",")+",c)}");var d=new Array(t),f=new Array(t);for(p=0;p<t;++p)d[p]="a[i"+p+"]",f[p]="b[i"+p+"]";s.push("proto.transpose=function "+r+"_transpose("+o+"){"+o.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+d.join(",")+","+f.join(",")+",this.offset)}"),s.push("proto.pick=function "+r+"_pick("+o+"){var a=[],b=[],c=this.offset");for(p=0;p<t;++p)s.push("if(typeof i"+p+"==='number'&&i"+p+">=0){c=(c+this.stride["+p+"]*i"+p+")|0}else{a.push(this.shape["+p+"]);b.push(this.stride["+p+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+i.map((function(e){return"shape["+e+"]"})).join(",")+","+i.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(qi[e],zi)}var qi={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};var Yi={},Qi={},$i={},eo={},to={};function ro(e,t,r){var n,s,i=e.length,o=t.arrayArgs.length,a=t.indexArgs.length>0,l=[],c=[],u=0,h=0;for(n=0;n<i;++n)c.push(["i",n,"=0"].join(""));for(s=0;s<o;++s)for(n=0;n<i;++n)h=u,u=e[n],0===n?c.push(["d",s,"s",n,"=t",s,"p",u].join("")):c.push(["d",s,"s",n,"=(t",s,"p",u,"-s",h,"*t",s,"p",h,")"].join(""));for(c.length>0&&l.push("var "+c.join(",")),n=i-1;n>=0;--n)u=e[n],l.push(["for(i",n,"=0;i",n,"<s",u,";++i",n,"){"].join(""));for(l.push(r),n=0;n<i;++n){for(h=u,u=e[n],s=0;s<o;++s)l.push(["p",s,"+=d",s,"s",n].join(""));a&&(n>0&&l.push(["index[",h,"]-=s",h].join("")),l.push(["++index[",u,"]"].join(""))),l.push("}")}return l.join("\n")}function no(e,t,r){for(var n=e.body,s=[],i=[],o=0;o<e.args.length;++o){var a=e.args[o];if(!(a.count<=0)){var l=new RegExp(a.name,"g"),c="",u=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var h=t.offsetArgIndex.indexOf(o);u=t.offsetArgs[h].array,c="+q"+h;case"array":c="p"+u+c;var p="l"+o,d="a"+u;if(0===t.arrayBlockIndices[u])1===a.count?"generic"===r[u]?a.lvalue?(s.push(["var ",p,"=",d,".get(",c,")"].join("")),n=n.replace(l,p),i.push([d,".set(",c,",",p,")"].join(""))):n=n.replace(l,[d,".get(",c,")"].join("")):n=n.replace(l,[d,"[",c,"]"].join("")):"generic"===r[u]?(s.push(["var ",p,"=",d,".get(",c,")"].join("")),n=n.replace(l,p),a.lvalue&&i.push([d,".set(",c,",",p,")"].join(""))):(s.push(["var ",p,"=",d,"[",c,"]"].join("")),n=n.replace(l,p),a.lvalue&&i.push([d,"[",c,"]=",p].join("")));else{for(var f=[a.name],g=[c],m=0;m<Math.abs(t.arrayBlockIndices[u]);m++)f.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(m+1)+"*t"+u+"b"+m);if(l=new RegExp(f.join(""),"g"),c=g.join("+"),"generic"===r[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(l,[d,"[",c,"]"].join(""))}break;case"scalar":n=n.replace(l,"Y"+t.scalarArgs.indexOf(o));break;case"index":n=n.replace(l,"index");break;case"shape":n=n.replace(l,"shape")}}}return[s.join("\n"),n,i.join("\n")].join("\n").trim()}function so(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var s=e[n],i=s.match(/\d+/);i=i?i[0]:"",0===s.charAt(0)?t[n]="u"+s.charAt(1)+i:t[n]=s.charAt(0)+i,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}function io(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}to=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,s=e[0],i=e[0],o=1;o<n;++o)if(i=s,t(s=e[o],i)){if(o===r){r++;continue}e[r++]=s}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],s=e[0],i=1;i<r;++i,s=n)if(s=n,(n=e[i])!==s){if(i===t){t++;continue}e[t++]=n}return e.length=t,e}(e))},eo=function(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,n=new Array(e.arrayArgs.length),s=new Array(e.arrayArgs.length),i=0;i<e.arrayArgs.length;++i)s[i]=t[2*i],n[i]=t[2*i+1];var o=[],a=[],l=[],c=[],u=[];for(i=0;i<e.arrayArgs.length;++i){e.arrayBlockIndices[i]<0?(l.push(0),c.push(r),o.push(r),a.push(r+e.arrayBlockIndices[i])):(l.push(e.arrayBlockIndices[i]),c.push(e.arrayBlockIndices[i]+r),o.push(0),a.push(e.arrayBlockIndices[i]));for(var h=[],p=0;p<n[i].length;p++)l[i]<=n[i][p]&&n[i][p]<c[i]&&h.push(n[i][p]-l[i]);u.push(h)}var d=["SS"],f=["'use strict'"],g=[];for(p=0;p<r;++p)g.push(["s",p,"=SS[",p,"]"].join(""));for(i=0;i<e.arrayArgs.length;++i){d.push("a"+i),d.push("t"+i),d.push("p"+i);for(p=0;p<r;++p)g.push(["t",i,"p",p,"=t",i,"[",l[i]+p,"]"].join(""));for(p=0;p<Math.abs(e.arrayBlockIndices[i]);++p)g.push(["t",i,"b",p,"=t",i,"[",o[i]+p,"]"].join(""))}for(i=0;i<e.scalarArgs.length;++i)d.push("Y"+i);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var m=new Array(r);for(i=0;i<r;++i)m[i]="0";g.push(["index=[",m.join(","),"]"].join(""))}for(i=0;i<e.offsetArgs.length;++i){var A=e.offsetArgs[i],v=[];for(p=0;p<A.offset.length;++p)0!==A.offset[p]&&(1===A.offset[p]?v.push(["t",A.array,"p",p].join("")):v.push([A.offset[p],"*t",A.array,"p",p].join("")));0===v.length?g.push("q"+i+"=0"):g.push(["q",i,"=",v.join("+")].join(""))}var B=to([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((g=g.concat(B)).length>0&&f.push("var "+g.join(",")),i=0;i<e.arrayArgs.length;++i)f.push("p"+i+"|=0");e.pre.body.length>3&&f.push(no(e.pre,e,s));var _=no(e.body,e,s),C=function(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}(u);C<r?f.push(function(e,t,r,n){for(var s=t.length,i=r.arrayArgs.length,o=r.blockSize,a=r.indexArgs.length>0,l=[],c=0;c<i;++c)l.push(["var offset",c,"=p",c].join(""));for(c=e;c<s;++c)l.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),l.push(["if(j",c,"<",o,"){"].join("")),l.push(["s",t[c],"=j",c].join("")),l.push(["j",c,"=0"].join("")),l.push(["}else{s",t[c],"=",o].join("")),l.push(["j",c,"-=",o,"}"].join("")),a&&l.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<i;++c){for(var u=["offset"+c],h=e;h<s;++h)u.push(["j",h,"*t",c,"p",t[h]].join(""));l.push(["p",c,"=(",u.join("+"),")"].join(""))}for(l.push(ro(t,r,n)),c=e;c<s;++c)l.push("}");return l.join("\n")}(C,u[0],e,_)):f.push(ro(u[0],e,_)),e.post.body.length>3&&f.push(no(e.post,e,s)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+f.join("\n")+"\n----------");var b=[e.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",C,so(s)].join("");return new Function(["function ",b,"(",d.join(","),"){",f.join("\n"),"} return ",b].join(""))()},$i=function(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var s=[],i=[],o=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],a=[],l=[],c=0;c<e.arrayArgs.length;++c){var u=e.arrayArgs[c];r.push(["t",u,"=array",u,".dtype,","r",u,"=array",u,".order"].join("")),s.push("t"+u),s.push("r"+u),i.push("t"+u),i.push("r"+u+".join()"),o.push("array"+u+".data"),o.push("array"+u+".stride"),o.push("array"+u+".offset|0"),c>0&&(a.push("array"+e.arrayArgs[0]+".shape.length===array"+u+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+u+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+a.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)o.push("scalar"+e.scalarArgs[c]);return r.push(["type=[",i.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",s.join(","),"])}","return proc(",o.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(eo.bind(void 0,e))},Qi=function(e){var t=new io;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var s=r[n];if("array"===s||"object"==typeof s&&s.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if("index"===s){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+r[n]);t.argTypes[n]="offset",t.offsetArgs.push({array:s.array,offset:s.offset}),t.offsetArgIndex.push(n)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,$i(t)};var oo={body:"",args:[],thisVars:[],localVars:[]};function ao(e){if(!e)return oo;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function lo(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return Qi({args:e.args,pre:ao(e.pre),body:ao(e.body),post:ao(e.proc),funcName:e.funcName})}(e))}var co={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in co){var t=co[e];Yi[e]=lo({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e}),Yi[e+"eq"]=lo({args:["array","array"],body:{args:["a","b"],body:"a"+t+"=b"},rvalue:!0,funcName:e+"eq"}),Yi[e+"s"]=lo({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"}),Yi[e+"seq"]=lo({args:["array","scalar"],body:{args:["a","s"],body:"a"+t+"=s"},rvalue:!0,funcName:e+"seq"})}}();var uo={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in uo){var t=uo[e];Yi[e]=lo({args:["array","array"],body:{args:["a","b"],body:"a="+t+"b"},funcName:e}),Yi[e+"eq"]=lo({args:["array"],body:{args:["a"],body:"a="+t+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var ho={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in ho){var t=ho[e];Yi[e]=lo({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+t+"c"},funcName:e}),Yi[e+"s"]=lo({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+t+"s"},funcName:e+"s"}),Yi[e+"eq"]=lo({args:["array","array"],body:{args:["a","b"],body:"a=a"+t+"b"},rvalue:!0,count:2,funcName:e+"eq"}),Yi[e+"seq"]=lo({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+t+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var po=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<po.length;++e){var t=po[e];Yi[t]=lo({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:t}),Yi[t+"eq"]=lo({args:["array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"})}}();var fo=["max","min","atan2","pow"];!function(){for(var e=0;e<fo.length;++e){var t=fo[e];Yi[t]=lo({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t}),Yi[t+"s"]=lo({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:t+"s"}),Yi[t+"eq"]=lo({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"eq"}),Yi[t+"seq"]=lo({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"seq"})}}();var go=["atan2","pow"];!function(){for(var e=0;e<go.length;++e){var t=go[e];Yi[t+"op"]=lo({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"op"}),Yi[t+"ops"]=lo({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:t+"ops"}),Yi[t+"opeq"]=lo({args:["array","array"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opeq"}),Yi[t+"opseq"]=lo({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+t,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:t+"opseq"})}}(),Yi.any=Qi({args:["array"],pre:oo,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),Yi.all=Qi({args:["array"],pre:oo,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),Yi.sum=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),Yi.prod=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),Yi.norm2squared=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),Yi.norm2=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),Yi.norminf=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),Yi.norm1=Qi({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),Yi.sup=Qi({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),Yi.inf=Qi({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),Yi.argmin=Qi({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),Yi.argmax=Qi({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),Yi.random=lo({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),Yi.assign=lo({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),Yi.assigns=lo({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),Yi.equals=Qi({args:["array","array"],pre:oo,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"});var mo;function Ao(){return(Ao=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function vo(e,t){return Object.defineProperty(t,"name",{value:e}),t}!function(e){e[e.LANCZOS_3=3]="LANCZOS_3",e[e.LANCZOS_2=2]="LANCZOS_2"}(mo||(mo={}));Br.ACCESSOR,Br.MESH,Br.TEXTURE,Br.MATERIAL;const Bo={pattern:/^((?!JOINTS_).)*$/};function _o(e=Bo){const t=Ao({},Bo,e);return vo("dequantize",(e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes())for(const e of r.listPrimitives())Co(e,t);e.createExtension(Pi).dispose(),r.debug("dequantize: Complete.")}))}function Co(e,t){for(const r of e.listSemantics())bo(r,e.getAttribute(r),t);for(const r of e.listTargets())for(const e of r.listSemantics())bo(e,r.getAttribute(e),t)}function bo(e,t,r){if(!t.getArray())return;if(!r.pattern.test(e))return;if(t.getComponentSize()>=4)return;const n=t.getArray(),s=new Float32Array(n.length);for(let e=0,r=t.getCount(),i=[];e<r;e++)i=t.getElement(e,i),t.setArray(s).setElement(e,i).setArray(n);t.setArray(s).setNormalized(!1)}Br.NODE,Br.SKIN,Br.MESH,Br.CAMERA,Br.PRIMITIVE,Br.PRIMITIVE_TARGET,Br.ANIMATION,Br.MATERIAL,Br.TEXTURE,Br.ACCESSOR,Br.BUFFER;Int8Array,Int16Array,Int32Array;const{TRANSLATION:wo,ROTATION:Eo,SCALE:xo,WEIGHTS:yo}=$r.TargetPath;var Do;!function(e){e.OXIPNG="oxipng",e.MOZJPEG="mozjpeg",e.WEBP="webp"}(Do||(Do={}));Do.OXIPNG,Do.MOZJPEG,Do.WEBP;const To={formats:/.*/,slots:/.*/,auto:!1};Ao({},To,{codec:Do.WEBP}),Ao({},To,{codec:Do.MOZJPEG,formats:/^image\/jpeg$/}),Ao({},To,{codec:Do.OXIPNG,formats:/^image\/png$/});var Io;!function(e){e.LANCZOS3="lanczos3",e.LANCZOS2="lanczos2"}(Io||(Io={}));Io.LANCZOS3;const Ro={tolerance:1e-4};function Fo(e=Ro){const t=Ao({},Ro,e);return vo("weld",(e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes())for(const n of r.listPrimitives())n.getMode()!==dn.Mode.POINTS&&(0===t.tolerance?Mo(e,n):Po(e,n,t));r.debug("weld: Complete.")}))}function Mo(e,t){if(t.getIndices())return;const r=t.listAttributes()[0],n=r.getCount(),s=r.getBuffer(),i=n<=65534?new Uint16Array(n):new Uint32Array(n),o=e.createAccessor().setBuffer(s).setType(Yr.Type.SCALAR).setArray(i);for(let e=0;e<o.getCount();e++)o.setScalar(e,e);t.setIndices(o)}function Po(e,t,r){const n=Math.max(r.tolerance,Number.EPSILON),s=Math.log10(1/n),i=Math.pow(10,s),o={},a=t.getIndices(),l=a?a.getCount():t.listAttributes()[0].getCount(),c=new Map;t.listAttributes().forEach((e=>c.set(e,[]))),t.listTargets().forEach((e=>{e.listAttributes().forEach((e=>c.set(e,[])))}));const u=[];let h=0;for(let e=0;e<l;e++){const r=a?a.getScalar(e):e,n=[],s=[];for(const e of t.listAttributes())for(let t=0;t<e.getElementSize();t++)n.push(~~(e.getElement(r,s)[t]*i));const l=n.join("|");if(l in o)u.push(o[l]);else{for(const e of t.listAttributes())c.get(e).push(e.getElement(r,[]));for(const e of t.listTargets())for(const t of e.listAttributes())c.get(t).push(t.getElement(r,[]));o[l]=h,u.push(h),h++}}const p=t.listAttributes()[0].getCount(),d=c.get(t.getAttribute("POSITION")).length;e.getLogger().debug(`weld: ${p}  ${d} vertices.`);for(const e of t.listAttributes())Lo(t,e,c.get(e)),1===e.listParents().length&&e.dispose();for(const e of t.listTargets())for(const t of e.listAttributes())Lo(e,t,c.get(t)),1===t.listParents().length&&t.dispose();if(a){const e=So(a.getArray(),u.length);e.set(u),t.setIndices(a.clone().setArray(e)),1===a.listParents().length&&a.dispose()}else{const r=p<=65534?new Uint16Array(u):new Uint32Array(u);t.setIndices(e.createAccessor().setArray(r))}}function So(e,t){return new e.constructor(t)}function Lo(e,t,r){const n=r.length*t.getElementSize(),s=So(t.getArray(),n),i=t.clone().setArray(s);for(let e=0;e<r.length;e++)i.setElement(e,r[e]);e.swap(t,i)}var Oo=function(){var e,t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};function r(e){if(!e)throw new Error("Assertion failed")}function n(t,r,n,s,i){var o=e.exports.sbrk,a=o(r),l=o(s*i),c=new Uint8Array(e.exports.memory.buffer);c.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),l);var u=t(a,r,l,s,i),h=new Uint8Array(u);return h.set(c.subarray(a,a+u)),o(a-o(0)),h}function s(e){for(var t=0,r=0;r<e.length;++r){var n=e[r];t=t<n?n:t}return t}function i(e,t){if(r(2==t||4==t),4==t)return new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4);var n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);return new Uint32Array(n)}function o(t,r,n,s,i,o){var a=e.exports.sbrk,l=a(n*s),c=a(n*o),u=new Uint8Array(e.exports.memory.buffer);u.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),c),t(l,n,s,i,c);var h=new Uint8Array(n*s);return h.set(u.subarray(l,l+n*s)),a(l-a(0)),h}return{ready:WebAssembly.instantiate(function(e){for(var r=new Uint8Array(e.length),n=0;n<e.length;++n){var s=e.charCodeAt(n);r[n]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}var i=0;for(n=0;n<e.length;++n)r[i++]=r[n]<60?t[r[n]]:64*(r[n]-60)+r[++n];return r.buffer.slice(0,i)}("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"),{}).then((function(t){(e=t.instance).exports.__wasm_call_ctors(),e.exports.meshopt_encodeVertexVersion(0),e.exports.meshopt_encodeIndexVersion(1)})),supported:!0,reorderMesh:function(t,r,n){var i=r?n?e.exports.meshopt_optimizeVertexCacheStrip:e.exports.meshopt_optimizeVertexCache:void 0;return function(t,r,n){var s=e.exports.sbrk,i=s(4*t.length),o=s(4*r),a=new Uint8Array(e.exports.memory.buffer),l=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);a.set(l,i),n&&n(i,i,t.length,r);var c=e.exports.meshopt_optimizeVertexFetchRemap(o,i,t.length,r);a=new Uint8Array(e.exports.memory.buffer);var u=new Uint32Array(r);new Uint8Array(u.buffer).set(a.subarray(o,o+4*r)),l.set(a.subarray(i,i+4*t.length)),s(i-s(0));for(var h=0;h<t.length;++h)t[h]=u[t[h]];return[u,c]}(t,s(t)+1,i)},encodeVertexBuffer:function(t,s,i){r(i>0&&i<=256),r(i%4==0);var o=e.exports.meshopt_encodeVertexBufferBound(s,i);return n(e.exports.meshopt_encodeVertexBuffer,o,t,s,i)},encodeIndexBuffer:function(t,o,a){r(2==a||4==a),r(o%3==0);var l=i(t,a),c=e.exports.meshopt_encodeIndexBufferBound(o,s(l)+1);return n(e.exports.meshopt_encodeIndexBuffer,c,l,o,4)},encodeIndexSequence:function(t,o,a){r(2==a||4==a);var l=i(t,a),c=e.exports.meshopt_encodeIndexSequenceBound(o,s(l)+1);return n(e.exports.meshopt_encodeIndexSequence,c,l,o,4)},encodeGltfBuffer:function(e,t,n,s){var i={ATTRIBUTES:this.encodeVertexBuffer,TRIANGLES:this.encodeIndexBuffer,INDICES:this.encodeIndexSequence};return r(i[s]),i[s](e,t,n)},encodeFilterOct:function(t,n,s,i){return r(4==s||8==s),r(i>=1&&i<=16),o(e.exports.meshopt_encodeFilterOct,t,n,s,i,16)},encodeFilterQuat:function(t,n,s,i){return r(8==s),r(i>=4&&i<=16),o(e.exports.meshopt_encodeFilterQuat,t,n,s,i,16)},encodeFilterExp:function(t,n,s,i){return r(s>0&&s%4==0),r(i>=1&&i<=24),o(e.exports.meshopt_encodeFilterExp,t,n,s,i,s)}}}(),No=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var r,n="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";WebAssembly.validate(e)&&(n="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");var s=WebAssembly.instantiate(function(e){for(var r=new Uint8Array(e.length),n=0;n<e.length;++n){var s=e.charCodeAt(n);r[n]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}var i=0;for(n=0;n<e.length;++n)r[i++]=r[n]<60?t[r[n]]:64*(r[n]-60)+r[++n];return r.buffer.slice(0,i)}(n),{}).then((function(e){(r=e.instance).exports.__wasm_call_ctors()}));function i(e,t,n,s,i,o){var a=r.exports.sbrk,l=n+3&-4,c=a(l*s),u=a(i.length),h=new Uint8Array(r.exports.memory.buffer);h.set(i,u);var p=e(c,n,s,u,i.length);if(0==p&&o&&o(c,l,s),t.set(h.subarray(c,c+n*s)),a(c-a(0)),0!=p)throw new Error("Malformed buffer data: "+p)}var o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},a={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:s,supported:!0,decodeVertexBuffer:function(e,t,n,s,a){i(r.exports.meshopt_decodeVertexBuffer,e,t,n,s,r.exports[o[a]])},decodeIndexBuffer:function(e,t,n,s){i(r.exports.meshopt_decodeIndexBuffer,e,t,n,s)},decodeIndexSequence:function(e,t,n,s){i(r.exports.meshopt_decodeIndexSequence,e,t,n,s)},decodeGltfBuffer:function(e,t,n,s,l,c){i(r.exports[a[l]],e,t,n,s,r.exports[o[c]])}}}();async function ko(e,t){await No.ready,await Oo.ready;const r=(new Mn).registerExtensions(Vi).setVertexLayout(_r.SEPARATE).registerDependencies({"meshopt.decoder":No,"meshopt.encoder":Oo});function n(e){return e.split(".").pop()}async function s(e){const t={};let r={};for(let[s,i]of e){const e=await i.arrayBuffer();if("gltf"==n(i.name)){const e=await i.text();r=JSON.parse(e)}else t[s.slice(1)]=new Uint8Array(e)}return{json:r,resources:t}}let i={};for(let t of e){const o=t[1];if("glb"===n(o.name)){const e=await o.arrayBuffer();i=await r.readBinary(new Uint8Array(e))}if("gltf"===n(o.name)){const t=await s(e);i=await r.readJSON(t)}}await i.transform(_o(),Fo());return Ho((await r.writeBinary(i)).buffer,t)}function Ho(e,t){var r=new je.GLTFLoader;r.setMeshoptDecoder(No);var n=new ze;return n.setTranscoderPath("three/examples/js/libs/basis/"),r.setKTX2Loader(n),new Promise(((n,s)=>{r.parse(e,"",(e=>{const r=e.scene||e.scenes[0];if(r||s(new Error("This model contains no scene, and cannot be viewed.")),t){var i=(new He.Box3).setFromObject(r);const e=Math.min(i.min.x,Math.min(i.min.y,i.min.z));let t=1/(Math.max(i.max.x,Math.max(i.max.y,i.max.z))-e);r.scale.set(t,t,t)}r.updateMatrixWorld(),n(e)}),(e=>{s(new Error("Error loading glTF scene: "+e))}))}))}window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");class Go extends o.EventEmitter{autoScaleScene=!1;interactionTimeoutId=null;get renderer(){return this._renderer}_fps=0;get fps(){return this._fps}get autoRotate(){return this.controls.autoRotate}set autoRotate(e){this.toggleInteractionMode(e),this.controls.autoRotate=e}_pathtracing=!0;get togglePathtracing(){return this._pathtracing}set togglePathtracing(e){e?this.startPathtracing():this.startRasterizer(),this._pathtracing=e}_pixelRatio=1;get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e,this._renderer.pixelRatio=e}_pathtracedInteraction=!0;get pathtracedInteraction(){return this._pathtracedInteraction}set pathtracedInteraction(e){this._pathtracedInteraction=e}_interactionPixelRatio=.1;set interactionPixelRatio(e){this._interactionPixelRatio=e}get interactionPixelRatio(){return this._interactionPixelRatio}_showGroundPlane=!1;set showGroundPlane(e){this._showGroundPlane=e}_tileRes=4;set tileRes(e){this._tileRes=e,this._renderer.tileRes=e}get tileRes(){return this._tileRes}constructor(e){super(),this.container=e.container,document.body.appendChild(this.container),this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.startpage=document.getElementById("startpage"),this.loadscreen=document.getElementById("loadscreen"),this.status=document.getElementById("status"),this.spinner=document.getElementsByClassName("spinner")[0],this.canvas_pt=document.createElement("canvas"),this.canvas_three=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas_pt.width=window.innerWidth,this.canvas_pt.height=window.innerHeight,this.canvas_three.width=window.innerWidth,this.canvas_three.height=window.innerHeight;let t=window.innerWidth/window.innerHeight;this.camera=new He.PerspectiveCamera(45,t,.01,1e3),this.controls=new Ue.OrbitControls(this.camera,this.canvas),this.controls.screenSpacePanning=!0,this.controls.enableDamping=!1,this.controls.rotateSpeed=2,this.controls.panSpeed=2,this.controls.addEventListener("change",(()=>{this.camera.updateMatrixWorld(),this._renderer.resetAccumulation()})),this.controls.addEventListener("start",(()=>{this._pathtracing&&(this.pathtracedInteraction?this.toggleInteractionMode(!0):this.startRasterizer())})),this.controls.addEventListener("end",(()=>{this.pathtracedInteraction?this.toggleInteractionMode(!1):(this.startPathtracing(),this.stopRasterizer())})),this.controls.mouseButtons={LEFT:He.MOUSE.ROTATE,MIDDLE:He.MOUSE.PAN,RIGHT:He.MOUSE.DOLLY},this._renderer=new Ke.PathtracingRenderer({canvas:this.canvas_pt}),this.three_renderer=new Ge({canvas:this.canvas_three,powerPreference:"high-performance",alpha:!0}),this._renderer.maxBounces=5,this._renderer.pixelRatio=this.pixelRatio,this._renderer.tileRes=this.tileRes,window.addEventListener("resize",(()=>{this.resize()}),!1);const r=document.createElement("input"),n=new ke(this.startpage,r);n.on("dropstart",(()=>{this.hideStartpage()})),n.on("drop",(async({files:e})=>{await this.loadDropFiles(e)}));new ke(this.canvas,r).on("drop",(async({files:e})=>{await this.loadDropFiles(e)})),this.container.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}))}toggleInteractionMode(e,t){e?(this._renderer.pixelRatio=this.interactionPixelRatio,this._renderer.tileRes=1,t&&!this.interactionTimeoutId&&setTimeout((()=>{this.toggleInteractionMode(!1)}),t)):(this._renderer.pixelRatio=this.pixelRatio,this._renderer.tileRes=this._tileRes)}async loadDropFiles(e){for(const[t,r]of e)if(t.match(/\.hdr$/)&&(this.showStatusScreen("Loading HDR..."),await this.loadIbl(URL.createObjectURL(r)),this.hideLoadscreen()),t.match(/\.glb$/)||t.match(/\.gltf$/)){this.showStatusScreen("Loading Scene...");const t=Array.from(e),r=await ko(t,this.autoScaleScene);await this.loadScene(r)}}async loadSceneFromUrl(e){this.showStatusScreen("Loading Scene...");const t=await async function(e,t){await No.ready,await Oo.ready;const r=(new Mn).registerExtensions(Vi).setVertexLayout(_r.SEPARATE).registerDependencies({"meshopt.decoder":No,"meshopt.encoder":Oo}),n=await r.read(e);return await n.transform(_o(),Fo()),Ho((await r.writeBinary(n)).buffer,t)}(e,this.autoScaleScene);await this.loadScene(t),this.hideStartpage()}async loadScene(e){this.sceneBoundingBox=(new He.Box3).setFromObject(e.scene),this.updateCameraFromBoundingBox(),this.centerView(),this._showGroundPlane&&(this.addGroundPlane(e.scene),this.sceneBoundingBox=(new He.Box3).setFromObject(e.scene)),this.sceneAdapter=new Ke.ThreeSceneAdapter(e.scene,e),await this.sceneAdapter.init(),await this._renderer.setScene(this.sceneAdapter.scene),this._pathtracing&&this.startPathtracing(),this.three_renderer.setScene((new He.Scene).add(e.scene)),this._pathtracing||this.startRasterizer(),this.hideLoadscreen(),this.emit("sceneLoaded",{scene:this.sceneAdapter.scene})}async loadIbl(e){const t=e=>{this._renderer.setIBL(e),this.three_renderer.setIBL(e),this._renderer.useIBL=!0,this.three_renderer.useIBL(!0),this.three_renderer.showBackground=!0,this._renderer.showBackground=!0};if("None"==e)return this._renderer.useIBL=!1,this.three_renderer.showBackground=!1,void(this._renderer.showBackground=!1);console.log(`Loading ${e}`),(new Ve.RGBELoader).setDataType(He.FloatType).loadAsync(e).then((e=>{t(e)}))}addGroundPlane(e){if(!this.sceneBoundingBox)return;const t=new He.Mesh(new He.PlaneBufferGeometry,new He.MeshStandardMaterial({transparent:!1,color:526344,roughness:.15,metalness:1}));t.scale.setScalar(3.1415*(this.sceneBoundingBox.max.x-this.sceneBoundingBox.min.x)),t.rotation.x=-Math.PI/2,t.position.y=this.sceneBoundingBox.min.y-.01,e.add(t)}startRasterizer(){this.stopPathtracing(),this.three_renderer.render(this.camera,(()=>{this.canvas.getContext("2d").drawImage(this.canvas_three,0,0)}))}stopRasterizer(){this.three_renderer.stopRendering()}stopPathtracing(){this._renderer.stopRendering()}lastTimeStamp=0;startPathtracing(){this.stopRasterizer(),this._renderer.render(this.camera,-1,(()=>{(this.controls.update(),this._pathtracing)&&this.canvas.getContext("2d").drawImage(this.canvas_pt,0,0)}),(()=>{const e=performance.now();this._fps=1e3/(e-this.lastTimeStamp),this.lastTimeStamp=e}))}resize(){console.log("resizing",window.innerWidth,window.innerHeight);window.innerWidth,window.innerHeight;this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas_pt.width=window.innerWidth,this.canvas_pt.height=window.innerHeight,this.canvas_three.width=window.innerWidth,this.canvas_three.height=window.innerHeight,this._renderer.resize(window.innerWidth,window.innerHeight),this.three_renderer.resize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}updateCameraFromBoundingBox(){if(!this.sceneBoundingBox)return;this.controls.reset();let e=this.sceneBoundingBox.max.distanceTo(this.sceneBoundingBox.min),t=2*e/Math.tan(45*Math.PI/180),r=new He.Vector3;this.sceneBoundingBox.getCenter(r);let n=r.clone();n.add(new He.Vector3(0,0,t)),n.add(new He.Vector3(0,e,0)),this.camera.position.set(n.x,n.y,n.z),this.camera.lookAt(r),this.camera.updateMatrixWorld(),this.controls.update()}saveImage(){var e=this.canvas.toDataURL("image/png");const t=document.createElement("a");t.download="capture.png",t.href=e,t.click()}centerView(){if(this.controls){let e=new He.Vector3;this.sceneBoundingBox.getCenter(e),this.controls.target=e,this.controls.update(),this._renderer.resetAccumulation()}}showStartpage(){this.startpage.style.visibility="visible"}hideStartpage(){this.startpage.style.visibility="hidden"}showStatusScreen(e){this.status.innerText=e,this.loadscreen.style.visibility="visible",this.spinner.style.visibility="visible"}hideLoadscreen(){this.loadscreen.style.visibility="hidden",this.spinner.style.visibility="hidden"}}const Ko={"Damaged Helmet":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/DamagedHelmet">glTF Sample Model</a> (Original: Battle Damaged Sci-fi Helmet - PBR by <a href"https://sketchfab.com/theblueturtle_">theblueturtle_</a>, on <a href"https://sketchfab.com/models/b81008d513954189a063ff901f7abfe4">Sketchfab</a>.)'},"Tea Time":{url:"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/scenes/teatime/teatime.glb",credit:'by <a href="https://www.artstation.com/jamesray">James Ray Cock</a>, Jurita Burger and <a href="https://www.artstation.com/ricocilliers">Rico Cilliers</a> on <a href="https://polyhaven.com/a/tea_set_01">polyhaven.com</a>'},"Potted Plant":{url:"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/scenes/potted_plant/potted_plant_1k.glb",credit:'by <a href="https://www.artstation.com/ricocilliers">Rico Cilliers</a> on <a href="https://polyhaven.com/a/potted_plant_02">polyhaven.com</a>'},"Dragon Attenuation":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DragonAttenuation/glTF-Binary/DragonAttenuation.glb",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/DragonAttenuation">glTF Sample Model</a>'},"Emissive Strength Test":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/EmissiveStrengthTest/glTF-Binary/EmissiveStrengthTest.glb",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/EmissiveStrengthTest">glTF Sample Model</a> (Copyright 2022 Analytical Graphics, Inc. <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> Model and textures by Ed Mackey)'},"Iridescent Dish With Olives":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescentDishWithOlives/glTF/IridescentDishWithOlives.gltf",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescentDishWithOlives">glTF Sample Model</a>. (Copyright 2021 Wayfair LLC. <a href="https://creativecommons.org/licenses/by/4.0/)">CC BY 4.0 International</a>'},"Iridescence Metallic Spheres":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescenceMetallicSpheres/glTF/IridescenceMetallicSpheres.gltf",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescenceMetallicSpheres">glTF Sample Model</a>.'},"Iridescence Suzanne":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/IridescenceSuzanne/glTF/IridescenceSuzanne.gltf",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/IridescenceSuzanne">glTF Sample Model</a>.'},"Stained Glass Lamp":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/StainedGlassLamp/glTF/StainedGlassLamp.gltf",credit:'Official <a href="https://github.com/KhronosGroup/glTF-Sample-Models/tree/master/2.0/StainedGlassLamp">glTF Sample Model</a>. (Copyright 2021 Wayfair LLC. <a href="https://creativecommons.org/licenses/by/4.0/)">CC BY 4.0 International</a>'}},Vo={"Artist Workshop":{url:"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/artist_workshop_1k.hdr",credit:'by Oliksiy Yakovlyev from <a href="polyhaven.com">polyhaven.com</a> <a href="https://creativecommons.org/publicdomain/zero/1.0/">(CC0)</a>',intensity:1.5},Studio_05:{url:"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/studio_small_05_1k.hdr",credit:'by <a href="https://gregzaal.com/">Greg Zaal</a> from <a href="polyhaven.com">polyhaven.com</a> <a href="https://creativecommons.org/publicdomain/zero/1.0/">(CC0)</a>',intensity:1.5},"Footprint Court":{url:"https://raw.githubusercontent.com/DassaultSystemes-Technology/dspbr-pt/main/assets/ibl/Footprint_Court_Env.hdr",credit:'from <a href="http://www.hdrlabs.com/sibl/archive.html">hdrlabs.com</a> <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">(CC BY-NC-SA 3.0)</a>',intensity:1.5}};window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");new class{_defaultIblKey="Artist Workshop";_currentIbl=this._defaultIblKey;_currentScene="";constructor(){this._container=document.createElement("div"),this._viewer=new Go({container:this._container}),this._renderer=this._viewer.renderer,this._ui=new s.Pane({title:"dspbr-pt"}),this._params=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}),this._viewer.on("sceneLoaded",(e=>{this._scene=e.scene,this.initMaterialSelector(this._params)})),this._params.ground&&(console.log("Param: showGroundPlane => true"),this._viewer.showGroundPlane=!0),this._params.src&&this._viewer.loadSceneFromUrl(this.resolveUrlFromIndex(this._params.src)),this._params.ibl?(console.log(this.resolveUrlFromIndex(this._params.ibl)),this._viewer.loadIbl(this.resolveUrlFromIndex(this._params.ibl))):this._viewer.loadIbl(this.resolveUrlFromIndex(this._defaultIblKey)),this._params.iblRotation&&(console.log(`Param: iblRotation => ${this._params.iblRotation}`),this._renderer.iblRotation=parseFloat(this._params.iblRotation)),this._params.tileRes&&(console.log(`Param: tileRes => ${this._params.tileRes}`),this._viewer.tileRes=parseInt(this._params.tileRes)),this.initUI()}initUI(){this._ui.element.style.width="350px",this._ui.element.style.top="5px",this._ui.element.style.right="5px",this._ui.element.style.position="absolute",this._ui.element.style.zIndex="2",this._uiTabs=this._ui.addTab({pages:[{title:"Parameters"},{title:"Materials"}]});const e=this._uiTabs.pages[0];e.addButton({title:"Center View"}).on("click",(()=>{this._viewer.centerView()})),e.addButton({title:"Save Image"}).on("click",(()=>{this._viewer.saveImage()}));const t=e.addFolder({title:"Scene"}),r=e=>{const t={"":""};for(let r in e)t[e[r]]=e[r];return t};t.addInput(this,"_currentScene",{label:"Scene",options:r(Object.keys(Ko))}).on("change",(e=>{if(""!=e.value){const t=this.resolveUrlFromIndex(e.value);this._viewer.loadSceneFromUrl(t)}})),t.addInput(this._viewer,"autoRotate",{label:"Auto Rotate"});const n=e.addFolder({title:"Lighting"});n.addInput(this,"_currentIbl",{label:"IBL",options:r(Object.keys(Vo))}).on("change",(e=>{const t=this.resolveUrlFromIndex(e.value);console.log(t),this._viewer.loadIbl(t)})),n.addInput(this._renderer,"iblRotation",{label:"IBL Rotation",step:.1,min:-180,max:180}).on("change",(()=>{this._viewer.toggleInteractionMode(!0,100)})),n.addInput(this._renderer,"iblImportanceSampling",{label:"Importance Sampling"});const s=e.addFolder({title:"Integrator"});s.addInput(this._viewer,"togglePathtracing",{label:"Pathtracing"}),s.addInput(this._renderer,"debugMode",{label:"Debug Mode",options:r(this._renderer.debugModes)}),s.addInput(this._renderer,"maxBounces",{label:"Max Bounces",step:1,min:0,max:32}),s.addInput(this._renderer,"rayEps",{label:"Ray Offset",step:1e-5,min:0,max:10}),s.addInput(this._viewer,"tileRes",{label:"Tile Res",step:1,min:1,max:8}),s.addInput(this._renderer,"clampThreshold",{label:"Clamp Threshold",step:.1,min:0,max:100});const i=e.addFolder({title:"Display"});i.addInput(this._renderer,"exposure",{label:"Display Exposure",step:.01,min:0,max:10}),i.addInput(this._renderer,"tonemapping",{label:"Tonemapping",options:r(this._renderer.tonemappingModes)}),i.addInput(this._renderer,"enableGamma",{label:"Gamma"}),i.addInput(this._viewer,"pathtracedInteraction",{label:"Pathtraced Navigation"}),i.addInput(this._viewer,"pixelRatio",{label:"Pixel Ratio",step:.1,min:.1,max:1}),i.addInput(this._viewer,"interactionPixelRatio",{label:"Interaction Ratio",step:.1,min:.1,max:1}),i.addInput(this._renderer,"enableFxaa",{label:"Fxaa"});const o=e.addFolder({title:"Background"});i.addInput(this._renderer,"showBackground",{label:"Background from IBL"}),o.color={r:0,g:0,b:0},o.addInput(o,"color",{label:"Background Color",picker:"inline",expanded:!0}).on("change",(e=>{console.log(e.value),this._renderer.backgroundColor=[e.value.r/255,e.value.g/255,e.value.g/255,1]})),e.addMonitor(this._viewer,"fps",{label:"Fps",view:"graph",step:.1,min:0,max:10})}initMaterialSelector(e){const t=this._scene.materials,r=this._uiTabs.pages[1];for(let e of r.children)console.log("dispose",e),e.dispose();const n=[];for(let e=0;e<t.length;e++)n.push({text:t[e].name,value:e});const s={name:t[0].name};r.addInput(s,"name",{options:n}).on("change",(e=>{this.initMaterialParamUI(e.value)})),t.length>0&&this.initMaterialParamUI(n[0].value,e)}paneMatFolders={};initMaterialParamUI(e,t){const r=this._uiTabs.pages[1],n=this._scene.materials[e];for(let e in this.paneMatFolders)this.paneMatFolders[e].dispose();this.paneMatFolders={};const s={albedo:{r:255*n.albedo[0],g:255*n.albedo[1],b:255*n.albedo[2]},specularTint:{r:255*n.specularTint[0],g:255*n.specularTint[1],b:255*n.specularTint[2]},translucencyColor:{r:255*n.translucencyColor[0],g:255*n.translucencyColor[1],b:255*n.translucencyColor[2]},sheenColor:{r:255*n.sheenColor[0],g:255*n.sheenColor[1],b:255*n.sheenColor[2]},attenuationColor:{r:255*n.attenuationColor[0],g:255*n.attenuationColor[1],b:255*n.attenuationColor[2]}},i={emission:{x:n.emission[0],y:n.emission[1],z:n.emission[2]}},o={step:.01,min:0,max:1},a=r.addFolder({title:"Base"});this.paneMatFolders.base=a,a.addInput(s,"albedo").on("change",(e=>{n.albedo=[e.value.r/255,e.value.g/255,e.value.b/255]})),a.addInput(n,"roughness",o),a.addInput(n,"metallic",o),a.addInput(n,"specular",o),a.addInput(i,"emission",{x:{min:0,max:1e7,step:.1},y:{min:0,max:1e7,step:.1},z:{min:0,max:1e7,step:.1}}).on("change",(e=>{n.emission=[e.value.x,e.value.y,e.value.z]}));const l=r.addFolder({title:"Anisotropy"});this.paneMatFolders.anisotropy=l,l.addInput(n,"anisotropy",{step:.01,min:-1,max:1}),l.direction={x:n.anisotropyDirection[0],y:n.anisotropyDirection[1]},l.addInput(l,"direction",{picker:"inline",expanded:!0,x:{min:-1,max:1,step:.01},y:{min:-1,max:1,step:.01}}).on("change",(e=>{n.anisotropyDirection=[e.value.x,e.value.y]}));const c=r.addFolder({title:"Transmission"});this.paneMatFolders.transmission=c,c.addInput(n,"transparency",o),c.addInput(n,"cutoutOpacity",o),c.addInput(n,"translucency",{...o,label:"diffuse transmission"}),c.addInput(s,"translucencyColor",{...o,label:"diffuse transmission color"}).on("change",(e=>{n.translucencyColor=[e.value.r/255,e.value.g/255,e.value.b/255]}));const u=r.addFolder({title:"Sheen"});this.paneMatFolders.sheen=u,u.addInput(n,"sheenRoughness",o),u.addInput(s,"sheenColor").on("change",(e=>{n.sheenColor=[e.value.r/255,e.value.g/255,e.value.b/255]}));const h=r.addFolder({title:"Clearcoat"});this.paneMatFolders.clearcoat=h,h.addInput(n,"clearcoat",o),h.addInput(n,"clearcoatRoughness",o);const p=r.addFolder({title:"Volume"});this.paneMatFolders.volume=p,p.thinWalled=n.thinWalled>0,p.addInput(p,"thinWalled").on("change",(e=>{n.thinWalled=e.value?1:0})),p.addInput(n,"ior",{min:0,max:3,step:.01}),p.addInput(n,"attenuationDistance",{step:1e-5,min:0,max:1e6}),p.addInput(s,"attenuationColor").on("change",(e=>{n.attenuationColor=[e.value.r/255,e.value.g/255,e.value.b/255]}));const d=r.addFolder({title:"Iridescence"});if(this.paneMatFolders.iridescence=d,d.addInput(n,"iridescence",o),d.addInput(n,"iridescenceIOR",{min:0,max:3,step:.01}),d.addInput(n,"iridescenceThicknessMinimum",{min:10,max:1200,step:1}),d.addInput(n,"iridescenceThicknessMaximum",{min:10,max:1200,step:1}),t&&t.unfold){this._uiTabs.pages[1].selected=!0;for(let e in this.paneMatFolders)this.paneMatFolders[e].expanded=!1;const e=t.unfold.split(" "),r=Object.keys(this.paneMatFolders);for(let t in e)r.includes(e[t])&&(this.paneMatFolders[e[t]].expanded=!0)}}resolveUrlFromIndex(e){if(""==e)return"None";let t="";const r=e.replaceAll("%20"," ");if(r in Ko){const e=Ko[r];this.setSceneInfo(r,e.credit),t=e.url}if(r in Vo){const e=Vo[r];this.setIBLInfo(r,e.credit),t=e.url,this._renderer.exposure=e.intensity??1,this._renderer.iblRotation=e.rotation??180}return""!=t?t:e}setIBLInfo(e,t){document.getElementById("ibl-info").innerHTML=`IBL: ${e}`,t&&(document.getElementById("ibl-info").innerHTML+=` - ${t}`)}setSceneInfo(e,t){document.getElementById("scene-info").innerHTML=`Scene: ${e}`,t&&(document.getElementById("scene-info").innerHTML+=` - ${t}`)}};
//# sourceMappingURL=index.3f804a5f.js.map
